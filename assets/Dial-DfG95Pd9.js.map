{"version":3,"file":"Dial-DfG95Pd9.js","sources":["../../src/components/custom-widget-elements/Dial.vue"],"sourcesContent":["<template>\n  <div\n    id=\"dial\"\n    class=\"flex items-center w-auto\"\n    :style=\"{ justifyContent: miniWidget.options.layout?.align }\"\n    :class=\"\n      widgetStore.elementToShowOnDrawer?.hash === miniWidget.hash && widgetStore.editingMode\n        ? 'bg-[#00000010] '\n        : 'border-0'\n    \"\n    @click=\"widgetStore.editingMode && widgetStore.showElementPropsDrawer(miniWidget.hash)\"\n  >\n    <div class=\"flex flex-row\" :class=\"widgetStore.editingMode ? 'pointer-events-none' : 'pointer-events-auto'\">\n      <div class=\"potentiometer-container w-full\" :class=\"sizeClass\" @mousedown=\"startDrag\">\n        <div class=\"potentiometer-scale elevation-5\">\n          <div\n            class=\"potentiometer-knob\"\n            :style=\"{\n              transform: `rotate(${rotationAngle}deg)`,\n              background: miniWidget.options.layout?.knobColor || '#838383',\n            }\"\n          >\n            <div class=\"knob-notch\" :style=\"{ background: miniWidget.options.layout?.notchColor || '#222222' }\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div\n      v-if=\"miniWidget.options.layout?.showValue\"\n      class=\"value-display bg-[#FFFFFF22] border-[#FFFFFF44] border-[1px] rounded-md p-[2px] min-w-9 text-center elevation-1\"\n    >\n      {{ Math.round(potentiometerValue) || 0 }}\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, onUnmounted, ref, toRefs, watch } from 'vue'\n\nimport {\n  deleteDataLakeVariable,\n  listenDataLakeVariable,\n  setDataLakeVariableData,\n  unlistenDataLakeVariable,\n} from '@/libs/actions/data-lake'\nimport { useWidgetManagerStore } from '@/stores/widgetManager'\nimport { CustomWidgetElementOptions, CustomWidgetElementType } from '@/types/widgets'\n\nconst widgetStore = useWidgetManagerStore()\n\nconst props = defineProps<{\n  /**\n   * Element instance\n   */\n  miniWidget: CustomWidgetElementOptions[CustomWidgetElementType.Dial]\n}>()\n\nconst miniWidget = toRefs(props).miniWidget\n\nconst potentiometerValue = ref(0)\nconst rotationAngle = ref(-150)\nlet listenerId: string | undefined\n\nwatch(\n  () => widgetStore.miniWidgetManagerVars(miniWidget.value.hash).configMenuOpen,\n  (newValue) => {\n    if (newValue === true) {\n      widgetStore.showElementPropsDrawer(miniWidget.value.hash)\n      setTimeout(() => {\n        widgetStore.miniWidgetManagerVars(miniWidget.value.hash).configMenuOpen = false\n      }, 200)\n    }\n  },\n  { immediate: true, deep: true }\n)\n\nconst setDialValue = (value: number | string | undefined): void => {\n  let numValue: number\n  if (value === undefined || value === null || isNaN(Number(value))) {\n    numValue = miniWidget.value.options.layout?.minValue || 0\n  } else {\n    numValue = Number(value)\n  }\n\n  potentiometerValue.value = numValue\n\n  const rotationRange = 300\n  const valueRange = miniWidget.value.options.layout?.maxValue - miniWidget.value.options.layout?.minValue || 1\n  rotationAngle.value = ((numValue - miniWidget.value.options.layout?.minValue) / valueRange) * rotationRange - 150\n}\n\nonMounted(() => {\n  if (!miniWidget.value.options || Object.keys(miniWidget.value.options).length === 0) {\n    miniWidget.value.isCustomElement = true\n    widgetStore.updateElementOptions(miniWidget.value.hash, {\n      layout: {\n        minValue: 0,\n        maxValue: 100,\n        size: 'small',\n        showValue: true,\n        align: 'center',\n        knobColor: '#838383',\n        notchColor: '#303030aa',\n      },\n      variableType: 'number',\n      dataLakeVariable: undefined,\n    })\n  }\n  if (miniWidget.value.options.dataLakeVariable) {\n    listenerId = listenDataLakeVariable(miniWidget.value.options.dataLakeVariable?.name, (value) => {\n      setDialValue(value as number)\n    })\n    const initialValue = widgetStore.getMiniWidgetLastValue(miniWidget.value.hash)\n    setDialValue(initialValue)\n  }\n})\n\nconst sizeClass = computed(() => {\n  switch (miniWidget.value.options.layout?.size) {\n    case 'medium':\n      return 'potentiometer-medium'\n    case 'large':\n      return 'potentiometer-large'\n    default:\n      return 'potentiometer-small'\n  }\n})\n\nconst startDrag = (event: MouseEvent): void => {\n  event.preventDefault()\n\n  const target = event.currentTarget as HTMLElement\n  const rect = target.getBoundingClientRect()\n\n  const centerX = rect.left + rect.width / 2\n  const centerY = rect.top + rect.height / 2\n\n  const dxStart = event.clientX - centerX\n  const dyStart = event.clientY - centerY\n  const initialMouseAngle = Math.atan2(dyStart, dxStart) * (180 / Math.PI)\n\n  const initialRotationAngle = rotationAngle.value\n\n  const handleDrag = (moveEvent: MouseEvent): void => {\n    const dx = moveEvent.clientX - centerX\n    const dy = moveEvent.clientY - centerY\n\n    const currentMouseAngle = Math.atan2(dy, dx) * (180 / Math.PI)\n\n    let angleDifference = currentMouseAngle - initialMouseAngle\n\n    if (angleDifference > 180) {\n      angleDifference -= 360\n    } else if (angleDifference < -180) {\n      angleDifference += 360\n    }\n\n    let newRotationAngle = initialRotationAngle + angleDifference\n\n    newRotationAngle = Math.max(-150, Math.min(150, newRotationAngle))\n\n    rotationAngle.value = newRotationAngle\n\n    const rotationRange = 300\n    const valueRange = miniWidget.value.options.layout?.maxValue - miniWidget.value.options.layout?.minValue || 1\n    potentiometerValue.value =\n      ((newRotationAngle + 150) / rotationRange) * valueRange + miniWidget.value.options.layout?.minValue\n\n    if (miniWidget.value.options.dataLakeVariable) {\n      if (widgetStore.editingMode) return\n      widgetStore.setMiniWidgetLastValue(miniWidget.value.hash, Math.round(potentiometerValue.value))\n      setDataLakeVariableData(miniWidget.value.options.dataLakeVariable.name, Math.round(potentiometerValue.value))\n    }\n  }\n\n  const stopDrag = (): void => {\n    document.removeEventListener('mousemove', handleDrag)\n    document.removeEventListener('mouseup', stopDrag)\n  }\n\n  document.addEventListener('mousemove', handleDrag)\n  document.addEventListener('mouseup', stopDrag)\n}\n\nonUnmounted(() => {\n  if (miniWidget.value.options.dataLakeVariable) {\n    deleteDataLakeVariable(miniWidget.value.options.dataLakeVariable.id)\n    if (listenerId) {\n      unlistenDataLakeVariable(miniWidget.value.options.dataLakeVariable.name, listenerId)\n    }\n  }\n})\n</script>\n\n<style scoped>\n.potentiometer-container {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  user-select: none;\n}\n\n.potentiometer-small {\n  width: 50px;\n  height: 50px;\n}\n\n.potentiometer-medium {\n  width: 75px;\n  height: 75px;\n}\n\n.potentiometer-large {\n  width: 120px;\n  height: 120px;\n}\n\n.potentiometer-scale {\n  width: 80%;\n  height: 80%;\n  background-size: contain;\n  background-repeat: no-repeat;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  position: relative;\n}\n\n.potentiometer-knob {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  position: relative;\n  cursor: pointer;\n}\n\n.knob-notch {\n  position: absolute;\n  top: 10%;\n  left: 50%;\n  width: 15%;\n  height: 15%;\n  border-radius: 50%;\n  transform: translateX(-50%);\n}\n\n.value-display {\n  font-size: 14px;\n  color: white;\n  margin-left: 8px;\n}\n</style>\n"],"names":["widgetStore","useWidgetManagerStore","miniWidget","toRefs","__props","potentiometerValue","ref","rotationAngle","listenerId","watch","newValue","setDialValue","value","numValue","_a","rotationRange","valueRange","_b","_c","_d","onMounted","listenDataLakeVariable","initialValue","sizeClass","computed","startDrag","event","rect","centerX","centerY","dxStart","dyStart","initialMouseAngle","initialRotationAngle","handleDrag","moveEvent","dx","dy","angleDifference","newRotationAngle","setDataLakeVariableData","stopDrag","onUnmounted","deleteDataLakeVariable","unlistenDataLakeVariable"],"mappings":"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"}