{"version":3,"file":"IFrame-KjsfIDji.js","sources":["../../src/components/widgets/IFrame.vue"],"sourcesContent":["<template>\n  <div class=\"w-full h-full\">\n    <teleport to=\".widgets-view\">\n      <iframe\n        v-show=\"iframe_loaded\"\n        :src=\"widget.options.source\"\n        :style=\"iframeStyle\"\n        frameborder=\"0\"\n        @load=\"loadFinished\"\n      />\n    </teleport>\n    <v-dialog v-model=\"widgetStore.widgetManagerVars(widget.hash).configMenuOpen\" min-width=\"400\" max-width=\"35%\">\n      <v-card class=\"pa-2\" :style=\"interfaceStore.globalGlassMenuStyles\">\n        <v-card-title class=\"text-center\">Settings</v-card-title>\n        <v-card-text>\n          <p>Iframe Source</p>\n          <div class=\"flex items-center justify-between\">\n            <v-text-field\n              v-model=\"inputURL\"\n              variant=\"filled\"\n              outlined\n              :rules=\"[validateURL]\"\n              @keydown.enter=\"updateURL\"\n            />\n            <v-btn\n              v-tooltip.bottom=\"'Set'\"\n              icon=\"mdi-check\"\n              class=\"mx-1 mb-5 bg-[#FFFFFF22]\"\n              rounded=\"lg\"\n              flat\n              @click=\"updateURL\"\n            />\n          </div>\n        </v-card-text>\n        <v-card-text>\n          <v-slider v-model=\"transparency\" label=\"Transparency\" color=\"white\" :min=\"0\" :max=\"90\" />\n        </v-card-text>\n        <v-card-actions class=\"flex justify-end\">\n          <v-btn color=\"white\" @click=\"widgetStore.widgetManagerVars(widget.hash).configMenuOpen = false\">\n            Close\n          </v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n  <Snackbar\n    :open-snackbar=\"openSnackbar\"\n    :message=\"snackbarMessage\"\n    :duration=\"3000\"\n    :close-button=\"false\"\n    @update:open-snackbar=\"openSnackbar = $event\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { useWindowSize } from '@vueuse/core'\nimport { computed, defineProps, onBeforeMount, ref, toRefs, watch } from 'vue'\n\nimport { defaultBlueOsAddress } from '@/assets/defaults'\nimport Snackbar from '@/components/Snackbar.vue'\nimport { isValidURL } from '@/libs/utils'\nimport { useAppInterfaceStore } from '@/stores/appInterface'\nimport { useWidgetManagerStore } from '@/stores/widgetManager'\nimport type { Widget } from '@/types/widgets'\nconst interfaceStore = useAppInterfaceStore()\n\nconst widgetStore = useWidgetManagerStore()\n\nconst props = defineProps<{\n  /**\n   * Widget reference\n   */\n  widget: Widget\n}>()\nconst widget = toRefs(props).widget\n\nconst iframe_loaded = ref(false)\nconst transparency = ref(0)\nconst inputURL = ref(widget.value.options.source)\nconst openSnackbar = ref(false)\nconst snackbarMessage = ref('')\n\nconst validateURL = (url: string): true | string => {\n  return isValidURL(url) ? true : 'URL is not valid.'\n}\n\nconst updateURL = (): void => {\n  const urlValidationResult = validateURL(inputURL.value)\n  if (urlValidationResult !== true) {\n    snackbarMessage.value = `${urlValidationResult} Please enter a valid URL.`\n    openSnackbar.value = true\n    return\n  }\n  widget.value.options.source = inputURL.value\n  snackbarMessage.value = `IFrame URL sucessfully updated to '${inputURL.value}'.`\n  openSnackbar.value = true\n}\n\nonBeforeMount(() => {\n  if (Object.keys(widget.value.options).length !== 0) {\n    return\n  }\n\n  widget.value.options = {\n    source: defaultBlueOsAddress,\n  }\n  inputURL.value = defaultBlueOsAddress\n})\n\nconst { width: windowWidth, height: windowHeight } = useWindowSize()\n\nconst iframeStyle = computed<string>(() => {\n  let newStyle = ''\n\n  newStyle = newStyle.concat(' ', 'position: absolute;')\n  newStyle = newStyle.concat(' ', `left: ${widget.value.position.x * windowWidth.value}px;`)\n  newStyle = newStyle.concat(' ', `top: ${widget.value.position.y * windowHeight.value}px;`)\n  newStyle = newStyle.concat(' ', `width: ${widget.value.size.width * windowWidth.value}px;`)\n  newStyle = newStyle.concat(' ', `height: ${widget.value.size.height * windowHeight.value}px;`)\n\n  if (widgetStore.editingMode) {\n    newStyle = newStyle.concat(' ', 'pointer-events:none; border:0;')\n  }\n\n  if (!widgetStore.isWidgetVisible(widget.value)) {\n    newStyle = newStyle.concat(' ', 'display: none;')\n  }\n\n  return newStyle\n})\n\nconst iframeOpacity = computed<number>(() => {\n  return (100 - transparency.value) / 100\n})\n\n/**\n * Called when iframe finishes loading\n */\nfunction loadFinished(): void {\n  console.log('Finished loading')\n  iframe_loaded.value = true\n}\n\nwatch(\n  widget,\n  () => {\n    if (widgetStore.widgetManagerVars(widget.value.hash).configMenuOpen === false) {\n      if (validateURL(inputURL.value) !== true) {\n        inputURL.value = widget.value.options.source\n      }\n    }\n  },\n  { deep: true }\n)\n</script>\n\n<style scoped>\niframe {\n  width: 100%;\n  height: 100%;\n  border: none;\n  flex-grow: 1;\n  margin: 0;\n  padding: 0;\n  opacity: calc(v-bind('iframeOpacity'));\n}\n</style>\n"],"names":["interfaceStore","useAppInterfaceStore","widgetStore","useWidgetManagerStore","widget","toRefs","__props","iframe_loaded","ref","transparency","inputURL","openSnackbar","snackbarMessage","validateURL","url","isValidURL","updateURL","urlValidationResult","onBeforeMount","defaultBlueOsAddress","windowWidth","windowHeight","useWindowSize","iframeStyle","computed","newStyle","iframeOpacity","loadFinished","watch"],"mappings":"8wBAgEA,MAAMA,EAAiBC,IAEjBC,EAAcC,IAQdC,EAASC,EANDC,CAMa,EAAE,OAEvBC,EAAgBC,EAAI,EAAK,EACzBC,EAAeD,EAAI,CAAC,EACpBE,EAAWF,EAAIJ,EAAO,MAAM,QAAQ,MAAM,EAC1CO,EAAeH,EAAI,EAAK,EACxBI,EAAkBJ,EAAI,EAAE,EAExBK,EAAeC,GACZC,GAAWD,CAAG,EAAI,GAAO,oBAG5BE,EAAY,IAAY,CACtB,MAAAC,EAAsBJ,EAAYH,EAAS,KAAK,EACtD,GAAIO,IAAwB,GAAM,CAChBL,EAAA,MAAQ,GAAGK,CAAmB,6BAC9CN,EAAa,MAAQ,GACrB,MACF,CACOP,EAAA,MAAM,QAAQ,OAASM,EAAS,MACvBE,EAAA,MAAQ,sCAAsCF,EAAS,KAAK,KAC5EC,EAAa,MAAQ,EAAA,EAGvBO,EAAc,IAAM,CACd,OAAO,KAAKd,EAAO,MAAM,OAAO,EAAE,SAAW,IAIjDA,EAAO,MAAM,QAAU,CACrB,OAAQe,CAAA,EAEVT,EAAS,MAAQS,EAAA,CAClB,EAED,KAAM,CAAE,MAAOC,EAAa,OAAQC,CAAA,EAAiBC,IAE/CC,EAAcC,EAAiB,IAAM,CACzC,IAAIC,EAAW,GAEJ,OAAAA,EAAAA,EAAS,OAAO,IAAK,qBAAqB,EAC1CA,EAAAA,EAAS,OAAO,IAAK,SAASrB,EAAO,MAAM,SAAS,EAAIgB,EAAY,KAAK,KAAK,EAC9EK,EAAAA,EAAS,OAAO,IAAK,QAAQrB,EAAO,MAAM,SAAS,EAAIiB,EAAa,KAAK,KAAK,EAC9EI,EAAAA,EAAS,OAAO,IAAK,UAAUrB,EAAO,MAAM,KAAK,MAAQgB,EAAY,KAAK,KAAK,EAC/EK,EAAAA,EAAS,OAAO,IAAK,WAAWrB,EAAO,MAAM,KAAK,OAASiB,EAAa,KAAK,KAAK,EAEzFnB,EAAY,cACHuB,EAAAA,EAAS,OAAO,IAAK,gCAAgC,GAG7DvB,EAAY,gBAAgBE,EAAO,KAAK,IAChCqB,EAAAA,EAAS,OAAO,IAAK,gBAAgB,GAG3CA,CAAA,CACR,EAEKC,EAAgBF,EAAiB,KAC7B,IAAMf,EAAa,OAAS,GACrC,EAKD,SAASkB,GAAqB,CAC5B,QAAQ,IAAI,kBAAkB,EAC9BpB,EAAc,MAAQ,EACxB,CAEA,OAAAqB,EACExB,EACA,IAAM,CACAF,EAAY,kBAAkBE,EAAO,MAAM,IAAI,EAAE,iBAAmB,IAClES,EAAYH,EAAS,KAAK,IAAM,KACzBA,EAAA,MAAQN,EAAO,MAAM,QAAQ,OAG5C,EACA,CAAE,KAAM,EAAK,CAAA"}