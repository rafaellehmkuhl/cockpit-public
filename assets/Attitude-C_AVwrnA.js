import{c as te,J as ae,K as oe,M as B,Y as U,u as le,I as se,r as V,at as ie,L as ne,o as re,au as de,k as j,av as k,w as g,aw as x,ax as ue,ay as ce,az as C,an as M,aA as he,l as ve,m as pe,n as O,G as i,N as h,V as ge,O as fe,q as o,P as me,Q as G,R as we,a4 as E,aB as Y,aC as be,W as Ve,F as xe,_ as Ce}from"./index-DOL2xD4N.js";import{g as T}from"./index-C5ZFbjcW.js";import{V as Fe,a as Te,b as De,c as Pe}from"./VExpansionPanels-QpuAERFY.js";(function(){try{var v=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new v.Error().stack;f&&(v._sentryDebugIds=v._sentryDebugIds||{},v._sentryDebugIds[f]="bad4c89b-433b-45f5-b596-189d9f1ef4d8",v._sentryDebugIdIdentifier="sentry-dbid-bad4c89b-433b-45f5-b596-189d9f1ef4d8")}catch{}})();const Se={class:"main"},Ae=["width","height"],ye={class:"flex justify-center gap-x-8 mb-4"},Re=te({__name:"Attitude",props:{widget:{}},setup(v){const f=ae(),N=oe();B.registerUsage(U.roll),B.registerUsage(U.pitch);const m=le(),a=se(v).widget,F=V(),S=V(),D=V(0),P=V(0),w=V(void 0),A=[-90,-70,-45,-30,-10,0,10,30,45,70,90],s=ie({rollDegrees:0,pitchLinesHeights:{},cameraTiltDeg:0,pitchDegrees:0}),W=V([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),q={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,hudColor:W.value[0][0],cameraFOV:64};ne(()=>{Object.entries(q).forEach(([e,t])=>{a.value.options[e]===void 0&&(a.value.options[e]=t)})}),re(()=>{A.forEach(e=>s.pitchLinesHeights[e]=5*e),R()});const{width:J,height:K}=de(),r=j(()=>({width:a.value.size.width*J.value,height:a.value.size.height*K.value})),n=j(()=>k(a.value.options.desiredAimRadius,35,.2*r.value.width));let z,H;g(m.attitude,e=>{const t=Math.abs(x(e.roll-(z||0))),l=Math.abs(x(e.pitch-(H||0)));t>.1&&(z=e.roll,D.value=x(m.attitude.roll)),l>.1&&(H=e.pitch,P.value=x(m.attitude.pitch))}),g(m.genericVariables,e=>{const t=e.cameraTiltDeg;(w.value===void 0||Math.abs(t-w.value)>.1)&&(w.value=t)});const y=e=>{const t=180/a.value.options.cameraFOV;return e/180*t*r.value.height},Q=ue(F);g(Q,(e,t)=>{e&&!t&&R()});const R=()=>{if(F.value===void 0||F.value===null)return;if(S.value===void 0){console.debug("Canvas context undefined!"),S.value=F.value.getContext("2d");return}const e=S.value;ce(e);const t=.5*r.value.width,l=.5*r.value.height,I=12,L=22,b=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${I}px Arial`,e.fillStyle="white";const u=2*n.value;e.translate(t,l),e.rotate(C(s.rollDegrees));let p=0;w.value!==void 0&&(p=-y(s.cameraTiltDeg+s.pitchDegrees));for(const[c,d]of Object.entries(s.pitchLinesHeights)){e.beginPath();const X=Number(c)===0?1:.7,Z=Number(c)===0?[]:[5,2],ee=Number(c)===0?3:2;if(e.lineWidth=ee,e.setLineDash(Z),a.value.options.showPitchLines){const $=u+X*(t-u);e.moveTo(-$+b,d),e.lineTo(-u,d),e.lineTo(-u+5,d+15),e.fillText(Number(c),-u-4*b,d-3*b),e.moveTo(+$-b,d),e.lineTo(u,d),e.lineTo(u-5,d+15),e.fillText(Number(c),u+4*b,d-3*b),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${L}px Arial`,a.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-n.value,p),e.lineTo(-1.5*n.value,p),e.stroke(),e.beginPath(),e.arc(0,p,n.value,C(135),C(225)),e.stroke(),e.beginPath(),e.moveTo(n.value,p),e.lineTo(1.5*n.value,p),e.stroke(),e.beginPath(),e.arc(0,p,n.value,C(-45),C(45)),e.stroke()),a.value.options.showRollPitchValues){const c=`r: ${Number(D.value).toFixed(2)}`,d=`p: ${Number(P.value).toFixed(2)}`;e.rotate(C(-s.rollDegrees)),n.value<200?(e.fillText(c,0,k(-1.5*n.value,-.8*l,0)),e.fillText(d,0,k(1.5*n.value,0,.8*l))):(e.textAlign="start",e.fillText(c,-n.value+L,-30),e.fillText(d,-n.value+L,30)),e.stroke()}e.translate(-t,-l),e.globalCompositeOperation="source-in";const _=e.createLinearGradient(0,0,r.value.width,r.value.height);_.addColorStop(0,a.value.options.hudColor),_.addColorStop(1,a.value.options.hudColor),e.fillStyle=_,e.fillRect(0,0,r.value.width,r.value.height)};return g(P,()=>{A.forEach(e=>{const t=-M(y(e+s.cameraTiltDeg-x(m.attitude.pitch)),2);T.to(s.pitchLinesHeights,.1,{[e]:t})}),T.to(s,.1,{pitchDegrees:P.value})}),g(D,()=>{T.to(s,.1,{rollDegrees:-M(D.value,2)})}),g(w,()=>{T.to(s,.1,{cameraTiltDeg:w.value}),A.forEach(e=>{const t=-M(y(e+s.cameraTiltDeg-x(m.attitude.pitch)),2);T.to(s.pitchLinesHeights,.1,{[e]:t})})}),g([s,r,a.value.options],()=>{f.isWidgetVisible(a.value)&&he(()=>R())}),(e,t)=>(ve(),pe(xe,null,[O("div",Se,[O("canvas",{ref_key:"canvasRef",ref:F,width:r.value.width,height:r.value.height},null,8,Ae)]),i(Ve,{modelValue:o(f).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=l=>o(f).widgetManagerVars(o(a).hash).configMenuOpen=l),"min-width":"400","max-width":"45%"},{default:h(()=>[i(ge,{class:"pa-4",style:fe([o(N).globalGlassMenuStyles,{"border-radius":"15px"}])},{default:h(()=>[i(me,{class:"text-center"},{default:h(()=>t[7]||(t[7]=[G("Attitude widget config")])),_:1}),i(we,null,{default:h(()=>[O("div",ye,[i(E,{class:"ma-1",label:"Show roll/pitch values","model-value":o(a).options.showRollPitchValues,color:o(a).options.showRollPitchValues?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=l=>o(a).options.showRollPitchValues=!o(a).options.showRollPitchValues)},null,8,["model-value","color"]),i(E,{class:"ma-1",label:"Show center aim","model-value":o(a).options.showCenterAim,color:o(a).options.showCenterAim?"white":void 0,"hide-details":"",onChange:t[1]||(t[1]=l=>o(a).options.showCenterAim=!o(a).options.showCenterAim)},null,8,["model-value","color"]),i(E,{class:"ma-1",label:"Show pitch lines","model-value":o(a).options.showPitchLines,color:o(a).options.showPitchLines?"white":void 0,"hide-details":"",onChange:t[2]||(t[2]=l=>o(a).options.showPitchLines=!o(a).options.showPitchLines)},null,8,["model-value","color"])]),i(Y,{modelValue:o(a).options.cameraFOV,"onUpdate:modelValue":t[3]||(t[3]=l=>o(a).options.cameraFOV=l),color:"white",label:"Camera vertical FOV",min:20,max:180,"thumb-label":""},null,8,["modelValue"]),i(Y,{modelValue:o(a).options.desiredAimRadius,"onUpdate:modelValue":t[4]||(t[4]=l=>o(a).options.desiredAimRadius=l),label:"Center circle radius",color:"white",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),i(Fe,{theme:"dark"},{default:h(()=>[i(Te,{class:"bg-[#FFFFFF22]"},{default:h(()=>[i(De,null,{default:h(()=>t[8]||(t[8]=[G("Color")])),_:1}),i(Pe,{class:"pa-2"},{default:h(()=>[i(be,{modelValue:o(a).options.hudColor,"onUpdate:modelValue":t[5]||(t[5]=l=>o(a).options.hudColor=l),class:"ma-1 bg-[#FFFFFF11] text-white",swatches:W.value,"show-swatches":"",width:"100%"},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Oe=Ce(Re,[["__scopeId","data-v-64737875"]]);export{Oe as default};
//# sourceMappingURL=Attitude-C_AVwrnA.js.map
