import{ba as se,bb as ie,h as F,cb as ue,bs as de,bh as re,cc as D,c8 as H,c as Te,e as Ue,t as Ye,r as T,W as Ie,o as Fe,aN as $e,aH as De,aM as je,j as Oe,cd as Ae,w as U,ag as Ee,aU as Be,aY as Re,a_ as We,aX as ze,m as z,n as G,q as s,z as n,p as r,E as f,V as Ge,G as He,a1 as C,as as Ke,a0 as b,af as Z,a$ as ee,P as te,x as le,J as _e,F as Je,ac as ae,_ as qe}from"./index-nLl2A2Om.js";const me=D.reduce((o,d)=>(o[d]={type:[Boolean,String,Number],default:!1},o),{}),fe=D.reduce((o,d)=>{const u="offset"+H(d);return o[u]={type:[String,Number],default:null},o},{}),pe=D.reduce((o,d)=>{const u="order"+H(d);return o[u]={type:[String,Number],default:null},o},{}),oe={col:Object.keys(me),offset:Object.keys(fe),order:Object.keys(pe)};function Xe(o,d,u){let e=o;if(!(u==null||u===!1)){if(d){const i=d.replace(o,"");e+=`-${i}`}return o==="col"&&(e="v-"+e),o==="col"&&(u===""||u===!0)||(e+=`-${u}`),e.toLowerCase()}}const Qe=["auto","start","end","center","baseline","stretch"],Ze=ie({cols:{type:[Boolean,String,Number],default:!1},...me,offset:{type:[String,Number],default:null},...fe,order:{type:[String,Number],default:null},...pe,alignSelf:{type:String,default:null,validator:o=>Qe.includes(o)},...re(),...de()},"VCol"),Y=se()({name:"VCol",props:Ze(),setup(o,d){let{slots:u}=d;const e=F(()=>{const i=[];let p;for(p in oe)oe[p].forEach(h=>{const x=o[h],c=Xe(p,h,x);c&&i.push(c)});const V=i.some(h=>h.startsWith("v-col-"));return i.push({"v-col":!V||!o.cols,[`v-col-${o.cols}`]:o.cols,[`offset-${o.offset}`]:o.offset,[`order-${o.order}`]:o.order,[`align-self-${o.alignSelf}`]:o.alignSelf}),i});return()=>{var i;return ue(o.tag,{class:[e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),K=["start","end","center"],ce=["space-between","space-around","space-evenly"];function _(o,d){return D.reduce((u,e)=>{const i=o+H(e);return u[i]=d(),u},{})}const et=[...K,"baseline","stretch"],ve=o=>et.includes(o),be=_("align",()=>({type:String,default:null,validator:ve})),tt=[...K,...ce],ge=o=>tt.includes(o),Ve=_("justify",()=>({type:String,default:null,validator:ge})),lt=[...K,...ce,"stretch"],he=o=>lt.includes(o),xe=_("alignContent",()=>({type:String,default:null,validator:he})),ne={align:Object.keys(be),justify:Object.keys(Ve),alignContent:Object.keys(xe)},at={align:"align",justify:"justify",alignContent:"align-content"};function ot(o,d,u){let e=at[o];if(u!=null){if(d){const i=d.replace(o,"");e+=`-${i}`}return e+=`-${u}`,e.toLowerCase()}}const nt=ie({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ve},...be,justify:{type:String,default:null,validator:ge},...Ve,alignContent:{type:String,default:null,validator:he},...xe,...re(),...de()},"VRow"),I=se()({name:"VRow",props:nt(),setup(o,d){let{slots:u}=d;const e=F(()=>{const i=[];let p;for(p in ne)ne[p].forEach(V=>{const h=o[V],x=ot(p,V,h);x&&i.push(x)});return i.push({"v-row--no-gutters":o.noGutters,"v-row--dense":o.dense,[`align-${o.align}`]:o.align,[`justify-${o.justify}`]:o.justify,[`align-content-${o.alignContent}`]:o.alignContent}),i});return()=>{var i;return ue(o.tag,{class:["v-row",e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),st={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},it={key:1,class:"main"},ut=["width","height"],dt={class:"ml-2"},rt={class:"ml-2 flex gap-x-8"},mt={class:"ml-2 flex gap-x-8"},ft={class:"ml-2"},pt={class:"ml-2 flex flex-wrap gap-x-6"},ct={class:"ml-2 flex gap-x-8 mb-4"},vt={class:"flex flex-col"},bt={class:"flex flex-col"},gt={class:"flex w-full justify-end my-2"},Vt=Te({__name:"Plotter",props:{widget:{}},setup(o){const d=Ue(),e=Ye(o).widget,i=T([]);let p,V;Ie(()=>{const a={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0,useFixedMinY:!1,useFixedMaxY:!1,fixedMinY:0,fixedMaxY:100,showCurrent:!0,showMin:!0,showMax:!0,showAvg:!0,showMedian:!0};e.value.options={...a,...e.value.options}}),Fe(()=>{if(j(e.value.options.dataLakeVariableId),i.value=Object.values($e()),V=De(a=>{i.value=Object.values(a)}),m.length===0){const a=je(e.value.options.dataLakeVariableId);a&&q(a)}}),Oe(()=>{V&&Ae(V),p&&ae(e.value.options.dataLakeVariableId,p)});const h=F(()=>i.value.filter(a=>a.type==="number")),x=T(""),c=T(!1);U(()=>e.value.options.dataLakeVariableId,()=>c.value=!1);const we=F(()=>{const a=(x.value||"").toLowerCase();return h.value.filter(t=>t.name.toLowerCase().includes(a))}),J=()=>{e.value.options.limitSamples&&(m.length===e.value.options.maxSamples+1?m.shift():m.length>e.value.options.maxSamples&&m.splice(0,m.length-e.value.options.maxSamples))},q=a=>{m.push(a),J(),A()},j=(a,t)=>{if(a===void 0){console.error("No data lake variable ID provided!");return}t!==void 0&&p&&ae(t,p),p=Ee(a,l=>q(l),{notifyOnTimestampChange:e.value.options.updateOnConstantValue})};U(()=>e.value.options.dataLakeVariableId,(a,t)=>{j(a,t),m.length=0}),U(()=>e.value.options.updateOnConstantValue,()=>{const a=e.value.options.dataLakeVariableId;a&&j(a,a)});const{width:ke,height:ye}=Be(),S=F(()=>({width:e.value.size.width*ke.value,height:e.value.size.height*ye.value})),L=T(),O=T(),M=(a,t,l,v)=>{const w=a.measureText(t),k=4;a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(l-k,v-16-k,w.width+k*2,16+k*2),a.fillStyle=e.value.options.lineColor,a.fillText(t,l,v)},A=()=>{if(L.value===void 0||L.value===null)return;if(O.value===void 0){console.debug("Canvas context undefined!"),O.value=L.value.getContext("2d");return}const a=O.value,t=S.value.width,l=S.value.height;Re(a),a.clearRect(0,0,t,l),a.fillStyle=e.value.options.backgroundColor,a.fillRect(0,0,t,l),a.strokeStyle=e.value.options.lineColor,a.lineWidth=Math.max(e.value.options.lineThickness,1);try{E=Math.max(...m),B=Math.min(...m),X=Me(m),Q=Ce(m);const v=e.value.options.useFixedMinY?e.value.options.fixedMinY:B,w=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:E,k=.05*(w!=v?w-v:1),P=e.value.options.useFixedMinY?e.value.options.fixedMinY:v-k,R=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:w+k,Le=m[m.length-1];if(P<=0&&R>=0){const y=l-(0-P)/(R-P)*l;a.beginPath(),a.setLineDash([5,5]),a.strokeStyle="rgba(255, 255, 255, 0.3)",a.lineWidth=1,a.moveTo(0,y),a.lineTo(t,y),a.stroke(),a.strokeStyle=e.value.options.lineColor,a.lineWidth=Math.max(e.value.options.lineThickness,1)}if(a.beginPath(),a.moveTo(0,l/2),a.setLineDash([]),m.length===0?(a.beginPath(),a.arc(0,l/2,7,0,2*Math.PI),a.stroke()):m.length===1?(a.fillStyle=e.value.options.lineColor,a.beginPath(),a.arc(0,l/2,7,0,2*Math.PI),a.fill(),a.beginPath(),a.setLineDash([5,5]),a.moveTo(0,l/2),a.lineTo(50,l/2),a.stroke()):(a.setLineDash([]),m.forEach((y,W)=>{const Pe=W*(t/m.length),Ne=l-(y-P)/(R-P)*l;a.lineTo(Pe,Ne)})),a.stroke(),a.font="14px monospace",a.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const y=i.value.find(W=>W.id===e.value.options.dataLakeVariableId);y&&(M(a,y.name,10,26),a.textBaseline="bottom")}const N=e.value.options.decimalPlaces,$=20;let g=10;e.value.options.showCurrent&&(M(a,`Current: ${Number(Le).toFixed(N)}`,10,l-g),g+=$),e.value.options.showMin&&(M(a,`Min: ${Number(B).toFixed(N)}`,10,l-g),g+=$),e.value.options.showMax&&(M(a,`Max: ${Number(E).toFixed(N)}`,10,l-g),g+=$),e.value.options.showAvg&&(M(a,`Avg: ${Number(Q).toFixed(N)}`,10,l-g),g+=$),e.value.options.showMedian&&M(a,`Median: ${Number(X).toFixed(N)}`,10,l-g)}catch(v){console.error("Error drawing graph:",v)}},m=[];let E=0,B=0,X=0,Q=0;const Me=a=>{if(a.length===0)return 0;if(a.length===1)return a[0];const t=[...a].sort((v,w)=>v-w),l=Math.floor(t.length/2);return t.length%2===0?(t[l-1]+t[l])/2:t[l]},Ce=a=>a.length===0?0:a.reduce((t,l)=>t+l,0)/a.length;U([S,e],()=>{d.isWidgetVisible(e.value)&&(J(),We(()=>A()))},{deep:!0});const Se=ze(L);return U(Se,(a,t)=>{a&&!t&&A()}),(a,t)=>(G(),z(Je,null,[n(e).options.dataLakeVariableId?(G(),z("div",it,[r("canvas",{ref_key:"canvasRef",ref:L,width:S.value.width,height:S.value.height},null,8,ut)])):(G(),z("p",st," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),s(_e,{modelValue:n(d).widgetManagerVars(n(e).hash).configMenuOpen,"onUpdate:modelValue":t[24]||(t[24]=l=>n(d).widgetManagerVars(n(e).hash).configMenuOpen=l),title:"Plotter config",variant:"text-only"},{content:f(()=>[s(I,null,{default:f(()=>[s(Y,{cols:"12"},{default:f(()=>[t[25]||(t[25]=r("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),r("div",dt,[s(C,{modelValue:x.value,"onUpdate:modelValue":[t[0]||(t[0]=l=>x.value=l),t[1]||(t[1]=l=>c.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":t[2]||(t[2]=l=>c.value=!1),"onUpdate:focused":t[3]||(t[3]=l=>c.value=l)},null,8,["modelValue"]),s(Ke,{modelValue:n(e).options.dataLakeVariableId,"onUpdate:modelValue":t[4]||(t[4]=l=>n(e).options.dataLakeVariableId=l),items:we.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:c.value},onClick:t[5]||(t[5]=l=>c.value=!c.value)},null,8,["modelValue","items","menu-props"])])]),_:1,__:[25]})]),_:1}),s(I,null,{default:f(()=>[s(Y,{cols:"12"},{default:f(()=>[t[28]||(t[28]=r("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),r("div",rt,[s(b,{modelValue:n(e).options.showTitle,"onUpdate:modelValue":t[6]||(t[6]=l=>n(e).options.showTitle=l),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(Z,{"close-on-content-click":!1},{activator:f(({props:l})=>[r("div",te(l,{class:"flex cursor-pointer"}),[t[26]||(t[26]=r("span",{class:"mt-3"},"Background color",-1)),r("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:le({backgroundColor:n(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[s(ee,{modelValue:n(e).options.backgroundColor,"onUpdate:modelValue":t[7]||(t[7]=l=>n(e).options.backgroundColor=l),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(Z,{"close-on-content-click":!1},{activator:f(({props:l})=>[r("div",te(l,{class:"flex cursor-pointer"}),[t[27]||(t[27]=r("span",{class:"mt-3"},"Line color",-1)),r("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:le({backgroundColor:n(e).options.lineColor})},null,4)],16)]),default:f(()=>[s(ee,{modelValue:n(e).options.lineColor,"onUpdate:modelValue":t[8]||(t[8]=l=>n(e).options.lineColor=l),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(C,{modelValue:n(e).options.lineThickness,"onUpdate:modelValue":t[9]||(t[9]=l=>n(e).options.lineThickness=l),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[l=>l>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1,__:[28]})]),_:1}),s(I,null,{default:f(()=>[s(Y,{cols:"12"},{default:f(()=>[t[29]||(t[29]=r("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),r("div",mt,[s(C,{modelValue:n(e).options.decimalPlaces,"onUpdate:modelValue":t[10]||(t[10]=l=>n(e).options.decimalPlaces=l),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[l=>l>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),s(b,{modelValue:n(e).options.limitSamples,"onUpdate:modelValue":t[11]||(t[11]=l=>n(e).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),s(C,{modelValue:n(e).options.maxSamples,"onUpdate:modelValue":t[12]||(t[12]=l=>n(e).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!n(e).options.limitSamples,rules:[l=>l>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])]),r("div",ft,[s(b,{modelValue:n(e).options.updateOnConstantValue,"onUpdate:modelValue":t[13]||(t[13]=l=>n(e).options.updateOnConstantValue=l),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1,__:[29]})]),_:1}),s(I,null,{default:f(()=>[s(Y,{cols:"12"},{default:f(()=>[t[30]||(t[30]=r("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Statistics Display",-1)),r("div",pt,[s(b,{modelValue:n(e).options.showCurrent,"onUpdate:modelValue":t[14]||(t[14]=l=>n(e).options.showCurrent=l),label:"Current","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(b,{modelValue:n(e).options.showMin,"onUpdate:modelValue":t[15]||(t[15]=l=>n(e).options.showMin=l),label:"Min","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(b,{modelValue:n(e).options.showMax,"onUpdate:modelValue":t[16]||(t[16]=l=>n(e).options.showMax=l),label:"Max","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(b,{modelValue:n(e).options.showAvg,"onUpdate:modelValue":t[17]||(t[17]=l=>n(e).options.showAvg=l),label:"Avg","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(b,{modelValue:n(e).options.showMedian,"onUpdate:modelValue":t[18]||(t[18]=l=>n(e).options.showMedian=l),label:"Median","hide-details":"",class:"-mt-1"},null,8,["modelValue"])])]),_:1,__:[30]})]),_:1}),s(I,null,{default:f(()=>[s(Y,{cols:"12"},{default:f(()=>[t[31]||(t[31]=r("div",{class:"text-subtitle-1 font-weight-medium"},"Y-Axis Bounds",-1)),r("div",ct,[r("div",vt,[s(b,{modelValue:n(e).options.useFixedMinY,"onUpdate:modelValue":t[19]||(t[19]=l=>n(e).options.useFixedMinY=l),label:"Fixed minimum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(C,{modelValue:n(e).options.fixedMinY,"onUpdate:modelValue":t[20]||(t[20]=l=>n(e).options.fixedMinY=l),modelModifiers:{number:!0},type:"number",label:"Min value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMinY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])]),r("div",bt,[s(b,{modelValue:n(e).options.useFixedMaxY,"onUpdate:modelValue":t[21]||(t[21]=l=>n(e).options.useFixedMaxY=l),label:"Fixed maximum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(C,{modelValue:n(e).options.fixedMaxY,"onUpdate:modelValue":t[22]||(t[22]=l=>n(e).options.fixedMaxY=l),modelModifiers:{number:!0},type:"number",label:"Max value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMaxY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])])])]),_:1,__:[31]})]),_:1})]),actions:f(()=>[r("div",gt,[s(Ge,{onClick:t[23]||(t[23]=l=>n(d).widgetManagerVars(n(e).hash).configMenuOpen=!1)},{default:f(()=>t[32]||(t[32]=[He("Close")])),_:1,__:[32]})])]),_:1},8,["modelValue"])],64))}}),xt=qe(Vt,[["__scopeId","data-v-5e38ced4"]]);export{xt as default};
