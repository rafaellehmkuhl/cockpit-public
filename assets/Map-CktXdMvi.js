import{c as je,bO as yt,z as na,bP as ra,r as d,w as x,k as F,I as q,m as E,O as m,n as A,H as n,U as Y,ae as ua,K as Lt,aq as Tt,ax as da,aY as Fe,o as Et,ay as I,V as Ot,N as ce,v as l,P as It,a7 as H,a6 as wt,Q as z,R as Ft,az as $t,l as Q,F as At,q as ca,aA as Oe,bQ as va,a_ as ma,x as Re,t as Ze,S as xt,s as j,aP as pa,am as Ie,bH as fa,W as Dt,_ as Ut,bD as ga,J as ba,af as ha,u as ya,j as wa,M as kt,Y as Vt,L as xa,bR as ka,bS as Le,bT as v,bU as Va,bV as O,al as Ca,aU as Ma,bW as Sa,bX as La,bY as Ct,bZ as Ta,b_ as Ea,b$ as Oa,a0 as Ia,y as Fa,bj as $a,G as Mt,a5 as be,a$ as Aa,a8 as Da,aG as de,a4 as Te,c0 as Ua,ad as Ee,c1 as Pa,ao as St,c2 as za,c3 as Ha}from"./index-Dxb3FTBE.js";const _a={class:"flex items-center gap-2 mb-6"},Wa={class:"flex items-center gap-2 mb-6"},Ba={class:"flex items-center gap-2 mb-2"},Ga=je({__name:"GlobalOriginDialog",props:yt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:yt(["origin-set"],["update:modelValue"]),setup(ae,{emit:oe}){const{openSnackbar:o}=na(),C=ra(ae,"modelValue"),J=oe,M=ae,u=d(M.initialLatitude),c=d(M.initialLongitude),a=d(0),S=d(!1);x(()=>[M.initialLatitude,M.initialLongitude],([_,b])=>{u.value=_,c.value=b});const L=F(()=>u.value!==null&&u.value!==void 0&&u.value>=-90&&u.value<=90&&c.value!==null&&c.value!==void 0&&c.value>=-180&&c.value<=180&&a.value!==null&&a.value!==void 0),w=()=>{C.value=!1},X=()=>{if(!(!L.value||S.value)){if(M.vehicle===void 0||M.vehicle.dateLastHeartbeat()===void 0||M.vehicle.dateLastHeartbeat()>new Date(Date.now()-5e3)){o({message:"Cannot set global origin. Vehicle does not appear to be online.",variant:"error"});return}S.value=!0;try{M.vehicle.setGlobalOrigin([u.value,c.value],a.value),o({message:"Global origin set successfully.",variant:"success"}),J("origin-set",u.value,c.value),w()}catch(_){o({message:`Failed to set global origin: ${_}`,variant:"error"})}finally{S.value=!1}}},$=F(()=>[{text:"Cancel",action:w,disabled:S.value},{text:S.value?"Saving...":"Save",disabled:!L.value||S.value,action:X,class:S.value?"opacity-70":""}]);return(_,b)=>(E(),q(ua,{"show-dialog":C.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:$.value,"onUpdate:showDialog":b[3]||(b[3]=p=>C.value=p)},{content:m(()=>[b[7]||(b[7]=A("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),A("div",_a,[n(Y,{modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=p=>u.value=p),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[p=>p!=null||"Latitude is required",p=>p>=-90&&p<=90||"Latitude must be between -90 and 90"],class:"flex-1"},null,8,["modelValue","rules"]),b[4]||(b[4]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),A("div",Wa,[n(Y,{modelValue:c.value,"onUpdate:modelValue":b[1]||(b[1]=p=>c.value=p),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[p=>p!=null||"Longitude is required",p=>p>=-180&&p<=180||"Longitude must be between -180 and 180"],class:"flex-1"},null,8,["modelValue","rules"]),b[5]||(b[5]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"°",-1))]),A("div",Ba,[n(Y,{modelValue:a.value,"onUpdate:modelValue":b[2]||(b[2]=p=>a.value=p),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",rules:[p=>p!=null||"Altitude is required"],class:"flex-1"},null,8,["modelValue","rules"]),b[6]||(b[6]=A("span",{class:"text-white text-lg font-medium mb-6 w-4"},"m",-1))])]),_:1},8,["show-dialog","actions"]))}}),Na={class:"flex justify-end"},Ra={key:0,class:"fixed top-[80px] right-5"},Za={key:1,class:"flex w-full items-center"},ja={class:"flex justify-between w-full py-1 px-2 pt-3"},qa={class:"flex items-center"},Ya=je({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(ae,{emit:oe}){const o=Lt(),C=Tt(),J=ae,M=oe,u=da("cockpit-pre-arm-checklist",[]),c=d({}),a=d(""),S=d(null),L=d(!1),w=F(()=>J.modelValue),X=()=>{const h={};for(const r of u.value??[])h[r.id]=!1;c.value=h},$=F(()=>{if(!C.showChecklistBeforeArm)return!0;const h=u.value??[];return h.length>0&&h.every(r=>c.value[r.id]===!0)});x(()=>w.value,h=>{h?(X(),Fe(()=>{var r,f;return(f=(r=S.value)==null?void 0:r.focus)==null?void 0:f.call(r)})):(c.value={},L.value=!1)}),x(()=>u.value,h=>{if(!w.value)return;const r={...c.value},f={};for(const T of h??[])f[T.id]=!0,T.id in r||(r[T.id]=!1);for(const T of Object.keys(r)){const B=Number(T);f[B]||delete r[B]}c.value=r},{deep:!0});const _=async()=>{var f,T;const h=a.value.trim();if(!h)return;const r={id:Date.now(),text:h};u.value.push(r),w.value&&(c.value[r.id]=!1),a.value="",await Fe(),(T=(f=S.value)==null?void 0:f.focus)==null||T.call(f)},b=h=>{if(u.value=u.value.filter(r=>r.id!==h),h in c.value){const r={...c.value};delete r[h],c.value=r}},p=()=>{M("dismissed"),M("update:modelValue",!1)},ve=()=>{M("confirmed",!0),M("update:modelValue",!1)};return Et(()=>{u.value.length===0&&(u.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),w.value&&X()}),x(()=>C.showChecklistBeforeArm,h=>{h||I({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(h,r)=>(E(),q(Dt,{modelValue:w.value,"onUpdate:modelValue":r[4]||(r[4]=f=>w.value=f),"max-width":"600",scrollable:"",persistent:""},{default:m(()=>[n(Ot,{style:ce(l(o).globalGlassMenuStyles),class:"rounded-lg"},{default:m(()=>[n(It,{class:"text-center relative pt-3"},{default:m(()=>[r[6]||(r[6]=A("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),n(H,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:p},{default:m(()=>[n(wt,null,{default:m(()=>r[5]||(r[5]=[z("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),n(Ft,{class:"mt-[-10px]"},{default:m(()=>[n($t,{lines:"one",theme:"dark",class:"bg-transparent"},{default:m(()=>[(E(!0),Q(At,null,ca(l(u),f=>(E(),q(Oe,{key:f.id,theme:"dark"},va({prepend:m(()=>[n(xt,{modelValue:c.value[f.id],"onUpdate:modelValue":T=>c.value[f.id]=T,class:"mt-0","hide-details":"",density:"compact",disabled:!l(C).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:m(()=>[n(ma,{class:Re([{"line-through opacity-60":c.value[f.id]},{"opacity-50":!l(C).showChecklistBeforeArm}])},{default:m(()=>[z(Ze(f.text),1)]),_:2},1032,["class"])]),_:2},[L.value&&l(u).length>1?{name:"append",fn:m(()=>[n(H,{icon:"",variant:"text",disabled:!l(C).showChecklistBeforeArm,onClick:T=>b(f.id)},{default:m(()=>[n(wt,null,{default:m(()=>r[7]||(r[7]=[z("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),A("div",Na,[L.value?(E(),Q("div",Za,[L.value?(E(),q(Y,{key:0,ref_key:"newItemInput",ref:S,modelValue:a.value,"onUpdate:modelValue":r[1]||(r[1]=f=>a.value=f),disabled:!l(C).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:pa(_,["enter"]),"onClick:appendInner":_},null,8,["modelValue","disabled"])):j("",!0),n(H,{"prepend-icon":"mdi-check",disabled:!l(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:r[2]||(r[2]=()=>{L.value=!1,_()})},{default:m(()=>r[9]||(r[9]=[z("Done")])),_:1,__:[9]},8,["disabled"])])):(E(),Q("div",Ra,[n(H,{"prepend-icon":"mdi-format-list-checks",disabled:!l(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:r[0]||(r[0]=f=>L.value=!0)},{default:m(()=>r[8]||(r[8]=[z(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),n(Ie,{class:"flex center w-[80%]",inset:""}),n(fa,null,{default:m(()=>[A("div",ja,[n(H,{variant:"text",onClick:p},{default:m(()=>r[10]||(r[10]=[z("Cancel")])),_:1,__:[10]}),A("div",qa,[n(xt,{"model-value":!l(C).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":r[3]||(r[3]=f=>l(C).showChecklistBeforeArm=!f)},null,8,["model-value"]),r[11]||(r[11]=A("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),n(H,{color:"#ffffff33",class:Re({"opacity-30":!$.value}),variant:"flat",disabled:!$.value,onClick:ve},{default:m(()=>r[12]||(r[12]=[z("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Ka=Ut(Ya,[["__scopeId","data-v-b0b8e43a"]]),Qa=["id"],Ja={key:0},Xa=je({__name:"Map",props:{widget:{}},setup(ae){var gt;ga(e=>({"6efb6379":ta.value}));const oe=ae,o=ba(oe).widget,C=Lt(),{showDialog:J,closeDialog:M}=ha(),u=ya(),c=Tt(),a=d(),S=d(c.defaultMapZoom),L=d(c.defaultMapCenter),w=d(),X=F(()=>`map-${o.value.hash}`),$=F(()=>Gt.value||le.value),_=d(!1),b=d([]),p=d(),ve=d(!1),h=d(!1),r=d(!1),f=d(!1),T=d(0),B=d(0),he=d("");let ye,we,xe;const le=d(!1),Pt=()=>{ye==null||ye.click(),le.value=!1},zt=()=>{we==null||we.click(),le.value=!1},Ht=()=>{xe==null||xe.click(),le.value=!1};let qe;const Ye=e=>{e.touches.length>1&&(h.value=!0,Z.value&&Me(),clearTimeout(qe))},Ke=e=>{e.touches.length<=1&&(qe=window.setTimeout(()=>h.value=!1,300))},ie=d(null),W=d({});kt.registerUsage(Vt.latitude),kt.registerUsage(Vt.longitude),xa(()=>{Object.keys(o.value.options).length===0&&(o.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),o.value.options.showCoordinateGrid===void 0&&(o.value.options.showCoordinateGrid=!1),o.value.options.wmsEnabled===void 0&&(o.value.options.wmsEnabled=!0,o.value.options.wmsUrl="http://10.144.37.83:40801/geoserver/ows",o.value.options.wmsLayers="dct:height_grid_layer_view_2m_aggregated",o.value.options.wmsLayerName="Bathymetry Height Data (2m)",o.value.options.wmsFormat="image/png",o.value.options.wmsVersion="1.3.0",o.value.options.wmsTransparent=!0,o.value.options.wmsMaxZoom=19,o.value.options.wmsAttribution=""),D.enableAutoUpdate()});const ke=Le.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),Ve=Le.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),$e=Le.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),_t=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),N=d(void 0),Qe=()=>{if(!(!o.value.options.wmsEnabled||!o.value.options.wmsUrl||!o.value.options.wmsLayers))return v.tileLayer.wms(o.value.options.wmsUrl,{layers:o.value.options.wmsLayers,format:o.value.options.wmsFormat||"image/png",transparent:o.value.options.wmsTransparent??!0,version:o.value.options.wmsVersion||"1.1.1",attribution:o.value.options.wmsAttribution||"",maxZoom:o.value.options.wmsMaxZoom||19})},Wt={OpenStreetMap:ke,"Esri World Imagery":Ve},Bt=()=>{const e={Seamarks:$e,"Marine Profile":_t};if(N.value){const t=o.value.options.wmsLayerName||"Custom WMS";e[t]=N.value}return e},se=d(),Gt=wa(se),Je=v.control.zoom({position:"bottomright"}),K=d(void 0),me=d(void 0),Ae=()=>{if(!a.value)return;K.value&&a.value.removeControl(K.value);const e=Bt();K.value=v.control.layers(Wt,e),$.value&&a.value.addControl(K.value)},Nt=()=>{if(!a.value){I({message:"Map is not initialized yet",variant:"warning"});return}if(!o.value.options.wmsUrl||!o.value.options.wmsLayers){I({message:"Please provide both WMS URL and Layers",variant:"warning"});return}try{N.value&&a.value.hasLayer(N.value)&&a.value.removeLayer(N.value),N.value=Qe(),Ae(),I({message:"WMS layer configured successfully! Use the layer control to toggle visibility.",variant:"success",duration:4e3})}catch(e){console.error("Failed to configure WMS layer:",e),I({message:`Failed to configure WMS layer: ${e.message}`,variant:"error"})}};x($,()=>{a.value!==void 0&&($.value?(a.value.addControl(Je),K.value?a.value.addControl(K.value):Ae(),et()):(a.value.removeControl(Je),K.value&&a.value.removeControl(K.value),tt()))}),x(()=>o.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?De():Rt())}),x([S,L],()=>{o.value.options.showCoordinateGrid&&a.value&&De(),$.value&&a.value&&et()});const De=()=>{if(a.value)try{me.value=Va(a.value,me.value)}catch(e){console.error("Failed to create grid overlay:",e)}},Rt=()=>{me.value&&a.value&&(a.value.removeLayer(me.value),me.value=void 0)},Xe=v.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),et=()=>{a.value&&(tt(),Xe.addTo(a.value))},tt=()=>{if(a.value)try{a.value.removeControl(Xe)}catch{}};Et(async()=>{var bt,ht;(bt=se.value)==null||bt.addEventListener("touchstart",Ye,{passive:!0}),(ht=se.value)==null||ht.addEventListener("touchend",Ke,{passive:!0}),o.value.options.wmsEnabled&&o.value.options.wmsUrl&&o.value.options.wmsLayers&&(N.value=Qe());const e=[ke,Ve];N.value&&e.push(N.value),a.value=v.map(X.value,{layers:e,attributionControl:!1}).setView(L.value,S.value),a.value.removeControl(a.value.zoomControl),Ae(),a.value.on("click",k=>{V.value=[k.latlng.lat,k.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:k,lng:G}=a.value.getCenter();k&&G&&(L.value=[k,G])});const t=Ue(Ve,"Esri",19),s=Ue(ke,"OSM",19),i=Ue($e,"Seamarks",18);a.value&&(t.addTo(a.value),s.addTo(a.value),i.addTo(a.value));const y=k=>{var ge;const G=((ge=k.getContainer)==null?void 0:ge.call(k))??k._container;G&&(G.classList.add("hidden-savetiles"),G.style.display="none")};y(t),y(s),y(i),await Fe();const g=k=>{var ge;const G=((ge=k.getContainer)==null?void 0:ge.call(k))??k._container;return Array.from((G==null?void 0:G.querySelectorAll("a"))??[])},[P]=g(t),[te]=g(s),[ue]=g(i);ye=P,we=te,xe=ue,Pe(Ve,"Esri"),Pe(ke,"OSM"),Pe($e,"Seamarks"),a.value.on("dragstart",()=>{ve.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ve.value=!1,200)}),a.value.on("zoomend",()=>{var k;Z.value=!1,a.value!==void 0&&(S.value=((k=a.value)==null?void 0:k.getZoom())??L.value)}),a.value.on("contextmenu",k=>{V.value=[k.latlng.lat,k.latlng.lng]}),D.enableAutoUpdate(),window.addEventListener("keydown",rt),U.value?D.goToTarget(O.VEHICLE):D.goToTarget(O.HOME),!u.isVehicleOnline&&c.vehicleMission.length&&Ge(c.vehicleMission),o.value.options.showCoordinateGrid&&De(),_.value=!0,await ze()});const Zt=e=>(t,s)=>{J({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:M},{text:"Save tiles",color:"white",action:()=>{s(),M()}}]})},jt=e=>(t,s)=>{J({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:M},{text:"Remove tiles",color:"white",action:()=>{s(),M(),I({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Ue=(e,t,s)=>Le.savetiles(e,{saveWhatYouSee:!0,maxZoom:s,alwaysDownload:!1,position:"topright",parallel:20,confirm:Zt(t),confirmRemoval:jt(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Pe=(e,t)=>{e.on("savestart",s=>{var i;T.value=0,B.value=((i=s==null?void 0:s._tilesforSave)==null?void 0:i.length)??0,he.value=t,f.value=!0,I({message:`Saving ${B.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{T.value+=1,B.value>0&&T.value>=B.value&&(I({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),f.value=!1,he.value="",T.value=0,B.value=0)})},qt={open:e=>{if(!a.value||h.value||ve.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),s=a.value.containerPointToLatLng(t);V.value=[s.lat,s.lng],p.value.openAt(e),Z.value=!0},close:()=>{Me()}},at=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),b.value=[],Ce.value=void 0,ee.value=void 0,re.value=void 0,R.value=void 0},ze=async()=>{_.value&&(at(),u.isVehicleOnline?await dt():c.vehicleMission.length&&Ge(c.vehicleMission))};x(()=>u.isVehicleOnline,()=>{ze()}),x(()=>c.vehicleMissionRevision,()=>{ze()}),Ca(()=>{var e,t;D.disableAutoUpdate(),window.removeEventListener("keydown",rt),a.value&&(a.value.off("contextmenu"),Object.values(W.value).forEach(s=>s.remove()),W.value={}),(e=se.value)==null||e.removeEventListener("touchstart",Ye),(t=se.value)==null||t.removeEventListener("touchend",Ke)}),x(L,(e,t)=>{var s;e.toString()!==t.toString()&&((s=a.value)==null||s.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(S,(e,t)=>{var s;e!==t&&(Z.value=!1,(s=a.value)==null||s.setZoom(S.value))}),x(oe.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ne=d(void 0),D=new ka(e=>ne.value=e,e=>L.value=e);D.setTrackableTarget(O.VEHICLE,()=>U.value),D.setTrackableTarget(O.HOME,()=>w.value);const U=F(()=>u.coordinates.latitude?[u.coordinates.latitude,u.coordinates.longitude]:void 0),He=F(()=>{var e;return u.attitude.yaw?Ma((e=u.attitude)==null?void 0:e.yaw):0}),ot=F(()=>{const e=u.lastHeartbeat;return e?`${Sa(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Yt}=La(U);(gt=navigator==null?void 0:navigator.geolocation)==null||gt.watchPosition(e=>{w.value||(w.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let lt=!0;x([w,a],async()=>{w.value===L.value||!a.value||!lt||(D.goToTarget(O.HOME),lt=!1)});const R=d();x(u.coordinates,()=>{if(!(!a.value||!U.value)){if(R.value===void 0){let e=Ta;u.vehicleType===Ct.MAV_TYPE_SURFACE_BOAT?e=Ea:u.vehicleType===Ct.MAV_TYPE_SUBMARINE&&(e=Oa);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});R.value=v.marker(U.value,{icon:t});const s=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});R.value.bindTooltip(s),a.value.addLayer(R.value)}R.value.setLatLng(U.value)}}),x(U,(e,t)=>{ne.value===O.VEHICLE||t!==void 0||D.follow(O.VEHICLE)}),x([U,He,ot,()=>u.isArmed],()=>{var t,s,i,y,g;if(R.value===void 0)return;(y=R.value.getTooltip())==null||y.setContent(`
    <p>Coordinates: ${(t=U.value)==null?void 0:t[0].toFixed(6)}, ${(s=U.value)==null?void 0:s[1].toFixed(6)}</p>
    <p>Velocity: ${((i=u.velocity.ground)==null?void 0:i.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${He.value.toFixed(2)}°</p>
    <p>${u.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${ot.value}</p>
  `);const e=(g=R.value.getElement())==null?void 0:g.querySelector("img");e&&(e.style.transform=`rotate(${He.value}deg)`)});const ee=d();x(w,()=>{if(a.value===void 0)return;const e=w.value;if(e!==void 0)if(ee.value)ee.value.setLatLng(e);else{ee.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});ee.value.bindTooltip(t),ee.value.on("dragend",s=>{const y=s.target.getLatLng();Ne([y.lat,y.lng])}),a.value.addLayer(ee.value)}});const Ce=d();x(b,e=>{a.value&&(Ce.value||(Ce.value=v.polyline([],{color:"#358AC3"}).addTo(a.value)),Ce.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,s)=>{var g;const i=v.marker(t.coordinates);i.setIcon(v.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const y=v.tooltip({content:s.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});i.bindTooltip(y),(g=a.value)==null||g.addLayer(i)}))},{deep:!0});const _e=d();x(Yt,e=>{if(a.value===void 0||e===void 0)return;_e.value===void 0&&(_e.value=v.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(s=>s.snapshot!==void 0).map(s=>s.snapshot);_e.value.setLatLngs(t)});const Z=d(!1),V=d(null),it=d(),We=d(!1),st=d(0),nt=d(0),Be=d(),Kt=Ia([{item:"Set home waypoint",action:()=>pe("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>pe("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>pe("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>pe("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>pe("set-default-map-position"),icon:"mdi-map-check"}]),re=d(),Qt=async()=>{var e;if(!(!a.value||!V.value))try{await c.setDefaultMapPosition(V.value,S.value),I({message:"Default map position set",variant:"success"});const t=v.marker(V.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),s=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(s).openTooltip();const i=t.getElement(),y=(e=t.getTooltip())==null?void 0:e.getElement();[i,y].forEach(g=>{g&&(g.style.transition="opacity 1s",g.style.opacity="1")}),setTimeout(()=>{[i,y].forEach(g=>{g&&(g.style.opacity="0")}),setTimeout(()=>{var g;(g=a.value)==null||g.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),I({message:"Failed to set default map position",variant:"error"})}},Jt=async()=>{if(!V.value||!a.value)return;re.value&&(a.value.removeLayer(re.value),re.value=void 0),re.value=v.marker(V.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(re.value.bindTooltip(e),V.value){const g=u.coordinates.altitude??0,P=V.value[0],te=V.value[1];try{await u.goTo(0,0,0,0,P,te,g)}catch(ue){I({message:`GoTo request failed: ${ue.message}`,variant:"error"})}}},pe=async e=>{switch(e){case"goto":{Jt();break}case"set-default-map-position":Qt();break;case"place-poi":V.value&&ie.value?ie.value.openDialog(V.value):V.value?ie.value||(I({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(I({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":V.value&&Ne(V.value);break;case"set-global-origin":V.value&&(st.value=V.value[0],nt.value=V.value[1],We.value=!0);break;default:console.warn("Unknown menu option selected:",e)}Z.value=!1},Me=()=>{Z.value=!1,a.value!==void 0&&it.value!==void 0&&a.value.removeLayer(it.value)},Xt=(e,t)=>{if(!a.value)return;Be.value&&a.value.removeLayer(Be.value);const s=v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),i=v.marker([e,t],{icon:s}).addTo(a.value),y=v.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});i.bindTooltip(y),Be.value=i},rt=e=>{e.key==="Escape"&&Me()},Ge=e=>{e.forEach((t,s)=>{s===0?(w.value=t.coordinates,Ne(t.coordinates)):b.value.push(t)})},Se=d(!1),ut=d(0),dt=async()=>{Se.value=!0,at();const e=async t=>{ut.value=t};try{const t=await u.fetchMission(e);Ge(t),I({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){J({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Se.value=!1}},Ne=async e=>{const t=[e[0],e[1]];w.value=t,await u.setHomeWaypoint(t,0),Z.value&&(Z.value=!1)},ct=async()=>{try{await u.startMission()}catch{I({message:"Failed to start mission.",variant:"error"})}},ea=async()=>{if(c.showChecklistBeforeArm){r.value=!0;return}ct()},fe=Fa(),ta=F(()=>`${Math.max(-fe.widgetClearanceForVisibleArea(o.value).bottom,0)}px`),vt=F(()=>`${Math.max(-fe.widgetClearanceForVisibleArea(o.value).top,0)}px`),aa=F(()=>u.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),oa=F(()=>u.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),la=F(()=>w.value===void 0?"Cannot center map on home (home position undefined).":ne.value===O.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),ia=F(()=>u.isVehicleOnline?U.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ne.value===O.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),mt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),pt=e=>{if(!a.value||!a.value.getContainer())return;const t=v.divIcon(mt(e)),s=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),i=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,y={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};s.bindTooltip(i,y),s.on("drag",g=>{var ue;const P=g.target.getLatLng(),te=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${P.lat.toFixed(8)}, Lng: ${P.lng.toFixed(8)}
    `;(ue=s.getTooltip())==null||ue.setContent(te)}),s.on("dragend",g=>{const P=g.target.getLatLng();c.movePointOfInterest(e.id,[P.lat,P.lng])}),s.on("click",g=>{if(v.DomEvent.stopPropagation(g),ie.value){const P=c.pointsOfInterest.find(te=>te.id===e.id);P?ie.value.openDialog(void 0,P):console.warn("POI not found in store:",e.id)}}),W.value[e.id]=s},ft=e=>{var i;if(!a.value||!a.value.getContainer()||!W.value[e.id])return;const t=W.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(mt(e)));const s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(i=t.getTooltip())==null||i.setContent(s)},sa=e=>{!a.value||!W.value[e]||(W.value[e].remove(),delete W.value[e])};return x(()=>c.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Fe(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(s=>s.id));Object.keys(W.value).forEach(s=>{t.has(s)||sa(s)}),e.forEach(s=>{W.value[s.id]?ft(s):pt(s)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&c.pointsOfInterest.forEach(t=>{W.value[t.id]?ft(t):pt(t)})},{immediate:!0}),(e,t)=>{const s=$a("contextmenu");return E(),Q(At,null,[Mt((E(),Q("div",{ref_key:"mapBase",ref:se,class:Re(["page-base",l(fe).editingMode?"pointer-events-none":"pointer-events-auto"])},[A("div",{id:X.value,ref_key:"map",ref:a,class:"map"},[n(Da,{modelValue:le.value,"onUpdate:modelValue":t[0]||(t[0]=i=>le.value=i),"close-on-content-click":!1,location:"top end"},{activator:m(({props:i})=>[Mt(n(H,be(i,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[Aa,$.value]])]),default:m(()=>[n($t,{style:ce(l(C).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:m(()=>[n(Oe,{class:"py-0",title:"Save visible Esri tiles",onClick:Pt}),n(Ie),n(Oe,{class:"py-0",title:"Save visible OSM tiles",onClick:zt}),n(Ie),n(Oe,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Ht})]),_:1},8,["style"])]),_:1},8,["modelValue"]),n(Te,{location:"top",text:la.value},{activator:m(({props:i})=>[$.value?(E(),q(H,be({key:0},i,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",w.value?"":"active-events-on-disabled"],color:ne.value==l(O).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!w.value,onClick:t[1]||(t[1]=de(y=>l(D).goToTarget(l(O).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=de(y=>l(D).follow(l(O).HOME),["stop"]))}),null,16,["class","color","disabled"])):j("",!0)]),_:1},8,["text"]),n(Te,{location:"top",text:ia.value},{activator:m(({props:i})=>[$.value?(E(),q(H,be({key:0},i,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",U.value?"":"active-events-on-disabled"],color:ne.value==l(O).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!U.value,onClick:t[3]||(t[3]=de(y=>l(D).goToTarget(l(O).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=de(y=>l(D).follow(l(O).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):j("",!0)]),_:1},8,["text"]),n(Te,{location:"top",text:aa.value},{activator:m(({props:i})=>[$.value?(E(),q(H,be({key:0},i,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",l(u).isVehicleOnline?"":"active-events-on-disabled"],disabled:!l(u).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:de(dt,["stop"])}),null,16,["class","disabled"])):j("",!0)]),_:1},8,["text"]),n(Te,{location:"top",text:oa.value},{activator:m(({props:i})=>[$.value?(E(),q(H,be({key:0},i,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",l(u).isVehicleOnline?"":"active-events-on-disabled"],disabled:!l(u).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:de(ea,["stop"])}),null,16,["class","disabled"])):j("",!0)]),_:1},8,["text"])],8,Qa)],2)),[[s,qt]]),n(Ua,{ref_key:"contextMenuRef",ref:p,visible:Z.value,width:"260px","menu-items":Kt,onClose:Me},null,8,["visible","menu-items"]),n(Dt,{modelValue:l(fe).widgetManagerVars(l(o).hash).configMenuOpen,"onUpdate:modelValue":t[16]||(t[16]=i=>l(fe).widgetManagerVars(l(o).hash).configMenuOpen=i),width:"auto"},{default:m(()=>[n(Ot,{class:"pa-2",style:ce([l(C).globalGlassMenuStyles,{"min-width":"400px"}])},{default:m(()=>[n(It,{class:"text-center"},{default:m(()=>t[19]||(t[19]=[z("Map widget settings")])),_:1,__:[19]}),n(Ft,null,{default:m(()=>[n(Ee,{modelValue:l(o).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=i=>l(o).options.showVehiclePath=i),class:"my-1",label:"Show vehicle path",color:l(o).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),n(Ee,{modelValue:l(o).options.showCoordinateGrid,"onUpdate:modelValue":t[6]||(t[6]=i=>l(o).options.showCoordinateGrid=i),class:"my-1",label:"Show coordinate grid",color:l(o).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),n(Ie,{class:"my-4"}),n(Pa,{class:"text-center px-0 pb-2"},{default:m(()=>t[20]||(t[20]=[z("Custom WMS Service")])),_:1,__:[20]}),n(Ee,{modelValue:l(o).options.wmsEnabled,"onUpdate:modelValue":t[7]||(t[7]=i=>l(o).options.wmsEnabled=i),class:"my-1",label:"Enable custom WMS overlay",color:l(o).options.wmsEnabled?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),n(Y,{modelValue:l(o).options.wmsUrl,"onUpdate:modelValue":t[8]||(t[8]=i=>l(o).options.wmsUrl=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"WMS Service URL",placeholder:"https://example.com/geoserver/wms",density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(Y,{modelValue:l(o).options.wmsLayers,"onUpdate:modelValue":t[9]||(t[9]=i=>l(o).options.wmsLayers=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"WMS Layers",placeholder:"layer1,layer2",density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(Y,{modelValue:l(o).options.wmsLayerName,"onUpdate:modelValue":t[10]||(t[10]=i=>l(o).options.wmsLayerName=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"Display Name",placeholder:"Custom WMS Layer",density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(St,{modelValue:l(o).options.wmsFormat,"onUpdate:modelValue":t[11]||(t[11]=i=>l(o).options.wmsFormat=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"Image Format",items:["image/png","image/jpeg","image/gif"],density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(St,{modelValue:l(o).options.wmsVersion,"onUpdate:modelValue":t[12]||(t[12]=i=>l(o).options.wmsVersion=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"WMS Version",items:["1.1.0","1.1.1","1.3.0"],density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(Ee,{modelValue:l(o).options.wmsTransparent,"onUpdate:modelValue":t[13]||(t[13]=i=>l(o).options.wmsTransparent=i),disabled:!l(o).options.wmsEnabled,class:"my-1",label:"Transparent background",color:l(o).options.wmsTransparent?"white":void 0,"hide-details":""},null,8,["modelValue","disabled","color"]),n(Y,{modelValue:l(o).options.wmsMaxZoom,"onUpdate:modelValue":t[14]||(t[14]=i=>l(o).options.wmsMaxZoom=i),modelModifiers:{number:!0},disabled:!l(o).options.wmsEnabled,class:"my-2",label:"Max Zoom Level",type:"number",density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(Y,{modelValue:l(o).options.wmsAttribution,"onUpdate:modelValue":t[15]||(t[15]=i=>l(o).options.wmsAttribution=i),disabled:!l(o).options.wmsEnabled,class:"my-2",label:"Attribution (optional)",placeholder:"© Data Provider",density:"compact","hide-details":""},null,8,["modelValue","disabled"]),n(H,{disabled:!l(o).options.wmsEnabled||!l(o).options.wmsUrl||!l(o).options.wmsLayers,class:"mt-3",color:"primary",block:"",size:"small",onClick:Nt},{default:m(()=>t[21]||(t[21]=[z(" Apply WMS Configuration ")])),_:1,__:[21]},8,["disabled"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Se.value?(E(),q(za,{key:0,"model-value":ut.value,height:"10",absolute:"",bottom:"",color:"white",style:ce(`top: ${vt.value}`)},null,8,["model-value","style"])):j("",!0),Se.value?(E(),Q("p",{key:1,style:ce({top:vt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):j("",!0),n(Ha,{ref_key:"poiManagerMapWidgetRef",ref:ie},null,512),n(Ka,{"model-value":r.value,onConfirmed:ct,"onUpdate:modelValue":t[17]||(t[17]=i=>r.value=i)},null,8,["model-value"]),n(Ga,{modelValue:We.value,"onUpdate:modelValue":t[18]||(t[18]=i=>We.value=i),vehicle:l(u).mainVehicle,"initial-latitude":st.value,"initial-longitude":nt.value,onOriginSet:Xt},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),f.value?(E(),Q("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ce(l(C).globalGlassMenuStyles)},[A("p",null,[t[22]||(t[22]=z(" Saving offline map content ")),he.value?(E(),Q("span",Ja,"("+Ze(he.value)+")",1)):j("",!0),z(":  "+Ze(B.value?Math.round(T.value/B.value*100):0)+"% ",1)])],4)):j("",!0)],64)}}}),to=Ut(Xa,[["__scopeId","data-v-30bcc3f6"]]);export{to as default};
