import{bf as Ce,bg as Ae,bh as ze,bi as q,f as Ne,bj as ye,bk as $e,bl as Pe,c as _e,b9 as Fe,I as Ue,K as Be,a7 as Re,u as Xe,aj as We,r as m,k as A,M as Me,Y as we,L as Ye,bm as i,j as qe,w as h,o as Ge,bn as b,ad as Ze,bo as je,aw as Ke,bp as Je,bq as ke,at as Qe,J as ea,l as E,m as le,n as G,D as xe,T as Te,H as P,v as se,q as u,aq as D,a5 as Z,s as L,O as j,G as _,N as K,V as aa,P as oa,Q as ta,R as na,a4 as la,W as sa,br as ra,F as ia,y as ua,z as ca,E as da,bs as re}from"./index-BKn6T0-n.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new r.Error().stack;f&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[f]="84c2b095-8fe5-4562-89d4-c9adcbc4d076",r._sentryDebugIdIdentifier="sentry-dbid-84c2b095-8fe5-4562-89d4-c9adcbc4d076")}catch{}})();function Ee(r,f){if(r==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&(r[n]=f[n]);return r}function va(r){return Ee({},r)}var Ie=1440,ma=2520,ie=43200,fa=86400;function pa(r,f,n){var z,N;Ce(2,arguments);var c=Pe(),l=(z=(N=n==null?void 0:n.locale)!==null&&N!==void 0?N:c.locale)!==null&&z!==void 0?z:Ae;if(!l.formatDistance)throw new RangeError("locale must contain formatDistance property");var o=ze(r,f);if(isNaN(o))throw new RangeError("Invalid time value");var s=Ee(va(n),{addSuffix:!!(n!=null&&n.addSuffix),comparison:o}),y,v;o>0?(y=q(f),v=q(r)):(y=q(r),v=q(f));var x=Ne(v,y),T=(ye(v)-ye(y))/1e3,d=Math.round((x-T)/60),I;if(d<2)return n!=null&&n.includeSeconds?x<5?l.formatDistance("lessThanXSeconds",5,s):x<10?l.formatDistance("lessThanXSeconds",10,s):x<20?l.formatDistance("lessThanXSeconds",20,s):x<40?l.formatDistance("halfAMinute",0,s):x<60?l.formatDistance("lessThanXMinutes",1,s):l.formatDistance("xMinutes",1,s):d===0?l.formatDistance("lessThanXMinutes",1,s):l.formatDistance("xMinutes",d,s);if(d<45)return l.formatDistance("xMinutes",d,s);if(d<90)return l.formatDistance("aboutXHours",1,s);if(d<Ie){var F=Math.round(d/60);return l.formatDistance("aboutXHours",F,s)}else{if(d<ma)return l.formatDistance("xDays",1,s);if(d<ie){var U=Math.round(d/Ie);return l.formatDistance("xDays",U,s)}else if(d<fa)return I=Math.round(d/ie),l.formatDistance("aboutXMonths",I,s)}if(I=$e(v,y),I<12){var J=Math.round(d/ie);return l.formatDistance("xMonths",J,s)}else{var B=I%12,O=Math.floor(I/12);return B<3?l.formatDistance("aboutXYears",O,s):B<9?l.formatDistance("overXYears",O,s):l.formatDistance("almostXYears",O+1,s)}}function ga(r,f){return Ce(1,arguments),pa(r,Date.now(),f)}const ha=""+new URL("blueboat-marker-DyHmCFOq.png",import.meta.url).href,ba=""+new URL("brov2-marker-CBzp11FX.png",import.meta.url).href,ya=""+new URL("generic-vehicle-marker-SovxT5Tc.png",import.meta.url).href,Ma=["id"],ka=_e({__name:"Map",props:{widget:{}},setup(r){var be;Fe(e=>({"4fa1c672":Oe.value}));const f=r,n=Ue(f).widget,z=Be(),{showDialog:N}=Re(),c=Xe(),l=We(),o=m(),s=m(15),y=m([-27.5935,-48.55854]),v=m(),x=A(()=>`map-${n.value.hash}`),T=m(!1);Me.registerUsage(we.latitude),Me.registerUsage(we.longitude),Ye(()=>{Object.keys(n.value.options).length===0&&(n.value.options={showVehiclePath:!0}),p.enableAutoUpdate()});const d=i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),I=i.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri World Imagery"}),F=i.tileLayer("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),U=i.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),J={OpenStreetMap:d,"Esri World Imagery":I},B={Seamarks:F,"Marine Profile":U},O=m(),ue=qe(O),ce=i.control.zoom({position:"bottomright"}),de=i.control.layers(J,B);h(T,()=>{o.value!==void 0&&(T.value?(o.value.addControl(ce),o.value.addControl(de)):(o.value.removeControl(ce),o.value.removeControl(de)))}),h(ue,()=>{T.value=ue.value}),Ge(async()=>{o.value=i.map(x.value,{layers:[d,I,F,U],attributionControl:!1}).setView(y.value,s.value),o.value.removeControl(o.value.zoomControl),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:e,lng:a}=o.value.getCenter();e&&a&&(y.value=[e,a])}),o.value.on("zoomend",()=>{var e;o.value!==void 0&&(s.value=((e=o.value)==null?void 0:e.getZoom())??y.value)}),o.value.on("click",()=>{o.value!==void 0&&o.value.on("click",fe)}),o.value.on("contextmenu",()=>{pe()}),p.enableAutoUpdate(),window.addEventListener("keydown",ge),g.value?p.goToTarget(b.VEHICLE):p.goToTarget(b.HOME)}),Ze(()=>{p.disableAutoUpdate(),window.removeEventListener("keydown",ge),o.value&&(o.value.off("click",fe),o.value.off("contextmenu"))}),h(y,(e,a)=>{var t,M,k;e.toString()!==a.toString()&&((t=o.value)==null||t.panTo(e),(k=(M=S.value)==null?void 0:M.getTooltip())==null||k.setContent(`Home: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`))}),h(o,(e,a)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=a)}),h(s,(e,a)=>{var t;e!==a&&((t=o.value)==null||t.setZoom(s.value))}),h(f.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const R=m(void 0),p=new je(e=>R.value=e,e=>y.value=e);p.setTrackableTarget(b.VEHICLE,()=>g.value),p.setTrackableTarget(b.HOME,()=>v.value);const g=A(()=>c.coordinates.latitude?[c.coordinates.latitude,c.coordinates.longitude]:void 0),Q=A(()=>{var e;return c.attitude.yaw?Ke((e=c.attitude)==null?void 0:e.yaw):0}),ve=A(()=>{const e=c.lastHeartbeat;return e?`${ga(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Se}=Je(g);(be=navigator==null?void 0:navigator.geolocation)==null||be.watchPosition(e=>v.value=[e.coords.latitude,e.coords.longitude],e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let me=!0;h([v,o],async()=>{v.value===y.value||!o.value||!me||(p.goToTarget(b.HOME),me=!1)});const C=m();h(c.coordinates,()=>{if(!(!o.value||!g.value)){if(C.value===void 0){let e=ya;c.vehicleType===ke.MAV_TYPE_SURFACE_BOAT?e=ha:c.vehicleType===ke.MAV_TYPE_SUBMARINE&&(e=ba);const a=i.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});C.value=i.marker(g.value,{icon:a});const t=i.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});C.value.bindTooltip(t),o.value.addLayer(C.value)}C.value.setLatLng(g.value)}}),h(g,(e,a)=>{R.value===b.VEHICLE||a!==void 0||p.follow(b.VEHICLE)}),h([g,Q,ve,()=>c.isArmed],()=>{var a,t,M,k,w;if(C.value===void 0)return;(k=C.value.getTooltip())==null||k.setContent(`
    <p>Coordinates: ${(a=g.value)==null?void 0:a[0].toFixed(6)}, ${(t=g.value)==null?void 0:t[1].toFixed(6)}</p>
    <p>Velocity: ${((M=c.velocity.ground)==null?void 0:M.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Q.value.toFixed(2)}°</p>
    <p>${c.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${ve.value}</p>
  `);const e=(w=C.value.getElement())==null?void 0:w.querySelector("img");e&&(e.style.transform=`rotate(${Q.value}deg)`)});const S=m();h(v,()=>{if(o.value===void 0)return;const e=v.value;if(e!==void 0){if(S.value===void 0){S.value=i.marker(e);const a=i.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:"H"});S.value.setIcon(a);const t=i.tooltip({content:"No data available",className:"waypoint-tooltip"});S.value.bindTooltip(t),o.value.addLayer(S.value)}S.value.setLatLng(v.value)}});const ee=m();h(l.currentPlanningWaypoints,e=>{if(o.value!==void 0){if(ee.value===void 0){const a=e.map(t=>t.coordinates);ee.value=i.polyline(a,{color:"#358AC3"}).addTo(o.value)}ee.value.setLatLngs(e.map(a=>a.coordinates)),e.forEach((a,t)=>{var w;const M=i.marker(a.coordinates),k=i.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:`${t}`});M.setIcon(k),(w=o.value)==null||w.addLayer(M)})}});const ae=m();h(Se,e=>{if(o.value===void 0||e===void 0)return;ae.value===void 0&&(ae.value=i.polyline([],{color:"#ffff00"}).addTo(o.value));const a=e.filter(t=>t.snapshot!==void 0).map(t=>t.snapshot);ae.value.setLatLngs(a)});const X=m(!1),H=m(null),W=Qe({top:"0px",left:"0px"}),V=m(),fe=e=>{var a,t,M,k;if(V.value!==void 0&&o.value!==void 0&&((a=V.value)==null||a.removeFrom(o.value)),((t=e==null?void 0:e.latlng)==null?void 0:t.lat)!=null&&((M=e==null?void 0:e.latlng)==null?void 0:M.lng)!=null){H.value=[e.latlng.lat,e.latlng.lng],X.value=!0;const w=(k=o.value)==null?void 0:k.getContainer();if(w){const{x:te,y:ne}=w.getBoundingClientRect();W.left=`${e.originalEvent.clientX-te}px`,W.top=`${e.originalEvent.clientY-ne}px`}}else console.error("Invalid event structure:",e);if(o.value!==void 0){V.value=i.marker(H.value);const w=i.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16]});V.value.setIcon(w),o.value.addLayer(V.value)}},Ve=e=>{switch(e){case"goto":if(H.value){const w=c.coordinates.altitude??0,te=H.value[0],ne=H.value[1];ua(async()=>{try{await c.goTo(0,0,0,0,te,ne,w)}catch(He){re({message:He,variant:"error"})}},{command:"GoTo"},ca(da.GOTO))}break;default:console.warn("Unknown menu option selected:",e)}X.value=!1},pe=()=>{X.value=!1,H.value=null,o.value!==void 0&&V.value!==void 0&&o.value.removeLayer(V.value)},ge=e=>{e.key==="Escape"&&pe()},Y=m(!1),oe=m(0),De=async()=>{for(Y.value=!0,oe.value=0;l.currentPlanningWaypoints.length>0;)l.currentPlanningWaypoints.pop();const e=async a=>{oe.value=a};try{(await c.fetchMission(e)).forEach(t=>{l.currentPlanningWaypoints.push(t)}),re({variant:"success",message:"Mission download succeed!",duration:3e3})}catch(a){N({variant:"error",title:"Mission download failed",message:a,timer:5e3})}finally{Y.value=!1}},Le=async()=>{try{await c.startMission()}catch{re({message:"Failed to start mission.",variant:"error"})}},$=ea(),Oe=A(()=>`${Math.max(-$.widgetClearanceForVisibleArea(n.value).bottom,0)}px`),he=A(()=>`${Math.max(-$.widgetClearanceForVisibleArea(n.value).top,0)}px`);return(e,a)=>(E(),le(ia,null,[G("div",{ref_key:"mapBase",ref:O,class:se(["page-base",u($).editingMode?"pointer-events-none":"pointer-events-auto"])},[G("div",{id:x.value,ref_key:"map",ref:o,class:"map"},[T.value?xe((E(),P(Z,{key:0,class:se(["absolute left-0 m-3 bottom-button bg-slate-50",v.value?"":"active-events-on-disabled"]),color:R.value==u(b).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-map-marker",size:"x-small",disabled:!v.value,onClick:a[0]||(a[0]=D(t=>u(p).goToTarget(u(b).HOME,!0),["stop"])),onDblclick:a[1]||(a[1]=D(t=>u(p).follow(u(b).HOME),["stop"]))},null,8,["class","color","disabled"])),[[Te,v.value?"Center map on home position.":"Home position is currently undefined."]]):L("",!0),T.value?xe((E(),P(Z,{key:1,class:se(["absolute m-3 bottom-button left-10 bg-slate-50",g.value?"":"active-events-on-disabled"]),color:R.value==u(b).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!g.value,onClick:a[2]||(a[2]=D(t=>u(p).goToTarget(u(b).VEHICLE,!0),["stop"])),onDblclick:a[3]||(a[3]=D(t=>u(p).follow(u(b).VEHICLE),["stop"]))},null,8,["class","color","disabled"])),[[Te,g.value?"Center map on vehicle position.":"Vehicle position is currently undefined."]]):L("",!0),T.value?(E(),P(Z,{key:2,class:"absolute m-3 bottom-button left-20 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:D(De,["stop"])})):L("",!0),T.value?(E(),P(Z,{key:3,class:"absolute mb-3 ml-1 bottom-button left-32 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:D(Le,["stop"])})):L("",!0)],8,Ma)],2),X.value?(E(),le("div",{key:0,class:"context-menu",style:j({top:W.top,left:W.left})},[G("ul",{onClick:a[5]||(a[5]=D(()=>{},["stop"]))},[G("li",{onClick:a[4]||(a[4]=t=>Ve("goto"))},"GoTo")])],4)):L("",!0),_(sa,{modelValue:u($).widgetManagerVars(u(n).hash).configMenuOpen,"onUpdate:modelValue":a[7]||(a[7]=t=>u($).widgetManagerVars(u(n).hash).configMenuOpen=t),width:"auto"},{default:K(()=>[_(aa,{class:"pa-2",style:j(u(z).globalGlassMenuStyles)},{default:K(()=>[_(oa,{class:"text-center"},{default:K(()=>a[8]||(a[8]=[ta("Map widget settings")])),_:1}),_(na,null,{default:K(()=>[_(la,{modelValue:u(n).options.showVehiclePath,"onUpdate:modelValue":a[6]||(a[6]=t=>u(n).options.showVehiclePath=t),class:"my-1",label:"Show vehicle path",color:u(n).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Y.value?(E(),P(ra,{key:1,"model-value":oe.value,height:"10",absolute:"",bottom:"",color:"white",style:j(`top: ${he.value}`)},null,8,["model-value","style"])):L("",!0),Y.value?(E(),le("p",{key:2,style:j({top:he.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):L("",!0)],64))}});export{ka as default};
//# sourceMappingURL=Map-BmBlAwmk.js.map
