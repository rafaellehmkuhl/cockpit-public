import{c as Q,bC as q,k as v,K as X,y as Y,r as u,J as Z,bK as T,aR as ee,w as N,L as se,aJ as ae,a9 as E,al as te,a1 as oe,l as V,m,H as l,v as t,N as b,x as le,n as i,G as y,O as d,Q as A,a6 as ie,t as I,a7 as L,a_ as M,I as ne,as as de,V as re,P as ue,R as ce,U as W,aO as pe,bL as ve,T as me,aQ as fe,bM as he,ad as j,s as ge,am as we,bG as Ve,W as be,bN as ye,ay as G,_ as Ae}from"./index-vQbP6_M-.js";const xe={class:"w-full h-full"},_e=["width","height"],Be={class:"flex flex-col justify-start items-center h-auto pt-2 cursor-pointer"},Ce={class:"flex justify-between w-full h-[25px] px-2"},Ue={class:"select-none"},ke={class:"pt-2"},Le=["src"],Me={key:1},Se=["src"],Re={class:"flex items-center justify-between mt-2 gap-1"},De={class:"-mr-3 text-base text-gray-400"},Fe={class:"mt-2 mb-2 w-[95%]"},$e={class:"flex justify-between"},ze={key:0},Oe=Q({__name:"IFrame",props:{widget:{}},setup(K){q(a=>({"230b72ba":J.value}));const S=X(),r=Y(),x=u(),e=Z(K).widget,c=u(!1),_=u(0),n=u(e.value.options.source),f=u(""),h=u({usingVehicleAddressAsBase:"",notUsingVehicleAddressAsBase:""}),R=v(()=>{const a=window.location.protocol.includes("file")?"http:":window.location.protocol,s=f.value||T;return`${a}//${s}`}),B=(a,s)=>s?`${R.value}${a}`:a,g=v(()=>B(e.value.options.source,e.value.options.useVehicleAddressAsBase)),P=()=>{r.allowMovingAndResizing(e.value.hash,!0),window.addEventListener("mouseup",p),window.addEventListener("dragend",p)},p=()=>{r.allowMovingAndResizing(e.value.hash,!1),window.removeEventListener("mouseup",p),window.removeEventListener("dragend",p)},D=v(()=>({width:e.value.size.width*w.value,height:e.value.size.height*w.value})),C=a=>ye(a)?!0:"URL is not valid.",U=()=>{const a=C(B(n.value,e.value.options.useVehicleAddressAsBase));if(a!==!0){G({message:`${a} Please enter a valid URL.`,variant:"error"});return}e.value.options.source=n.value,G({message:`IFrame URL sucessfully updated to '${g.value}'.`,variant:"success"})},H=a=>{a?(h.value.notUsingVehicleAddressAsBase=n.value,n.value=h.value.usingVehicleAddressAsBase):(h.value.usingVehicleAddressAsBase=n.value,n.value=h.value.notUsingVehicleAddressAsBase),U()},F=a=>{if(a.data.type!=="cockpit:listenToDatalakeVariables")return;const{variable:s}=a.data;E(s,o=>{x.value.contentWindow.postMessage({type:"cockpit:datalakeVariable",variable:s,value:o},"*")})};N([f,()=>e.value.options.useVehicleAddressAsBase],()=>{e.value.options.useVehicleAddressAsBase&&(c.value=!1,setTimeout(()=>{c.value=!0},100))},{deep:!0});let k;se(()=>{window.addEventListener("message",F,!0);const a={source:"http://"+T,useVehicleAddressAsBase:!1,startCollapsed:!1,containerName:"iframe"};e.value.options={...a,...e.value.options};const s=ae("vehicle-address");typeof s=="string"&&(f.value=s),k=E("vehicle-address",o=>{typeof o=="string"&&(f.value=o)})}),te(()=>{window.removeEventListener("message",F,!0),k&&oe("vehicle-address",k)});const{width:w,height:$}=ee(),z=v(()=>{let a="";return a=a.concat(" ",`left: ${e.value.position.x*w.value}px;`),a=a.concat(" ",`top: ${e.value.position.y*$.value}px;`),a=a.concat(" ",`width: ${e.value.size.width*w.value}px;`),a=a.concat(" ",`height: ${e.value.size.height*$.value}px;`),r.editingMode&&(a=a.concat(" ","pointer-events:none; border:0;")),r.isWidgetVisible(e.value)||(a=a.concat(" ","display: none;")),a}),J=v(()=>(100-_.value)/100);function O(){console.log("Finished loading"),c.value=!0}return N(e,()=>{r.widgetManagerVars(e.value.hash).configMenuOpen===!1&&C(g.value)!==!0&&(n.value=e.value.options.source)},{deep:!0}),(a,s)=>(m(),V("div",xe,[t(e).options.isCollapsible?(m(),V("div",{key:0,ref:"iframe-container",class:le(["w-full rounded-lg overflow-hidden -mt-2",[t(e).options.startCollapsed?"h-[42px]":"h-full"]]),width:D.value.width,height:D.value.height,style:b(t(S).globalGlassMenuStyles)},[i("div",Be,[i("div",Ce,[l(ie,{class:"cursor-grab opacity-40",onMousedown:P,onMouseup:p},{default:d(()=>s[8]||(s[8]=[A(" mdi-drag ")])),_:1,__:[8]}),i("div",Ue,I(t(e).options.containerName),1),l(L,{icon:t(e).options.startCollapsed?"mdi-chevron-down":"mdi-chevron-up",variant:"text",size:"36",class:"mt-[-6px] opacity-60",onClick:s[0]||(s[0]=o=>t(e).options.startCollapsed=!t(e).options.startCollapsed)},null,8,["icon"])]),y(i("div",ke,[y(i("iframe",{ref_key:"iframe",ref:x,src:g.value,style:b(z.value),frameborder:"0",onLoad:O},null,44,Le),[[M,c.value]])],512),[[M,!t(e).options.startCollapsed]])])],14,_e)):(m(),V("div",Me,[(m(),ne(de,{to:".widgets-view"},[y(i("iframe",{ref_key:"iframe",ref:x,src:g.value,style:b([z.value,{position:"absolute"}]),frameborder:"0",onLoad:O},null,44,Se),[[M,c.value]])]))])),l(be,{modelValue:t(r).widgetManagerVars(t(e).hash).configMenuOpen,"onUpdate:modelValue":s[7]||(s[7]=o=>t(r).widgetManagerVars(t(e).hash).configMenuOpen=o),"min-width":"600","max-width":"45%"},{default:d(()=>[l(re,{class:"pa-2",style:b(t(S).globalGlassMenuStyles)},{default:d(()=>[l(ue,{class:"text-center"},{default:d(()=>s[9]||(s[9]=[A("Settings")])),_:1,__:[9]}),l(ce,null,{default:d(()=>[i("div",null,[s[10]||(s[10]=i("p",null,"Iframe Source",-1)),i("div",Re,[l(W,{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=o=>n.value=o),variant:"outlined",rules:[C(B(n.value,t(e).options.useVehicleAddressAsBase))],placeholder:t(e).options.useVehicleAddressAsBase?"/my-service":"http://example.com",onKeydown:pe(U,["enter"])},ve({_:2},[t(e).options.useVehicleAddressAsBase?{name:"prepend-inner",fn:d(()=>[i("span",De,I(R.value),1)]),key:"0"}:void 0]),1032,["modelValue","rules","placeholder"]),y(l(L,{icon:"mdi-check",class:"mx-1 mb-5 bg-[#FFFFFF22]",rounded:"lg",flat:"",onClick:U},null,512),[[me,"Set",void 0,{bottom:!0}]])])]),i("div",Fe,[l(fe,{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=o=>_.value=o),label:"Transparency",color:"white",min:0,max:90},null,8,["modelValue"])]),l(he,{compact:"","is-expanded":!0,"no-bottom-divider":"","no-top-divider":""},{title:d(()=>s[11]||(s[11]=[A("Advanced options")])),content:d(()=>[l(j,{modelValue:t(e).options.useVehicleAddressAsBase,"onUpdate:modelValue":[s[3]||(s[3]=o=>t(e).options.useVehicleAddressAsBase=o),H],label:"Use vehicle address as base URL",color:"white",density:"compact","hide-details":"",class:"ml-3 my-2"},null,8,["modelValue"]),i("div",$e,[l(j,{modelValue:t(e).options.isCollapsible,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).options.isCollapsible=o),label:"Collapsible container",color:"white",class:"ml-2"},null,8,["modelValue"]),t(e).options.isCollapsible?(m(),V("div",ze,[l(W,{modelValue:t(e).options.containerName,"onUpdate:modelValue":s[5]||(s[5]=o=>t(e).options.containerName=o),label:"Container name","item-title":"name",density:"compact",variant:"outlined","no-data-text":"iframe","hide-details":"",theme:"dark",class:"w-[300px] mt-2"},null,8,["modelValue"])])):ge("",!0)])]),_:1})]),_:1}),l(we,{width:"80%",inset:""}),l(Ve,{class:"flex justify-end mt-2"},{default:d(()=>[l(L,{color:"white",onClick:s[6]||(s[6]=o=>t(r).widgetManagerVars(t(e).hash).configMenuOpen=!1)},{default:d(()=>s[12]||(s[12]=[A(" Close ")])),_:1,__:[12]})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]))}}),Ee=Ae(Oe,[["__scopeId","data-v-ccf9ee50"]]);export{Ee as default};
