import{c as Ue,bO as dt,z as jt,bP as Yt,r as n,w as x,k as I,I as q,m as T,O as v,n as Z,H as r,U as Te,ae as Kt,K as bt,aq as yt,ax as Qt,aY as Le,o as xt,ay as z,V as kt,N as re,v as u,P as wt,a7 as B,a6 as vt,Q as U,R as Mt,az as Ct,l as j,F as Vt,q as Jt,aA as Se,bQ as Xt,a_ as ea,x as Be,t as He,S as mt,s as W,aP as ta,am as Ne,bH as aa,W as Tt,_ as St,bD as oa,J as la,af as ia,u as sa,j as na,M as pt,Y as ft,L as ra,bR as ua,bS as Ce,bT as d,bU as E,al as ca,aU as da,bV as va,bW as ma,bX as gt,bY as pa,bZ as fa,b_ as ga,a0 as ha,y as ba,bj as ya,G as ht,a5 as me,a$ as xa,a8 as ka,aG as ne,a4 as Ve,b$ as wa,ad as Ma,c0 as Ca,c1 as Va}from"./index-Dsni_2CJ.js";const Ta=Ue({__name:"GlobalOriginDialog",props:dt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:dt(["origin-set"],["update:modelValue"]),setup(ee,{emit:te}){const{openSnackbar:L}=jt(),w=Yt(ee,"modelValue"),Y=te,O=ee,i=n(O.initialLatitude),c=n(O.initialLongitude),a=n(0),C=n(!1);x(()=>[O.initialLatitude,O.initialLongitude],([D,M])=>{i.value=D,c.value=M});const S=I(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&c.value!==null&&c.value!==void 0&&c.value>=-180&&c.value<=180&&a.value!==null&&a.value!==void 0),b=()=>{w.value=!1},K=async()=>{if(!(!S.value||C.value)){C.value=!0;try{await O.vehicle.setGlobalOrigin([i.value,c.value],a.value),L({message:"Global origin set successfully.",variant:"success"}),Y("origin-set",i.value,c.value),b()}catch(D){L({message:`Failed to set global origin: ${D}`,variant:"error"})}finally{C.value=!1}}},$=I(()=>[{text:"Cancel",action:b,disabled:C.value},{text:C.value?"Saving...":"Save",disabled:!S.value||C.value,action:K,class:C.value?"opacity-70":""}]);return(D,M)=>(T(),q(Kt,{"show-dialog":w.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:$.value,"onUpdate:showDialog":M[3]||(M[3]=m=>w.value=m)},{content:v(()=>[M[4]||(M[4]=Z("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),r(Te,{modelValue:i.value,"onUpdate:modelValue":M[0]||(M[0]=m=>i.value=m),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",suffix:"°",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Latitude is required",m=>m>=-90&&m<=90||"Latitude must be between -90 and 90"],class:"mb-6"},null,8,["modelValue","rules"]),r(Te,{modelValue:c.value,"onUpdate:modelValue":M[1]||(M[1]=m=>c.value=m),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",suffix:"°",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Longitude is required",m=>m>=-180&&m<=180||"Longitude must be between -180 and 180"],class:"mb-6"},null,8,["modelValue","rules"]),r(Te,{modelValue:a.value,"onUpdate:modelValue":M[2]||(M[2]=m=>a.value=m),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",suffix:"m",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",class:"mb-2",rules:[m=>m!=null||"Altitude is required"]},null,8,["modelValue","rules"])]),_:1},8,["show-dialog","actions"]))}}),Sa={class:"flex justify-end"},La={key:0,class:"fixed top-[80px] right-5"},Oa={key:1,class:"flex w-full items-center"},Ea={class:"flex justify-between w-full py-1 px-2 pt-3"},Ia={class:"flex items-center"},$a=Ue({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(ee,{emit:te}){const L=bt(),w=yt(),Y=ee,O=te,i=Qt("cockpit-pre-arm-checklist",[]),c=n({}),a=n(""),C=n(null),S=n(!1),b=I(()=>Y.modelValue),K=()=>{const g={};for(const l of i.value??[])g[l.id]=!1;c.value=g},$=I(()=>{if(!w.showChecklistBeforeArm)return!0;const g=i.value??[];return g.length>0&&g.every(l=>c.value[l.id]===!0)});x(()=>b.value,g=>{g?(K(),Le(()=>{var l,p;return(p=(l=C.value)==null?void 0:l.focus)==null?void 0:p.call(l)})):(c.value={},S.value=!1)}),x(()=>i.value,g=>{if(!b.value)return;const l={...c.value},p={};for(const V of g??[])p[V.id]=!0,V.id in l||(l[V.id]=!1);for(const V of Object.keys(l)){const H=Number(V);p[H]||delete l[H]}c.value=l},{deep:!0});const D=async()=>{var p,V;const g=a.value.trim();if(!g)return;const l={id:Date.now(),text:g};i.value.push(l),b.value&&(c.value[l.id]=!1),a.value="",await Le(),(V=(p=C.value)==null?void 0:p.focus)==null||V.call(p)},M=g=>{if(i.value=i.value.filter(l=>l.id!==g),g in c.value){const l={...c.value};delete l[g],c.value=l}},m=()=>{O("dismissed"),O("update:modelValue",!1)},ue=()=>{O("confirmed",!0),O("update:modelValue",!1)};return xt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),b.value&&K()}),x(()=>w.showChecklistBeforeArm,g=>{g||z({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(g,l)=>(T(),q(Tt,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=p=>b.value=p),"max-width":"600",scrollable:"",persistent:""},{default:v(()=>[r(kt,{style:re(u(L).globalGlassMenuStyles),class:"rounded-lg"},{default:v(()=>[r(wt,{class:"text-center relative pt-3"},{default:v(()=>[l[6]||(l[6]=Z("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(B,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:m},{default:v(()=>[r(vt,null,{default:v(()=>l[5]||(l[5]=[U("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Mt,{class:"mt-[-10px]"},{default:v(()=>[r(Ct,{lines:"one",theme:"dark",class:"bg-transparent"},{default:v(()=>[(T(!0),j(Vt,null,Jt(u(i),p=>(T(),q(Se,{key:p.id,theme:"dark"},Xt({prepend:v(()=>[r(mt,{modelValue:c.value[p.id],"onUpdate:modelValue":V=>c.value[p.id]=V,class:"mt-0","hide-details":"",density:"compact",disabled:!u(w).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:v(()=>[r(ea,{class:Be([{"line-through opacity-60":c.value[p.id]},{"opacity-50":!u(w).showChecklistBeforeArm}])},{default:v(()=>[U(He(p.text),1)]),_:2},1032,["class"])]),_:2},[S.value&&u(i).length>1?{name:"append",fn:v(()=>[r(B,{icon:"",variant:"text",disabled:!u(w).showChecklistBeforeArm,onClick:V=>M(p.id)},{default:v(()=>[r(vt,null,{default:v(()=>l[7]||(l[7]=[U("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Z("div",Sa,[S.value?(T(),j("div",Oa,[S.value?(T(),q(Te,{key:0,ref_key:"newItemInput",ref:C,modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=p=>a.value=p),disabled:!u(w).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:ta(D,["enter"]),"onClick:appendInner":D},null,8,["modelValue","disabled"])):W("",!0),r(B,{"prepend-icon":"mdi-check",disabled:!u(w).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{S.value=!1,D()})},{default:v(()=>l[9]||(l[9]=[U("Done")])),_:1,__:[9]},8,["disabled"])])):(T(),j("div",La,[r(B,{"prepend-icon":"mdi-format-list-checks",disabled:!u(w).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=p=>S.value=!0)},{default:v(()=>l[8]||(l[8]=[U(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Ne,{class:"flex center w-[80%]",inset:""}),r(aa,null,{default:v(()=>[Z("div",Ea,[r(B,{variant:"text",onClick:m},{default:v(()=>l[10]||(l[10]=[U("Cancel")])),_:1,__:[10]}),Z("div",Ia,[r(mt,{"model-value":!u(w).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=p=>u(w).showChecklistBeforeArm=!p)},null,8,["model-value"]),l[11]||(l[11]=Z("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(B,{color:"#ffffff33",class:Be({"opacity-30":!$.value}),variant:"flat",disabled:!$.value,onClick:ue},{default:v(()=>l[12]||(l[12]=[U("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Aa=St($a,[["__scopeId","data-v-b0b8e43a"]]),Fa=["id"],_a={key:0},Da=Ue({__name:"Map",props:{widget:{}},setup(ee){var ut;oa(e=>({d1cc28a6:Ut.value}));const te=ee,L=la(te).widget,w=bt(),{showDialog:Y,closeDialog:O}=ia(),i=sa(),c=yt(),a=n(),C=n(c.defaultMapZoom),S=n(c.defaultMapCenter),b=n(),K=I(()=>`map-${L.value.hash}`),$=I(()=>Oe.value||ae.value),D=n(!1),M=n([]),m=n(),ue=n(!1),g=n(!1),l=n(!1),p=n(!1),V=n(0),H=n(0),pe=n("");let fe,ge,he;const ae=n(!1),Lt=()=>{fe==null||fe.click(),ae.value=!1},Ot=()=>{ge==null||ge.click(),ae.value=!1},Et=()=>{he==null||he.click(),ae.value=!1};let Ge;const Re=e=>{e.touches.length>1&&(g.value=!0,R.value&&we(),clearTimeout(Ge))},We=e=>{e.touches.length<=1&&(Ge=window.setTimeout(()=>g.value=!1,300))},oe=n(null),P=n({});pt.registerUsage(ft.latitude),pt.registerUsage(ft.longitude),ra(()=>{Object.keys(L.value.options).length===0&&(L.value.options={showVehiclePath:!0}),A.enableAutoUpdate()});const be=Ce.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),ye=Ce.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),xe=Ce.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),qe=d.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),It={OpenStreetMap:be,"Esri World Imagery":ye},$t={Seamarks:xe,"Marine Profile":qe},le=n(),Oe=na(le),Ze=d.control.zoom({position:"bottomright"}),je=d.control.layers(It,$t);x($,()=>{a.value!==void 0&&($.value?(a.value.addControl(Ze),a.value.addControl(je)):(a.value.removeControl(Ze),a.value.removeControl(je)))}),x(Oe,()=>{$.value=Oe.value}),xt(async()=>{var X,ct;(X=le.value)==null||X.addEventListener("touchstart",Re,{passive:!0}),(ct=le.value)==null||ct.addEventListener("touchend",We,{passive:!0}),a.value=d.map(K.value,{layers:[be,ye,xe,qe],attributionControl:!1}).setView(S.value,C.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",y=>{k.value=[y.latlng.lat,y.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:y,lng:N}=a.value.getCenter();y&&N&&(S.value=[y,N])});const e=Ee(ye,"Esri",19),t=Ee(be,"OSM",19),o=Ee(xe,"Seamarks",18);a.value&&(e.addTo(a.value),t.addTo(a.value),o.addTo(a.value));const s=y=>{var ve;const N=((ve=y.getContainer)==null?void 0:ve.call(y))??y._container;N&&(N.classList.add("hidden-savetiles"),N.style.display="none")};s(e),s(t),s(o),await Le();const h=y=>{var ve;const N=((ve=y.getContainer)==null?void 0:ve.call(y))??y._container;return Array.from((N==null?void 0:N.querySelectorAll("a"))??[])},[f]=h(e),[_]=h(t),[J]=h(o);fe=f,ge=_,he=J,Ie(ye,"Esri"),Ie(be,"OSM"),Ie(xe,"Seamarks"),a.value.on("dragstart",()=>{ue.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ue.value=!1,200)}),a.value.on("zoomend",()=>{var y;R.value=!1,a.value!==void 0&&(C.value=((y=a.value)==null?void 0:y.getZoom())??S.value)}),a.value.on("contextmenu",y=>{k.value=[y.latlng.lat,y.latlng.lng]}),A.enableAutoUpdate(),window.addEventListener("keydown",tt),F.value?A.goToTarget(E.VEHICLE):A.goToTarget(E.HOME),!i.isVehicleOnline&&c.vehicleMission.length&&Pe(c.vehicleMission),D.value=!0,await $e()});const At=e=>(t,o)=>{Y({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:O},{text:"Save tiles",color:"white",action:()=>{o(),O()}}]})},Ft=e=>(t,o)=>{Y({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:O},{text:"Remove tiles",color:"white",action:()=>{o(),O(),z({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Ee=(e,t,o)=>Ce.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:At(t),confirmRemoval:Ft(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Ie=(e,t)=>{e.on("savestart",o=>{var s;V.value=0,H.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,pe.value=t,p.value=!0,z({message:`Saving ${H.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{V.value+=1,H.value>0&&V.value>=H.value&&(z({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),p.value=!1,pe.value="",V.value=0,H.value=0)})},_t={open:e=>{if(!a.value||g.value||ue.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);k.value=[o.lat,o.lng],m.value.openAt(e),R.value=!0},close:()=>{we()}},Ye=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof d.Marker||t instanceof d.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),M.value=[],ke.value=void 0,Q.value=void 0,se.value=void 0,G.value=void 0},$e=async()=>{D.value&&(Ye(),i.isVehicleOnline?await ot():c.vehicleMission.length&&Pe(c.vehicleMission))};x(()=>i.isVehicleOnline,()=>{$e()}),x(()=>c.vehicleMissionRevision,()=>{$e()}),ca(()=>{var e,t;A.disableAutoUpdate(),window.removeEventListener("keydown",tt),a.value&&(a.value.off("contextmenu"),Object.values(P.value).forEach(o=>o.remove()),P.value={}),(e=le.value)==null||e.removeEventListener("touchstart",Re),(t=le.value)==null||t.removeEventListener("touchend",We)}),x(S,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(C,(e,t)=>{var o;e!==t&&(R.value=!1,(o=a.value)==null||o.setZoom(C.value))}),x(te.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ie=n(void 0),A=new ua(e=>ie.value=e,e=>S.value=e);A.setTrackableTarget(E.VEHICLE,()=>F.value),A.setTrackableTarget(E.HOME,()=>b.value);const F=I(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),Ae=I(()=>{var e;return i.attitude.yaw?da((e=i.attitude)==null?void 0:e.yaw):0}),Ke=I(()=>{const e=i.lastHeartbeat;return e?`${va(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Dt}=ma(F);(ut=navigator==null?void 0:navigator.geolocation)==null||ut.watchPosition(e=>{b.value||(b.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Qe=!0;x([b,a],async()=>{b.value===S.value||!a.value||!Qe||(A.goToTarget(E.HOME),Qe=!1)});const G=n();x(i.coordinates,()=>{if(!(!a.value||!F.value)){if(G.value===void 0){let e=pa;i.vehicleType===gt.MAV_TYPE_SURFACE_BOAT?e=fa:i.vehicleType===gt.MAV_TYPE_SUBMARINE&&(e=ga);const t=d.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});G.value=d.marker(F.value,{icon:t});const o=d.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});G.value.bindTooltip(o),a.value.addLayer(G.value)}G.value.setLatLng(F.value)}}),x(F,(e,t)=>{ie.value===E.VEHICLE||t!==void 0||A.follow(E.VEHICLE)}),x([F,Ae,Ke,()=>i.isArmed],()=>{var t,o,s,h,f;if(G.value===void 0)return;(h=G.value.getTooltip())==null||h.setContent(`
    <p>Coordinates: ${(t=F.value)==null?void 0:t[0].toFixed(6)}, ${(o=F.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=i.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Ae.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Ke.value}</p>
  `);const e=(f=G.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${Ae.value}deg)`)});const Q=n();x(b,()=>{if(a.value===void 0)return;const e=b.value;if(e!==void 0)if(Q.value)Q.value.setLatLng(e);else{Q.value=d.marker(e,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=d.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});Q.value.bindTooltip(t),Q.value.on("dragend",o=>{const h=o.target.getLatLng();ze([h.lat,h.lng])}),a.value.addLayer(Q.value)}});const ke=n();x(M,e=>{a.value&&(ke.value||(ke.value=d.polyline([],{color:"#358AC3"}).addTo(a.value)),ke.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var f;const s=d.marker(t.coordinates);s.setIcon(d.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const h=d.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(h),(f=a.value)==null||f.addLayer(s)}))},{deep:!0});const Fe=n();x(Dt,e=>{if(a.value===void 0||e===void 0)return;Fe.value===void 0&&(Fe.value=d.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);Fe.value.setLatLngs(t)});const R=n(!1),k=n(null),Je=n(),_e=n(!1),Xe=n(0),et=n(0),De=n(),Pt=ha([{item:"Set home waypoint",action:()=>ce("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>ce("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ce("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ce("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ce("set-default-map-position"),icon:"mdi-map-check"}]),se=n(),zt=async()=>{var e;if(!(!a.value||!k.value))try{await c.setDefaultMapPosition(k.value,C.value),z({message:"Default map position set",variant:"success"});const t=d.marker(k.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=d.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),h=(e=t.getTooltip())==null?void 0:e.getElement();[s,h].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[s,h].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=a.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),z({message:"Failed to set default map position",variant:"error"})}},Bt=async()=>{if(!k.value||!a.value)return;se.value&&(a.value.removeLayer(se.value),se.value=void 0),se.value=d.marker(k.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=d.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(se.value.bindTooltip(e),k.value){const f=i.coordinates.altitude??0,_=k.value[0],J=k.value[1];try{await i.goTo(0,0,0,0,_,J,f)}catch(X){z({message:`GoTo request failed: ${X.message}`,variant:"error"})}}},ce=async e=>{switch(e){case"goto":{Bt();break}case"set-default-map-position":zt();break;case"place-poi":k.value&&oe.value?oe.value.openDialog(k.value):k.value?oe.value||(z({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(z({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":k.value&&ze(k.value);break;case"set-global-origin":k.value&&(Xe.value=k.value[0],et.value=k.value[1],_e.value=!0);break;default:console.warn("Unknown menu option selected:",e)}R.value=!1},we=()=>{R.value=!1,a.value!==void 0&&Je.value!==void 0&&a.value.removeLayer(Je.value)},Ht=(e,t)=>{if(!a.value)return;De.value&&a.value.removeLayer(De.value);const o=d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),s=d.marker([e,t],{icon:o}).addTo(a.value),h=d.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(h),De.value=s},tt=e=>{e.key==="Escape"&&we()},Pe=e=>{e.forEach((t,o)=>{o===0?(b.value=t.coordinates,ze(t.coordinates)):M.value.push(t)})},Me=n(!1),at=n(0),ot=async()=>{Me.value=!0,Ye();const e=async t=>{at.value=t};try{const t=await i.fetchMission(e);Pe(t),z({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){Y({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Me.value=!1}},ze=async e=>{const t=[e[0],e[1]];b.value=t,await i.setHomeWaypoint(t,0),R.value&&(R.value=!1)},lt=async()=>{try{await i.startMission()}catch{z({message:"Failed to start mission.",variant:"error"})}},Nt=async()=>{if(c.showChecklistBeforeArm){l.value=!0;return}lt()},de=ba(),Ut=I(()=>`${Math.max(-de.widgetClearanceForVisibleArea(L.value).bottom,0)}px`),it=I(()=>`${Math.max(-de.widgetClearanceForVisibleArea(L.value).top,0)}px`),Gt=I(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Rt=I(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),Wt=I(()=>b.value===void 0?"Cannot center map on home (home position undefined).":ie.value===E.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),qt=I(()=>i.isVehicleOnline?F.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ie.value===E.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),st=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),nt=e=>{if(!a.value||!a.value.getContainer())return;const t=d.divIcon(st(e)),o=d.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,h={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,h),o.on("drag",f=>{var X;const _=f.target.getLatLng(),J=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${_.lat.toFixed(8)}, Lng: ${_.lng.toFixed(8)}
    `;(X=o.getTooltip())==null||X.setContent(J)}),o.on("dragend",f=>{const _=f.target.getLatLng();c.movePointOfInterest(e.id,[_.lat,_.lng])}),o.on("click",f=>{if(d.DomEvent.stopPropagation(f),oe.value){const _=c.pointsOfInterest.find(J=>J.id===e.id);_?oe.value.openDialog(void 0,_):console.warn("POI not found in store:",e.id)}}),P.value[e.id]=o},rt=e=>{var s;if(!a.value||!a.value.getContainer()||!P.value[e.id])return;const t=P.value[e.id];t.setLatLng(e.coordinates),t.setIcon(d.divIcon(st(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},Zt=e=>{!a.value||!P.value[e]||(P.value[e].remove(),delete P.value[e])};return x(()=>c.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Le(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(P.value).forEach(o=>{t.has(o)||Zt(o)}),e.forEach(o=>{P.value[o.id]?rt(o):nt(o)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&c.pointsOfInterest.forEach(t=>{P.value[t.id]?rt(t):nt(t)})},{immediate:!0}),(e,t)=>{const o=ya("contextmenu");return T(),j(Vt,null,[ht((T(),j("div",{ref_key:"mapBase",ref:le,class:Be(["page-base",u(de).editingMode?"pointer-events-none":"pointer-events-auto"])},[Z("div",{id:K.value,ref_key:"map",ref:a,class:"map"},[r(ka,{modelValue:ae.value,"onUpdate:modelValue":t[0]||(t[0]=s=>ae.value=s),"close-on-content-click":!1,location:"top end"},{activator:v(({props:s})=>[ht(r(B,me(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[xa,$.value]])]),default:v(()=>[r(Ct,{style:re(u(w).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:v(()=>[r(Se,{class:"py-0",title:"Save visible Esri tiles",onClick:Lt}),r(Ne),r(Se,{class:"py-0",title:"Save visible OSM tiles",onClick:Ot}),r(Ne),r(Se,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Et})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(Ve,{location:"top",text:Wt.value},{activator:v(({props:s})=>[$.value?(T(),q(B,me({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",b.value?"":"active-events-on-disabled"],color:ie.value==u(E).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!b.value,onClick:t[1]||(t[1]=ne(h=>u(A).goToTarget(u(E).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=ne(h=>u(A).follow(u(E).HOME),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:qt.value},{activator:v(({props:s})=>[$.value?(T(),q(B,me({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",F.value?"":"active-events-on-disabled"],color:ie.value==u(E).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!F.value,onClick:t[3]||(t[3]=ne(h=>u(A).goToTarget(u(E).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=ne(h=>u(A).follow(u(E).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:Gt.value},{activator:v(({props:s})=>[$.value?(T(),q(B,me({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",u(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:ne(ot,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:Rt.value},{activator:v(({props:s})=>[$.value?(T(),q(B,me({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",u(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:ne(Nt,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"])],8,Fa)],2)),[[o,_t]]),r(wa,{ref_key:"contextMenuRef",ref:m,visible:R.value,width:"260px","menu-items":Pt,onClose:we},null,8,["visible","menu-items"]),r(Tt,{modelValue:u(de).widgetManagerVars(u(L).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>u(de).widgetManagerVars(u(L).hash).configMenuOpen=s),width:"auto"},{default:v(()=>[r(kt,{class:"pa-2",style:re(u(w).globalGlassMenuStyles)},{default:v(()=>[r(wt,{class:"text-center"},{default:v(()=>t[9]||(t[9]=[U("Map widget settings")])),_:1,__:[9]}),r(Mt,null,{default:v(()=>[r(Ma,{modelValue:u(L).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>u(L).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:u(L).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Me.value?(T(),q(Ca,{key:0,"model-value":at.value,height:"10",absolute:"",bottom:"",color:"white",style:re(`top: ${it.value}`)},null,8,["model-value","style"])):W("",!0),Me.value?(T(),j("p",{key:1,style:re({top:it.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):W("",!0),r(Va,{ref_key:"poiManagerMapWidgetRef",ref:oe},null,512),r(Aa,{"model-value":l.value,onConfirmed:lt,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value=s)},null,8,["model-value"]),r(Ta,{modelValue:_e.value,"onUpdate:modelValue":t[8]||(t[8]=s=>_e.value=s),vehicle:u(i).mainVehicle,"initial-latitude":Xe.value,"initial-longitude":et.value,onOriginSet:Ht},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),p.value?(T(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:re(u(w).globalGlassMenuStyles)},[Z("p",null,[t[10]||(t[10]=U(" Saving offline map content ")),pe.value?(T(),j("span",_a,"("+He(pe.value)+")",1)):W("",!0),U(":  "+He(H.value?Math.round(V.value/H.value*100):0)+"% ",1)])],4)):W("",!0)],64)}}}),za=St(Da,[["__scopeId","data-v-38d52f44"]]);export{za as default};
