import{c as Ue,bO as Gt,z as Zt,bP as jt,r,w as x,k as I,I as G,m as V,O as c,n as Z,H as n,U as De,ae as qt,K as gt,aq as ht,ax as Yt,aY as Se,o as bt,ay as D,V as yt,N as se,v as u,P as xt,a7 as z,a6 as ct,Q as U,R as kt,az as wt,l as j,F as Ct,q as Kt,aA as Te,bQ as Qt,a_ as Jt,x as ze,t as Be,S as dt,s as W,aP as Xt,am as He,bH as ea,W as Mt,_ as Vt,bD as ta,J as aa,af as oa,u as ia,j as la,M as vt,Y as mt,L as sa,bR as na,bS as Me,bT as p,bU as L,al as ra,aU as ua,bV as ca,bW as da,bX as pt,bY as va,bZ as ma,b_ as pa,a0 as fa,y as ga,bj as ha,G as ft,a5 as me,a$ as ba,a8 as ya,aG as le,a4 as Ve,b$ as xa,ad as ka,c0 as wa,c1 as Ca}from"./index-G_wwCBAx.js";const Ma=Ue({__name:"ExternalPositionEstimateDialog",props:Gt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(J){const{openSnackbar:q}=Zt(),T=jt(J,"modelValue"),k=J,O=r(k.initialLatitude),C=r(k.initialLongitude),l=r(!1);x(()=>[k.initialLatitude,k.initialLongitude],([g,S])=>{O.value=g,C.value=S});const d=I(()=>O.value!==null&&O.value!==void 0&&O.value>=-90&&O.value<=90&&C.value!==null&&C.value!==void 0&&C.value>=-180&&C.value<=180),a=()=>{T.value=!1},_=async()=>{if(!(!d.value||l.value)){l.value=!0;try{await k.vehicle.setExternalPositionEstimate([O.value,C.value]),q({message:"Position estimate sent to vehicle.",variant:"success"}),a()}catch(g){q({message:`Failed to set position estimate: ${g}`,variant:"error"})}finally{l.value=!1}}},E=I(()=>[{text:"Cancel",action:a,disabled:l.value},{text:l.value?"Saving...":"Save",disabled:!d.value||l.value,action:_,class:l.value?"opacity-70":""}]);return(g,S)=>(V(),G(qt,{"show-dialog":T.value,title:"Set Position Estimate",variant:"text-only","max-width":"500px",actions:E.value,"onUpdate:showDialog":S[2]||(S[2]=v=>T.value=v)},{content:c(()=>[S[3]||(S[3]=Z("p",{class:"text-sm mb-4 text-gray-300"}," This feature allows you to set the vehicle's global position estimate. This is especially useful when using local position units (such as indoor positioning systems) where you want to define a corresponding global position for the EKF (Extended Kalman Filter). ",-1)),n(De,{modelValue:O.value,"onUpdate:modelValue":S[0]||(S[0]=v=>O.value=v),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",suffix:"°",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[v=>v!=null||"Latitude is required",v=>v>=-90&&v<=90||"Latitude must be between -90 and 90"],class:"mb-4"},null,8,["modelValue","rules"]),n(De,{modelValue:C.value,"onUpdate:modelValue":S[1]||(S[1]=v=>C.value=v),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",suffix:"°",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[v=>v!=null||"Longitude is required",v=>v>=-180&&v<=180||"Longitude must be between -180 and 180"]},null,8,["modelValue","rules"])]),_:1},8,["show-dialog","actions"]))}}),Va={class:"flex justify-end"},Ta={key:0,class:"fixed top-[80px] right-5"},Sa={key:1,class:"flex w-full items-center"},Ea={class:"flex justify-between w-full py-1 px-2 pt-3"},La={class:"flex items-center"},Ia=Ue({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(J,{emit:q}){const T=gt(),k=ht(),O=J,C=q,l=Yt("cockpit-pre-arm-checklist",[]),d=r({}),a=r(""),_=r(null),E=r(!1),g=I(()=>O.modelValue),S=()=>{const h={};for(const i of l.value??[])h[i.id]=!1;d.value=h},v=I(()=>{if(!k.showChecklistBeforeArm)return!0;const h=l.value??[];return h.length>0&&h.every(i=>d.value[i.id]===!0)});x(()=>g.value,h=>{h?(S(),Se(()=>{var i,m;return(m=(i=_.value)==null?void 0:i.focus)==null?void 0:m.call(i)})):(d.value={},E.value=!1)}),x(()=>l.value,h=>{if(!g.value)return;const i={...d.value},m={};for(const M of h??[])m[M.id]=!0,M.id in i||(i[M.id]=!1);for(const M of Object.keys(i)){const B=Number(M);m[B]||delete i[B]}d.value=i},{deep:!0});const X=async()=>{var m,M;const h=a.value.trim();if(!h)return;const i={id:Date.now(),text:h};l.value.push(i),g.value&&(d.value[i.id]=!1),a.value="",await Se(),(M=(m=_.value)==null?void 0:m.focus)==null||M.call(m)},ne=h=>{if(l.value=l.value.filter(i=>i.id!==h),h in d.value){const i={...d.value};delete i[h],d.value=i}},re=()=>{C("dismissed"),C("update:modelValue",!1)},ue=()=>{C("confirmed",!0),C("update:modelValue",!1)};return bt(()=>{l.value.length===0&&(l.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),g.value&&S()}),x(()=>k.showChecklistBeforeArm,h=>{h||D({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(h,i)=>(V(),G(Mt,{modelValue:g.value,"onUpdate:modelValue":i[4]||(i[4]=m=>g.value=m),"max-width":"600",scrollable:"",persistent:""},{default:c(()=>[n(yt,{style:se(u(T).globalGlassMenuStyles),class:"rounded-lg"},{default:c(()=>[n(xt,{class:"text-center relative pt-3"},{default:c(()=>[i[6]||(i[6]=Z("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),n(z,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:re},{default:c(()=>[n(ct,null,{default:c(()=>i[5]||(i[5]=[U("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),n(kt,{class:"mt-[-10px]"},{default:c(()=>[n(wt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:c(()=>[(V(!0),j(Ct,null,Kt(u(l),m=>(V(),G(Te,{key:m.id,theme:"dark"},Qt({prepend:c(()=>[n(dt,{modelValue:d.value[m.id],"onUpdate:modelValue":M=>d.value[m.id]=M,class:"mt-0","hide-details":"",density:"compact",disabled:!u(k).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:c(()=>[n(Jt,{class:ze([{"line-through opacity-60":d.value[m.id]},{"opacity-50":!u(k).showChecklistBeforeArm}])},{default:c(()=>[U(Be(m.text),1)]),_:2},1032,["class"])]),_:2},[E.value&&u(l).length>1?{name:"append",fn:c(()=>[n(z,{icon:"",variant:"text",disabled:!u(k).showChecklistBeforeArm,onClick:M=>ne(m.id)},{default:c(()=>[n(ct,null,{default:c(()=>i[7]||(i[7]=[U("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Z("div",Va,[E.value?(V(),j("div",Sa,[E.value?(V(),G(De,{key:0,ref_key:"newItemInput",ref:_,modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=m=>a.value=m),disabled:!u(k).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:Xt(X,["enter"]),"onClick:appendInner":X},null,8,["modelValue","disabled"])):W("",!0),n(z,{"prepend-icon":"mdi-check",disabled:!u(k).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:i[2]||(i[2]=()=>{E.value=!1,X()})},{default:c(()=>i[9]||(i[9]=[U("Done")])),_:1,__:[9]},8,["disabled"])])):(V(),j("div",Ta,[n(z,{"prepend-icon":"mdi-format-list-checks",disabled:!u(k).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:i[0]||(i[0]=m=>E.value=!0)},{default:c(()=>i[8]||(i[8]=[U(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),n(He,{class:"flex center w-[80%]",inset:""}),n(ea,null,{default:c(()=>[Z("div",Ea,[n(z,{variant:"text",onClick:re},{default:c(()=>i[10]||(i[10]=[U("Cancel")])),_:1,__:[10]}),Z("div",La,[n(dt,{"model-value":!u(k).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":i[3]||(i[3]=m=>u(k).showChecklistBeforeArm=!m)},null,8,["model-value"]),i[11]||(i[11]=Z("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),n(z,{color:"#ffffff33",class:ze({"opacity-30":!v.value}),variant:"flat",disabled:!v.value,onClick:ue},{default:c(()=>i[12]||(i[12]=[U("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Oa=Vt(Ia,[["__scopeId","data-v-b0b8e43a"]]),$a=["id"],Fa={key:0},Pa=Ue({__name:"Map",props:{widget:{}},setup(J){var rt;ta(e=>({"0d825aae":Bt.value}));const q=J,T=aa(q).widget,k=gt(),{showDialog:O,closeDialog:C}=oa(),l=ia(),d=ht(),a=r(),_=r(d.defaultMapZoom),E=r(d.defaultMapCenter),g=r(),S=I(()=>`map-${T.value.hash}`),v=I(()=>Ee.value||ee.value),X=r(!1),ne=r([]),re=r(),ue=r(!1),h=r(!1),i=r(!1),m=r(!1),M=r(0),B=r(0),pe=r("");let fe,ge,he;const ee=r(!1),Tt=()=>{fe==null||fe.click(),ee.value=!1},St=()=>{ge==null||ge.click(),ee.value=!1},Et=()=>{he==null||he.click(),ee.value=!1};let Ne;const Re=e=>{e.touches.length>1&&(h.value=!0,R.value&&we(),clearTimeout(Ne))},We=e=>{e.touches.length<=1&&(Ne=window.setTimeout(()=>h.value=!1,300))},te=r(null),A=r({});vt.registerUsage(mt.latitude),vt.registerUsage(mt.longitude),sa(()=>{Object.keys(T.value.options).length===0&&(T.value.options={showVehiclePath:!0}),$.enableAutoUpdate()});const be=Me.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),ye=Me.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),xe=Me.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ge=p.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Lt={OpenStreetMap:be,"Esri World Imagery":ye},It={Seamarks:xe,"Marine Profile":Ge},ae=r(),Ee=la(ae),Ze=p.control.zoom({position:"bottomright"}),je=p.control.layers(Lt,It);x(v,()=>{a.value!==void 0&&(v.value?(a.value.addControl(Ze),a.value.addControl(je)):(a.value.removeControl(Ze),a.value.removeControl(je)))}),x(Ee,()=>{v.value=Ee.value}),bt(async()=>{var Q,ut;(Q=ae.value)==null||Q.addEventListener("touchstart",Re,{passive:!0}),(ut=ae.value)==null||ut.addEventListener("touchend",We,{passive:!0}),a.value=p.map(S.value,{layers:[be,ye,xe,Ge],attributionControl:!1}).setView(E.value,_.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",y=>{w.value=[y.latlng.lat,y.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:y,lng:H}=a.value.getCenter();y&&H&&(E.value=[y,H])});const e=Le(ye,"Esri",19),t=Le(be,"OSM",19),o=Le(xe,"Seamarks",18);a.value&&(e.addTo(a.value),t.addTo(a.value),o.addTo(a.value));const s=y=>{var ve;const H=((ve=y.getContainer)==null?void 0:ve.call(y))??y._container;H&&(H.classList.add("hidden-savetiles"),H.style.display="none")};s(e),s(t),s(o),await Se();const b=y=>{var ve;const H=((ve=y.getContainer)==null?void 0:ve.call(y))??y._container;return Array.from((H==null?void 0:H.querySelectorAll("a"))??[])},[f]=b(e),[P]=b(t),[K]=b(o);fe=f,ge=P,he=K,Ie(ye,"Esri"),Ie(be,"OSM"),Ie(xe,"Seamarks"),a.value.on("dragstart",()=>{ue.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ue.value=!1,200)}),a.value.on("zoomend",()=>{var y;R.value=!1,a.value!==void 0&&(_.value=((y=a.value)==null?void 0:y.getZoom())??E.value)}),a.value.on("contextmenu",y=>{w.value=[y.latlng.lat,y.latlng.lng]}),$.enableAutoUpdate(),window.addEventListener("keydown",et),F.value?$.goToTarget(L.VEHICLE):$.goToTarget(L.HOME),!l.isVehicleOnline&&d.vehicleMission.length&&_e(d.vehicleMission),X.value=!0,await Oe()});const Ot=e=>(t,o)=>{O({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:C},{text:"Save tiles",color:"white",action:()=>{o(),C()}}]})},$t=e=>(t,o)=>{O({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:C},{text:"Remove tiles",color:"white",action:()=>{o(),C(),D({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Le=(e,t,o)=>Me.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:Ot(t),confirmRemoval:$t(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Ie=(e,t)=>{e.on("savestart",o=>{var s;M.value=0,B.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,pe.value=t,m.value=!0,D({message:`Saving ${B.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{M.value+=1,B.value>0&&M.value>=B.value&&(D({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),m.value=!1,pe.value="",M.value=0,B.value=0)})},Ft={open:e=>{if(!a.value||h.value||ue.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);w.value=[o.lat,o.lng],re.value.openAt(e),R.value=!0},close:()=>{we()}},qe=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof p.Marker||t instanceof p.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),ne.value=[],ke.value=void 0,Y.value=void 0,ie.value=void 0,N.value=void 0},Oe=async()=>{X.value&&(qe(),l.isVehicleOnline?await at():d.vehicleMission.length&&_e(d.vehicleMission))};x(()=>l.isVehicleOnline,()=>{Oe()}),x(()=>d.vehicleMissionRevision,()=>{Oe()}),ra(()=>{var e,t;$.disableAutoUpdate(),window.removeEventListener("keydown",et),a.value&&(a.value.off("contextmenu"),Object.values(A.value).forEach(o=>o.remove()),A.value={}),(e=ae.value)==null||e.removeEventListener("touchstart",Re),(t=ae.value)==null||t.removeEventListener("touchend",We)}),x(E,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),x(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),x(_,(e,t)=>{var o;e!==t&&(R.value=!1,(o=a.value)==null||o.setZoom(_.value))}),x(q.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const oe=r(void 0),$=new na(e=>oe.value=e,e=>E.value=e);$.setTrackableTarget(L.VEHICLE,()=>F.value),$.setTrackableTarget(L.HOME,()=>g.value);const F=I(()=>l.coordinates.latitude?[l.coordinates.latitude,l.coordinates.longitude]:void 0),$e=I(()=>{var e;return l.attitude.yaw?ua((e=l.attitude)==null?void 0:e.yaw):0}),Ye=I(()=>{const e=l.lastHeartbeat;return e?`${ca(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Pt}=da(F);(rt=navigator==null?void 0:navigator.geolocation)==null||rt.watchPosition(e=>{g.value||(g.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Ke=!0;x([g,a],async()=>{g.value===E.value||!a.value||!Ke||($.goToTarget(L.HOME),Ke=!1)});const N=r();x(l.coordinates,()=>{if(!(!a.value||!F.value)){if(N.value===void 0){let e=va;l.vehicleType===pt.MAV_TYPE_SURFACE_BOAT?e=ma:l.vehicleType===pt.MAV_TYPE_SUBMARINE&&(e=pa);const t=p.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});N.value=p.marker(F.value,{icon:t});const o=p.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});N.value.bindTooltip(o),a.value.addLayer(N.value)}N.value.setLatLng(F.value)}}),x(F,(e,t)=>{oe.value===L.VEHICLE||t!==void 0||$.follow(L.VEHICLE)}),x([F,$e,Ye,()=>l.isArmed],()=>{var t,o,s,b,f;if(N.value===void 0)return;(b=N.value.getTooltip())==null||b.setContent(`
    <p>Coordinates: ${(t=F.value)==null?void 0:t[0].toFixed(6)}, ${(o=F.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=l.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${$e.value.toFixed(2)}°</p>
    <p>${l.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Ye.value}</p>
  `);const e=(f=N.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${$e.value}deg)`)});const Y=r();x(g,()=>{if(a.value===void 0)return;const e=g.value;if(e!==void 0)if(Y.value)Y.value.setLatLng(e);else{Y.value=p.marker(e,{icon:p.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=p.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});Y.value.bindTooltip(t),Y.value.on("dragend",o=>{const b=o.target.getLatLng();Ae([b.lat,b.lng])}),a.value.addLayer(Y.value)}});const ke=r();x(ne,e=>{a.value&&(ke.value||(ke.value=p.polyline([],{color:"#358AC3"}).addTo(a.value)),ke.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var f;const s=p.marker(t.coordinates);s.setIcon(p.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const b=p.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(b),(f=a.value)==null||f.addLayer(s)}))},{deep:!0});const Fe=r();x(Pt,e=>{if(a.value===void 0||e===void 0)return;Fe.value===void 0&&(Fe.value=p.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);Fe.value.setLatLngs(t)});const R=r(!1),w=r(null),Qe=r(),Pe=r(!1),Je=r(0),Xe=r(0),_t=fa([{item:"Set home waypoint",action:()=>ce("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Position Estimate",action:()=>ce("set-position"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ce("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ce("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ce("set-default-map-position"),icon:"mdi-map-check"}]),ie=r(),At=async()=>{var e;if(!(!a.value||!w.value))try{await d.setDefaultMapPosition(w.value,_.value),D({message:"Default map position set",variant:"success"});const t=p.marker(w.value,{icon:p.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=p.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),b=(e=t.getTooltip())==null?void 0:e.getElement();[s,b].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[s,b].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=a.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),D({message:"Failed to set default map position",variant:"error"})}},Dt=async()=>{if(!w.value||!a.value)return;ie.value&&(a.value.removeLayer(ie.value),ie.value=void 0),ie.value=p.marker(w.value,{icon:p.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=p.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(ie.value.bindTooltip(e),w.value){const f=l.coordinates.altitude??0,P=w.value[0],K=w.value[1];try{await l.goTo(0,0,0,0,P,K,f)}catch(Q){D({message:`GoTo request failed: ${Q.message}`,variant:"error"})}}},ce=async e=>{switch(e){case"goto":{Dt();break}case"set-default-map-position":At();break;case"place-poi":w.value&&te.value?te.value.openDialog(w.value):w.value?te.value||(D({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(D({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":w.value&&Ae(w.value);break;case"set-position":w.value&&(Je.value=w.value[0],Xe.value=w.value[1],Pe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}R.value=!1},we=()=>{R.value=!1,a.value!==void 0&&Qe.value!==void 0&&a.value.removeLayer(Qe.value)},et=e=>{e.key==="Escape"&&we()},_e=e=>{e.forEach((t,o)=>{o===0?(g.value=t.coordinates,Ae(t.coordinates)):ne.value.push(t)})},Ce=r(!1),tt=r(0),at=async()=>{Ce.value=!0,qe();const e=async t=>{tt.value=t};try{const t=await l.fetchMission(e);_e(t),D({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){O({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ce.value=!1}},Ae=async e=>{const t=[e[0],e[1]];g.value=t,await l.setHomeWaypoint(t,0),R.value&&(R.value=!1)},ot=async()=>{try{await l.startMission()}catch{D({message:"Failed to start mission.",variant:"error"})}},zt=async()=>{if(d.showChecklistBeforeArm){i.value=!0;return}ot()},de=ga(),Bt=I(()=>`${Math.max(-de.widgetClearanceForVisibleArea(T.value).bottom,0)}px`),it=I(()=>`${Math.max(-de.widgetClearanceForVisibleArea(T.value).top,0)}px`),Ht=I(()=>l.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Ut=I(()=>l.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),Nt=I(()=>g.value===void 0?"Cannot center map on home (home position undefined).":oe.value===L.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),Rt=I(()=>l.isVehicleOnline?F.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":oe.value===L.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),lt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),st=e=>{if(!a.value||!a.value.getContainer())return;const t=p.divIcon(lt(e)),o=p.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,b={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,b),o.on("drag",f=>{var Q;const P=f.target.getLatLng(),K=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${P.lat.toFixed(8)}, Lng: ${P.lng.toFixed(8)}
    `;(Q=o.getTooltip())==null||Q.setContent(K)}),o.on("dragend",f=>{const P=f.target.getLatLng();d.movePointOfInterest(e.id,[P.lat,P.lng])}),o.on("click",f=>{if(p.DomEvent.stopPropagation(f),te.value){const P=d.pointsOfInterest.find(K=>K.id===e.id);P?te.value.openDialog(void 0,P):console.warn("POI not found in store:",e.id)}}),A.value[e.id]=o},nt=e=>{var s;if(!a.value||!a.value.getContainer()||!A.value[e.id])return;const t=A.value[e.id];t.setLatLng(e.coordinates),t.setIcon(p.divIcon(lt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},Wt=e=>{!a.value||!A.value[e]||(A.value[e].remove(),delete A.value[e])};return x(()=>d.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Se(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(A.value).forEach(o=>{t.has(o)||Wt(o)}),e.forEach(o=>{A.value[o.id]?nt(o):st(o)})},{deep:!0,immediate:!0}),x(a,e=>{e&&e.getContainer()&&d.pointsOfInterest.forEach(t=>{A.value[t.id]?nt(t):st(t)})},{immediate:!0}),(e,t)=>{const o=ha("contextmenu");return V(),j(Ct,null,[ft((V(),j("div",{ref_key:"mapBase",ref:ae,class:ze(["page-base",u(de).editingMode?"pointer-events-none":"pointer-events-auto"])},[Z("div",{id:S.value,ref_key:"map",ref:a,class:"map"},[n(ya,{modelValue:ee.value,"onUpdate:modelValue":t[0]||(t[0]=s=>ee.value=s),"close-on-content-click":!1,location:"top end"},{activator:c(({props:s})=>[ft(n(z,me(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[ba,v.value]])]),default:c(()=>[n(wt,{style:se(u(k).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:c(()=>[n(Te,{class:"py-0",title:"Save visible Esri tiles",onClick:Tt}),n(He),n(Te,{class:"py-0",title:"Save visible OSM tiles",onClick:St}),n(He),n(Te,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Et})]),_:1},8,["style"])]),_:1},8,["modelValue"]),n(Ve,{location:"top",text:Nt.value},{activator:c(({props:s})=>[v.value?(V(),G(z,me({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",g.value?"":"active-events-on-disabled"],color:oe.value==u(L).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!g.value,onClick:t[1]||(t[1]=le(b=>u($).goToTarget(u(L).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=le(b=>u($).follow(u(L).HOME),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),n(Ve,{location:"top",text:Rt.value},{activator:c(({props:s})=>[v.value?(V(),G(z,me({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",F.value?"":"active-events-on-disabled"],color:oe.value==u(L).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!F.value,onClick:t[3]||(t[3]=le(b=>u($).goToTarget(u(L).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=le(b=>u($).follow(u(L).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),n(Ve,{location:"top",text:Ht.value},{activator:c(({props:s})=>[v.value?(V(),G(z,me({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",u(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:le(at,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"]),n(Ve,{location:"top",text:Ut.value},{activator:c(({props:s})=>[v.value?(V(),G(z,me({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",u(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:le(zt,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"])],8,$a)],2)),[[o,Ft]]),n(xa,{ref_key:"contextMenuRef",ref:re,visible:R.value,width:"260px","menu-items":_t,onClose:we},null,8,["visible","menu-items"]),n(Mt,{modelValue:u(de).widgetManagerVars(u(T).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>u(de).widgetManagerVars(u(T).hash).configMenuOpen=s),width:"auto"},{default:c(()=>[n(yt,{class:"pa-2",style:se(u(k).globalGlassMenuStyles)},{default:c(()=>[n(xt,{class:"text-center"},{default:c(()=>t[9]||(t[9]=[U("Map widget settings")])),_:1,__:[9]}),n(kt,null,{default:c(()=>[n(ka,{modelValue:u(T).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>u(T).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:u(T).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ce.value?(V(),G(wa,{key:0,"model-value":tt.value,height:"10",absolute:"",bottom:"",color:"white",style:se(`top: ${it.value}`)},null,8,["model-value","style"])):W("",!0),Ce.value?(V(),j("p",{key:1,style:se({top:it.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):W("",!0),n(Ca,{ref_key:"poiManagerMapWidgetRef",ref:te},null,512),n(Oa,{"model-value":i.value,onConfirmed:ot,"onUpdate:modelValue":t[7]||(t[7]=s=>i.value=s)},null,8,["model-value"]),n(Ma,{modelValue:Pe.value,"onUpdate:modelValue":t[8]||(t[8]=s=>Pe.value=s),vehicle:u(l).mainVehicle,"initial-latitude":Je.value,"initial-longitude":Xe.value},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),m.value?(V(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:se(u(k).globalGlassMenuStyles)},[Z("p",null,[t[10]||(t[10]=U(" Saving offline map content ")),pe.value?(V(),j("span",Fa,"("+Be(pe.value)+")",1)):W("",!0),U(":  "+Be(B.value?Math.round(M.value/B.value*100):0)+"% ",1)])],4)):W("",!0)],64)}}}),Aa=Vt(Pa,[["__scopeId","data-v-f77b2939"]]);export{Aa as default};
