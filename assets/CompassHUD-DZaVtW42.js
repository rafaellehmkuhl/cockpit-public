import{c as U,J as $,K as B,M as H,Y as G,u as j,I as q,r as C,at as J,L as K,o as Q,au as Z,k as ee,w as V,aw as P,ay as ae,aA as te,ax as oe,l as se,m as ne,n as k,G as l,N as r,V as le,O as ie,q as s,P as re,Q as A,R as ue,a4 as I,aC as de,W as ce,F as fe,az as ge,_ as he}from"./index-BvgFrkVz.js";import{w as y}from"./index-DEAYn5Ny.js";import{g as we}from"./index-C5ZFbjcW.js";import{V as pe,a as ve,b as be,c as me}from"./VExpansionPanels-kTpYiQcd.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new u.Error().stack;f&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[f]="7d3fb04c-bfe1-4e3b-aa52-7820b534496b",u._sentryDebugIdIdentifier="sentry-dbid-7d3fb04c-bfe1-4e3b-aa52-7820b534496b")}catch{}})();const Ce={class:"main"},Ve=["width","height"],ye=U({__name:"CompassHUD",props:{widget:{}},setup(u){const f=$(),_=B();H.registerUsage(G.heading);const W=j(),t=q(u).widget,D=C([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),L=e=>{switch(e){case-180:return"S";case-135:return"SW";case-90:return"W";case-45:return"NW";case 0:return"N";case 45:return"NE";case 90:return"E";case 135:return"SE";case 180:return"S";case 225:return"SW";case 270:return"W";case 315:return"NW";case 360:return"N";default:return`${e}°`}},g=J({yawLinesX:{}}),S=[];let x=-180;for(;x<181;)S.push(x),x+=3;K(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showYawValue:!0,hudColor:D.value[0][0],useNegativeRange:!1})}),Q(()=>{S.forEach(e=>g.yawLinesX[e]=E(e)),N()});const{width:X}=Z(),d=ee(()=>({width:t.value.size.width*X.value,height:64})),b=C(0);let M;V(W.attitude,e=>{Math.abs(P(e.yaw-(M||0)))>.1&&(M=e.yaw,b.value=P(W.attitude.yaw))});const E=e=>{let o=-(e-b.value||0);return o<-180?o+=360:o>180&&(o-=360),-o},h=C(),F=C(),N=()=>{if(h.value===void 0||h.value===null)return;if(F.value===void 0){console.debug("Canvas context undefined!"),F.value=h.value.getContext("2d");return}const e=F.value;ae(e);const a=.5*d.value.width,o=.5*d.value.height,R=12,c=16,w=10,n=2,Y=7;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${R}px Arial`,e.fillStyle="white";for(const[i,T]of Object.entries(g.yawLinesX)){if(T<-90||T>90)continue;const O=2*a/Math.PI*Math.sin(ge(T)),m=a+O;if(e.beginPath(),e.moveTo(m,c+n+w+n),e.lineTo(m,o*2-R-n-Y),e.lineWidth="1",Number(i)%15===0){e.lineWidth="2",e.lineTo(m,o*2-R-n);let v=Number(i);t.value.options.useNegativeRange||(v=v<0?v+360:v),e.fillText(L(Number(v)),m,o*2-n)}e.stroke()}if(t.value.options.showYawValue){e.font=`bold ${c}px Arial`;let i=Number(b.value);t.value.options.useNegativeRange||(i=i<0?i+360:i),e.fillText(`${i.toFixed(1)}°`,a,c)}e.beginPath(),e.moveTo(a,c+n+w),e.lineTo(a-.5*w,n+c+n),e.lineTo(a+.5*w,n+c+n),e.lineTo(a,c+n+w),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const p=e.createLinearGradient(0,o,d.value.width,o);p.addColorStop(.18,y(t.value.options.hudColor).alpha(0).toRgbString()),p.addColorStop(.3,y(t.value.options.hudColor).alpha(1).toRgbString()),p.addColorStop(.7,y(t.value.options.hudColor).alpha(1).toRgbString()),p.addColorStop(.82,y(t.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=p,e.fillRect(0,0,d.value.width,o*2)};V(b,()=>{S.forEach(e=>{const a=E(e);Math.abs(g.yawLinesX[e]-a)>90?g.yawLinesX[e]=a:we.to(g.yawLinesX,{duration:2.5,ease:"elastic.out(1.2, 0.5)",[e]:a})})}),V([g,d,t.value.options],()=>{f.isWidgetVisible(t.value)&&te(()=>N())});const z=oe(h);return V(z,(e,a)=>{e&&!a&&N()}),(e,a)=>(se(),ne(fe,null,[k("div",Ce,[k("canvas",{ref_key:"canvasRef",ref:h,width:d.value.width,height:d.value.height},null,8,Ve)]),l(ce,{modelValue:s(f).widgetManagerVars(s(t).hash).configMenuOpen,"onUpdate:modelValue":a[3]||(a[3]=o=>s(f).widgetManagerVars(s(t).hash).configMenuOpen=o),"min-width":"400","max-width":"35%"},{default:r(()=>[l(le,{class:"px-8 pb-6 pt-2",style:ie(s(_).globalGlassMenuStyles)},{default:r(()=>[l(re,{class:"text-center"},{default:r(()=>a[4]||(a[4]=[A("HUD Compass widget config")])),_:1}),l(ue,null,{default:r(()=>[l(I,{class:"ma-1",label:"Show yaw value",color:s(t).options.showYawValue?"white":void 0,"model-value":s(t).options.showYawValue,"hide-details":"",onChange:a[0]||(a[0]=o=>s(t).options.showYawValue=!s(t).options.showYawValue)},null,8,["color","model-value"]),l(I,{class:"ma-1",label:"Use -180/+180 range",color:s(t).options.useNegativeRange?"white":void 0,"model-value":s(t).options.useNegativeRange,"hide-details":"",onChange:a[1]||(a[1]=o=>s(t).options.useNegativeRange=!s(t).options.useNegativeRange)},null,8,["color","model-value"]),l(pe,null,{default:r(()=>[l(ve,{class:"bg-[#FFFFFF11] text-white mt-2"},{default:r(()=>[l(be,null,{default:r(()=>a[5]||(a[5]=[A("Color")])),_:1}),l(me,null,{default:r(()=>[l(de,{modelValue:s(t).options.hudColor,"onUpdate:modelValue":a[2]||(a[2]=o=>s(t).options.hudColor=o),theme:"dark",class:"ma-1 bg-[#FFFFFF11] text-white",swatches:D.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Te=he(ye,[["__scopeId","data-v-246f3d78"]]);export{Te as default};
//# sourceMappingURL=CompassHUD-DZaVtW42.js.map
