import{c as A,K as B,J as D,I as F,r as h,L as P,o as _,bw as z,bx as E,by as N,w as x,au as O,k as W,ay as H,aA as $,ax as j,l as G,m as q,n as y,G as i,N as c,V as J,O as K,q as o,P as Q,Q as X,R as Y,aC as M,ah as Z,a4 as ee,U as ae,W as le,F as te,_ as oe}from"./index-C0m83jVb.js";const se={class:"main"},ie=["width","height"],ne=A({__name:"Plotter",props:{widget:{}},setup(I){const L=B(),v=D(),e=F(I).widget,S=h([]);P(()=>{Object.keys(e.value.options).length===0&&(e.value.options={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0})}),_(()=>{C(e.value.options.dataLakeVariableId),S.value=Object.values(z()).filter(a=>a.type==="number")});const k=()=>{e.value.options.limitSamples&&(s.length===e.value.options.maxSamples+1?s.shift():s.length>e.value.options.maxSamples&&s.splice(0,s.length-e.value.options.maxSamples))},C=a=>{if(a===void 0){console.error("No data lake variable ID provided!");return}const t=e.value.options.dataLakeVariableId;t!==void 0&&E(t),N(a,l=>{s.push(l),k(),m()})};x([e.value.options.maxSamples,e.value.options.limitSamples],()=>{k(),m()});const{height:w}=O(),u=W(()=>({width:e.value.size.width*w.value,height:e.value.size.height*w.value})),d=h(),g=h(),f=(a,t,l,n)=>{const b=a.measureText(t),r=4;a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(l-r,n-16-r,b.width+r*2,16+r*2),a.fillStyle=e.value.options.lineColor,a.fillText(t,l,n)},m=()=>{if(d.value===void 0||d.value===null)return;if(g.value===void 0){console.debug("Canvas context undefined!"),g.value=d.value.getContext("2d");return}const a=g.value,t=u.value.width,l=u.value.height;H(a),a.clearRect(0,0,t,l),a.fillStyle=e.value.options.backgroundColor,a.fillRect(0,0,t,l),a.strokeStyle=e.value.options.lineColor;try{if(s.length===0)return;V=Math.max(...s),p=Math.min(...s);const n=s[s.length-1];a.beginPath(),a.moveTo(0,l),s.forEach((b,r)=>{const R=r*(t/s.length),U=l-(b-p)/(V-p)*l;a.lineTo(R,U)}),a.stroke(),a.font="14px monospace",a.textBaseline="bottom",f(a,`Current: ${n.toFixed(2)}`,10,l-10),f(a,`Min: ${p.toFixed(2)}`,10,l-30),f(a,`Max: ${V.toFixed(2)}`,10,l-50)}catch(n){console.error("Error drawing graph:",n)}},s=[];let V=0,p=0;x([u,e.value.options],()=>{v.isWidgetVisible(e.value)&&$(()=>m())});const T=j(d);return x(T,(a,t)=>{a&&!t&&m()}),(a,t)=>(G(),q(te,null,[y("div",se,[y("canvas",{ref_key:"canvasRef",ref:d,width:u.value.width,height:u.value.height},null,8,ie)]),i(le,{modelValue:o(v).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":t[5]||(t[5]=l=>o(v).widgetManagerVars(o(e).hash).configMenuOpen=l),"min-width":"400","max-width":"35%"},{default:c(()=>[i(J,{class:"pa-2",style:K(o(L).globalGlassMenuStyles)},{default:c(()=>[i(Q,null,{default:c(()=>t[6]||(t[6]=[X("Plotter config")])),_:1}),i(Y,null,{default:c(()=>[i(M,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":t[0]||(t[0]=l=>o(e).options.backgroundColor=l),label:"Background color"},null,8,["modelValue"]),i(M,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":t[1]||(t[1]=l=>o(e).options.lineColor=l),label:"Line color"},null,8,["modelValue"]),i(Z,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":[t[2]||(t[2]=l=>o(e).options.dataLakeVariableId=l),C],items:S.value,"item-title":"name","item-value":"id",label:"Data Lake variable ID"},null,8,["modelValue","items"]),i(ee,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":t[3]||(t[3]=l=>o(e).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),i(ae,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":t[4]||(t[4]=l=>o(e).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",rules:[l=>l>0||"Must be greater than 0"],disabled:!o(e).options.limitSamples},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),de=oe(ne,[["__scopeId","data-v-ffd6752e"]]);export{de as default};
