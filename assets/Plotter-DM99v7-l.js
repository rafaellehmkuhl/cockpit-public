import{ba as te,bb as ae,h as S,cb as le,bs as oe,bh as ne,cc as Y,c8 as R,c as Ce,e as Me,t as Le,r as C,W as Se,o as Pe,aN as Ne,aH as Ie,aM as Te,j as Ye,cd as Ue,w as M,ag as Fe,aU as je,aY as $e,a_ as De,aX as Oe,m as B,n as A,q as s,z as n,p as d,E as c,V as Ee,G as Be,a1 as h,as as Ae,a0 as L,af as K,a$ as J,P as q,x as X,J as Re,F as _e,ac as Q,_ as ze}from"./index-BzHA-k0o.js";const se=Y.reduce((o,r)=>(o[r]={type:[Boolean,String,Number],default:!1},o),{}),ie=Y.reduce((o,r)=>{const u="offset"+R(r);return o[u]={type:[String,Number],default:null},o},{}),ue=Y.reduce((o,r)=>{const u="order"+R(r);return o[u]={type:[String,Number],default:null},o},{}),Z={col:Object.keys(se),offset:Object.keys(ie),order:Object.keys(ue)};function We(o,r,u){let e=o;if(!(u==null||u===!1)){if(r){const i=r.replace(o,"");e+=`-${i}`}return o==="col"&&(e="v-"+e),o==="col"&&(u===""||u===!0)||(e+=`-${u}`),e.toLowerCase()}}const Ge=["auto","start","end","center","baseline","stretch"],He=ae({cols:{type:[Boolean,String,Number],default:!1},...se,offset:{type:[String,Number],default:null},...ie,order:{type:[String,Number],default:null},...ue,alignSelf:{type:String,default:null,validator:o=>Ge.includes(o)},...ne(),...oe()},"VCol"),I=te()({name:"VCol",props:He(),setup(o,r){let{slots:u}=r;const e=S(()=>{const i=[];let f;for(f in Z)Z[f].forEach(b=>{const g=o[b],p=We(f,b,g);p&&i.push(p)});const v=i.some(b=>b.startsWith("v-col-"));return i.push({"v-col":!v||!o.cols,[`v-col-${o.cols}`]:o.cols,[`offset-${o.offset}`]:o.offset,[`order-${o.order}`]:o.order,[`align-self-${o.alignSelf}`]:o.alignSelf}),i});return()=>{var i;return le(o.tag,{class:[e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),_=["start","end","center"],re=["space-between","space-around","space-evenly"];function z(o,r){return Y.reduce((u,e)=>{const i=o+R(e);return u[i]=r(),u},{})}const Ke=[..._,"baseline","stretch"],de=o=>Ke.includes(o),me=z("align",()=>({type:String,default:null,validator:de})),Je=[..._,...re],ce=o=>Je.includes(o),fe=z("justify",()=>({type:String,default:null,validator:ce})),qe=[..._,...re,"stretch"],pe=o=>qe.includes(o),ve=z("alignContent",()=>({type:String,default:null,validator:pe})),ee={align:Object.keys(me),justify:Object.keys(fe),alignContent:Object.keys(ve)},Xe={align:"align",justify:"justify",alignContent:"align-content"};function Qe(o,r,u){let e=Xe[o];if(u!=null){if(r){const i=r.replace(o,"");e+=`-${i}`}return e+=`-${u}`,e.toLowerCase()}}const Ze=ae({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:de},...me,justify:{type:String,default:null,validator:ce},...fe,alignContent:{type:String,default:null,validator:pe},...ve,...ne(),...oe()},"VRow"),T=te()({name:"VRow",props:Ze(),setup(o,r){let{slots:u}=r;const e=S(()=>{const i=[];let f;for(f in ee)ee[f].forEach(v=>{const b=o[v],g=Qe(f,v,b);g&&i.push(g)});return i.push({"v-row--no-gutters":o.noGutters,"v-row--dense":o.dense,[`align-${o.align}`]:o.align,[`justify-${o.justify}`]:o.justify,[`align-content-${o.alignContent}`]:o.alignContent}),i});return()=>{var i;return le(o.tag,{class:["v-row",e.value,o.class],style:o.style},(i=u.default)==null?void 0:i.call(u))}}}),et={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},tt={key:1,class:"main"},at=["width","height"],lt={class:"ml-2"},ot={class:"ml-2 flex gap-x-8"},nt={class:"ml-2 flex gap-x-8"},st={class:"ml-2"},it={class:"ml-2 flex gap-x-8"},ut={class:"flex flex-col"},rt={class:"flex flex-col"},dt={class:"flex w-full justify-end my-2"},mt=Ce({__name:"Plotter",props:{widget:{}},setup(o){const r=Me(),e=Le(o).widget,i=C([]);let f,v;Se(()=>{const l={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0,useFixedMinY:!1,useFixedMaxY:!1,fixedMinY:0,fixedMaxY:100};e.value.options={...l,...e.value.options}}),Pe(()=>{if(U(e.value.options.dataLakeVariableId),i.value=Object.values(Ne()),v=Ie(l=>{i.value=Object.values(l)}),m.length===0){const l=Te(e.value.options.dataLakeVariableId);l&&G(l)}}),Ye(()=>{v&&Ue(v),f&&Q(e.value.options.dataLakeVariableId,f)});const b=S(()=>i.value.filter(l=>l.type==="number")),g=C(""),p=C(!1);M(()=>e.value.options.dataLakeVariableId,()=>p.value=!1);const be=S(()=>{const l=(g.value||"").toLowerCase();return b.value.filter(t=>t.name.toLowerCase().includes(l))}),W=()=>{e.value.options.limitSamples&&(m.length===e.value.options.maxSamples+1?m.shift():m.length>e.value.options.maxSamples&&m.splice(0,m.length-e.value.options.maxSamples))},G=l=>{m.push(l),W(),j()},U=(l,t)=>{if(l===void 0){console.error("No data lake variable ID provided!");return}t!==void 0&&f&&Q(t,f),f=Fe(l,a=>G(a),{notifyOnTimestampChange:e.value.options.updateOnConstantValue})};M(()=>e.value.options.dataLakeVariableId,(l,t)=>{U(l,t),m.length=0}),M(()=>e.value.options.updateOnConstantValue,()=>{const l=e.value.options.dataLakeVariableId;l&&U(l,l)});const{width:ge,height:Ve}=je(),k=S(()=>({width:e.value.size.width*ge.value,height:e.value.size.height*Ve.value})),y=C(),F=C(),P=(l,t,a,V)=>{const w=l.measureText(t),x=4;l.fillStyle="rgba(0, 0, 0, 0.5)",l.fillRect(a-x,V-16-x,w.width+x*2,16+x*2),l.fillStyle=e.value.options.lineColor,l.fillText(t,a,V)},j=()=>{if(y.value===void 0||y.value===null)return;if(F.value===void 0){console.debug("Canvas context undefined!"),F.value=y.value.getContext("2d");return}const l=F.value,t=k.value.width,a=k.value.height;$e(l),l.clearRect(0,0,t,a),l.fillStyle=e.value.options.backgroundColor,l.fillRect(0,0,t,a),l.strokeStyle=e.value.options.lineColor,l.lineWidth=Math.max(e.value.options.lineThickness,1);try{$=Math.max(...m),D=Math.min(...m);const V=e.value.options.useFixedMinY?e.value.options.fixedMinY:D,w=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:$,x=.05*(w!=V?w-V:1),H=e.value.options.useFixedMinY?e.value.options.fixedMinY:V-x,he=e.value.options.useFixedMaxY?e.value.options.fixedMaxY:w+x,ke=m[m.length-1];if(l.beginPath(),l.moveTo(0,a/2),l.setLineDash([]),m.length===0?(l.beginPath(),l.arc(0,a/2,7,0,2*Math.PI),l.stroke()):m.length===1?(l.fillStyle=e.value.options.lineColor,l.beginPath(),l.arc(0,a/2,7,0,2*Math.PI),l.fill(),l.beginPath(),l.setLineDash([5,5]),l.moveTo(0,a/2),l.lineTo(50,a/2),l.stroke()):(l.setLineDash([]),m.forEach((N,E)=>{const ye=E*(t/m.length),we=a-(N-H)/(he-H)*a;l.lineTo(ye,we)})),l.stroke(),l.font="14px monospace",l.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const N=i.value.find(E=>E.id===e.value.options.dataLakeVariableId);N&&(P(l,N.name,10,26),l.textBaseline="bottom")}const O=e.value.options.decimalPlaces;P(l,`Current: ${Number(ke).toFixed(O)}`,10,a-10),P(l,`Min: ${Number(D).toFixed(O)}`,10,a-30),P(l,`Max: ${Number($).toFixed(O)}`,10,a-50)}catch(V){console.error("Error drawing graph:",V)}},m=[];let $=0,D=0;M([k,e],()=>{r.isWidgetVisible(e.value)&&(W(),De(()=>j()))},{deep:!0});const xe=Oe(y);return M(xe,(l,t)=>{l&&!t&&j()}),(l,t)=>(A(),B(_e,null,[n(e).options.dataLakeVariableId?(A(),B("div",tt,[d("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,at)])):(A(),B("p",et," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),s(Re,{modelValue:n(r).widgetManagerVars(n(e).hash).configMenuOpen,"onUpdate:modelValue":t[19]||(t[19]=a=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=a),title:"Plotter config",variant:"text-only"},{content:c(()=>[s(T,null,{default:c(()=>[s(I,{cols:"12"},{default:c(()=>[t[20]||(t[20]=d("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),d("div",lt,[s(h,{modelValue:g.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>g.value=a),t[1]||(t[1]=a=>p.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":t[2]||(t[2]=a=>p.value=!1),"onUpdate:focused":t[3]||(t[3]=a=>p.value=a)},null,8,["modelValue"]),s(Ae,{modelValue:n(e).options.dataLakeVariableId,"onUpdate:modelValue":t[4]||(t[4]=a=>n(e).options.dataLakeVariableId=a),items:be.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:p.value},onClick:t[5]||(t[5]=a=>p.value=!p.value)},null,8,["modelValue","items","menu-props"])])]),_:1,__:[20]})]),_:1}),s(T,null,{default:c(()=>[s(I,{cols:"12"},{default:c(()=>[t[23]||(t[23]=d("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),d("div",ot,[s(L,{modelValue:n(e).options.showTitle,"onUpdate:modelValue":t[6]||(t[6]=a=>n(e).options.showTitle=a),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(K,{"close-on-content-click":!1},{activator:c(({props:a})=>[d("div",q(a,{class:"flex cursor-pointer"}),[t[21]||(t[21]=d("span",{class:"mt-3"},"Background color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:X({backgroundColor:n(e).options.backgroundColor})},null,4)],16)]),default:c(()=>[s(J,{modelValue:n(e).options.backgroundColor,"onUpdate:modelValue":t[7]||(t[7]=a=>n(e).options.backgroundColor=a),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(K,{"close-on-content-click":!1},{activator:c(({props:a})=>[d("div",q(a,{class:"flex cursor-pointer"}),[t[22]||(t[22]=d("span",{class:"mt-3"},"Line color",-1)),d("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:X({backgroundColor:n(e).options.lineColor})},null,4)],16)]),default:c(()=>[s(J,{modelValue:n(e).options.lineColor,"onUpdate:modelValue":t[8]||(t[8]=a=>n(e).options.lineColor=a),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),s(h,{modelValue:n(e).options.lineThickness,"onUpdate:modelValue":t[9]||(t[9]=a=>n(e).options.lineThickness=a),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[a=>a>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1,__:[23]})]),_:1}),s(T,null,{default:c(()=>[s(I,{cols:"12"},{default:c(()=>[t[24]||(t[24]=d("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),d("div",nt,[s(h,{modelValue:n(e).options.decimalPlaces,"onUpdate:modelValue":t[10]||(t[10]=a=>n(e).options.decimalPlaces=a),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[a=>a>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),s(L,{modelValue:n(e).options.limitSamples,"onUpdate:modelValue":t[11]||(t[11]=a=>n(e).options.limitSamples=a),label:"Limit number of samples"},null,8,["modelValue"]),s(h,{modelValue:n(e).options.maxSamples,"onUpdate:modelValue":t[12]||(t[12]=a=>n(e).options.maxSamples=a),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!n(e).options.limitSamples,rules:[a=>a>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])]),d("div",st,[s(L,{modelValue:n(e).options.updateOnConstantValue,"onUpdate:modelValue":t[13]||(t[13]=a=>n(e).options.updateOnConstantValue=a),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1,__:[24]})]),_:1}),s(T,null,{default:c(()=>[s(I,{cols:"12"},{default:c(()=>[t[25]||(t[25]=d("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Y-Axis Bounds",-1)),d("div",it,[d("div",ut,[s(L,{modelValue:n(e).options.useFixedMinY,"onUpdate:modelValue":t[14]||(t[14]=a=>n(e).options.useFixedMinY=a),label:"Fixed minimum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(h,{modelValue:n(e).options.fixedMinY,"onUpdate:modelValue":t[15]||(t[15]=a=>n(e).options.fixedMinY=a),modelModifiers:{number:!0},type:"number",label:"Min value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMinY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])]),d("div",rt,[s(L,{modelValue:n(e).options.useFixedMaxY,"onUpdate:modelValue":t[16]||(t[16]=a=>n(e).options.useFixedMaxY=a),label:"Fixed maximum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),s(h,{modelValue:n(e).options.fixedMaxY,"onUpdate:modelValue":t[17]||(t[17]=a=>n(e).options.fixedMaxY=a),modelModifiers:{number:!0},type:"number",label:"Max value",variant:"outlined",density:"compact",disabled:!n(e).options.useFixedMaxY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])])])]),_:1,__:[25]})]),_:1})]),actions:c(()=>[d("div",dt,[s(Ee,{onClick:t[18]||(t[18]=a=>n(r).widgetManagerVars(n(e).hash).configMenuOpen=!1)},{default:c(()=>t[26]||(t[26]=[Be("Close")])),_:1,__:[26]})])]),_:1},8,["modelValue"])],64))}}),ft=ze(mt,[["__scopeId","data-v-28036ea3"]]);export{ft as default};
