import{c as ae,bD as le,k as z,ax as re,bE as ie,bF as ue,K as de,y as ce,J as pe,r as b,bG as P,L as me,o as fe,al as ge,D as he,l as J,m as K,n as d,H as s,N as V,v as m,O as n,V as ve,a6 as j,Q as p,P as Ce,R as xe,bd as ye,s as we,S as Y,aB as be,bH as Ve,a7 as k,W as ke,F as Se,bI as je,bJ as C,bK as E,_ as Ee}from"./index-DUOq3AX3.js";import{V as Le,a as N,b as B,c as F}from"./VExpansionPanels-By07U8x0.js";function Me(c){return new Worker(""+new URL("css.worker-3JzdLVeD.js",import.meta.url).href,{name:c==null?void 0:c.name})}function We(c){return new Worker(""+new URL("html.worker-BhoZsQ3c.js",import.meta.url).href,{name:c==null?void 0:c.name})}function De(c){return new Worker(""+new URL("json.worker-Dyr4b0Di.js",import.meta.url).href,{name:c==null?void 0:c.name})}const Te={class:"main"},Ie=["innerHTML"],_e={key:0,class:"help-panel mb-4 p-4 rounded bg-white/5"},Oe={class:"flex justify-between items-center px-4 w-full h-full"},Ue={class:"flex gap-x-3"},G=50,Ae=ae({__name:"DoItYourself",props:{widget:{}},setup(c){le(t=>({v3463a1da:S.value}));const x=re("diy-widget-auto-save",!1);self.MonacoEnvironment={getWorker(t,e){return e==="json"?new De:e==="css"||e==="scss"||e==="less"?new Me:e==="html"||e==="handlebars"||e==="razor"?new We:e==="typescript"||e==="javascript"?new ie:new ue}};const L=de(),M=ce(),r=pe(c).widget,W=b(null),D=b(null),T=b(null),I=b(!1),_=b(["html","css","js"]);let o=null,a=null,l=null;const f={html:`<!-- Write your HTML code here -->
<div id="diy-container">
  <span>Create your own widget!</span>
</div>`,css:`/* Write your CSS code here */
#diy-container {
  width: 100%;
  height: 100%;
  padding: 1rem;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  text-align: center;
  font-family: 'Roboto', sans-serif;
  font-weight: 500;
}`,js:`// Write your JavaScript code here
document.addEventListener('DOMContentLoaded', () => {
  // Your code here
});`,inheritCockpitStyles:!0},Q=z(()=>{const t=r.value.options.html||f.html,e=r.value.options.css||f.css,i=r.value.options.js||f.js;return`${t}
<style>
${e}
</style>
<script>
${i}
<\/script>`}),O=(t,e,i)=>je.create(t,{value:i,language:e,theme:"vs-dark",minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",padding:{top:12,bottom:12}}),U=t=>{t.addCommand(C.CtrlCmd|E.Enter,()=>v()),t.addCommand(C.CtrlCmd|E.KeyS,()=>v()),t.addCommand(C.CtrlCmd|C.Alt|E.UpArrow,()=>{o&&o.hasTextFocus()&&a?a.focus():l&&l.hasTextFocus()&&o?o.focus():a&&a.hasTextFocus()&&l&&l.focus()}),t.addCommand(C.CtrlCmd|C.Alt|E.DownArrow,()=>{o&&o.hasTextFocus()&&l?l.focus():l&&l.hasTextFocus()&&a?a.focus():a&&a.hasTextFocus()&&o&&o.focus()})},A=t=>{t.onDidChangeModelContent(()=>{q()})};P.registerCompletionItemProvider("javascript",{triggerCharacters:["("],provideCompletionItems:(t,e)=>{const i=t.getWordUntilPosition(e),u={startLineNumber:e.lineNumber,startColumn:i.startColumn,endLineNumber:e.lineNumber,endColumn:i.endColumn};return{suggestions:Object.entries(window.cockpit.getAllDataLakeVariablesInfo()).map(([y,w])=>({label:y,kind:P.CompletionItemKind.Variable,documentation:`${y}: ${w} (${typeof w})`,insertText:`window.cockpit.getDataLakeVariableData('${y}')`,range:u}))}}});const Z=async()=>{o||!W.value||l||!T.value||a||!D.value||(o=O(W.value,"html",r.value.options.html||f.html),l=O(T.value,"javascript",r.value.options.js||f.js),a=O(D.value,"css",r.value.options.css||f.css),o&&(U(o),A(o)),l&&(U(l),A(l)),a&&(U(a),A(a)))},q=()=>{x.value&&v()},X=async()=>{await Z()},ee=async()=>{R()},v=()=>{!o||!a||!l||(r.value.options.html=o.getValue(),r.value.options.css=a.getValue(),r.value.options.js=l.getValue(),H())},H=()=>{var u;const t=r.value.options.js||"",e=`diy-script-${r.value.hash}`;(u=document.getElementById(e))==null||u.remove();const i=document.createElement("script");i.type="text/javascript",i.textContent=t,i.id=e,document.body.appendChild(i)},te=()=>{!o||!a||!l||(o.setValue(r.value.options.html||f.html),a.setValue(r.value.options.css||f.css),l.setValue(r.value.options.js||f.js))},R=()=>{o&&(o.dispose(),o=null),a&&(a.dispose(),a=null),l&&(l.dispose(),l=null)},se=()=>{M.widgetManagerVars(r.value.hash).configMenuOpen=!1,x.value&&v(),R()},ne=()=>{if(!o||!a||!l)return;const t={html:o.getValue(),css:a.getValue(),js:l.getValue(),inheritCockpitStyles:r.value.options.inheritCockpitStyles||!1},e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),u=URL.createObjectURL(i),g=document.createElement("a");g.href=u,g.download="diy-widget-config.json",document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(u)},oe=()=>{const t=document.createElement("input");t.type="file",t.onchange=e=>{const i=e.target;if(!i.files||!i.files[0]||!o||!a||!l)return;const u=i.files[0],g=new FileReader;g.onload=y=>{var w;try{const $=(w=y.target)==null?void 0:w.result,h=JSON.parse($);if(!h.html||!h.css||!h.js)throw new Error("Invalid configuration file");o&&o.setValue(h.html),a&&a.setValue(h.css),l&&l.setValue(h.js),r.value.options.inheritCockpitStyles=h.inheritCockpitStyles||!1,v()}catch($){console.error("Error importing configuration:",$),alert("Invalid configuration file")}},g.readAsText(u)},document.body.appendChild(t),t.click(),document.body.removeChild(t)},S=z(()=>{const t=_.value.length;return t===0?`${G}vh`:`${Math.round(G/t)}vh`});return me(()=>{r.value.options=Object.assign({},f,r.value.options)}),fe(()=>{H()}),ge(()=>{R()}),(t,e)=>{const i=he("vue-draggable-resizable");return K(),J(Se,null,[d("div",Te,[d("div",{class:"w-full h-full",style:V(m(r).options.inheritCockpitStyles?m(L).globalGlassMenuStyles:{}),innerHTML:Q.value},null,12,Ie)]),s(ke,{modelValue:m(M).widgetManagerVars(m(r).hash).configMenuOpen,"onUpdate:modelValue":e[4]||(e[4]=u=>m(M).widgetManagerVars(m(r).hash).configMenuOpen=u),"max-width":m(L).isOnSmallScreen?"100%":"800px",onAfterEnter:X,onAfterLeave:ee},{default:n(()=>[s(i,{"drag-handle":".drag-handle",w:"auto",h:"auto",handles:["tm","mr","bm","ml"]},{default:n(()=>[s(ve,{class:"pa-2",style:V(m(L).globalGlassMenuStyles)},{default:n(()=>[s(j,{class:"drag-handle absolute top-[12px] left-[12px] cursor-grab"},{default:n(()=>[...e[5]||(e[5]=[p("mdi-drag",-1)])]),_:1}),s(j,{class:"absolute top-[12px] right-[12px] cursor-pointer",onClick:e[0]||(e[0]=u=>I.value=!I.value)},{default:n(()=>[...e[6]||(e[6]=[p(" mdi-help-circle-outline ",-1)])]),_:1}),s(Ce,{class:"w-full text-center mt-2"},{default:n(()=>[...e[7]||(e[7]=[p("DIY widget configuration",-1)])]),_:1}),s(xe,{class:"mx-2 flex flex-col gap-y-3"},{default:n(()=>[s(ye,null,{default:n(()=>[I.value?(K(),J("div",_e,[...e[8]||(e[8]=[d("h3",{class:"text-lg mb-2"},"Editor instructions",-1),d("ul",{class:"text-sm text-white/70 list-disc pl-4 space-y-1"},[d("li",null,"Use the HTML, CSS, and JS editors to create your custom widget"),d("li",null,"Changes are applied when you click Apply or press Cmd/Ctrl + Enter/S"),d("li",null,"Navigate between editors using Cmd/Ctrl + Option/Alt + ↑/↓"),d("li",null,"Reset to last saved state using the Reset button"),d("li",null,"Your code runs in the widget's context and has access to the DOM"),d("li",null,"You can use the console to debug your code"),d("li",null," You can use the data-lake system to inject or consume data from Cockpit. Check the docs for more information around this. "),d("li",null,"Click on each editor's header to expand it to full size")],-1)])])):we("",!0)]),_:1}),s(Le,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=u=>_.value=u),class:"editors-container",multiple:""},{default:n(()=>[s(N,{value:"html"},{default:n(()=>[s(B,{static:"",height:"30px",class:"text-white/60"},{default:n(()=>[...e[9]||(e[9]=[p(" HTML ",-1)])]),_:1}),s(F,{eager:""},{default:n(()=>[d("div",{ref_key:"htmlEditorContainer",ref:W,class:"editor-container",style:V({height:S.value})},null,4)]),_:1})]),_:1}),s(N,{value:"js"},{default:n(()=>[s(B,{static:"",height:"30px",class:"text-white/60"},{default:n(()=>[...e[10]||(e[10]=[p(" JS ",-1)])]),_:1}),s(F,{eager:""},{default:n(()=>[d("div",{ref_key:"jsEditorContainer",ref:T,class:"editor-container",style:V({height:S.value})},null,4)]),_:1})]),_:1}),s(N,{value:"css"},{default:n(()=>[s(B,{static:"",height:"30px",class:"text-white/60"},{default:n(()=>[...e[11]||(e[11]=[p(" CSS ",-1)])]),_:1}),s(F,{eager:""},{default:n(()=>[d("div",{ref_key:"cssEditorContainer",ref:D,class:"editor-container",style:V({height:S.value})},null,4)]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Y,{modelValue:m(x),"onUpdate:modelValue":e[2]||(e[2]=u=>be(x)?x.value=u:null),label:"Auto Save",density:"compact",class:"-mb-2","hide-details":""},null,8,["modelValue"]),s(Y,{modelValue:m(r).options.inheritCockpitStyles,"onUpdate:modelValue":e[3]||(e[3]=u=>m(r).options.inheritCockpitStyles=u),label:"Inherit Cockpit interface styles",density:"compact",class:"-mb-2","hide-details":""},null,8,["modelValue"])]),_:1}),s(Ve,null,{default:n(()=>[d("div",Oe,[s(k,{class:"text-white/60",variant:"text",onClick:se},{default:n(()=>[...e[12]||(e[12]=[p("Close",-1)])]),_:1}),d("div",Ue,[s(k,{class:"text-white/60",variant:"text",title:"Export configuration",onClick:ne},{default:n(()=>[s(j,{class:"mr-1 mt-[2px]"},{default:n(()=>[...e[13]||(e[13]=[p("mdi-download",-1)])]),_:1}),e[14]||(e[14]=p(" Export ",-1))]),_:1}),s(k,{class:"text-white/60 mr-10",variant:"text",title:"Import configuration",onClick:oe},{default:n(()=>[s(j,{class:"mr-1 mt-[2px]"},{default:n(()=>[...e[15]||(e[15]=[p("mdi-upload",-1)])]),_:1}),e[16]||(e[16]=p(" Import ",-1))]),_:1}),s(k,{class:"text-white/60",variant:"text",onClick:te},{default:n(()=>[...e[17]||(e[17]=[p("Reset",-1)])]),_:1}),s(k,{class:"text-white",variant:"text",onClick:v},{default:n(()=>[...e[18]||(e[18]=[p("Apply",-1)])]),_:1})])])]),_:1})]),_:1},8,["style"])]),_:1})]),_:1},8,["modelValue","max-width"])],64)}}}),Be=Ee(Ae,[["__scopeId","data-v-3e4b3bcd"]]);export{Be as default};
