import{c as Re,bO as gt,z as ta,bP as aa,r as n,w as y,k as I,I as q,m as L,O as v,n as Z,H as r,U as Se,ae as oa,K as Mt,aq as Vt,ax as la,aY as Oe,o as Tt,ay as z,V as St,N as re,v as u,P as Lt,a7 as B,a6 as ht,Q as U,R as Ot,az as Et,l as j,F as It,q as ia,aA as Le,bQ as sa,a_ as na,x as He,t as Ue,S as bt,s as W,aP as ra,am as Ne,bH as ua,W as $t,_ as Ft,bD as ca,J as da,af as va,u as ma,j as pa,M as yt,Y as xt,L as fa,bR as ga,bS as Ve,bT as d,bU as ha,bV as E,al as ba,aU as ya,bW as xa,bX as wa,bY as wt,bZ as ka,b_ as Ca,b$ as Ma,a0 as Va,y as Ta,bj as Sa,G as kt,a5 as pe,a$ as La,a8 as Oa,aG as ne,a4 as Te,c0 as Ea,ad as Ct,c1 as Ia,c2 as $a}from"./index-DMtaCr7_.js";const Fa=Re({__name:"GlobalOriginDialog",props:gt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:gt(["origin-set"],["update:modelValue"]),setup(ee,{emit:te}){const{openSnackbar:g}=ta(),C=aa(ee,"modelValue"),Y=te,O=ee,i=n(O.initialLatitude),c=n(O.initialLongitude),a=n(0),M=n(!1);y(()=>[O.initialLatitude,O.initialLongitude],([D,V])=>{i.value=D,c.value=V});const T=I(()=>i.value!==null&&i.value!==void 0&&i.value>=-90&&i.value<=90&&c.value!==null&&c.value!==void 0&&c.value>=-180&&c.value<=180&&a.value!==null&&a.value!==void 0),x=()=>{C.value=!1},K=()=>{if(!(!T.value||M.value)){M.value=!0;try{O.vehicle.setGlobalOrigin([i.value,c.value],a.value),g({message:"Global origin set successfully.",variant:"success"}),Y("origin-set",i.value,c.value),x()}catch(D){g({message:`Failed to set global origin: ${D}`,variant:"error"})}finally{M.value=!1}}},$=I(()=>[{text:"Cancel",action:x,disabled:M.value},{text:M.value?"Saving...":"Save",disabled:!T.value||M.value,action:K,class:M.value?"opacity-70":""}]);return(D,V)=>(L(),q(oa,{"show-dialog":C.value,title:"Set Global Origin",variant:"text-only","max-width":"500px",actions:$.value,"onUpdate:showDialog":V[3]||(V[3]=m=>C.value=m)},{content:v(()=>[V[4]||(V[4]=Z("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the GNSS coordinates of the vehicle's local origin (0,0,0). This is useful when using local position units (such as indoor positioning systems or DVLs) where you want to define a corresponding global position. ",-1)),r(Se,{modelValue:i.value,"onUpdate:modelValue":V[0]||(V[0]=m=>i.value=m),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",suffix:"°",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Latitude is required",m=>m>=-90&&m<=90||"Latitude must be between -90 and 90"],class:"mb-6"},null,8,["modelValue","rules"]),r(Se,{modelValue:c.value,"onUpdate:modelValue":V[1]||(V[1]=m=>c.value=m),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",suffix:"°",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[m=>m!=null||"Longitude is required",m=>m>=-180&&m<=180||"Longitude must be between -180 and 180"],class:"mb-6"},null,8,["modelValue","rules"]),r(Se,{modelValue:a.value,"onUpdate:modelValue":V[2]||(V[2]=m=>a.value=m),modelModifiers:{number:!0},label:"Altitude",type:"number",step:"0.1",suffix:"m",hint:"Altitude in meters (MSL)","persistent-hint":"",variant:"outlined",class:"mb-2",rules:[m=>m!=null||"Altitude is required"]},null,8,["modelValue","rules"])]),_:1},8,["show-dialog","actions"]))}}),Aa={class:"flex justify-end"},_a={key:0,class:"fixed top-[80px] right-5"},Da={key:1,class:"flex w-full items-center"},Pa={class:"flex justify-between w-full py-1 px-2 pt-3"},za={class:"flex items-center"},Ba=Re({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(ee,{emit:te}){const g=Mt(),C=Vt(),Y=ee,O=te,i=la("cockpit-pre-arm-checklist",[]),c=n({}),a=n(""),M=n(null),T=n(!1),x=I(()=>Y.modelValue),K=()=>{const h={};for(const l of i.value??[])h[l.id]=!1;c.value=h},$=I(()=>{if(!C.showChecklistBeforeArm)return!0;const h=i.value??[];return h.length>0&&h.every(l=>c.value[l.id]===!0)});y(()=>x.value,h=>{h?(K(),Oe(()=>{var l,p;return(p=(l=M.value)==null?void 0:l.focus)==null?void 0:p.call(l)})):(c.value={},T.value=!1)}),y(()=>i.value,h=>{if(!x.value)return;const l={...c.value},p={};for(const S of h??[])p[S.id]=!0,S.id in l||(l[S.id]=!1);for(const S of Object.keys(l)){const G=Number(S);p[G]||delete l[G]}c.value=l},{deep:!0});const D=async()=>{var p,S;const h=a.value.trim();if(!h)return;const l={id:Date.now(),text:h};i.value.push(l),x.value&&(c.value[l.id]=!1),a.value="",await Oe(),(S=(p=M.value)==null?void 0:p.focus)==null||S.call(p)},V=h=>{if(i.value=i.value.filter(l=>l.id!==h),h in c.value){const l={...c.value};delete l[h],c.value=l}},m=()=>{O("dismissed"),O("update:modelValue",!1)},ue=()=>{O("confirmed",!0),O("update:modelValue",!1)};return Tt(()=>{i.value.length===0&&(i.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),x.value&&K()}),y(()=>C.showChecklistBeforeArm,h=>{h||z({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(h,l)=>(L(),q($t,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=p=>x.value=p),"max-width":"600",scrollable:"",persistent:""},{default:v(()=>[r(St,{style:re(u(g).globalGlassMenuStyles),class:"rounded-lg"},{default:v(()=>[r(Lt,{class:"text-center relative pt-3"},{default:v(()=>[l[6]||(l[6]=Z("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(B,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:m},{default:v(()=>[r(ht,null,{default:v(()=>l[5]||(l[5]=[U("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Ot,{class:"mt-[-10px]"},{default:v(()=>[r(Et,{lines:"one",theme:"dark",class:"bg-transparent"},{default:v(()=>[(L(!0),j(It,null,ia(u(i),p=>(L(),q(Le,{key:p.id,theme:"dark"},sa({prepend:v(()=>[r(bt,{modelValue:c.value[p.id],"onUpdate:modelValue":S=>c.value[p.id]=S,class:"mt-0","hide-details":"",density:"compact",disabled:!u(C).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:v(()=>[r(na,{class:He([{"line-through opacity-60":c.value[p.id]},{"opacity-50":!u(C).showChecklistBeforeArm}])},{default:v(()=>[U(Ue(p.text),1)]),_:2},1032,["class"])]),_:2},[T.value&&u(i).length>1?{name:"append",fn:v(()=>[r(B,{icon:"",variant:"text",disabled:!u(C).showChecklistBeforeArm,onClick:S=>V(p.id)},{default:v(()=>[r(ht,null,{default:v(()=>l[7]||(l[7]=[U("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Z("div",Aa,[T.value?(L(),j("div",Da,[T.value?(L(),q(Se,{key:0,ref_key:"newItemInput",ref:M,modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=p=>a.value=p),disabled:!u(C).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:ra(D,["enter"]),"onClick:appendInner":D},null,8,["modelValue","disabled"])):W("",!0),r(B,{"prepend-icon":"mdi-check",disabled:!u(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:l[2]||(l[2]=()=>{T.value=!1,D()})},{default:v(()=>l[9]||(l[9]=[U("Done")])),_:1,__:[9]},8,["disabled"])])):(L(),j("div",_a,[r(B,{"prepend-icon":"mdi-format-list-checks",disabled:!u(C).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:l[0]||(l[0]=p=>T.value=!0)},{default:v(()=>l[8]||(l[8]=[U(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Ne,{class:"flex center w-[80%]",inset:""}),r(ua,null,{default:v(()=>[Z("div",Pa,[r(B,{variant:"text",onClick:m},{default:v(()=>l[10]||(l[10]=[U("Cancel")])),_:1,__:[10]}),Z("div",za,[r(bt,{"model-value":!u(C).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":l[3]||(l[3]=p=>u(C).showChecklistBeforeArm=!p)},null,8,["model-value"]),l[11]||(l[11]=Z("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(B,{color:"#ffffff33",class:He({"opacity-30":!$.value}),variant:"flat",disabled:!$.value,onClick:ue},{default:v(()=>l[12]||(l[12]=[U("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),Ga=Ft(Ba,[["__scopeId","data-v-b0b8e43a"]]),Ha=["id"],Ua={key:0},Na=Re({__name:"Map",props:{widget:{}},setup(ee){var pt;ca(e=>({"1f2736f2":Yt.value}));const te=ee,g=da(te).widget,C=Mt(),{showDialog:Y,closeDialog:O}=va(),i=ma(),c=Vt(),a=n(),M=n(c.defaultMapZoom),T=n(c.defaultMapCenter),x=n(),K=I(()=>`map-${g.value.hash}`),$=I(()=>Ee.value||ae.value),D=n(!1),V=n([]),m=n(),ue=n(!1),h=n(!1),l=n(!1),p=n(!1),S=n(0),G=n(0),fe=n("");let ge,he,be;const ae=n(!1),At=()=>{ge==null||ge.click(),ae.value=!1},_t=()=>{he==null||he.click(),ae.value=!1},Dt=()=>{be==null||be.click(),ae.value=!1};let We;const qe=e=>{e.touches.length>1&&(h.value=!0,R.value&&Ce(),clearTimeout(We))},Ze=e=>{e.touches.length<=1&&(We=window.setTimeout(()=>h.value=!1,300))},oe=n(null),P=n({});yt.registerUsage(xt.latitude),yt.registerUsage(xt.longitude),fa(()=>{Object.keys(g.value.options).length===0&&(g.value.options={showVehiclePath:!0,showCoordinateGrid:!1}),g.value.options.showCoordinateGrid===void 0&&(g.value.options.showCoordinateGrid=!1),F.enableAutoUpdate()});const ye=Ve.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),xe=Ve.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),we=Ve.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),je=d.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Pt={OpenStreetMap:ye,"Esri World Imagery":xe},zt={Seamarks:we,"Marine Profile":je},le=n(),Ee=pa(le),Ye=d.control.zoom({position:"bottomright"}),Ke=d.control.layers(Pt,zt),ce=n(void 0);y($,()=>{a.value!==void 0&&($.value?(a.value.addControl(Ye),a.value.addControl(Ke),Je()):(a.value.removeControl(Ye),a.value.removeControl(Ke),Xe()))}),y(Ee,()=>{$.value=Ee.value}),y(()=>g.value.options.showCoordinateGrid,e=>{a.value!==void 0&&(e?Ie():Bt())}),y([M,T],()=>{g.value.options.showCoordinateGrid&&a.value&&Ie(),$.value&&a.value&&Je()});const Ie=()=>{if(a.value)try{ce.value=ha(a.value,ce.value)}catch(e){console.error("Failed to create grid overlay:",e)}},Bt=()=>{ce.value&&a.value&&(a.value.removeLayer(ce.value),ce.value=void 0)},Qe=d.control.scale({position:"bottomright",metric:!0,imperial:!1,maxWidth:100}),Je=()=>{a.value&&(Xe(),Qe.addTo(a.value))},Xe=()=>{if(a.value)try{a.value.removeControl(Qe)}catch{}};Tt(async()=>{var X,ft;(X=le.value)==null||X.addEventListener("touchstart",qe,{passive:!0}),(ft=le.value)==null||ft.addEventListener("touchend",Ze,{passive:!0}),a.value=d.map(K.value,{layers:[ye,xe,we,je],attributionControl:!1}).setView(T.value,M.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",w=>{k.value=[w.latlng.lat,w.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:w,lng:H}=a.value.getCenter();w&&H&&(T.value=[w,H])});const e=$e(xe,"Esri",19),t=$e(ye,"OSM",19),o=$e(we,"Seamarks",18);a.value&&(e.addTo(a.value),t.addTo(a.value),o.addTo(a.value));const s=w=>{var me;const H=((me=w.getContainer)==null?void 0:me.call(w))??w._container;H&&(H.classList.add("hidden-savetiles"),H.style.display="none")};s(e),s(t),s(o),await Oe();const b=w=>{var me;const H=((me=w.getContainer)==null?void 0:me.call(w))??w._container;return Array.from((H==null?void 0:H.querySelectorAll("a"))??[])},[f]=b(e),[_]=b(t),[J]=b(o);ge=f,he=_,be=J,Fe(xe,"Esri"),Fe(ye,"OSM"),Fe(we,"Seamarks"),a.value.on("dragstart",()=>{ue.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ue.value=!1,200)}),a.value.on("zoomend",()=>{var w;R.value=!1,a.value!==void 0&&(M.value=((w=a.value)==null?void 0:w.getZoom())??T.value)}),a.value.on("contextmenu",w=>{k.value=[w.latlng.lat,w.latlng.lng]}),F.enableAutoUpdate(),window.addEventListener("keydown",st),A.value?F.goToTarget(E.VEHICLE):F.goToTarget(E.HOME),!i.isVehicleOnline&&c.vehicleMission.length&&Be(c.vehicleMission),g.value.options.showCoordinateGrid&&Ie(),D.value=!0,await Ae()});const Gt=e=>(t,o)=>{Y({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:O},{text:"Save tiles",color:"white",action:()=>{o(),O()}}]})},Ht=e=>(t,o)=>{Y({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:O},{text:"Remove tiles",color:"white",action:()=>{o(),O(),z({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},$e=(e,t,o)=>Ve.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:Gt(t),confirmRemoval:Ht(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Fe=(e,t)=>{e.on("savestart",o=>{var s;S.value=0,G.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,fe.value=t,p.value=!0,z({message:`Saving ${G.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{S.value+=1,G.value>0&&S.value>=G.value&&(z({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),p.value=!1,fe.value="",S.value=0,G.value=0)})},Ut={open:e=>{if(!a.value||h.value||ue.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);k.value=[o.lat,o.lng],m.value.openAt(e),R.value=!0},close:()=>{Ce()}},et=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof d.Marker||t instanceof d.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),V.value=[],ke.value=void 0,Q.value=void 0,se.value=void 0,N.value=void 0},Ae=async()=>{D.value&&(et(),i.isVehicleOnline?await rt():c.vehicleMission.length&&Be(c.vehicleMission))};y(()=>i.isVehicleOnline,()=>{Ae()}),y(()=>c.vehicleMissionRevision,()=>{Ae()}),ba(()=>{var e,t;F.disableAutoUpdate(),window.removeEventListener("keydown",st),a.value&&(a.value.off("contextmenu"),Object.values(P.value).forEach(o=>o.remove()),P.value={}),(e=le.value)==null||e.removeEventListener("touchstart",qe),(t=le.value)==null||t.removeEventListener("touchend",Ze)}),y(T,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),y(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),y(M,(e,t)=>{var o;e!==t&&(R.value=!1,(o=a.value)==null||o.setZoom(M.value))}),y(te.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ie=n(void 0),F=new ga(e=>ie.value=e,e=>T.value=e);F.setTrackableTarget(E.VEHICLE,()=>A.value),F.setTrackableTarget(E.HOME,()=>x.value);const A=I(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),_e=I(()=>{var e;return i.attitude.yaw?ya((e=i.attitude)==null?void 0:e.yaw):0}),tt=I(()=>{const e=i.lastHeartbeat;return e?`${xa(e??0,{includeSeconds:!0})} ago`:"never"}),{history:Nt}=wa(A);(pt=navigator==null?void 0:navigator.geolocation)==null||pt.watchPosition(e=>{x.value||(x.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let at=!0;y([x,a],async()=>{x.value===T.value||!a.value||!at||(F.goToTarget(E.HOME),at=!1)});const N=n();y(i.coordinates,()=>{if(!(!a.value||!A.value)){if(N.value===void 0){let e=ka;i.vehicleType===wt.MAV_TYPE_SURFACE_BOAT?e=Ca:i.vehicleType===wt.MAV_TYPE_SUBMARINE&&(e=Ma);const t=d.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});N.value=d.marker(A.value,{icon:t});const o=d.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});N.value.bindTooltip(o),a.value.addLayer(N.value)}N.value.setLatLng(A.value)}}),y(A,(e,t)=>{ie.value===E.VEHICLE||t!==void 0||F.follow(E.VEHICLE)}),y([A,_e,tt,()=>i.isArmed],()=>{var t,o,s,b,f;if(N.value===void 0)return;(b=N.value.getTooltip())==null||b.setContent(`
    <p>Coordinates: ${(t=A.value)==null?void 0:t[0].toFixed(6)}, ${(o=A.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=i.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${_e.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${tt.value}</p>
  `);const e=(f=N.value.getElement())==null?void 0:f.querySelector("img");e&&(e.style.transform=`rotate(${_e.value}deg)`)});const Q=n();y(x,()=>{if(a.value===void 0)return;const e=x.value;if(e!==void 0)if(Q.value)Q.value.setLatLng(e);else{Q.value=d.marker(e,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=d.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});Q.value.bindTooltip(t),Q.value.on("dragend",o=>{const b=o.target.getLatLng();Ge([b.lat,b.lng])}),a.value.addLayer(Q.value)}});const ke=n();y(V,e=>{a.value&&(ke.value||(ke.value=d.polyline([],{color:"#358AC3"}).addTo(a.value)),ke.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var f;const s=d.marker(t.coordinates);s.setIcon(d.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const b=d.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(b),(f=a.value)==null||f.addLayer(s)}))},{deep:!0});const De=n();y(Nt,e=>{if(a.value===void 0||e===void 0)return;De.value===void 0&&(De.value=d.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);De.value.setLatLngs(t)});const R=n(!1),k=n(null),ot=n(),Pe=n(!1),lt=n(0),it=n(0),ze=n(),Rt=Va([{item:"Set home waypoint",action:()=>de("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Global Origin",action:()=>de("set-global-origin"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>de("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>de("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>de("set-default-map-position"),icon:"mdi-map-check"}]),se=n(),Wt=async()=>{var e;if(!(!a.value||!k.value))try{await c.setDefaultMapPosition(k.value,M.value),z({message:"Default map position set",variant:"success"});const t=d.marker(k.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=d.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),b=(e=t.getTooltip())==null?void 0:e.getElement();[s,b].forEach(f=>{f&&(f.style.transition="opacity 1s",f.style.opacity="1")}),setTimeout(()=>{[s,b].forEach(f=>{f&&(f.style.opacity="0")}),setTimeout(()=>{var f;(f=a.value)==null||f.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),z({message:"Failed to set default map position",variant:"error"})}},qt=async()=>{if(!k.value||!a.value)return;se.value&&(a.value.removeLayer(se.value),se.value=void 0),se.value=d.marker(k.value,{icon:d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=d.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(se.value.bindTooltip(e),k.value){const f=i.coordinates.altitude??0,_=k.value[0],J=k.value[1];try{await i.goTo(0,0,0,0,_,J,f)}catch(X){z({message:`GoTo request failed: ${X.message}`,variant:"error"})}}},de=async e=>{switch(e){case"goto":{qt();break}case"set-default-map-position":Wt();break;case"place-poi":k.value&&oe.value?oe.value.openDialog(k.value):k.value?oe.value||(z({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(z({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":k.value&&Ge(k.value);break;case"set-global-origin":k.value&&(lt.value=k.value[0],it.value=k.value[1],Pe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}R.value=!1},Ce=()=>{R.value=!1,a.value!==void 0&&ot.value!==void 0&&a.value.removeLayer(ot.value)},Zt=(e,t)=>{if(!a.value)return;ze.value&&a.value.removeLayer(ze.value);const o=d.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),s=d.marker([e,t],{icon:o}).addTo(a.value),b=d.tooltip({content:'<i class="mdi mdi-axis-arrow text-[18px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(b),ze.value=s},st=e=>{e.key==="Escape"&&Ce()},Be=e=>{e.forEach((t,o)=>{o===0?(x.value=t.coordinates,Ge(t.coordinates)):V.value.push(t)})},Me=n(!1),nt=n(0),rt=async()=>{Me.value=!0,et();const e=async t=>{nt.value=t};try{const t=await i.fetchMission(e);Be(t),z({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){Y({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Me.value=!1}},Ge=async e=>{const t=[e[0],e[1]];x.value=t,await i.setHomeWaypoint(t,0),R.value&&(R.value=!1)},ut=async()=>{try{await i.startMission()}catch{z({message:"Failed to start mission.",variant:"error"})}},jt=async()=>{if(c.showChecklistBeforeArm){l.value=!0;return}ut()},ve=Ta(),Yt=I(()=>`${Math.max(-ve.widgetClearanceForVisibleArea(g.value).bottom,0)}px`),ct=I(()=>`${Math.max(-ve.widgetClearanceForVisibleArea(g.value).top,0)}px`),Kt=I(()=>i.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Qt=I(()=>i.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),Jt=I(()=>x.value===void 0?"Cannot center map on home (home position undefined).":ie.value===E.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),Xt=I(()=>i.isVehicleOnline?A.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ie.value===E.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),dt=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),vt=e=>{if(!a.value||!a.value.getContainer())return;const t=d.divIcon(dt(e)),o=d.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,b={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,b),o.on("drag",f=>{var X;const _=f.target.getLatLng(),J=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${_.lat.toFixed(8)}, Lng: ${_.lng.toFixed(8)}
    `;(X=o.getTooltip())==null||X.setContent(J)}),o.on("dragend",f=>{const _=f.target.getLatLng();c.movePointOfInterest(e.id,[_.lat,_.lng])}),o.on("click",f=>{if(d.DomEvent.stopPropagation(f),oe.value){const _=c.pointsOfInterest.find(J=>J.id===e.id);_?oe.value.openDialog(void 0,_):console.warn("POI not found in store:",e.id)}}),P.value[e.id]=o},mt=e=>{var s;if(!a.value||!a.value.getContainer()||!P.value[e.id])return;const t=P.value[e.id];t.setLatLng(e.coordinates),t.setIcon(d.divIcon(dt(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},ea=e=>{!a.value||!P.value[e]||(P.value[e].remove(),delete P.value[e])};return y(()=>c.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Oe(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(P.value).forEach(o=>{t.has(o)||ea(o)}),e.forEach(o=>{P.value[o.id]?mt(o):vt(o)})},{deep:!0,immediate:!0}),y(a,e=>{e&&e.getContainer()&&c.pointsOfInterest.forEach(t=>{P.value[t.id]?mt(t):vt(t)})},{immediate:!0}),(e,t)=>{const o=Sa("contextmenu");return L(),j(It,null,[kt((L(),j("div",{ref_key:"mapBase",ref:le,class:He(["page-base",u(ve).editingMode?"pointer-events-none":"pointer-events-auto"])},[Z("div",{id:K.value,ref_key:"map",ref:a,class:"map"},[r(Oa,{modelValue:ae.value,"onUpdate:modelValue":t[0]||(t[0]=s=>ae.value=s),"close-on-content-click":!1,location:"top end"},{activator:v(({props:s})=>[kt(r(B,pe(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[La,$.value]])]),default:v(()=>[r(Et,{style:re(u(C).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:v(()=>[r(Le,{class:"py-0",title:"Save visible Esri tiles",onClick:At}),r(Ne),r(Le,{class:"py-0",title:"Save visible OSM tiles",onClick:_t}),r(Ne),r(Le,{class:"py-0",title:"Save visible Seamarks tiles",onClick:Dt})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(Te,{location:"top",text:Jt.value},{activator:v(({props:s})=>[$.value?(L(),q(B,pe({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",x.value?"":"active-events-on-disabled"],color:ie.value==u(E).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!x.value,onClick:t[1]||(t[1]=ne(b=>u(F).goToTarget(u(E).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=ne(b=>u(F).follow(u(E).HOME),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Xt.value},{activator:v(({props:s})=>[$.value?(L(),q(B,pe({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",A.value?"":"active-events-on-disabled"],color:ie.value==u(E).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!A.value,onClick:t[3]||(t[3]=ne(b=>u(F).goToTarget(u(E).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=ne(b=>u(F).follow(u(E).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Kt.value},{activator:v(({props:s})=>[$.value?(L(),q(B,pe({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",u(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:ne(rt,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"]),r(Te,{location:"top",text:Qt.value},{activator:v(({props:s})=>[$.value?(L(),q(B,pe({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",u(i).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(i).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:ne(jt,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"])],8,Ha)],2)),[[o,Ut]]),r(Ea,{ref_key:"contextMenuRef",ref:m,visible:R.value,width:"260px","menu-items":Rt,onClose:Ce},null,8,["visible","menu-items"]),r($t,{modelValue:u(ve).widgetManagerVars(u(g).hash).configMenuOpen,"onUpdate:modelValue":t[7]||(t[7]=s=>u(ve).widgetManagerVars(u(g).hash).configMenuOpen=s),width:"auto"},{default:v(()=>[r(St,{class:"pa-2",style:re(u(C).globalGlassMenuStyles)},{default:v(()=>[r(Lt,{class:"text-center"},{default:v(()=>t[10]||(t[10]=[U("Map widget settings")])),_:1,__:[10]}),r(Ot,null,{default:v(()=>[r(Ct,{modelValue:u(g).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>u(g).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:u(g).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),r(Ct,{modelValue:u(g).options.showCoordinateGrid,"onUpdate:modelValue":t[6]||(t[6]=s=>u(g).options.showCoordinateGrid=s),class:"my-1",label:"Show coordinate grid",color:u(g).options.showCoordinateGrid?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Me.value?(L(),q(Ia,{key:0,"model-value":nt.value,height:"10",absolute:"",bottom:"",color:"white",style:re(`top: ${ct.value}`)},null,8,["model-value","style"])):W("",!0),Me.value?(L(),j("p",{key:1,style:re({top:ct.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):W("",!0),r($a,{ref_key:"poiManagerMapWidgetRef",ref:oe},null,512),r(Ga,{"model-value":l.value,onConfirmed:ut,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value=s)},null,8,["model-value"]),r(Fa,{modelValue:Pe.value,"onUpdate:modelValue":t[9]||(t[9]=s=>Pe.value=s),vehicle:u(i).mainVehicle,"initial-latitude":lt.value,"initial-longitude":it.value,onOriginSet:Zt},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),p.value?(L(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:re(u(C).globalGlassMenuStyles)},[Z("p",null,[t[11]||(t[11]=U(" Saving offline map content ")),fe.value?(L(),j("span",Ua,"("+Ue(fe.value)+")",1)):W("",!0),U(":  "+Ue(G.value?Math.round(S.value/G.value*100):0)+"% ",1)])],4)):W("",!0)],64)}}}),Wa=Ft(Na,[["__scopeId","data-v-33c874ec"]]);export{Wa as default};
