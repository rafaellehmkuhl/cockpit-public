import{c as ye,y as xe,K as ke,aL as Ve,J as Me,r as m,k as I,aB as Ce,w as Fe,L as We,o as Se,D as Be,l as d,m as u,n as f,H as o,N as r,Q as C,ae,G as _,ar as le,aM as Ee,O as z,t as se,q as a,s as k,I as R,a5 as H,a2 as Ie,aN as De,aO as G,aP as X,aQ as Le,aR as Oe,v as w,F,p as D,aS as K,aT as P,V as ze,P as Ae,U as ne,az as oe,aU as $e,as as Te,al as Ue,aH as je,aV as Ne,aW as _e,_ as Re}from"./index-j_pn1PLB.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new h.Error().stack;n&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[n]="5b85860d-0016-40fe-803b-98a450fe9003",h._sentryDebugIdIdentifier="sentry-dbid-5b85860d-0016-40fe-803b-98a450fe9003")}catch{}})();const He=["width","height"],Ge={class:"flex flex-col justify-between h-full pa-2 cursor-pointer"},Xe={class:"flex justify-between w-full"},Ke={key:0},Pe={key:0},Je={class:"flex"},qe={key:0,class:"flex rotate-[270deg] justify-center whitespace-nowrap"},Qe={class:"flex justify-center h-full px-3 pt-2 gap-x-2"},Ye=["data-widget-hash"],Ze=["data-widget-hash"],et={class:"flex flex-col justify-start items-start gap-x-4 mt-3 w-full"},tt={key:0,ref:"widgetTrashArea",class:"absolute w-32 h-32 -translate-x-32 -translate-y-32 bottom-[20%] left-1/3 bg-[#FF000055] z-[65] rounded-xl flex items-center justify-center hover:bg-slate-200/50 transition-all"},at={class:"relative flex justify-center items-center w-full h-full"},lt={class:"select-none"},st=ye({__name:"CustomWidgetBase",props:{widget:{}},setup(h){const n=xe(),J=ke(),{showSnackbar:A}=Ve(),b=h,i=Me(b).widget,v=m(b.widget),$=m(new Map),q=m(!1),Q=m("justify-center"),ie=m(!1),T=m(!1),W=m(b.widget.name),V=m(null),L=m(b.widget.options.leftColumnWidth||50),Y=m(!1),S=m(null),c=m(!1),M=m("right"),O=m([]),U=()=>{if(S.value){const l=S.value.getBoundingClientRect(),e=window.innerWidth;l.left+l.width/2<e/2?M.value="left":M.value="right"}},de=I(()=>M.value==="left"?c.value?"mdi-chevron-right":"mdi-chevron-left":c.value?"mdi-chevron-left":"mdi-chevron-right"),re=()=>{W.value=b.widget.name,T.value=!0,je(()=>{V.value&&(V.value.focus(),V.value.select())})},Z=()=>{T.value=!1,v.value&&W.value!==v.value.name&&(v.value.name=W.value)},ue=l=>{var t;const e=(t=l.target.files)==null?void 0:t[0];if(!e){A({variant:"error",message:"No file selected.",duration:3e3});return}const p=new FileReader;p.onload=s=>{var x;try{const g=JSON.parse((x=s.target)==null?void 0:x.result),E=v.value.hash;n.loadWidgetFromFile(E,g)}catch{A({variant:"error",message:"Invalid widget file format.",duration:3e3})}},p.readAsText(e)},B=m(!1),fe=()=>{n.elementToShowOnDrawer=void 0,O.value=[]},j=l=>{if(ie.value=!1,l==="options")n.widgetManagerVars(v.value.hash).configMenuOpen=!0;else if(l==="save")me();else if(l==="load"){const e=document.createElement("input");e.type="file",e.accept=".widget",e.addEventListener("change",p=>{ue(p)}),e.click()}},me=()=>{const l=new Blob([JSON.stringify(i.value)],{type:"application/json;charset=utf-8"}),e=`${i.value.name}.widget`;Ne(l,e)},ge=l=>{if(!n.editingMode)return;const e=l.clientX,p=L.value;Y.value=!0;const t=x=>{if(!S.value)return;const g=S.value.offsetWidth,E=p+(x.clientX-e)/g*100;L.value=Math.max(10,Math.min(90,E))},s=()=>{Y.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)},ve=I(()=>v.value.options.elementContainers.filter(l=>l.name.includes("left"))),pe=I(()=>v.value.options.elementContainers.filter(l=>l.name.includes("right"))),ce=I(()=>Math.round(i.value.options.backgroundOpacity*255).toString(16)),we=()=>{n.allowMovingAndResizing(v.value.hash,!0),window.addEventListener("mouseup",y),window.addEventListener("dragend",y)},y=()=>{U(),n.allowMovingAndResizing(v.value.hash,!1),window.removeEventListener("mouseup",y),window.removeEventListener("dragend",y)},ee=(l,e)=>{const p=v.value.options.elementContainers.find(g=>g.name===e);if(!p)return;const t=p.elements.map(g=>g.hash),s=$.value.get(e)||[],x=t.find(g=>!s.includes(g));if(x){const g=p.elements.find(E=>E.hash===x);g&&l.pullMode==="clone"&&(g.hash=_e(),n.miniWidgetManagerVars(g.hash).configMenuOpen=!0),n.showElementPropsDrawer(g.hash),$.value.set(e,t)}},{width:te}=Ce(),N=I(()=>({width:v.value.size.width*te.value,height:v.value.size.height*te.value})),he=m(null);Fe(()=>n.editingMode,l=>{l===!0&&(y(),c.value=!1)});const be=()=>{try{const l=n.editWidgetByHash(b.widget.hash);l&&(v.value=l)}catch{A({variant:"warning",message:"Error reading widget file.",duration:1e3})}};return We(()=>{b.widget.options.elementContainers.forEach(l=>{$.value.set(l.name,l.elements.map(e=>e.hash))})}),Se(()=>{U(),window.addEventListener("resize",U),he.value=document.querySelector(".main"),be(),y()}),(l,e)=>{const p=Be("FontAwesomeIcon");return d(),u(F,null,[f("div",{ref_key:"widgetBase",ref:S,class:w(["h-full rounded-lg overflow-hidden",[c.value?"w-[40px]":"w-full",c.value&&M.value==="left"?"ml-0 mr-auto":"",c.value&&M.value==="right"?"mr-0 ml-auto":""]]),width:N.value.width,height:N.value.height,style:z([a(J).globalGlassMenuStyles,{backgroundColor:`${a(i).options.backgroundColor+ce.value}`,backdropFilter:`blur(${a(i).options.backgroundBlur}px)`}])},[f("div",Ge,[f("div",Xe,[o(ae,{class:"cursor-grab opacity-40",onMousedown:we,onMouseup:y},{default:r(()=>e[16]||(e[16]=[C(" mdi-drag ")])),_:1}),c.value?k("",!0):(d(),u("div",Ke,[T.value?(d(),u("div",Pe,[_(f("input",{ref_key:"nameInput",ref:V,"onUpdate:modelValue":e[0]||(e[0]=t=>W.value=t),class:"border-b border-gray-400",onBlur:Z,onKeyup:Ee(Z,["enter"])},null,544),[[le,W.value]])])):(d(),u("p",{key:1,class:"whitespace-nowrap overflow-hidden text-ellipsis",style:z({maxWidth:`${N.value.width*.8}px`}),onDblclick:re},se(a(i).name),37))])),f("div",Je,[a(n).editingMode?(d(),R(Le,{key:0,theme:"dark"},{activator:r(({props:t})=>[o(H,Ie({size:"20",icon:"mdi-dots-vertical",variant:"text"},t),null,16)]),default:r(()=>[o(De,null,{default:r(()=>[o(G,{onClick:e[1]||(e[1]=t=>j("options"))},{default:r(()=>[o(X,null,{default:r(()=>e[17]||(e[17]=[C("Options")])),_:1})]),_:1}),o(G,{onClick:e[2]||(e[2]=t=>j("save"))},{default:r(()=>[o(X,null,{default:r(()=>e[18]||(e[18]=[C("Save")])),_:1})]),_:1}),o(G,{onClick:e[3]||(e[3]=t=>j("load"))},{default:r(()=>[o(X,null,{default:r(()=>e[19]||(e[19]=[C("Load")])),_:1})]),_:1})]),_:1})]),_:1})):k("",!0)])]),c.value?(d(),u("div",qe,se(a(i).name),1)):k("",!0),_(f("div",Qe,[f("div",{class:w(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:z({width:a(i).options.columns>1?`${L.value}%`:"100%"})},[(d(!0),u(F,null,D(ve.value,t=>(d(),u("div",{key:t.name,class:"w-full h-full"},[o(a(P),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(n).editingMode,animation:150,group:"generalGroup",class:w(["flex items-center w-full h-full gap-2 px-2",[q.value?"flex-wrap":"",Q.value]]),onAdd:s=>ee(s,t.name),onStart:e[4]||(e[4]=s=>B.value=!0),onEnd:e[5]||(e[5]=s=>B.value=!1)},{default:r(()=>[(d(!0),u(F,null,D(t.elements,s=>(d(),u("div",{key:s.hash,"data-widget-hash":s.hash,class:w(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(s.hash).highlighted}])},[o(K,{"mini-widget":s},null,8,["mini-widget"])],10,Ye))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6),a(i).options.columns>1&&a(n).editingMode?(d(),u("div",{key:0,class:"cursor-col-resize w-1 bg-[#FFFFFF22] relative",onMousedown:ge},e[20]||(e[20]=[f("div",{class:"absolute inset-y-0 -left-1 -right-1"},null,-1)]),32)):k("",!0),a(i).options.columns>1?(d(),u("div",{key:1,class:w(["flex flex-col justify-center border-[#FFFFFF33] border-dashed rounded-md",[a(n).editingMode?"border-[1px]":"border-0"]]),style:z({width:`${100-L.value}%`})},[(d(!0),u(F,null,D(pe.value,t=>(d(),u("div",{key:t.name,class:"w-full h-full"},[o(a(P),{modelValue:t.elements,"onUpdate:modelValue":s=>t.elements=s,disabled:!a(n).editingMode,animation:150,group:"generalGroup",class:w(["flex items-center w-full h-full gap-2 px-2",[q.value?"flex-wrap":"",Q.value]]),onAdd:s=>ee(s,t.name),onStart:e[6]||(e[6]=s=>B.value=!0),onEnd:e[7]||(e[7]=s=>B.value=!1)},{default:r(()=>[(d(!0),u(F,null,D(t.elements,s=>(d(),u("div",{key:s.hash,"data-widget-hash":s.hash,class:w(["rounded-md w-full",{"cursor-grab":a(n).editingMode,"bg-slate-400":a(n).miniWidgetManagerVars(s.hash).highlighted}])},[o(K,{"mini-widget":s},null,8,["mini-widget"])],10,Ze))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","class","onAdd"])]))),128))],6)):k("",!0)],512),[[Oe,!c.value]]),e[21]||(e[21]=f("div",null,null,-1)),a(n).editingMode?k("",!0):(d(),R(H,{key:1,class:w(["fixed bottom-[2px]",M.value==="left"?"left-[2px]":"right-[2px]"]),icon:de.value,variant:"text",size:"36",onClick:e[8]||(e[8]=t=>c.value=!c.value)},null,8,["class","icon"]))])],14,He),(d(),R(Ue,{to:"body"},[o($e,{"is-visible":a(n).widgetManagerVars(a(i).hash).configMenuOpen},{default:r(()=>[o(ze,{class:"px-8 pb-6 pt-2 rounded-lg w-[400px] bg-transparent"},{default:r(()=>[o(Ae,{class:"text-center -mt-1"},{default:r(()=>e[22]||(e[22]=[C("Custom Widget options")])),_:1}),o(H,{class:"absolute top-3 right-0 text-lg rounded-full",variant:"text",size:"small",onClick:e[9]||(e[9]=t=>a(n).widgetManagerVars(a(i).hash).configMenuOpen=!1)},{default:r(()=>[o(ae,null,{default:r(()=>e[23]||(e[23]=[C("mdi-close")])),_:1})]),_:1}),f("div",et,[e[24]||(e[24]=f("p",{class:"text-start"},"Name:",-1)),o(ne,{ref_key:"nameInput",ref:V,modelValue:a(i).name,"onUpdate:modelValue":e[10]||(e[10]=t=>a(i).name=t),density:"compact",class:"w-3/4"},null,8,["modelValue"]),e[25]||(e[25]=f("p",{class:"text-start"},"Columns:",-1)),o(ne,{ref_key:"nameInput",ref:V,modelValue:a(i).options.columns,"onUpdate:modelValue":e[11]||(e[11]=t=>a(i).options.columns=t),min:"1",max:"2",type:"number",density:"compact",class:"w-1/4"},null,8,["modelValue"]),e[26]||(e[26]=f("p",{class:"mt-1"},"Background color",-1)),_(f("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>a(i).options.backgroundColor=t),type:"color",class:"p-0 w-20 mr-4"},null,512),[[le,a(i).options.backgroundColor]]),e[27]||(e[27]=f("p",{class:"mt-3"},"Background opacity:",-1)),o(oe,{modelValue:a(i).options.backgroundOpacity,"onUpdate:modelValue":e[13]||(e[13]=t=>a(i).options.backgroundOpacity=t),min:"0",max:"1",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"]),e[28]||(e[28]=f("p",{class:"mt-3"},"Background blur:",-1)),o(oe,{modelValue:a(i).options.backgroundBlur,"onUpdate:modelValue":e[14]||(e[14]=t=>a(i).options.backgroundBlur=t),min:"0",max:"100",color:"white","thumb-label":"",width:"250"},null,8,["modelValue"])])]),_:1})]),_:1},8,["is-visible"]),o(Te,null,{default:r(()=>[B.value?(d(),u("div",tt,[f("div",at,[o(p,{icon:"fa-solid fa-trash",class:"absolute h-16 transition-all -translate-x-7 -translate-y-8 top-1/2 left-1/2 text-white"}),o(a(P),{modelValue:O.value,"onUpdate:modelValue":e[15]||(e[15]=t=>O.value=t),animation:150,group:"generalGroup",class:"flex flex-wrap items-center justify-center w-full h-full gap-2",onAdd:fe},{default:r(()=>[(d(!0),u(F,null,D(O.value,t=>(d(),u("div",{key:t.hash},[f("div",lt,[o(K,{"mini-widget":t},null,8,["mini-widget"])])]))),128))]),_:1},8,["modelValue"])])],512)):k("",!0)]),_:1})]))],64)}}}),ot=Re(st,[["__scopeId","data-v-7d260848"]]);export{ot as default};
//# sourceMappingURL=CustomWidgetBase-C3FvGYVI.js.map
