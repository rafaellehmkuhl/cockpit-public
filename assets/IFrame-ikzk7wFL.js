import{c as Q,bD as q,k as m,K as X,y as Y,r as u,J as Z,bL as T,aS as ee,w as E,L as se,aK as ae,a9 as N,al as te,a1 as oe,l as V,m as f,H as l,v as t,N as b,x as le,n as i,G as y,O as n,Q as x,a6 as ie,t as I,a7 as S,a$ as B,I as ne,as as de,V as re,P as ue,R as ce,U as W,aP as pe,bM as ve,T as me,aR as fe,bN as he,ad as j,s as we,am as ge,bH as Ve,W as be,bO as ye,ay as K,_ as xe}from"./index-C8Iik586.js";const _e={class:"w-full h-full"},Ae=["width","height"],ke={class:"flex flex-col justify-start items-center h-auto pt-2 cursor-pointer"},Le={class:"flex justify-between w-full h-[25px] px-2"},Ce={class:"select-none"},Me={class:"pt-2"},Se=["src"],Be={key:1},Ue=["src"],De={class:"flex items-center justify-between mt-2 gap-1"},Re={class:"-mr-3 mt-[1px] text-base text-gray-400"},Fe={class:"mt-2 mb-2 w-[95%]"},$e={class:"flex justify-between"},ze={key:0},Oe=Q({__name:"IFrame",props:{widget:{}},setup(P){q(a=>({"5417d2ae":J.value}));const U=X(),d=Y(),_=u(),e=Z(P).widget,c=u(!1),A=u(0),r=u(e.value.options.source),p=u(!1),h=u(""),D=m(()=>{const a=window.location.protocol.includes("file")?"http:":window.location.protocol,s=h.value||T;return`${a}//${s}`}),k=(a,s)=>s?`${D.value}${a}`:a,w=m(()=>k(e.value.options.source,e.value.options.useVehicleAddressAsBase)),G=()=>{p.value=!p.value},H=()=>{d.allowMovingAndResizing(e.value.hash,!0),window.addEventListener("mouseup",v),window.addEventListener("dragend",v)},v=()=>{d.allowMovingAndResizing(e.value.hash,!1),window.removeEventListener("mouseup",v),window.removeEventListener("dragend",v)},R=m(()=>({width:e.value.size.width*g.value,height:e.value.size.height*g.value})),L=a=>ye(a)?!0:"URL is not valid.",C=()=>{const a=L(k(r.value,e.value.options.useVehicleAddressAsBase));if(a!==!0){K({message:`${a} Please enter a valid URL.`,variant:"error"});return}e.value.options.source=r.value,K({message:`IFrame URL sucessfully updated to '${w.value}'.`,variant:"success"})},F=a=>{if(a.data.type!=="cockpit:listenToDatalakeVariables")return;const{variable:s}=a.data;N(s,o=>{_.value.contentWindow.postMessage({type:"cockpit:datalakeVariable",variable:s,value:o},"*")})};E([h,()=>e.value.options.useVehicleAddressAsBase],()=>{e.value.options.useVehicleAddressAsBase&&(c.value=!1,setTimeout(()=>{c.value=!0},100))},{deep:!0});let M;se(()=>{window.addEventListener("message",F,!0);const a={source:"http://"+T,useVehicleAddressAsBase:!1};e.value.options={...a,...e.value.options};const s=ae("vehicle-address");typeof s=="string"&&(h.value=s),M=N("vehicle-address",o=>{typeof o=="string"&&(h.value=o)})}),te(()=>{window.removeEventListener("message",F,!0),M&&oe("vehicle-address",M)});const{width:g,height:$}=ee(),z=m(()=>{let a="";return a=a.concat(" ",`left: ${e.value.position.x*g.value}px;`),a=a.concat(" ",`top: ${e.value.position.y*$.value}px;`),a=a.concat(" ",`width: ${e.value.size.width*g.value}px;`),a=a.concat(" ",`height: ${e.value.size.height*$.value}px;`),d.editingMode&&(a=a.concat(" ","pointer-events:none; border:0;")),d.isWidgetVisible(e.value)||(a=a.concat(" ","display: none;")),a}),J=m(()=>(100-A.value)/100);function O(){console.log("Finished loading"),c.value=!0}return E(e,()=>{d.widgetManagerVars(e.value.hash).configMenuOpen===!1&&L(w.value)!==!0&&(r.value=e.value.options.source)},{deep:!0}),(a,s)=>(f(),V("div",_e,[t(e).options.isCollapsible?(f(),V("div",{key:0,ref:"iframe-container",class:le(["w-full rounded-lg overflow-hidden -mt-2",[p.value?"h-[42px]":"h-full"]]),width:R.value.width,height:R.value.height,style:b(t(U).globalGlassMenuStyles)},[i("div",ke,[i("div",Le,[l(ie,{class:"cursor-grab opacity-40",onMousedown:H,onMouseup:v},{default:n(()=>s[7]||(s[7]=[x(" mdi-drag ")])),_:1,__:[7]}),i("div",Ce,I(t(e).options.containerName||"iframe"),1),l(S,{icon:p.value?"mdi-chevron-down":"mdi-chevron-up",variant:"text",size:"36",class:"mt-[-6px] opacity-60",onClick:G},null,8,["icon"])]),y(i("div",Me,[y(i("iframe",{ref_key:"iframe",ref:_,src:w.value,style:b(z.value),frameborder:"0",onLoad:O},null,44,Se),[[B,c.value]])],512),[[B,!p.value]])])],14,Ae)):(f(),V("div",Be,[(f(),ne(de,{to:".widgets-view"},[y(i("iframe",{ref_key:"iframe",ref:_,src:w.value,style:b([z.value,{position:"absolute"}]),frameborder:"0",onLoad:O},null,44,Ue),[[B,c.value]])]))])),l(be,{modelValue:t(d).widgetManagerVars(t(e).hash).configMenuOpen,"onUpdate:modelValue":s[6]||(s[6]=o=>t(d).widgetManagerVars(t(e).hash).configMenuOpen=o),"min-width":"600","max-width":"45%"},{default:n(()=>[l(re,{class:"pa-2",style:b(t(U).globalGlassMenuStyles)},{default:n(()=>[l(ue,{class:"text-center"},{default:n(()=>s[8]||(s[8]=[x("Settings")])),_:1,__:[8]}),l(ce,null,{default:n(()=>[i("div",null,[s[9]||(s[9]=i("p",null,"Iframe Source",-1)),i("div",De,[l(W,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=o=>r.value=o),variant:"outlined",rules:[L(k(r.value,t(e).options.useVehicleAddressAsBase))],placeholder:t(e).options.useVehicleAddressAsBase?"/my-service":"http://example.com",onKeydown:pe(C,["enter"])},ve({_:2},[t(e).options.useVehicleAddressAsBase?{name:"prepend-inner",fn:n(()=>[i("span",Re,I(D.value),1)]),key:"0"}:void 0]),1032,["modelValue","rules","placeholder"]),y(l(S,{icon:"mdi-check",class:"mx-1 mb-5 bg-[#FFFFFF22]",rounded:"lg",flat:"",onClick:C},null,512),[[me,"Set",void 0,{bottom:!0}]])])]),i("div",Fe,[l(fe,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=o=>A.value=o),label:"Transparency",color:"white",min:0,max:90},null,8,["modelValue"])]),l(he,{compact:"","is-expanded":!0,"no-bottom-divider":"","no-top-divider":""},{title:n(()=>s[10]||(s[10]=[x("Advanced options")])),content:n(()=>[l(j,{modelValue:t(e).options.useVehicleAddressAsBase,"onUpdate:modelValue":[s[2]||(s[2]=o=>t(e).options.useVehicleAddressAsBase=o),C],label:"Use vehicle address as base",color:"white",density:"compact","hide-details":"",class:"ml-3 my-2"},null,8,["modelValue"]),i("div",$e,[l(j,{modelValue:t(e).options.isCollapsible,"onUpdate:modelValue":s[3]||(s[3]=o=>t(e).options.isCollapsible=o),label:"Collapsible container",color:"white",class:"ml-2"},null,8,["modelValue"]),t(e).options.isCollapsible?(f(),V("div",ze,[l(W,{modelValue:t(e).options.containerName,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).options.containerName=o),label:"Container name","item-title":"name",density:"compact",variant:"outlined","no-data-text":"iframe","hide-details":"",theme:"dark",class:"w-[300px] mt-2"},null,8,["modelValue"])])):we("",!0)])]),_:1})]),_:1}),l(ge,{width:"80%",inset:""}),l(Ve,{class:"flex justify-end mt-2"},{default:n(()=>[l(S,{color:"white",onClick:s[5]||(s[5]=o=>t(d).widgetManagerVars(t(e).hash).configMenuOpen=!1)},{default:n(()=>s[11]||(s[11]=[x(" Close ")])),_:1,__:[11]})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]))}}),Ne=xe(Oe,[["__scopeId","data-v-02414866"]]);export{Ne as default};
