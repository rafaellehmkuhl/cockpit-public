import{c as G,K as j,y as J,M as q,Y as K,u as Q,J as X,r as S,aA as Z,k as d,aX as ee,$ as te,L as ae,o as oe,aB as se,w as T,Z as ne,an as k,aF as le,aH as ie,aE as ue,l as re,m as de,n as H,H as l,N as h,V as he,O as ce,q as n,P as pe,Q as I,R as fe,a4 as ve,aI as ge,W as me,F as we,_ as be}from"./index-BuIQHwnx.js";import{w as xe}from"./index-DEAYn5Ny.js";import{g as A}from"./index-C5ZFbjcW.js";import{V as Ve,a as De,b as Ce,c as ye}from"./VExpansionPanels-DJjvKCpz.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},v=new c.Error().stack;v&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[v]="88f242cb-cf8e-4236-bb4e-53593e4ef8c7",c._sentryDebugIdIdentifier="sentry-dbid-88f242cb-cf8e-4236-bb4e-53593e4ef8c7")}catch{}})();const Fe={class:"main"},Se=["width","height"],Te=G({__name:"DepthHUD",props:{widget:{}},setup(c){const v=j(),V=J();q.registerUsage(K.depth);const L=Q(),a=X(c).widget,N=S([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),i=Z({depthLinesY:{},indicatorY:0}),D=S(Array(10).fill(0)),C=d(()=>D.value[D.value.length-1]),W=d(()=>D.value.slice(-10)),O=d(()=>Math.max(...W.value)),w=d(()=>1.3*O.value>10?1.3*O.value:10),y=d(()=>ee(0,w.value+1)),$=d(()=>Math.max(...y.value)),U=d(()=>te[v.displayUnitPreferences.distance]);ae(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:N.value[2][0]})}),oe(()=>{y.value.forEach(e=>i.depthLinesY[e]=_(e)),Y()});const{height:z}=se(),r=d(()=>({width:128,height:a.value.size.height*z.value}));T(L.altitude,()=>{const e=L.altitude.msl,t=ne(-e.value,e.toJSON().unit);if(Math.abs(t.value-(C.value||0))<.1)return;const g=t.to(v.displayUnitPreferences.distance);D.value.push(g.toJSON().value)});const _=e=>{const t=e,s=r.value.height/$.value;return k(s*t)},b=S(),M=S(),Y=()=>{if(b.value===void 0||b.value===null)return;if(M.value===void 0){console.debug("Canvas context undefined!"),M.value=b.value.getContext("2d");return}const e=M.value,t=r.value.width,s=r.value.height;le(e);const g=12,p=16,f=10,o=1,R=5,u=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${g}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let m=[1,5];w.value>25&&(m=[2,10]),w.value>125&&(m=[5,25]),w.value>250&&(m=[10,50]),w.value>500&&(m=[20,100]);for(const[P,x]of Object.entries(i.depthLinesY))Number(P)%m[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*g-R,x+u),e.lineTo(o+3.9*p+f,x+u),e.lineWidth="1"),Number(P)%m[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*g,x+u),e.lineTo(o+3.9*p+f,x+u),e.fillText(`${P} ${U.value}`,t-o-3*g,x+u)),e.stroke();const F=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${p}px Arial`,e.fillText(`${C.value.toFixed(1)} ${U.value}`,o+4.3*p-f-o,F+u)),e.beginPath(),e.moveTo(o+4.3*p+o,F+u),e.lineTo(o+4.3*p+o-f,F-f/2+u),e.lineTo(o+4.3*p+o-f,F+f/2+u),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const E=e.createLinearGradient(t/2,0,t/2,s);E.addColorStop(.95,a.value.options.hudColor),E.addColorStop(1,xe(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=E,e.fillRect(0,0,t,s)};T(C,()=>{y.value.forEach(t=>{var s;(s=i.depthLinesY)[t]??(s[t]=k(r.value.height+100)),A.to(i.depthLinesY,.5,{[t]:_(t)})}),Object.keys(i.depthLinesY).filter(t=>!y.value.includes(Number(t))).forEach(t=>{A.to(i.depthLinesY,.5,{[t]:k(r.value.height+100)})}),A.to(i,.5,{indicatorY:_(C.value)})}),T([i,r,a.value.options],()=>{V.isWidgetVisible(a.value)&&ie(()=>Y())});const B=ue(b);return T(B,(e,t)=>{e&&!t&&Y()}),(e,t)=>(re(),de(we,null,[H("div",Fe,[H("canvas",{ref_key:"canvasRef",ref:b,width:r.value.width,height:r.value.height},null,8,Se)]),l(me,{modelValue:n(V).widgetManagerVars(n(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=s=>n(V).widgetManagerVars(n(a).hash).configMenuOpen=s),"min-width":"400","max-width":"35%"},{default:h(()=>[l(he,{class:"pa-2",style:ce(n(v).globalGlassMenuStyles)},{default:h(()=>[l(pe,null,{default:h(()=>t[3]||(t[3]=[I("Depth HUD config")])),_:1}),l(fe,null,{default:h(()=>[l(ve,{class:"ma-1",label:"Show height value","model-value":n(a).options.showDepthValue,color:n(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=s=>n(a).options.showDepthValue=!n(a).options.showDepthValue)},null,8,["model-value","color"]),l(Ve,null,{default:h(()=>[l(De,{class:"bg-[#FFFFFF22] text-white"},{default:h(()=>[l(Ce,null,{default:h(()=>t[4]||(t[4]=[I("Color")])),_:1}),l(ye,null,{default:h(()=>[l(ge,{modelValue:n(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=s=>n(a).options.hudColor=s),class:"ma-2 text-white bg-[#FFFFFF22]",swatches:N.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),ke=be(Te,[["__scopeId","data-v-3466888d"]]);export{ke as default};
//# sourceMappingURL=DepthHUD-YJENnwFD.js.map
