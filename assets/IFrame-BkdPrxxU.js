import{c as q,bD as X,k as u,K as Y,y as Z,r,J as ee,bL as T,aS as ae,w as E,L as se,aK as te,a9 as N,al as oe,a1 as le,l as b,m as f,n,H as l,v as o,N as y,x as ne,G as x,O as i,Q as _,a6 as ie,t as W,a7 as U,a$ as B,I as de,as as re,V as ue,P as ce,R as pe,U as j,aP as ve,bM as me,T as fe,aR as he,bN as we,ad as P,s as ge,am as Ve,bH as be,W as ye,bO as xe,F as _e,bP as ke,_ as Ae}from"./index-BwO5vYvJ.js";const Se={class:"w-full h-full"},Le=["width","height"],Me={class:"flex flex-col justify-start items-center h-auto pt-2 cursor-pointer"},Ce={class:"flex justify-between w-full h-[25px] px-2"},Ue={class:"select-none"},Be={class:"pt-2"},Fe=["src"],De={key:1},Re=["src"],$e={class:"flex items-center justify-between mt-2 gap-1"},ze={class:"-mr-3 mt-[1px] text-base text-gray-400"},Oe={class:"mt-2 mb-2 w-[95%]"},Ie={class:"flex justify-between"},Te={key:0},Ee=q({__name:"IFrame",props:{widget:{}},setup(K){X(s=>({"36f05942":Q.value}));const F=Y(),d=Z(),k=r(),e=ee(K).widget,c=r(!1),A=r(0),h=r(e.value.options.source),w=r(!1),S=r(""),p=r(!1),g=r(""),G=u(()=>window.location.protocol.includes("file")?"http:":window.location.protocol),D=u(()=>{const s=g.value||T;return`${G.value}//${s}`}),v=u(()=>{let s=e.value.options.source||"";return e.value.options.useVehicleAddressAsBase?`${D.value}${s}`:s}),H=()=>{p.value=!p.value},J=()=>{d.allowMovingAndResizing(e.value.hash,!0),window.addEventListener("mouseup",m),window.addEventListener("dragend",m)},m=()=>{d.allowMovingAndResizing(e.value.hash,!1),window.removeEventListener("mouseup",m),window.removeEventListener("dragend",m)},R=u(()=>({width:e.value.size.width*V.value,height:e.value.size.height*V.value})),L=s=>ke(s)?!0:"URL is not valid.",M=()=>{const s=L(v.value);if(s!==!0){S.value=`${s} Please enter a valid URL.`,w.value=!0;return}e.value.options.source=h.value,S.value=`IFrame URL sucessfully updated to '${v.value}'.`,w.value=!0},$=s=>{if(s.data.type!=="cockpit:listenToDatalakeVariables")return;const{variable:a}=s.data;N(a,t=>{k.value.contentWindow.postMessage({type:"cockpit:datalakeVariable",variable:a,value:t},"*")})};let C;E([g,()=>e.value.options.useVehicleAddressAsBase],()=>{e.value.options.useVehicleAddressAsBase&&(c.value=!1,setTimeout(()=>{c.value=!0},100))},{deep:!0}),se(()=>{window.addEventListener("message",$,!0);const s={source:"http://"+T,useVehicleAddressAsBase:!1};e.value.options={...s,...e.value.options};const a=te("vehicle-address");typeof a=="string"&&(g.value=a),C=N("vehicle-address",t=>{typeof t=="string"&&(g.value=t)})}),oe(()=>{window.removeEventListener("message",$,!0),C&&le("vehicle-address",C)});const{width:V,height:z}=ae(),O=u(()=>{let s="";return s=s.concat(" ",`left: ${e.value.position.x*V.value}px;`),s=s.concat(" ",`top: ${e.value.position.y*z.value}px;`),s=s.concat(" ",`width: ${e.value.size.width*V.value}px;`),s=s.concat(" ",`height: ${e.value.size.height*z.value}px;`),d.editingMode&&(s=s.concat(" ","pointer-events:none; border:0;")),d.isWidgetVisible(e.value)||(s=s.concat(" ","display: none;")),s}),Q=u(()=>(100-A.value)/100);function I(){console.log("Finished loading"),c.value=!0}return E(e,()=>{d.widgetManagerVars(e.value.hash).configMenuOpen===!1&&L(v.value)!==!0&&(h.value=e.value.options.source)},{deep:!0}),(s,a)=>(f(),b(_e,null,[n("div",Se,[o(e).options.isCollapsible?(f(),b("div",{key:0,ref:"iframe-container",class:ne(["w-full rounded-lg overflow-hidden -mt-2",[p.value?"h-[42px]":"h-full"]]),width:R.value.width,height:R.value.height,style:y(o(F).globalGlassMenuStyles)},[n("div",Me,[n("div",Ce,[l(ie,{class:"cursor-grab opacity-40",onMousedown:J,onMouseup:m},{default:i(()=>a[8]||(a[8]=[_(" mdi-drag ")])),_:1,__:[8]}),n("div",Ue,W(o(e).options.containerName||"iframe"),1),l(U,{icon:p.value?"mdi-chevron-down":"mdi-chevron-up",variant:"text",size:"36",class:"mt-[-6px] opacity-60",onClick:H},null,8,["icon"])]),x(n("div",Be,[x(n("iframe",{ref_key:"iframe",ref:k,src:v.value,style:y(O.value),frameborder:"0",onLoad:I},null,44,Fe),[[B,c.value]])],512),[[B,!p.value]])])],14,Le)):(f(),b("div",De,[(f(),de(re,{to:".widgets-view"},[x(n("iframe",{ref_key:"iframe",ref:k,src:v.value,style:y([O.value,{position:"absolute"}]),frameborder:"0",onLoad:I},null,44,Re),[[B,c.value]])]))])),l(ye,{modelValue:o(d).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":a[6]||(a[6]=t=>o(d).widgetManagerVars(o(e).hash).configMenuOpen=t),"min-width":"600","max-width":"45%"},{default:i(()=>[l(ue,{class:"pa-2",style:y(o(F).globalGlassMenuStyles)},{default:i(()=>[l(ce,{class:"text-center"},{default:i(()=>a[9]||(a[9]=[_("Settings")])),_:1,__:[9]}),l(pe,null,{default:i(()=>[n("div",null,[a[10]||(a[10]=n("p",null,"Iframe Source",-1)),n("div",$e,[l(j,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),variant:"outlined",rules:[L],placeholder:o(e).options.useVehicleAddressAsBase?"/my-service":"http://example.com",onKeydown:ve(M,["enter"])},me({_:2},[o(e).options.useVehicleAddressAsBase?{name:"prepend-inner",fn:i(()=>[n("span",ze,W(D.value),1)]),key:"0"}:void 0]),1032,["modelValue","rules","placeholder"]),x(l(U,{icon:"mdi-check",class:"mx-1 mb-5 bg-[#FFFFFF22]",rounded:"lg",flat:"",onClick:M},null,512),[[fe,"Set",void 0,{bottom:!0}]])])]),n("div",Oe,[l(he,{modelValue:A.value,"onUpdate:modelValue":a[1]||(a[1]=t=>A.value=t),label:"Transparency",color:"white",min:0,max:90},null,8,["modelValue"])]),l(we,{compact:"","is-expanded":!0,"no-bottom-divider":"","no-top-divider":""},{title:i(()=>a[11]||(a[11]=[_("Advanced options")])),content:i(()=>[l(P,{modelValue:o(e).options.useVehicleAddressAsBase,"onUpdate:modelValue":[a[2]||(a[2]=t=>o(e).options.useVehicleAddressAsBase=t),M],label:"Use vehicle address as base",color:"white",density:"compact","hide-details":"",class:"ml-3 my-2"},null,8,["modelValue"]),n("div",Ie,[l(P,{modelValue:o(e).options.isCollapsible,"onUpdate:modelValue":a[3]||(a[3]=t=>o(e).options.isCollapsible=t),label:"Collapsible container",color:"white",class:"ml-2"},null,8,["modelValue"]),o(e).options.isCollapsible?(f(),b("div",Te,[l(j,{modelValue:o(e).options.containerName,"onUpdate:modelValue":a[4]||(a[4]=t=>o(e).options.containerName=t),label:"Container name","item-title":"name",density:"compact",variant:"outlined","no-data-text":"iframe","hide-details":"",theme:"dark",class:"w-[300px] mt-2"},null,8,["modelValue"])])):ge("",!0)])]),_:1})]),_:1}),l(Ve,{width:"80%",inset:""}),l(be,{class:"flex justify-end mt-2"},{default:i(()=>[l(U,{color:"white",onClick:a[5]||(a[5]=t=>o(d).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:i(()=>a[12]||(a[12]=[_(" Close ")])),_:1,__:[12]})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])]),l(xe,{"open-snackbar":w.value,message:S.value,duration:3e3,"close-button":!1,"onUpdate:openSnackbar":a[7]||(a[7]=t=>w.value=t)},null,8,["open-snackbar","message"])],64))}}),je=Ae(Ee,[["__scopeId","data-v-2fe67f83"]]);export{je as default};
