import{bQ as N,bN as A,b3 as X,b4 as Z,bk as ee,b6 as te,k as L,bR as ae,c as Ve,y as ke,J as ye,r as D,L as we,o as xe,bS as Ce,bT as Se,bU as Le,h as Ne,bV as Me,ay as Pe,w as U,aD as Te,aH as Ie,aJ as je,aG as De,l as $,m as E,q as o,n as c,H as u,N as f,ai as Ue,S as G,aQ as W,a1 as H,O as K,aK as J,U as O,a6 as $e,Q as Ee,a7 as Oe,F as Be,az as Q,_ as Re}from"./index-CDQ9LZCj.js";const le=N.reduce((t,r)=>(t[r]={type:[Boolean,String,Number],default:!1},t),{}),ne=N.reduce((t,r)=>{const i="offset"+A(r);return t[i]={type:[String,Number],default:null},t},{}),oe=N.reduce((t,r)=>{const i="order"+A(r);return t[i]={type:[String,Number],default:null},t},{}),Y={col:Object.keys(le),offset:Object.keys(ne),order:Object.keys(oe)};function Ae(t,r,i){let e=t;if(!(i==null||i===!1)){if(r){const s=r.replace(t,"");e+=`-${s}`}return t==="col"&&(e="v-"+e),t==="col"&&(i===""||i===!0)||(e+=`-${i}`),e.toLowerCase()}}const _e=["auto","start","end","center","baseline","stretch"],Fe=X({cols:{type:[Boolean,String,Number],default:!1},...le,offset:{type:[String,Number],default:null},...ne,order:{type:[String,Number],default:null},...oe,alignSelf:{type:String,default:null,validator:t=>_e.includes(t)},...Z(),...ee()},"VCol"),B=te()({name:"VCol",props:Fe(),setup(t,r){let{slots:i}=r;const e=L(()=>{const s=[];let m;for(m in Y)Y[m].forEach(p=>{const g=t[p],V=Ae(m,p,g);V&&s.push(V)});const b=s.some(p=>p.startsWith("v-col-"));return s.push({"v-col":!b||!t.cols,[`v-col-${t.cols}`]:t.cols,[`offset-${t.offset}`]:t.offset,[`order-${t.order}`]:t.order,[`align-self-${t.alignSelf}`]:t.alignSelf}),s});return()=>{var s;return ae(t.tag,{class:[e.value,t.class],style:t.style},(s=i.default)==null?void 0:s.call(i))}}}),_=["start","end","center"],se=["space-between","space-around","space-evenly"];function F(t,r){return N.reduce((i,e)=>{const s=t+A(e);return i[s]=r(),i},{})}const ze=[..._,"baseline","stretch"],ie=t=>ze.includes(t),re=F("align",()=>({type:String,default:null,validator:ie})),Ge=[..._,...se],ue=t=>Ge.includes(t),de=F("justify",()=>({type:String,default:null,validator:ue})),We=[..._,...se,"stretch"],ce=t=>We.includes(t),me=F("alignContent",()=>({type:String,default:null,validator:ce})),q={align:Object.keys(re),justify:Object.keys(de),alignContent:Object.keys(me)},He={align:"align",justify:"justify",alignContent:"align-content"};function Ke(t,r,i){let e=He[t];if(i!=null){if(r){const s=r.replace(t,"");e+=`-${s}`}return e+=`-${i}`,e.toLowerCase()}}const Je=X({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:ie},...re,justify:{type:String,default:null,validator:ue},...de,alignContent:{type:String,default:null,validator:ce},...me,...Z(),...ee()},"VRow"),R=te()({name:"VRow",props:Je(),setup(t,r){let{slots:i}=r;const e=L(()=>{const s=[];let m;for(m in q)q[m].forEach(b=>{const p=t[b],g=Ke(m,b,p);g&&s.push(g)});return s.push({"v-row--no-gutters":t.noGutters,"v-row--dense":t.dense,[`align-${t.align}`]:t.align,[`justify-${t.justify}`]:t.justify,[`align-content-${t.alignContent}`]:t.alignContent}),s});return()=>{var s;return ae(t.tag,{class:["v-row",e.value,t.class],style:t.style},(s=i.default)==null?void 0:s.call(i))}}}),Qe={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},Ye={key:1,class:"main"},qe=["width","height"],Xe={class:"ml-2"},Ze={class:"ml-2 flex gap-x-8"},et={class:"ml-2 flex gap-x-8"},tt={class:"flex w-full justify-end my-2"},at=Ve({__name:"Plotter",props:{widget:{}},setup(t){const r=ke(),e=ye(t).widget,s=D([]);let m,b;we(()=>{const l={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0};e.value.options={...l,...e.value.options}}),xe(()=>{if(z(e.value.options.dataLakeVariableId),s.value=Object.values(Ce()),b=Se(l=>{s.value=Object.values(l)}),d.length===0){const l=Le(e.value.options.dataLakeVariableId);l&&V(l)}}),Ne(()=>{b&&Me(b),m&&Q(e.value.options.dataLakeVariableId,m)});const p=L(()=>s.value.filter(l=>l.type==="number")),g=()=>{e.value.options.limitSamples&&(d.length===e.value.options.maxSamples+1?d.shift():d.length>e.value.options.maxSamples&&d.splice(0,d.length-e.value.options.maxSamples))},V=l=>{d.push(l),g(),P()},z=(l,a)=>{if(l===void 0){console.error("No data lake variable ID provided!");return}a!==void 0&&m&&Q(a,m),m=Pe(l,n=>V(n))};U(()=>e.value.options.dataLakeVariableId,(l,a)=>{z(l,a),d.length=0});const{width:fe,height:be}=Te(),k=L(()=>({width:e.value.size.width*fe.value,height:e.value.size.height*be.value})),y=D(),M=D(),C=(l,a,n,v)=>{const T=l.measureText(a),h=4;l.fillStyle="rgba(0, 0, 0, 0.5)",l.fillRect(n-h,v-16-h,T.width+h*2,16+h*2),l.fillStyle=e.value.options.lineColor,l.fillText(a,n,v)},P=()=>{if(y.value===void 0||y.value===null)return;if(M.value===void 0){console.debug("Canvas context undefined!"),M.value=y.value.getContext("2d");return}const l=M.value,a=k.value.width,n=k.value.height;Ie(l),l.clearRect(0,0,a,n),l.fillStyle=e.value.options.backgroundColor,l.fillRect(0,0,a,n),l.strokeStyle=e.value.options.lineColor,l.lineWidth=Math.max(e.value.options.lineThickness,1);try{w=Math.max(...d),x=Math.min(...d);const v=.05*(w!=x?w-x:1),T=w+v,h=x-v,ge=d[d.length-1];if(l.beginPath(),l.moveTo(0,n/2),d.length===1?(l.moveTo(0,n/2),l.lineTo(a,n/2)):d.forEach((S,j)=>{const ve=j*(a/d.length),he=n-(S-h)/(T-h)*n;l.lineTo(ve,he)}),l.stroke(),l.font="14px monospace",l.textBaseline="bottom",e.value.options.showTitle&&e.value.options.dataLakeVariableId){const S=s.value.find(j=>j.id===e.value.options.dataLakeVariableId);S&&(C(l,S.name,10,26),l.textBaseline="bottom")}const I=e.value.options.decimalPlaces;C(l,`Current: ${Number(ge).toFixed(I)}`,10,n-10),C(l,`Min: ${Number(x).toFixed(I)}`,10,n-30),C(l,`Max: ${Number(w).toFixed(I)}`,10,n-50)}catch(v){console.error("Error drawing graph:",v)}},d=[];let w=0,x=0;U([k,e],()=>{r.isWidgetVisible(e.value)&&(g(),je(()=>P()))},{deep:!0});const pe=De(y);return U(pe,(l,a)=>{l&&!a&&P()}),(l,a)=>($(),E(Be,null,[o(e).options.dataLakeVariableId?($(),E("div",Ye,[c("canvas",{ref_key:"canvasRef",ref:y,width:k.value.width,height:k.value.height},null,8,qe)])):($(),E("p",Qe," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),u(Oe,{modelValue:o(r).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":a[9]||(a[9]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=n),title:"Plotter config",variant:"text-only"},{content:f(()=>[u(R,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[10]||(a[10]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Source",-1)),c("div",Xe,[u(Ue,{modelValue:o(e).options.dataLakeVariableId,"onUpdate:modelValue":a[0]||(a[0]=n=>o(e).options.dataLakeVariableId=n),items:p.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue","items"])])]),_:1})]),_:1}),u(R,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[13]||(a[13]=c("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Appearance",-1)),c("div",Ze,[u(G,{modelValue:o(e).options.showTitle,"onUpdate:modelValue":a[1]||(a[1]=n=>o(e).options.showTitle=n),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),u(W,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",H(n,{class:"flex cursor-pointer"}),[a[11]||(a[11]=c("span",{class:"mt-3"},"Background color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(e).options.backgroundColor})},null,4)],16)]),default:f(()=>[u(J,{modelValue:o(e).options.backgroundColor,"onUpdate:modelValue":a[2]||(a[2]=n=>o(e).options.backgroundColor=n),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(W,{"close-on-content-click":!1},{activator:f(({props:n})=>[c("div",H(n,{class:"flex cursor-pointer"}),[a[12]||(a[12]=c("span",{class:"mt-3"},"Line color",-1)),c("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(e).options.lineColor})},null,4)],16)]),default:f(()=>[u(J,{modelValue:o(e).options.lineColor,"onUpdate:modelValue":a[3]||(a[3]=n=>o(e).options.lineColor=n),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),u(O,{modelValue:o(e).options.lineThickness,"onUpdate:modelValue":a[4]||(a[4]=n=>o(e).options.lineThickness=n),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[n=>n>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1})]),_:1}),u(R,null,{default:f(()=>[u(B,{cols:"12"},{default:f(()=>[a[14]||(a[14]=c("div",{class:"text-subtitle-1 font-weight-medium mb-4"},"Data Points",-1)),c("div",et,[u(O,{modelValue:o(e).options.decimalPlaces,"onUpdate:modelValue":a[5]||(a[5]=n=>o(e).options.decimalPlaces=n),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[n=>n>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px",class:"ml-2"},null,8,["modelValue","rules"]),u(G,{modelValue:o(e).options.limitSamples,"onUpdate:modelValue":a[6]||(a[6]=n=>o(e).options.limitSamples=n),label:"Limit number of samples"},null,8,["modelValue"]),u(O,{modelValue:o(e).options.maxSamples,"onUpdate:modelValue":a[7]||(a[7]=n=>o(e).options.maxSamples=n),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(e).options.limitSamples,rules:[n=>n>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])])]),_:1})]),_:1})]),actions:f(()=>[c("div",tt,[u($e,{onClick:a[8]||(a[8]=n=>o(r).widgetManagerVars(o(e).hash).configMenuOpen=!1)},{default:f(()=>a[15]||(a[15]=[Ee("Close")])),_:1})])]),_:1},8,["modelValue"])],64))}}),nt=Re(at,[["__scopeId","data-v-2a6a4d89"]]);export{nt as default};
