import{c as ue,R as re,e as pe,t as me,r as C,W as ve,o as fe,aN as be,aH as xe,aM as ce,j as Ve,c8 as he,h as z,w as S,ag as ge,aU as we,aY as Me,a_ as ke,aX as ye,m as W,n as E,q as i,z as o,p as s,E as d,V as Ce,G as c,y as Se,bN as L,a1 as V,as as Le,a0 as r,af as G,a$ as J,P as X,x as K,J as Ye,F as Te,ac as Q,_ as Ue}from"./index-BmcQp19m.js";const Ie={key:0,class:"w-full h-full flex items-center justify-center text-center text-white text-h5 font-weight-bold p-4 overflow-hidden"},De={key:1,class:"main"},Fe=["width","height"],Pe={class:"py-2"},Oe={class:"flex flex-wrap gap-x-8 gap-y-2 py-2"},Ne={class:"py-2"},Ae={class:"flex flex-wrap gap-x-8 gap-y-2"},Be={class:"flex flex-wrap gap-x-6 py-2"},$e={class:"flex gap-x-8 py-2 mb-2"},ze={class:"flex flex-col"},We={class:"flex flex-col"},Ee={class:"flex w-full justify-end my-2"},Re=ue({__name:"Plotter",props:{widget:{}},setup(Z){const h=re(),Y=pe(),a=me(Z).widget,T=C([]);let g,I;ve(()=>{const t={backgroundColor:"rgba(0, 0, 0, 0.7)",lineColor:"rgba(255, 0, 0, 1.0)",dataLakeVariableId:void 0,maxSamples:1e3,limitSamples:!0,lineThickness:1,decimalPlaces:2,showTitle:!0,updateOnConstantValue:!0,useFixedMinY:!1,useFixedMaxY:!1,fixedMinY:0,fixedMaxY:100,showCurrent:!0,showMin:!0,showMax:!0,showAvg:!0,showMedian:!0};a.value.options={...t,...a.value.options}}),fe(()=>{if(F(a.value.options.dataLakeVariableId),T.value=Object.values(be()),I=xe(t=>{T.value=Object.values(t)}),n.length===0){const t=ce(a.value.options.dataLakeVariableId);t&&H(t)}}),Ve(()=>{I&&he(I),g&&Q(a.value.options.dataLakeVariableId,g)});const _=z(()=>T.value.filter(t=>t.type==="number")),D=C(""),m=C(!1);S(()=>a.value.options.dataLakeVariableId,()=>m.value=!1);const ee=z(()=>{const t=(D.value||"").toLowerCase();return _.value.filter(e=>e.name.toLowerCase().includes(t))}),R=()=>{a.value.options.limitSamples&&(n.length===a.value.options.maxSamples+1?n.shift():n.length>a.value.options.maxSamples&&n.splice(0,n.length-a.value.options.maxSamples))},H=t=>{n.push(t),R(),O()},F=(t,e)=>{if(t===void 0){console.error("No data lake variable ID provided!");return}e!==void 0&&g&&Q(e,g),g=ge(t,l=>H(l),{notifyOnTimestampChange:a.value.options.updateOnConstantValue})};S(()=>a.value.options.dataLakeVariableId,(t,e)=>{F(t,e),n.length=0}),S(()=>a.value.options.updateOnConstantValue,()=>{const t=a.value.options.dataLakeVariableId;t&&F(t,t)});const{width:ae,height:le}=we(),w=z(()=>({width:a.value.size.width*ae.value,height:a.value.size.height*le.value})),M=C(),P=C(),x=(t,e,l,u)=>{const v=t.measureText(e),f=4;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(l-f,u-16-f,v.width+f*2,16+f*2),t.fillStyle=a.value.options.lineColor,t.fillText(e,l,u)},O=()=>{if(M.value===void 0||M.value===null)return;if(P.value===void 0){console.debug("Canvas context undefined!"),P.value=M.value.getContext("2d");return}const t=P.value,e=w.value.width,l=w.value.height;Me(t),t.clearRect(0,0,e,l),t.fillStyle=a.value.options.backgroundColor,t.fillRect(0,0,e,l),t.strokeStyle=a.value.options.lineColor,t.lineWidth=Math.max(a.value.options.lineThickness,1);try{N=Math.max(...n),A=Math.min(...n),j=te(n),q=oe(n);const u=a.value.options.useFixedMinY?a.value.options.fixedMinY:A,v=a.value.options.useFixedMaxY?a.value.options.fixedMaxY:N,f=.05*(v!=u?v-u:1),k=a.value.options.useFixedMinY?a.value.options.fixedMinY:u-f,B=a.value.options.useFixedMaxY?a.value.options.fixedMaxY:v+f,ne=n[n.length-1];if(k<=0&&B>=0){const b=l-(0-k)/(B-k)*l;t.beginPath(),t.setLineDash([5,5]),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=1,t.moveTo(0,b),t.lineTo(e,b),t.stroke(),t.strokeStyle=a.value.options.lineColor,t.lineWidth=Math.max(a.value.options.lineThickness,1)}if(t.beginPath(),t.moveTo(0,l/2),t.setLineDash([]),n.length===0?(t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.stroke()):n.length===1?(t.fillStyle=a.value.options.lineColor,t.beginPath(),t.arc(0,l/2,7,0,2*Math.PI),t.fill(),t.beginPath(),t.setLineDash([5,5]),t.moveTo(0,l/2),t.lineTo(50,l/2),t.stroke()):(t.setLineDash([]),n.forEach((b,$)=>{const se=$*(e/n.length),de=l-(b-k)/(B-k)*l;t.lineTo(se,de)})),t.stroke(),t.font="14px monospace",t.textBaseline="bottom",a.value.options.showTitle&&a.value.options.dataLakeVariableId){const b=T.value.find($=>$.id===a.value.options.dataLakeVariableId);b&&(x(t,b.name,10,26),t.textBaseline="bottom")}const y=a.value.options.decimalPlaces,U=20;let p=10;a.value.options.showCurrent&&(x(t,`Current: ${Number(ne).toFixed(y)}`,10,l-p),p+=U),a.value.options.showMin&&(x(t,`Min: ${Number(A).toFixed(y)}`,10,l-p),p+=U),a.value.options.showMax&&(x(t,`Max: ${Number(N).toFixed(y)}`,10,l-p),p+=U),a.value.options.showAvg&&(x(t,`Avg: ${Number(q).toFixed(y)}`,10,l-p),p+=U),a.value.options.showMedian&&x(t,`Median: ${Number(j).toFixed(y)}`,10,l-p)}catch(u){console.error("Error drawing graph:",u)}},n=[];let N=0,A=0,j=0,q=0;const te=t=>{if(t.length===0)return 0;if(t.length===1)return t[0];const e=[...t].sort((u,v)=>u-v),l=Math.floor(e.length/2);return e.length%2===0?(e[l-1]+e[l])/2:e[l]},oe=t=>t.length===0?0:t.reduce((e,l)=>e+l,0)/t.length;S([w,a],()=>{Y.isWidgetVisible(a.value)&&(R(),ke(()=>O()))},{deep:!0});const ie=ye(M);return S(ie,(t,e)=>{t&&!e&&O()}),(t,e)=>(E(),W(Te,null,[o(a).options.dataLakeVariableId?(E(),W("div",De,[s("canvas",{ref_key:"canvasRef",ref:M,width:w.value.width,height:w.value.height},null,8,Fe)])):(E(),W("p",Ie," Please open the Plotter widget configuration menu to select a variable to be plotted. ")),i(Ye,{modelValue:o(Y).widgetManagerVars(o(a).hash).configMenuOpen,"onUpdate:modelValue":e[24]||(e[24]=l=>o(Y).widgetManagerVars(o(a).hash).configMenuOpen=l),title:"Plotter config",variant:"text-only"},{content:d(()=>[s("div",{class:Se(["max-h-[85vh] overflow-y-auto -mr-2",o(h).isOnSmallScreen?"max-w-[85vw]":"max-w-[50vw]"])},[i(L,{"no-top-divider":"",compact:"","is-expanded":""},{title:d(()=>e[25]||(e[25]=[c("Data Source")])),content:d(()=>[s("div",Pe,[i(V,{modelValue:D.value,"onUpdate:modelValue":[e[0]||(e[0]=l=>D.value=l),e[1]||(e[1]=l=>m.value=!0)],density:"compact",variant:"filled",theme:"dark",type:"text",placeholder:"Search variables...",class:"mb-4",clearable:"","onClick:clear":e[2]||(e[2]=l=>m.value=!1),"onUpdate:focused":e[3]||(e[3]=l=>m.value=l)},null,8,["modelValue"]),i(Le,{modelValue:o(a).options.dataLakeVariableId,"onUpdate:modelValue":e[4]||(e[4]=l=>o(a).options.dataLakeVariableId=l),items:ee.value,"item-title":"name","item-value":"id",label:"Data Lake variable",hint:"Select a variable to be plotted","persistent-hint":"",theme:"dark",variant:"outlined",density:"comfortable","menu-props":{modelValue:m.value},onClick:e[5]||(e[5]=l=>m.value=!m.value)},null,8,["modelValue","items","menu-props"])])]),_:1}),i(L,{compact:"","is-expanded":!o(h).isOnSmallScreen},{title:d(()=>e[26]||(e[26]=[c("Appearance")])),content:d(()=>[s("div",Oe,[i(r,{modelValue:o(a).options.showTitle,"onUpdate:modelValue":e[6]||(e[6]=l=>o(a).options.showTitle=l),label:"Show title","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(G,{"close-on-content-click":!1},{activator:d(({props:l})=>[s("div",X(l,{class:"flex cursor-pointer"}),[e[27]||(e[27]=s("span",{class:"mt-3"},"Background color",-1)),s("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(a).options.backgroundColor})},null,4)],16)]),default:d(()=>[i(J,{modelValue:o(a).options.backgroundColor,"onUpdate:modelValue":e[7]||(e[7]=l=>o(a).options.backgroundColor=l),label:"Background","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),i(G,{"close-on-content-click":!1},{activator:d(({props:l})=>[s("div",X(l,{class:"flex cursor-pointer"}),[e[28]||(e[28]=s("span",{class:"mt-3"},"Line color",-1)),s("div",{class:"w-[30px] h-[30px] border-2 border-slate-700 rounded-lg cursor-pointer ml-2 mt-2",style:K({backgroundColor:o(a).options.lineColor})},null,4)],16)]),default:d(()=>[i(J,{modelValue:o(a).options.lineColor,"onUpdate:modelValue":e[8]||(e[8]=l=>o(a).options.lineColor=l),label:"Line","hide-inputs":"",theme:"dark"},null,8,["modelValue"])]),_:1}),i(V,{modelValue:o(a).options.lineThickness,"onUpdate:modelValue":e[9]||(e[9]=l=>o(a).options.lineThickness=l),modelModifiers:{number:!0},type:"number",label:"Line thickness",variant:"outlined",density:"compact",rules:[l=>l>0||"Must be greater than 0"],width:"140px","hide-details":""},null,8,["modelValue","rules"])])]),_:1},8,["is-expanded"]),i(L,{compact:"","is-expanded":!o(h).isOnSmallScreen},{title:d(()=>e[29]||(e[29]=[c("Data Points")])),content:d(()=>[s("div",Ne,[s("div",Ae,[i(V,{modelValue:o(a).options.decimalPlaces,"onUpdate:modelValue":e[10]||(e[10]=l=>o(a).options.decimalPlaces=l),modelModifiers:{number:!0},type:"number",label:"Decimal places",variant:"outlined",density:"comfortable",rules:[l=>l>=0||"Must be 0 or greater"],hint:"Number of decimal places to be displayed",width:"160px"},null,8,["modelValue","rules"]),i(r,{modelValue:o(a).options.limitSamples,"onUpdate:modelValue":e[11]||(e[11]=l=>o(a).options.limitSamples=l),label:"Limit number of samples"},null,8,["modelValue"]),i(V,{modelValue:o(a).options.maxSamples,"onUpdate:modelValue":e[12]||(e[12]=l=>o(a).options.maxSamples=l),modelModifiers:{number:!0},type:"number",label:"Maximum samples",variant:"outlined",density:"comfortable",disabled:!o(a).options.limitSamples,rules:[l=>l>0||"Must be greater than 0"],hint:"Higher values will show more history but may impact performance",width:"220px"},null,8,["modelValue","disabled","rules"])]),i(r,{modelValue:o(a).options.updateOnConstantValue,"onUpdate:modelValue":e[13]||(e[13]=l=>o(a).options.updateOnConstantValue=l),label:"Update on constant value",hint:"Advance graph when value is unchanged (shows horizontal lines for constant values)","persistent-hint":""},null,8,["modelValue"])])]),_:1},8,["is-expanded"]),i(L,{compact:"","is-expanded":!o(h).isOnSmallScreen},{title:d(()=>e[30]||(e[30]=[c("Statistics Display")])),content:d(()=>[s("div",Be,[i(r,{modelValue:o(a).options.showCurrent,"onUpdate:modelValue":e[14]||(e[14]=l=>o(a).options.showCurrent=l),label:"Current","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(r,{modelValue:o(a).options.showMin,"onUpdate:modelValue":e[15]||(e[15]=l=>o(a).options.showMin=l),label:"Min","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(r,{modelValue:o(a).options.showMax,"onUpdate:modelValue":e[16]||(e[16]=l=>o(a).options.showMax=l),label:"Max","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(r,{modelValue:o(a).options.showAvg,"onUpdate:modelValue":e[17]||(e[17]=l=>o(a).options.showAvg=l),label:"Avg","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(r,{modelValue:o(a).options.showMedian,"onUpdate:modelValue":e[18]||(e[18]=l=>o(a).options.showMedian=l),label:"Median","hide-details":"",class:"-mt-1"},null,8,["modelValue"])])]),_:1},8,["is-expanded"]),i(L,{compact:"","no-bottom-divider":"","is-expanded":!o(h).isOnSmallScreen},{title:d(()=>e[31]||(e[31]=[c("Y-Axis Bounds")])),content:d(()=>[s("div",$e,[s("div",ze,[i(r,{modelValue:o(a).options.useFixedMinY,"onUpdate:modelValue":e[19]||(e[19]=l=>o(a).options.useFixedMinY=l),label:"Fixed minimum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(V,{modelValue:o(a).options.fixedMinY,"onUpdate:modelValue":e[20]||(e[20]=l=>o(a).options.fixedMinY=l),modelModifiers:{number:!0},type:"number",label:"Min value",variant:"outlined",density:"compact",disabled:!o(a).options.useFixedMinY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])]),s("div",We,[i(r,{modelValue:o(a).options.useFixedMaxY,"onUpdate:modelValue":e[21]||(e[21]=l=>o(a).options.useFixedMaxY=l),label:"Fixed maximum","hide-details":"",class:"-mt-1"},null,8,["modelValue"]),i(V,{modelValue:o(a).options.fixedMaxY,"onUpdate:modelValue":e[22]||(e[22]=l=>o(a).options.fixedMaxY=l),modelModifiers:{number:!0},type:"number",label:"Max value",variant:"outlined",density:"compact",disabled:!o(a).options.useFixedMaxY,width:"140px","hide-details":""},null,8,["modelValue","disabled"])])])]),_:1},8,["is-expanded"])],2)]),actions:d(()=>[s("div",Ee,[i(Ce,{onClick:e[23]||(e[23]=l=>o(Y).widgetManagerVars(o(a).hash).configMenuOpen=!1)},{default:d(()=>e[32]||(e[32]=[c("Close")])),_:1,__:[32]})])]),_:1},8,["modelValue"])],64))}}),qe=Ue(Re,[["__scopeId","data-v-27d4a079"]]);export{qe as default};
