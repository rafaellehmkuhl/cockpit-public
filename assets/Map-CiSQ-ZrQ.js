import{c as Ne,bO as dt,z as qt,bP as Yt,r as n,w as y,k as O,I as G,m as V,O as d,n as Z,H as r,U as ze,ae as Kt,K as bt,aq as xt,ax as Qt,aY as Se,o as yt,ay as D,V as kt,N as ne,v as u,P as wt,a7 as z,a6 as vt,Q as U,R as Ct,az as Mt,l as j,F as Vt,q as Jt,aA as Te,bQ as Xt,a_ as ea,x as Be,t as He,S as mt,s as W,aP as ta,am as Ue,bH as aa,W as Tt,_ as St,bD as oa,J as ia,af as la,u as sa,j as na,M as pt,Y as ft,L as ra,bR as ua,bS as Me,bT as v,bU as I,al as ca,aU as da,bV as va,bW as ma,bX as gt,bY as pa,bZ as fa,b_ as ga,a0 as ha,y as ba,bj as xa,G as ht,a5 as me,a$ as ya,a8 as ka,aG as se,a4 as Ve,b$ as wa,ad as Ca,c0 as Ma,c1 as Va}from"./index-Cq0DVgIO.js";const Ta=Ne({__name:"ExternalPositionEstimateDialog",props:dt({vehicle:{},initialLatitude:{},initialLongitude:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:dt(["position-set"],["update:modelValue"]),setup(X,{emit:ee}){const{openSnackbar:E}=qt(),w=Yt(X,"modelValue"),q=ee,L=X,l=n(L.initialLatitude),c=n(L.initialLongitude),a=n(!1);y(()=>[L.initialLatitude,L.initialLongitude],([S,C])=>{l.value=S,c.value=C});const F=O(()=>l.value!==null&&l.value!==void 0&&l.value>=-90&&l.value<=90&&c.value!==null&&c.value!==void 0&&c.value>=-180&&c.value<=180),T=()=>{w.value=!1},h=async()=>{if(!(!F.value||a.value)){a.value=!0;try{await L.vehicle.setExternalPositionEstimate([l.value,c.value]),E({message:"Position estimate sent to vehicle.",variant:"success"}),q("position-set",l.value,c.value),T()}catch(S){E({message:`Failed to set position estimate: ${S}`,variant:"error"})}finally{a.value=!1}}},Y=O(()=>[{text:"Cancel",action:T,disabled:a.value},{text:a.value?"Saving...":"Save",disabled:!F.value||a.value,action:h,class:a.value?"opacity-70":""}]);return(S,C)=>(V(),G(Kt,{"show-dialog":w.value,title:"Set Position Estimate",variant:"text-only","max-width":"500px",actions:Y.value,"onUpdate:showDialog":C[2]||(C[2]=f=>w.value=f)},{content:d(()=>[C[3]||(C[3]=Z("p",{class:"text-sm mb-8 -mt-6 text-gray-300"}," This feature allows you to set the vehicle's global position estimate. This is especially useful when using local position units (such as indoor positioning systems) where you want to define a corresponding global position for the EKF (Extended Kalman Filter). ",-1)),r(ze,{modelValue:l.value,"onUpdate:modelValue":C[0]||(C[0]=f=>l.value=f),modelModifiers:{number:!0},label:"Latitude",type:"number",step:"0.000001",suffix:"°",hint:"Latitude in degrees (-90 to 90)","persistent-hint":"",variant:"outlined",rules:[f=>f!=null||"Latitude is required",f=>f>=-90&&f<=90||"Latitude must be between -90 and 90"],class:"mb-6"},null,8,["modelValue","rules"]),r(ze,{modelValue:c.value,"onUpdate:modelValue":C[1]||(C[1]=f=>c.value=f),modelModifiers:{number:!0},label:"Longitude",type:"number",step:"0.000001",suffix:"°",hint:"Longitude in degrees (-180 to 180)","persistent-hint":"",variant:"outlined",rules:[f=>f!=null||"Longitude is required",f=>f>=-180&&f<=180||"Longitude must be between -180 and 180"],class:"mb-2"},null,8,["modelValue","rules"])]),_:1},8,["show-dialog","actions"]))}}),Sa={class:"flex justify-end"},Ea={key:0,class:"fixed top-[80px] right-5"},La={key:1,class:"flex w-full items-center"},Ia={class:"flex justify-between w-full py-1 px-2 pt-3"},Oa={class:"flex items-center"},Pa=Ne({__name:"MissionChecklist",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirmed","dismissed"],setup(X,{emit:ee}){const E=bt(),w=xt(),q=X,L=ee,l=Qt("cockpit-pre-arm-checklist",[]),c=n({}),a=n(""),F=n(null),T=n(!1),h=O(()=>q.modelValue),Y=()=>{const g={};for(const i of l.value??[])g[i.id]=!1;c.value=g},S=O(()=>{if(!w.showChecklistBeforeArm)return!0;const g=l.value??[];return g.length>0&&g.every(i=>c.value[i.id]===!0)});y(()=>h.value,g=>{g?(Y(),Se(()=>{var i,m;return(m=(i=F.value)==null?void 0:i.focus)==null?void 0:m.call(i)})):(c.value={},T.value=!1)}),y(()=>l.value,g=>{if(!h.value)return;const i={...c.value},m={};for(const M of g??[])m[M.id]=!0,M.id in i||(i[M.id]=!1);for(const M of Object.keys(i)){const B=Number(M);m[B]||delete i[B]}c.value=i},{deep:!0});const C=async()=>{var m,M;const g=a.value.trim();if(!g)return;const i={id:Date.now(),text:g};l.value.push(i),h.value&&(c.value[i.id]=!1),a.value="",await Se(),(M=(m=F.value)==null?void 0:m.focus)==null||M.call(m)},f=g=>{if(l.value=l.value.filter(i=>i.id!==g),g in c.value){const i={...c.value};delete i[g],c.value=i}},re=()=>{L("dismissed"),L("update:modelValue",!1)},ue=()=>{L("confirmed",!0),L("update:modelValue",!1)};return yt(()=>{l.value.length===0&&(l.value=[{id:Date.now(),text:"Ensure the vehicle is safe to launch"}]),h.value&&Y()}),y(()=>w.showChecklistBeforeArm,g=>{g||D({message:"Pre-arm checklist disabled. You can re-enable it in Settings → Mission → Enable pre-arm checklist.",variant:"info",duration:5e3})},{immediate:!0}),(g,i)=>(V(),G(Tt,{modelValue:h.value,"onUpdate:modelValue":i[4]||(i[4]=m=>h.value=m),"max-width":"600",scrollable:"",persistent:""},{default:d(()=>[r(kt,{style:ne(u(E).globalGlassMenuStyles),class:"rounded-lg"},{default:d(()=>[r(wt,{class:"text-center relative pt-3"},{default:d(()=>[i[6]||(i[6]=Z("h6",{class:"ml-4"},"Warning! Your vehicle is about to be armed",-1)),r(z,{icon:"",variant:"text",color:"white",class:"absolute right-1 top-1","aria-label":"Close",onClick:re},{default:d(()=>[r(vt,null,{default:d(()=>i[5]||(i[5]=[U("mdi-close")])),_:1,__:[5]})]),_:1})]),_:1,__:[6]}),r(Ct,{class:"mt-[-10px]"},{default:d(()=>[r(Mt,{lines:"one",theme:"dark",class:"bg-transparent"},{default:d(()=>[(V(!0),j(Vt,null,Jt(u(l),m=>(V(),G(Te,{key:m.id,theme:"dark"},Xt({prepend:d(()=>[r(mt,{modelValue:c.value[m.id],"onUpdate:modelValue":M=>c.value[m.id]=M,class:"mt-0","hide-details":"",density:"compact",disabled:!u(w).showChecklistBeforeArm},null,8,["modelValue","onUpdate:modelValue","disabled"])]),default:d(()=>[r(ea,{class:Be([{"line-through opacity-60":c.value[m.id]},{"opacity-50":!u(w).showChecklistBeforeArm}])},{default:d(()=>[U(He(m.text),1)]),_:2},1032,["class"])]),_:2},[T.value&&u(l).length>1?{name:"append",fn:d(()=>[r(z,{icon:"",variant:"text",disabled:!u(w).showChecklistBeforeArm,onClick:M=>f(m.id)},{default:d(()=>[r(vt,null,{default:d(()=>i[7]||(i[7]=[U("mdi-close")])),_:1,__:[7]})]),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1024))),128))]),_:1}),Z("div",Sa,[T.value?(V(),j("div",La,[T.value?(V(),G(ze,{key:0,ref_key:"newItemInput",ref:F,modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=m=>a.value=m),disabled:!u(w).showChecklistBeforeArm,variant:"filled",density:"compact",placeholder:"Type an item and press Enter","hide-details":"",class:"ml-6 w-[80%]","append-inner-icon":"mdi-plus",onKeyup:ta(C,["enter"]),"onClick:appendInner":C},null,8,["modelValue","disabled"])):W("",!0),r(z,{"prepend-icon":"mdi-check",disabled:!u(w).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22] ml-10",onClick:i[2]||(i[2]=()=>{T.value=!1,C()})},{default:d(()=>i[9]||(i[9]=[U("Done")])),_:1,__:[9]},8,["disabled"])])):(V(),j("div",Ea,[r(z,{"prepend-icon":"mdi-format-list-checks",disabled:!u(w).showChecklistBeforeArm,variant:"text",color:"white",size:"small",class:"elevation-1 bg-[#FFFFFF15] hover:bg-[#FFFFFF22]",onClick:i[0]||(i[0]=m=>T.value=!0)},{default:d(()=>i[8]||(i[8]=[U(" Edit Items ")])),_:1,__:[8]},8,["disabled"])]))])]),_:1}),r(Ue,{class:"flex center w-[80%]",inset:""}),r(aa,null,{default:d(()=>[Z("div",Ia,[r(z,{variant:"text",onClick:re},{default:d(()=>i[10]||(i[10]=[U("Cancel")])),_:1,__:[10]}),Z("div",Oa,[r(mt,{"model-value":!u(w).showChecklistBeforeArm,class:"mt-0 scale-[0.8]","hide-details":"",density:"compact","onUpdate:modelValue":i[3]||(i[3]=m=>u(w).showChecklistBeforeArm=!m)},null,8,["model-value"]),i[11]||(i[11]=Z("p",{class:"text-xs text-center ml-2"},"Don't show this checklist again",-1))]),r(z,{color:"#ffffff33",class:Be({"opacity-30":!S.value}),variant:"flat",disabled:!S.value,onClick:ue},{default:d(()=>i[12]||(i[12]=[U("Go")])),_:1,__:[12]},8,["class","disabled"])])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]))}}),$a=St(Pa,[["__scopeId","data-v-b0b8e43a"]]),Fa=["id"],_a={key:0},Aa=Ne({__name:"Map",props:{widget:{}},setup(X){var ut;oa(e=>({"2358f93a":Nt.value}));const ee=X,E=ia(ee).widget,w=bt(),{showDialog:q,closeDialog:L}=la(),l=sa(),c=xt(),a=n(),F=n(c.defaultMapZoom),T=n(c.defaultMapCenter),h=n(),Y=O(()=>`map-${E.value.hash}`),S=O(()=>Ee.value||te.value),C=n(!1),f=n([]),re=n(),ue=n(!1),g=n(!1),i=n(!1),m=n(!1),M=n(0),B=n(0),pe=n("");let fe,ge,he;const te=n(!1),Et=()=>{fe==null||fe.click(),te.value=!1},Lt=()=>{ge==null||ge.click(),te.value=!1},It=()=>{he==null||he.click(),te.value=!1};let Re;const We=e=>{e.touches.length>1&&(g.value=!0,R.value&&we(),clearTimeout(Re))},Ge=e=>{e.touches.length<=1&&(Re=window.setTimeout(()=>g.value=!1,300))},ae=n(null),A=n({});pt.registerUsage(ft.latitude),pt.registerUsage(ft.longitude),ra(()=>{Object.keys(E.value.options).length===0&&(E.value.options={showVehiclePath:!0}),P.enableAutoUpdate()});const be=Me.tileLayerOffline("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:23,maxNativeZoom:19,attribution:"© OpenStreetMap"}),xe=Me.tileLayerOffline("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:23,maxNativeZoom:19,attribution:"© Esri World Imagery"}),ye=Me.tileLayerOffline("https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",{maxZoom:18,attribution:"© OpenSeaMap contributors"}),Ze=v.tileLayer.wms("https://geoserver.openseamap.org/geoserver/gwc/service/wms",{layers:"gebco2021:gebco_2021",format:"image/png",transparent:!0,version:"1.1.1",attribution:"© GEBCO, OpenSeaMap",tileSize:256,maxZoom:19}),Ot={OpenStreetMap:be,"Esri World Imagery":xe},Pt={Seamarks:ye,"Marine Profile":Ze},oe=n(),Ee=na(oe),je=v.control.zoom({position:"bottomright"}),qe=v.control.layers(Ot,Pt);y(S,()=>{a.value!==void 0&&(S.value?(a.value.addControl(je),a.value.addControl(qe)):(a.value.removeControl(je),a.value.removeControl(qe)))}),y(Ee,()=>{S.value=Ee.value}),yt(async()=>{var J,ct;(J=oe.value)==null||J.addEventListener("touchstart",We,{passive:!0}),(ct=oe.value)==null||ct.addEventListener("touchend",Ge,{passive:!0}),a.value=v.map(Y.value,{layers:[be,xe,ye,Ze],attributionControl:!1}).setView(T.value,F.value),a.value.removeControl(a.value.zoomControl),a.value.on("click",x=>{k.value=[x.latlng.lat,x.latlng.lng]}),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:x,lng:H}=a.value.getCenter();x&&H&&(T.value=[x,H])});const e=Le(xe,"Esri",19),t=Le(be,"OSM",19),o=Le(ye,"Seamarks",18);a.value&&(e.addTo(a.value),t.addTo(a.value),o.addTo(a.value));const s=x=>{var ve;const H=((ve=x.getContainer)==null?void 0:ve.call(x))??x._container;H&&(H.classList.add("hidden-savetiles"),H.style.display="none")};s(e),s(t),s(o),await Se();const b=x=>{var ve;const H=((ve=x.getContainer)==null?void 0:ve.call(x))??x._container;return Array.from((H==null?void 0:H.querySelectorAll("a"))??[])},[p]=b(e),[_]=b(t),[Q]=b(o);fe=p,ge=_,he=Q,Ie(xe,"Esri"),Ie(be,"OSM"),Ie(ye,"Seamarks"),a.value.on("dragstart",()=>{ue.value=!0}),a.value.on("dragend",()=>{setTimeout(()=>ue.value=!1,200)}),a.value.on("zoomend",()=>{var x;R.value=!1,a.value!==void 0&&(F.value=((x=a.value)==null?void 0:x.getZoom())??T.value)}),a.value.on("contextmenu",x=>{k.value=[x.latlng.lat,x.latlng.lng]}),P.enableAutoUpdate(),window.addEventListener("keydown",tt),$.value?P.goToTarget(I.VEHICLE):P.goToTarget(I.HOME),!l.isVehicleOnline&&c.vehicleMission.length&&Ae(c.vehicleMission),C.value=!0,await Oe()});const $t=e=>(t,o)=>{q({variant:"info",message:`Save ${t._tilesforSave.length} ${e} tiles for offline use?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:L},{text:"Save tiles",color:"white",action:()=>{o(),L()}}]})},Ft=e=>(t,o)=>{q({variant:"warning",message:`Remove all saved ${e} tiles for this layer?`,persistent:!1,maxWidth:"450px",actions:[{text:"Cancel",color:"white",action:L},{text:"Remove tiles",color:"white",action:()=>{o(),L(),D({message:`${e} offline tiles removed`,variant:"info",duration:3e3})}}]})},Le=(e,t,o)=>Me.savetiles(e,{saveWhatYouSee:!0,maxZoom:o,alwaysDownload:!1,position:"topright",parallel:20,confirm:$t(t),confirmRemoval:Ft(t),saveText:`<i class="mdi mdi-download" title="Save ${t} tiles"></i>`,rmText:`<i class="mdi mdi-trash-can" title="Remove ${t} tiles"></i>`}),Ie=(e,t)=>{e.on("savestart",o=>{var s;M.value=0,B.value=((s=o==null?void 0:o._tilesforSave)==null?void 0:s.length)??0,pe.value=t,m.value=!0,D({message:`Saving ${B.value} ${t} tiles...`,variant:"info",duration:2e3})}),e.on("loadtileend",()=>{M.value+=1,B.value>0&&M.value>=B.value&&(D({message:`${t} offline tiles saved!`,variant:"success",duration:3e3}),m.value=!1,pe.value="",M.value=0,B.value=0)})},_t={open:e=>{if(!a.value||g.value||ue.value)return;e.preventDefault(),e.stopPropagation();const t=a.value.mouseEventToContainerPoint(e),o=a.value.containerPointToLatLng(t);k.value=[o.lat,o.lng],re.value.openAt(e),R.value=!0},close:()=>{we()}},Ye=()=>{var e;(e=a.value)==null||e.eachLayer(t=>{(t instanceof v.Marker||t instanceof v.Polyline&&t.options.color==="#358AC3")&&a.value.removeLayer(t)}),f.value=[],ke.value=void 0,K.value=void 0,le.value=void 0,N.value=void 0},Oe=async()=>{C.value&&(Ye(),l.isVehicleOnline?await ot():c.vehicleMission.length&&Ae(c.vehicleMission))};y(()=>l.isVehicleOnline,()=>{Oe()}),y(()=>c.vehicleMissionRevision,()=>{Oe()}),ca(()=>{var e,t;P.disableAutoUpdate(),window.removeEventListener("keydown",tt),a.value&&(a.value.off("contextmenu"),Object.values(A.value).forEach(o=>o.remove()),A.value={}),(e=oe.value)==null||e.removeEventListener("touchstart",We),(t=oe.value)==null||t.removeEventListener("touchend",Ge)}),y(T,(e,t)=>{var o;e.toString()!==t.toString()&&((o=a.value)==null||o.panTo(e))}),y(a,(e,t)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=t)}),y(F,(e,t)=>{var o;e!==t&&(R.value=!1,(o=a.value)==null||o.setZoom(F.value))}),y(ee.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const ie=n(void 0),P=new ua(e=>ie.value=e,e=>T.value=e);P.setTrackableTarget(I.VEHICLE,()=>$.value),P.setTrackableTarget(I.HOME,()=>h.value);const $=O(()=>l.coordinates.latitude?[l.coordinates.latitude,l.coordinates.longitude]:void 0),Pe=O(()=>{var e;return l.attitude.yaw?da((e=l.attitude)==null?void 0:e.yaw):0}),Ke=O(()=>{const e=l.lastHeartbeat;return e?`${va(e??0,{includeSeconds:!0})} ago`:"never"}),{history:At}=ma($);(ut=navigator==null?void 0:navigator.geolocation)==null||ut.watchPosition(e=>{h.value||(h.value=[e.coords.latitude,e.coords.longitude])},e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Qe=!0;y([h,a],async()=>{h.value===T.value||!a.value||!Qe||(P.goToTarget(I.HOME),Qe=!1)});const N=n();y(l.coordinates,()=>{if(!(!a.value||!$.value)){if(N.value===void 0){let e=pa;l.vehicleType===gt.MAV_TYPE_SURFACE_BOAT?e=fa:l.vehicleType===gt.MAV_TYPE_SUBMARINE&&(e=ga);const t=v.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});N.value=v.marker($.value,{icon:t});const o=v.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});N.value.bindTooltip(o),a.value.addLayer(N.value)}N.value.setLatLng($.value)}}),y($,(e,t)=>{ie.value===I.VEHICLE||t!==void 0||P.follow(I.VEHICLE)}),y([$,Pe,Ke,()=>l.isArmed],()=>{var t,o,s,b,p;if(N.value===void 0)return;(b=N.value.getTooltip())==null||b.setContent(`
    <p>Coordinates: ${(t=$.value)==null?void 0:t[0].toFixed(6)}, ${(o=$.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((s=l.velocity.ground)==null?void 0:s.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${Pe.value.toFixed(2)}°</p>
    <p>${l.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${Ke.value}</p>
  `);const e=(p=N.value.getElement())==null?void 0:p.querySelector("img");e&&(e.style.transform=`rotate(${Pe.value}deg)`)});const K=n();y(h,()=>{if(a.value===void 0)return;const e=h.value;if(e!==void 0)if(K.value)K.value.setLatLng(e);else{K.value=v.marker(e,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0});const t=v.tooltip({content:'<i class="mdi mdi-home-map-marker text-[18px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});K.value.bindTooltip(t),K.value.on("dragend",o=>{const b=o.target.getLatLng();De([b.lat,b.lng])}),a.value.addLayer(K.value)}});const ke=n();y(f,e=>{a.value&&(ke.value||(ke.value=v.polyline([],{color:"#358AC3"}).addTo(a.value)),ke.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,o)=>{var p;const s=v.marker(t.coordinates);s.setIcon(v.divIcon({className:"marker-icon",iconSize:[16,16],iconAnchor:[8,8]}));const b=v.tooltip({content:o.toString(),permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});s.bindTooltip(b),(p=a.value)==null||p.addLayer(s)}))},{deep:!0});const $e=n();y(At,e=>{if(a.value===void 0||e===void 0)return;$e.value===void 0&&($e.value=v.polyline([],{color:"#ffff00"}).addTo(a.value));const t=e.filter(o=>o.snapshot!==void 0).map(o=>o.snapshot);$e.value.setLatLngs(t)});const R=n(!1),k=n(null),Je=n(),Fe=n(!1),Xe=n(0),et=n(0),_e=n(),Dt=ha([{item:"Set home waypoint",action:()=>ce("set-home-waypoint"),icon:"mdi-home-map-marker"},{item:"Set Position Estimate",action:()=>ce("set-position"),icon:"mdi-crosshairs-question"},{item:"Place Point of Interest",action:()=>ce("place-poi"),icon:"mdi-map-marker-plus"},{item:"GoTo",action:()=>ce("goto"),icon:"mdi-crosshairs-gps"},{item:"Set default map position",action:()=>ce("set-default-map-position"),icon:"mdi-map-check"}]),le=n(),zt=async()=>{var e;if(!(!a.value||!k.value))try{await c.setDefaultMapPosition(k.value,F.value),D({message:"Default map position set",variant:"success"});const t=v.marker(k.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value),o=v.tooltip({content:'<i class="mdi mdi-map-check text-[18px] border-[1px] rounded-full px-[2px] py-[1px]"></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});t.bindTooltip(o).openTooltip();const s=t.getElement(),b=(e=t.getTooltip())==null?void 0:e.getElement();[s,b].forEach(p=>{p&&(p.style.transition="opacity 1s",p.style.opacity="1")}),setTimeout(()=>{[s,b].forEach(p=>{p&&(p.style.opacity="0")}),setTimeout(()=>{var p;(p=a.value)==null||p.removeLayer(t)},1e3)},1500)}catch(t){console.error(t),D({message:"Failed to set default map position",variant:"error"})}},Bt=async()=>{if(!k.value||!a.value)return;le.value&&(a.value.removeLayer(le.value),le.value=void 0),le.value=v.marker(k.value,{icon:v.divIcon({className:"marker-icon",iconSize:[24,24],iconAnchor:[12,12]})}).addTo(a.value);const e=v.tooltip({content:'<i class="mdi mdi-crosshairs-gps border-[1px] rounded-full text-[18px] px-[2px] pt-[1px] "></i>',permanent:!0,direction:"center",className:"waypoint-tooltip",opacity:1});if(le.value.bindTooltip(e),k.value){const p=l.coordinates.altitude??0,_=k.value[0],Q=k.value[1];try{await l.goTo(0,0,0,0,_,Q,p)}catch(J){D({message:`GoTo request failed: ${J.message}`,variant:"error"})}}},ce=async e=>{switch(e){case"goto":{Bt();break}case"set-default-map-position":zt();break;case"place-poi":k.value&&ae.value?ae.value.openDialog(k.value):k.value?ae.value||(D({message:"POI Manager (map widget) is not available.",variant:"error"}),console.error("Cannot open POI dialog, POI Manager (map widget) ref is not set.")):(D({message:"Cannot place Point of Interest without map coordinates.",variant:"error"}),console.error("Cannot open POI dialog without click coordinates for new POI"));break;case"set-home-waypoint":k.value&&De(k.value);break;case"set-position":k.value&&(Xe.value=k.value[0],et.value=k.value[1],Fe.value=!0);break;default:console.warn("Unknown menu option selected:",e)}R.value=!1},we=()=>{R.value=!1,a.value!==void 0&&Je.value!==void 0&&a.value.removeLayer(Je.value)},Ht=(e,t)=>{if(!a.value)return;_e.value&&a.value.removeLayer(_e.value);const o=v.marker([e,t],{icon:v.divIcon({className:"position-estimate-marker",html:'<i class="mdi mdi-axis-arrow text-[32px] text-blue-500 drop-shadow-lg"></i>',iconSize:[32,32],iconAnchor:[16,16]})}).addTo(a.value);_e.value=o},tt=e=>{e.key==="Escape"&&we()},Ae=e=>{e.forEach((t,o)=>{o===0?(h.value=t.coordinates,De(t.coordinates)):f.value.push(t)})},Ce=n(!1),at=n(0),ot=async()=>{Ce.value=!0,Ye();const e=async t=>{at.value=t};try{const t=await l.fetchMission(e);Ae(t),D({variant:"success",message:"Mission download succeeded!",duration:3e3})}catch(t){q({variant:"error",title:"Mission download failed",message:t,timer:5e3})}finally{Ce.value=!1}},De=async e=>{const t=[e[0],e[1]];h.value=t,await l.setHomeWaypoint(t,0),R.value&&(R.value=!1)},it=async()=>{try{await l.startMission()}catch{D({message:"Failed to start mission.",variant:"error"})}},Ut=async()=>{if(c.showChecklistBeforeArm){i.value=!0;return}it()},de=ba(),Nt=O(()=>`${Math.max(-de.widgetClearanceForVisibleArea(E.value).bottom,0)}px`),lt=O(()=>`${Math.max(-de.widgetClearanceForVisibleArea(E.value).top,0)}px`),Rt=O(()=>l.isVehicleOnline?"Download the mission that is stored in the vehicle.":"Cannot download mission (vehicle offline)."),Wt=O(()=>l.isVehicleOnline?"Execute the mission that is stored in the vehicle.":"Cannot execute mission (vehicle offline)."),Gt=O(()=>h.value===void 0?"Cannot center map on home (home position undefined).":ie.value===I.HOME?"Tracking home position. Click to stop tracking.":"Click once to center on home or twice to track it."),Zt=O(()=>l.isVehicleOnline?$.value===void 0?"Cannot center map on vehicle (vehicle position undefined).":ie.value===I.VEHICLE?"Tracking vehicle position. Click to stop tracking.":"Click once to center on vehicle or twice to track it.":"Cannot center map on vehicle (vehicle offline)."),st=e=>({html:`
    <div class="poi-marker-container">
      <div class="poi-marker-background" style="background-color: ${e.color}80;"></div>
      <i class="v-icon notranslate mdi ${e.icon}" style="color: rgba(255, 255, 255, 0.7); position: relative; z-index: 2;"></i>
    </div>
  `,className:"poi-marker-icon-widget",iconSize:[32,32],iconAnchor:[16,32]}),nt=e=>{if(!a.value||!a.value.getContainer())return;const t=v.divIcon(st(e)),o=v.marker(e.coordinates,{icon:t,draggable:!0}).addTo(a.value),s=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `,b={permanent:!1,direction:"top",offset:[0,-40],className:"poi-tooltip-widget"};o.bindTooltip(s,b),o.on("drag",p=>{var J;const _=p.target.getLatLng(),Q=`
      <strong>${e.name}</strong><br>
      ${e.description?e.description+"<br>":""}
      Lat: ${_.lat.toFixed(8)}, Lng: ${_.lng.toFixed(8)}
    `;(J=o.getTooltip())==null||J.setContent(Q)}),o.on("dragend",p=>{const _=p.target.getLatLng();c.movePointOfInterest(e.id,[_.lat,_.lng])}),o.on("click",p=>{if(v.DomEvent.stopPropagation(p),ae.value){const _=c.pointsOfInterest.find(Q=>Q.id===e.id);_?ae.value.openDialog(void 0,_):console.warn("POI not found in store:",e.id)}}),A.value[e.id]=o},rt=e=>{var s;if(!a.value||!a.value.getContainer()||!A.value[e.id])return;const t=A.value[e.id];t.setLatLng(e.coordinates),t.setIcon(v.divIcon(st(e)));const o=`
    <strong>${e.name}</strong><br>
    ${e.description?e.description+"<br>":""}
    Lat: ${e.coordinates[0].toFixed(8)}, Lng: ${e.coordinates[1].toFixed(8)}
  `;(s=t.getTooltip())==null||s.setContent(o)},jt=e=>{!a.value||!A.value[e]||(A.value[e].remove(),delete A.value[e])};return y(()=>c.pointsOfInterest,async e=>{if((!a.value||!a.value.getContainer())&&(await Se(),!a.value||!a.value.getContainer())){console.warn("Map.vue: POI watcher - map not ready after nextTick.");return}const t=new Set(e.map(o=>o.id));Object.keys(A.value).forEach(o=>{t.has(o)||jt(o)}),e.forEach(o=>{A.value[o.id]?rt(o):nt(o)})},{deep:!0,immediate:!0}),y(a,e=>{e&&e.getContainer()&&c.pointsOfInterest.forEach(t=>{A.value[t.id]?rt(t):nt(t)})},{immediate:!0}),(e,t)=>{const o=xa("contextmenu");return V(),j(Vt,null,[ht((V(),j("div",{ref_key:"mapBase",ref:oe,class:Be(["page-base",u(de).editingMode?"pointer-events-none":"pointer-events-auto"])},[Z("div",{id:Y.value,ref_key:"map",ref:a,class:"map"},[r(ka,{modelValue:te.value,"onUpdate:modelValue":t[0]||(t[0]=s=>te.value=s),"close-on-content-click":!1,location:"top end"},{activator:d(({props:s})=>[ht(r(z,me(s,{class:"absolute right-[209px] m-3 bottom-button bg-slate-50 text-[14px]",elevation:"2",size:"x-small",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download-multiple"}),null,16),[[ya,S.value]])]),default:d(()=>[r(Mt,{style:ne(u(w).globalGlassMenuStyles),class:"py-0 min-w-[220px] rounded-lg border-[1px]"},{default:d(()=>[r(Te,{class:"py-0",title:"Save visible Esri tiles",onClick:Et}),r(Ue),r(Te,{class:"py-0",title:"Save visible OSM tiles",onClick:Lt}),r(Ue),r(Te,{class:"py-0",title:"Save visible Seamarks tiles",onClick:It})]),_:1},8,["style"])]),_:1},8,["modelValue"]),r(Ve,{location:"top",text:Gt.value},{activator:d(({props:s})=>[S.value?(V(),G(z,me({key:0},s,{class:["absolute right-[166px] m-3 bottom-button bg-slate-50 text-[14px]",h.value?"":"active-events-on-disabled"],color:ie.value==u(I).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-search",size:"x-small",disabled:!h.value,onClick:t[1]||(t[1]=se(b=>u(P).goToTarget(u(I).HOME,!0),["stop"])),onDblclick:t[2]||(t[2]=se(b=>u(P).follow(u(I).HOME),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:Zt.value},{activator:d(({props:s})=>[S.value?(V(),G(z,me({key:0},s,{class:["absolute m-3 bottom-button right-[124px] bg-slate-50 text-[14px]",$.value?"":"active-events-on-disabled"],color:ie.value==u(I).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!$.value,onClick:t[3]||(t[3]=se(b=>u(P).goToTarget(u(I).VEHICLE,!0),["stop"])),onDblclick:t[4]||(t[4]=se(b=>u(P).follow(u(I).VEHICLE),["stop"]))}),null,16,["class","color","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:Rt.value},{activator:d(({props:s})=>[S.value?(V(),G(z,me({key:0},s,{class:["absolute m-3 bottom-button right-[82px] bg-slate-50 text-[14px]",u(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:se(ot,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"]),r(Ve,{location:"top",text:Wt.value},{activator:d(({props:s})=>[S.value?(V(),G(z,me({key:0},s,{class:["absolute mb-3 ml-1 bottom-button right-[52px] bg-slate-50 text-[14px]",u(l).isVehicleOnline?"":"active-events-on-disabled"],disabled:!u(l).isVehicleOnline,elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:se(Ut,["stop"])}),null,16,["class","disabled"])):W("",!0)]),_:1},8,["text"])],8,Fa)],2)),[[o,_t]]),r(wa,{ref_key:"contextMenuRef",ref:re,visible:R.value,width:"260px","menu-items":Dt,onClose:we},null,8,["visible","menu-items"]),r(Tt,{modelValue:u(de).widgetManagerVars(u(E).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>u(de).widgetManagerVars(u(E).hash).configMenuOpen=s),width:"auto"},{default:d(()=>[r(kt,{class:"pa-2",style:ne(u(w).globalGlassMenuStyles)},{default:d(()=>[r(wt,{class:"text-center"},{default:d(()=>t[9]||(t[9]=[U("Map widget settings")])),_:1,__:[9]}),r(Ct,null,{default:d(()=>[r(Ca,{modelValue:u(E).options.showVehiclePath,"onUpdate:modelValue":t[5]||(t[5]=s=>u(E).options.showVehiclePath=s),class:"my-1",label:"Show vehicle path",color:u(E).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Ce.value?(V(),G(Ma,{key:0,"model-value":at.value,height:"10",absolute:"",bottom:"",color:"white",style:ne(`top: ${lt.value}`)},null,8,["model-value","style"])):W("",!0),Ce.value?(V(),j("p",{key:1,style:ne({top:lt.value}),class:"absolute left-[7px] mt-4 flex text-md font-bold text-white z-30 drop-shadow-md"}," Loading mission... ",4)):W("",!0),r(Va,{ref_key:"poiManagerMapWidgetRef",ref:ae},null,512),r($a,{"model-value":i.value,onConfirmed:it,"onUpdate:modelValue":t[7]||(t[7]=s=>i.value=s)},null,8,["model-value"]),r(Ta,{modelValue:Fe.value,"onUpdate:modelValue":t[8]||(t[8]=s=>Fe.value=s),vehicle:u(l).mainVehicle,"initial-latitude":Xe.value,"initial-longitude":et.value,onPositionSet:Ht},null,8,["modelValue","vehicle","initial-latitude","initial-longitude"]),m.value?(V(),j("div",{key:2,class:"absolute top-14 left-2 flex justify-start items-center text-white text-md py-2 px-4 rounded-lg",style:ne(u(w).globalGlassMenuStyles)},[Z("p",null,[t[10]||(t[10]=U(" Saving offline map content ")),pe.value?(V(),j("span",_a,"("+He(pe.value)+")",1)):W("",!0),U(":  "+He(B.value?Math.round(M.value/B.value*100):0)+"% ",1)])],4)):W("",!0)],64)}}}),za=St(Aa,[["__scopeId","data-v-5bef8b38"]]);export{za as default};
