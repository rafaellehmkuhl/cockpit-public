import{c as ee,bC as te,k as U,ax as se,bD as oe,bE as ne,K as ae,y as le,J as ie,r as C,L as re,o as ue,al as de,D as ce,l as $,m as B,n as r,H as s,O as x,v as p,N as o,V as pe,a6 as V,Q as d,P as fe,R as me,bc as ge,s as he,S as H,aB as ve,bF as Ce,a7 as y,W as xe,F as ye,bG as we,bH as Ve,bI as _e,bJ as h,bK as _,_ as ke}from"./index-BZN3mXus.js";import{V as be,a as I,b as A,c as O}from"./VExpansionPanels-RiZl0waq.js";function Se(u){return new Worker(""+new URL("css.worker-CDE9TcMx.js",import.meta.url).href,{name:u==null?void 0:u.name})}function je(u){return new Worker(""+new URL("html.worker-CgyTMpcR.js",import.meta.url).href,{name:u==null?void 0:u.name})}function Ee(u){return new Worker(""+new URL("json.worker-F_3Wl95C.js",import.meta.url).href,{name:u==null?void 0:u.name})}const Me={class:"main"},We=["innerHTML"],Te={key:0,class:"help-panel mb-4 p-4 rounded bg-white/5"},Le={class:"flex justify-between items-center px-4 w-full h-full"},De={class:"flex gap-x-3"},z=50,Fe=ee({__name:"DoItYourself",props:{widget:{}},setup(u){te(t=>({e5f1b0a6:w.value}));const v=se("diy-widget-auto-save",!1);self.MonacoEnvironment={getWorker(t,e){return e==="json"?new Ee:e==="css"||e==="scss"||e==="less"?new Se:e==="html"||e==="handlebars"||e==="razor"?new je:e==="typescript"||e==="javascript"?new oe:new ne}};const k=ae(),b=le(),n=ie(u).widget,S=C(null),j=C(null),E=C(null),M=C(!1),W=C(["html","css","js"]);let a=null,l=null,i=null;const f={html:`<!-- Write your HTML code here -->
<div id="diy-container">
  <span>Create your own widget!</span>
</div>`,css:`/* Write your CSS code here */
#diy-container {
  width: 100%;
  height: 100%;
  padding: 1rem;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  text-align: center;
  font-family: 'Roboto', sans-serif;
  font-weight: 500;
}`,js:`// Write your JavaScript code here
document.addEventListener('DOMContentLoaded', () => {
  // Your code here
});`,inheritCockpitStyles:!0},N=U(()=>{const t=n.value.options.html||f.html,e=n.value.options.css||f.css,m=n.value.options.js||f.js;return`${t}
<style>
${e}
</style>
<script>
${m}
<\/script>`}),T=(t,e,m)=>_e.create(t,{value:m,language:e,theme:"vs-dark",minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",padding:{top:12,bottom:12}}),L=t=>{t.addCommand(h.CtrlCmd|_.Enter,()=>g()),t.addCommand(h.CtrlCmd|_.KeyS,()=>g()),t.addCommand(h.CtrlCmd|h.Alt|_.UpArrow,()=>{a&&a.hasTextFocus()&&l?l.focus():i&&i.hasTextFocus()&&a?a.focus():l&&l.hasTextFocus()&&i&&i.focus()}),t.addCommand(h.CtrlCmd|h.Alt|_.DownArrow,()=>{a&&a.hasTextFocus()&&i?i.focus():i&&i.hasTextFocus()&&l?l.focus():l&&l.hasTextFocus()&&a&&a.focus()})},D=t=>{t.onDidChangeModelContent(()=>{Y()})},P=async()=>{a||!S.value||i||!E.value||l||!j.value||(a=T(S.value,"html",n.value.options.html||f.html),i=T(E.value,"javascript",n.value.options.js||f.js),l=T(j.value,"css",n.value.options.css||f.css),a&&(L(a),D(a)),i&&(L(i),D(i)),l&&(L(l),D(l)))},Y=()=>{v.value&&g()},K=async()=>{await P()},J=async()=>{F()},g=()=>{!a||!l||!i||(n.value.options.html=a.getValue(),n.value.options.css=l.getValue(),n.value.options.js=i.getValue(),R())},R=()=>{var c;const t=n.value.options.js||"",e=`diy-script-${n.value.hash}`;(c=document.getElementById(e))==null||c.remove();const m=document.createElement("script");m.type="text/javascript",m.textContent=t,m.id=e,document.body.appendChild(m)},G=()=>{!a||!l||!i||(a.setValue(n.value.options.html||f.html),l.setValue(n.value.options.css||f.css),i.setValue(n.value.options.js||f.js))},F=()=>{a&&(a.dispose(),a=null),l&&(l.dispose(),l=null),i&&(i.dispose(),i=null)},Q=()=>{b.widgetManagerVars(n.value.hash).configMenuOpen=!1,v.value&&g(),F()},q=()=>{if(!a||!l||!i)return;const t={html:a.getValue(),css:l.getValue(),js:i.getValue(),inheritCockpitStyles:n.value.options.inheritCockpitStyles||!1};Ve(t,"diy-widget-config.json")},X=async()=>{try{const t=await we("application/json",!0,Z);if(!a||!l||!i)return;a.setValue(t.html),l.setValue(t.css),i.setValue(t.js),n.value.options.inheritCockpitStyles=t.inheritCockpitStyles||!1,g()}catch(t){console.error("Error importing configuration:",t),alert(t.message||"Failed to import configuration file")}},Z=t=>!t||typeof t!="object"?{isValid:!1,error:"Invalid configuration file: content is not an object."}:!t.html||!t.css||!t.js?{isValid:!1,error:"Invalid configuration file: missing html, css, or js fields"}:{isValid:!0},w=U(()=>{const t=W.value.length;return t===0?`${z}vh`:`${Math.round(z/t)}vh`});return re(()=>{n.value.options=Object.assign({},f,n.value.options)}),ue(()=>{R()}),de(()=>{F()}),(t,e)=>{const m=ce("vue-draggable-resizable");return B(),$(ye,null,[r("div",Me,[r("div",{class:"w-full h-full",style:x(p(n).options.inheritCockpitStyles?p(k).globalGlassMenuStyles:{}),innerHTML:N.value},null,12,We)]),s(xe,{modelValue:p(b).widgetManagerVars(p(n).hash).configMenuOpen,"onUpdate:modelValue":e[4]||(e[4]=c=>p(b).widgetManagerVars(p(n).hash).configMenuOpen=c),"max-width":p(k).isOnSmallScreen?"100%":"800px",onAfterEnter:K,onAfterLeave:J},{default:o(()=>[s(m,{"drag-handle":".drag-handle",w:"auto",h:"auto",handles:["tm","mr","bm","ml"]},{default:o(()=>[s(pe,{class:"pa-2",style:x(p(k).globalGlassMenuStyles)},{default:o(()=>[s(V,{class:"drag-handle absolute top-[12px] left-[12px] cursor-grab"},{default:o(()=>e[5]||(e[5]=[d("mdi-drag")])),_:1,__:[5]}),s(V,{class:"absolute top-[12px] right-[12px] cursor-pointer",onClick:e[0]||(e[0]=c=>M.value=!M.value)},{default:o(()=>e[6]||(e[6]=[d(" mdi-help-circle-outline ")])),_:1,__:[6]}),s(fe,{class:"w-full text-center mt-2"},{default:o(()=>e[7]||(e[7]=[d("DIY widget configuration")])),_:1,__:[7]}),s(me,{class:"mx-2 flex flex-col gap-y-3"},{default:o(()=>[s(ge,null,{default:o(()=>[M.value?(B(),$("div",Te,e[8]||(e[8]=[r("h3",{class:"text-lg mb-2"},"Editor instructions",-1),r("ul",{class:"text-sm text-white/70 list-disc pl-4 space-y-1"},[r("li",null,"Use the HTML, CSS, and JS editors to create your custom widget"),r("li",null,"Changes are applied when you click Apply or press Cmd/Ctrl + Enter/S"),r("li",null,"Navigate between editors using Cmd/Ctrl + Option/Alt + ↑/↓"),r("li",null,"Reset to last saved state using the Reset button"),r("li",null,"Your code runs in the widget's context and has access to the DOM"),r("li",null,"You can use the console to debug your code"),r("li",null," You can use the data-lake system to inject or consume data from Cockpit. Check the docs for more information around this. "),r("li",null,"Click on each editor's header to expand it to full size")],-1)]))):he("",!0)]),_:1}),s(be,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=c=>W.value=c),class:"editors-container",multiple:""},{default:o(()=>[s(I,{value:"html"},{default:o(()=>[s(A,{static:"",height:"30px",class:"text-white/60"},{default:o(()=>e[9]||(e[9]=[d(" HTML ")])),_:1,__:[9]}),s(O,{eager:""},{default:o(()=>[r("div",{ref_key:"htmlEditorContainer",ref:S,class:"editor-container",style:x({height:w.value})},null,4)]),_:1})]),_:1}),s(I,{value:"js"},{default:o(()=>[s(A,{static:"",height:"30px",class:"text-white/60"},{default:o(()=>e[10]||(e[10]=[d(" JS ")])),_:1,__:[10]}),s(O,{eager:""},{default:o(()=>[r("div",{ref_key:"jsEditorContainer",ref:E,class:"editor-container",style:x({height:w.value})},null,4)]),_:1})]),_:1}),s(I,{value:"css"},{default:o(()=>[s(A,{static:"",height:"30px",class:"text-white/60"},{default:o(()=>e[11]||(e[11]=[d(" CSS ")])),_:1,__:[11]}),s(O,{eager:""},{default:o(()=>[r("div",{ref_key:"cssEditorContainer",ref:j,class:"editor-container",style:x({height:w.value})},null,4)]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(H,{modelValue:p(v),"onUpdate:modelValue":e[2]||(e[2]=c=>ve(v)?v.value=c:null),label:"Auto Save",density:"compact",class:"-mb-2","hide-details":""},null,8,["modelValue"]),s(H,{modelValue:p(n).options.inheritCockpitStyles,"onUpdate:modelValue":e[3]||(e[3]=c=>p(n).options.inheritCockpitStyles=c),label:"Inherit Cockpit interface styles",density:"compact",class:"-mb-2","hide-details":""},null,8,["modelValue"])]),_:1}),s(Ce,null,{default:o(()=>[r("div",Le,[s(y,{class:"text-white/60",variant:"text",onClick:Q},{default:o(()=>e[12]||(e[12]=[d("Close")])),_:1,__:[12]}),r("div",De,[s(y,{class:"text-white/60",variant:"text",title:"Export configuration",onClick:q},{default:o(()=>[s(V,{class:"mr-1 mt-[2px]"},{default:o(()=>e[13]||(e[13]=[d("mdi-download")])),_:1,__:[13]}),e[14]||(e[14]=d(" Export "))]),_:1,__:[14]}),s(y,{class:"text-white/60 mr-10",variant:"text",title:"Import configuration",onClick:X},{default:o(()=>[s(V,{class:"mr-1 mt-[2px]"},{default:o(()=>e[15]||(e[15]=[d("mdi-upload")])),_:1,__:[15]}),e[16]||(e[16]=d(" Import "))]),_:1,__:[16]}),s(y,{class:"text-white/60",variant:"text",onClick:G},{default:o(()=>e[17]||(e[17]=[d("Reset")])),_:1,__:[17]}),s(y,{class:"text-white",variant:"text",onClick:g},{default:o(()=>e[18]||(e[18]=[d("Apply")])),_:1,__:[18]})])])]),_:1})]),_:1},8,["style"])]),_:1})]),_:1},8,["modelValue","max-width"])],64)}}}),Re=ke(Fe,[["__scopeId","data-v-62cb0338"]]);export{Re as default};
