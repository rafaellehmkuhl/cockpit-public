import{bw as fe,bx as we,by as Te,bz as U,f as xe,bA as ne,bB as ke,bC as Ie,c as Ae,b9 as Se,af as Ve,K as Ce,R as De,u as Ee,ao as Oe,r as p,k as L,L as ie,M as se,ai as _e,bD as f,o as Ne,bE as M,U as He,w,bF as Le,aB as Re,bG as ze,bH as le,az as Fe,ae as Ue,l as Pe,m as K,n as re,p as P,s as ue,H as I,y as ce,v as c,a0 as E,a1 as $,W as de,x as ve,V as B,a3 as $e,aq as Be,Y as Xe,a4 as We,aF as Ye,a9 as Ge,I as qe,a2 as Ze,F as je,B as Ke,C as Je,E as Qe}from"./index-v1kt2_hk.js";function pe(n,d){if(n==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var i in d)Object.prototype.hasOwnProperty.call(d,i)&&(n[i]=d[i]);return n}function eo(n){return pe({},n)}var me=1440,oo=2520,J=43200,to=86400;function ao(n,d,i){var V,g;fe(2,arguments);var l=Ie(),s=(V=(g=i==null?void 0:i.locale)!==null&&g!==void 0?g:l.locale)!==null&&V!==void 0?V:we;if(!s.formatDistance)throw new RangeError("locale must contain formatDistance property");var t=Te(n,d);if(isNaN(t))throw new RangeError("Invalid time value");var r=pe(eo(i),{addSuffix:!!(i!=null&&i.addSuffix),comparison:t}),h,m;t>0?(h=U(d),m=U(n)):(h=U(n),m=U(d));var T=xe(m,h),R=(ne(m)-ne(h))/1e3,v=Math.round((T-R)/60),A;if(v<2)return i!=null&&i.includeSeconds?T<5?s.formatDistance("lessThanXSeconds",5,r):T<10?s.formatDistance("lessThanXSeconds",10,r):T<20?s.formatDistance("lessThanXSeconds",20,r):T<40?s.formatDistance("halfAMinute",0,r):T<60?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",1,r):v===0?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",v,r);if(v<45)return s.formatDistance("xMinutes",v,r);if(v<90)return s.formatDistance("aboutXHours",1,r);if(v<me){var H=Math.round(v/60);return s.formatDistance("aboutXHours",H,r)}else{if(v<oo)return s.formatDistance("xDays",1,r);if(v<J){var b=Math.round(v/me);return s.formatDistance("xDays",b,r)}else if(v<to)return A=Math.round(v/J),s.formatDistance("aboutXMonths",A,r)}if(A=ke(m,h),A<12){var y=Math.round(v/J);return s.formatDistance("xMonths",y,r)}else{var O=A%12,_=Math.floor(A/12);return O<3?s.formatDistance("aboutXYears",_,r):O<9?s.formatDistance("overXYears",_,r):s.formatDistance("almostXYears",_+1,r)}}function no(n,d){return fe(1,arguments),ao(n,Date.now(),d)}(function(n){let d;if(typeof define=="function"&&define.amd)define(["leaflet"],n);else if(typeof module=="object"&&typeof module.exports=="object")d=require("leaflet"),module.exports=n(d);else{if(typeof window.L>"u")throw"Leaflet must be loaded first";n(window.L)}})(function(n){const d=n.Marker.prototype._initIcon,i=n.Marker.prototype._setPos,V=n.DomUtil.TRANSFORM==="msTransform";n.Marker.addInitHook(function(){let l=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;l&&(l=l[0]+"px "+l[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||l||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(s){s.target._applyRotation()})}),n.Marker.include({_initIcon:function(){d.call(this)},_setPos:function(g){i.call(this,g),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[n.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,V?this._icon.style[n.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[n.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(g){return this.options.rotationAngle=g,this.update(),this},setRotationOrigin:function(g){return this.options.rotationOrigin=g,this.update(),this}})});const io=""+new URL("blueboat-marker-DyHmCFOq.png",import.meta.url).href,so=""+new URL("brov2-marker-CBzp11FX.png",import.meta.url).href,lo=""+new URL("generic-vehicle-marker-SovxT5Tc.png",import.meta.url).href,ro={class:"page-base"},uo=["id"],vo=Ae({__name:"Map",props:{widget:{}},setup(n){var ae;Se(e=>({"7dd406d0":Me.value}));const d=n,i=Ve(d).widget,V=Ce(),{showDialog:g}=De(),l=Ee(),s=Oe(),t=p(),r=p(15),h=p([-27.5935,-48.55854]),m=p(h.value),T=L(()=>`map-${i.value.hash}`);ie.registerUsage(se.latitude),ie.registerUsage(se.longitude),_e(()=>{Object.keys(i.value.options).length===0&&(i.value.options={showVehiclePath:!0}),b.enableAutoUpdate()});const R=f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),v=f.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri World Imagery"}),A={OpenStreetMap:R,"Esri World Imagery":v};Ne(async()=>{t.value=f.map(T.value,{layers:[R,v]}).setView(h.value,r.value),t.value.zoomControl.setPosition("bottomright"),t.value.on("moveend",()=>{if(t.value===void 0)return;let{lat:o,lng:a}=t.value.getCenter();o&&a&&(h.value=[o,a])}),t.value.on("zoomend",()=>{var o;t.value!==void 0&&(r.value=((o=t.value)==null?void 0:o.getZoom())??h.value)}),t.value.on("click",()=>{t.value!==void 0&&t.value.on("click",ee)}),t.value.on("contextmenu",()=>{oe()});const e=f.control.layers(A);t.value.addControl(e),b.enableAutoUpdate(),window.addEventListener("keydown",te),b.goToTarget(M.HOME)}),He(()=>{b.disableAutoUpdate(),window.removeEventListener("keydown",te),t.value&&(t.value.off("click",ee),t.value.off("contextmenu"))}),w(h,(e,o)=>{var a,u,S;e.toString()!==o.toString()&&((a=t.value)==null||a.panTo(e),(S=(u=C.value)==null?void 0:u.getTooltip())==null||S.setContent(`Home: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`))}),w(t,(e,o)=>{t.value!==void 0&&(e==null?void 0:e.options)===void 0&&(t.value=o)}),w(r,(e,o)=>{var a;e!==o&&((a=t.value)==null||a.setZoom(r.value))}),w(d.widget,()=>{var e;(e=t.value)==null||e.invalidateSize()});const H=p(void 0),b=new Le(e=>H.value=e,e=>h.value=e);b.setTrackableTarget(M.VEHICLE,()=>y.value),b.setTrackableTarget(M.HOME,()=>m.value);const y=L(()=>l.coordinates.latitude?[l.coordinates.latitude,l.coordinates.longitude]:void 0),O=L(()=>{var e;return l.attitude.yaw?Re((e=l.attitude)==null?void 0:e.yaw):0}),_=L(()=>{const e=l.lastHeartbeat;return e?`${no(e??0,{includeSeconds:!0})} ago`:"never"}),{history:ge}=ze(y);(ae=navigator==null?void 0:navigator.geolocation)==null||ae.watchPosition(e=>m.value=[e.coords.latitude,e.coords.longitude],e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Q=!0;w([m,t],async()=>{m.value===h.value||!t.value||!Q||(b.goToTarget(M.HOME),Q=!1)});const x=p();w(l.coordinates,()=>{if(!(!t.value||!y.value)){if(x.value===void 0){x.value=f.marker(y.value);let e=lo;l.vehicleType===le.MAV_TYPE_SURFACE_BOAT?e=io:l.vehicleType===le.MAV_TYPE_SUBMARINE&&(e=so);const o=new f.Icon({iconUrl:e,iconSize:[64,64],iconAnchor:[32,32]});x.value.setIcon(o);const a=f.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[64,-12]});x.value.bindTooltip(a),t.value.addLayer(x.value)}x.value.setLatLng(y.value)}}),w([y,O,_,()=>l.isArmed],()=>{var e,o,a,u;x.value!==void 0&&((u=x.value.getTooltip())==null||u.setContent(`
    <p>Coordinates: ${(e=y.value)==null?void 0:e[0].toFixed(6)}, ${(o=y.value)==null?void 0:o[1].toFixed(6)}</p>
    <p>Velocity: ${((a=l.velocity.ground)==null?void 0:a.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${O.value.toFixed(2)}°</p>
    <p>${l.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${_.value}</p>
  `),x.value.setRotationAngle(O.value))});const C=p();w(m,()=>{if(t.value===void 0)return;const e=m.value;if(e!==void 0){if(C.value===void 0){C.value=f.marker(e);const o=f.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:"H"});C.value.setIcon(o);const a=f.tooltip({content:"No data available",className:"waypoint-tooltip"});C.value.bindTooltip(a),t.value.addLayer(C.value)}C.value.setLatLng(m.value)}});const X=p();w(s.currentPlanningWaypoints,e=>{if(t.value!==void 0){if(X.value===void 0){const o=e.map(a=>a.coordinates);X.value=f.polyline(o,{color:"#358AC3"}).addTo(t.value)}X.value.setLatLngs(e.map(o=>o.coordinates)),e.forEach((o,a)=>{var k;const u=f.marker(o.coordinates),S=f.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:`${a}`});u.setIcon(S),(k=t.value)==null||k.addLayer(u)})}});const W=p();w(ge,e=>{if(t.value===void 0||e===void 0)return;W.value===void 0&&(W.value=f.polyline([],{color:"#358AC3"}).addTo(t.value));const o=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);W.value.setLatLngs(o)});const z=p(!1),N=p(null),F=Fe({top:"0px",left:"0px"}),D=p(),ee=e=>{var o,a,u,S;if(D.value!==void 0&&t.value!==void 0&&((o=D.value)==null||o.removeFrom(t.value)),((a=e==null?void 0:e.latlng)==null?void 0:a.lat)!=null&&((u=e==null?void 0:e.latlng)==null?void 0:u.lng)!=null){N.value=[e.latlng.lat,e.latlng.lng],z.value=!0;const k=(S=t.value)==null?void 0:S.getContainer();if(k){const{x:Z,y:j}=k.getBoundingClientRect();F.left=`${e.originalEvent.clientX-Z}px`,F.top=`${e.originalEvent.clientY-j}px`}}else console.error("Invalid event structure:",e);if(t.value!==void 0){D.value=f.marker(N.value);const k=f.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16]});D.value.setIcon(k),t.value.addLayer(D.value)}},he=e=>{switch(console.debug(`Map context menu option selected: ${e}.`),e){case"goto":if(N.value){const k=l.coordinates.altitude??0,Z=N.value[0],j=N.value[1];Ke(()=>{l.goTo(0,0,0,0,Z,j,k)},{command:"GoTo"},Je(Qe.GOTO))}break;default:console.warn("Unknown menu option selected:",e)}z.value=!1},oe=()=>{z.value=!1,N.value=null,t.value!==void 0&&D.value!==void 0&&t.value.removeLayer(D.value)},te=e=>{e.key==="Escape"&&oe()},Y=p(!1),G=p(0),be=async()=>{for(Y.value=!0,G.value=0;s.currentPlanningWaypoints.length>0;)s.currentPlanningWaypoints.pop();const e=async o=>{G.value=o};try{(await l.fetchMission(e)).forEach(a=>{s.currentPlanningWaypoints.push(a),g({variant:"success",message:"Mission download succeed!",timer:2e3})})}catch(o){g({variant:"error",title:"Mission download failed",message:o,timer:5e3})}finally{Y.value=!1}},ye=()=>{l.startMission()},q=Ue(),Me=L(()=>`${Math.max(-q.widgetClearanceForVisibleArea(i.value).bottom,0)}px`);return(e,o)=>{const a=Pe("tooltip");return K(),re(je,null,[P("div",ro,[P("div",{id:T.value,ref_key:"map",ref:t,class:"map"},[ue(I($,{class:ce(["absolute left-0 m-3 bottom-button bg-slate-50",m.value?"":"active-events-on-disabled"]),color:H.value==c(M).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-map-marker",size:"x-small",disabled:!m.value,onClick:o[0]||(o[0]=E(u=>c(b).goToTarget(c(M).HOME,!0),["stop"])),onDblclick:o[1]||(o[1]=E(u=>c(b).follow(c(M).HOME),["stop"]))},null,8,["class","color","disabled"]),[[a,m.value?void 0:"Home position is currently undefined"]]),ue(I($,{class:ce(["absolute m-3 bottom-button left-10 bg-slate-50",y.value?"":"active-events-on-disabled"]),color:H.value==c(M).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!y.value,onClick:o[2]||(o[2]=E(u=>c(b).goToTarget(c(M).VEHICLE,!0),["stop"])),onDblclick:o[3]||(o[3]=E(u=>c(b).follow(c(M).VEHICLE),["stop"]))},null,8,["class","color","disabled"]),[[a,y.value?void 0:"Vehicle position is currently undefined"]]),I($,{class:"absolute m-3 bottom-button left-20 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:E(be,["stop"])}),I($,{class:"absolute mb-3 ml-1 bottom-button left-32 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:E(ye,["stop"])})],8,uo)]),z.value?(K(),re("div",{key:0,class:"context-menu",style:de({top:F.top,left:F.left})},[P("ul",{onClick:o[5]||(o[5]=E(()=>{},["stop"]))},[P("li",{onClick:o[4]||(o[4]=u=>he("goto"))},"GoTo")])],4)):ve("",!0),I(Ge,{modelValue:c(q).widgetManagerVars(c(i).hash).configMenuOpen,"onUpdate:modelValue":o[7]||(o[7]=u=>c(q).widgetManagerVars(c(i).hash).configMenuOpen=u),width:"auto"},{default:B(()=>[I($e,{class:"pa-2",style:de(c(V).globalGlassMenuStyles)},{default:B(()=>[I(Be,{class:"text-center"},{default:B(()=>[Xe("Map widget settings")]),_:1}),I(We,null,{default:B(()=>[I(Ye,{modelValue:c(i).options.showVehiclePath,"onUpdate:modelValue":o[6]||(o[6]=u=>c(i).options.showVehiclePath=u),class:"my-1",label:"Show vehicle path",color:c(i).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Y.value?(K(),qe(Ze,{key:1,"model-value":G.value,height:"10",absolute:"",bottom:"",color:"white"},null,8,["model-value"])):ve("",!0)],64)}}});export{vo as default};
