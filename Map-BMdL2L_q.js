import{bo as pe,bp as we,bq as Te,br as U,bs as xe,bt as ne,bu as ke,bv as Ie,d as Se,b0 as Ae,a4 as Ve,p as Oe,u as Ce,bw as De,v as f,l as H,q as ie,D as se,a8 as Ee,bx as m,z as _e,by as y,H as Ne,x as M,bz as Re,ap as He,bA as Le,bB as le,an as ze,a3 as Pe,h as Ue,o as K,c as re,a as $,w as ue,i as k,n as ce,b as u,P as D,Q as F,J as de,k as ve,I as B,S as $e,ak as Fe,M as Be,T as Xe,at as We,Z as Ye,j as qe,R as Ze,K as Ge,s as je,e as Ke,E as Je,aa as me}from"./index-Ch3L8uw8.js";function ge(i,c){if(i==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&(i[s]=c[s]);return i}function Qe(i){return ge({},i)}var fe=1440,eo=2520,J=43200,oo=86400;function to(i,c,s){var V,n;pe(2,arguments);var h=Ie(),o=(V=(n=s==null?void 0:s.locale)!==null&&n!==void 0?n:h.locale)!==null&&V!==void 0?V:we;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var I=Te(i,c);if(isNaN(I))throw new RangeError("Invalid time value");var l=ge(Qe(s),{addSuffix:!!(s!=null&&s.addSuffix),comparison:I}),d,S;I>0?(d=U(c),S=U(i)):(d=U(i),S=U(c));var w=xe(S,d),L=(ne(S)-ne(d))/1e3,v=Math.round((w-L)/60),b;if(v<2)return s!=null&&s.includeSeconds?w<5?o.formatDistance("lessThanXSeconds",5,l):w<10?o.formatDistance("lessThanXSeconds",10,l):w<20?o.formatDistance("lessThanXSeconds",20,l):w<40?o.formatDistance("halfAMinute",0,l):w<60?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",1,l):v===0?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",v,l);if(v<45)return o.formatDistance("xMinutes",v,l);if(v<90)return o.formatDistance("aboutXHours",1,l);if(v<fe){var p=Math.round(v/60);return o.formatDistance("aboutXHours",p,l)}else{if(v<eo)return o.formatDistance("xDays",1,l);if(v<J){var g=Math.round(v/fe);return o.formatDistance("xDays",g,l)}else if(v<oo)return b=Math.round(v/J),o.formatDistance("aboutXMonths",b,l)}if(b=ke(S,d),b<12){var _=Math.round(v/J);return o.formatDistance("xMonths",_,l)}else{var N=b%12,R=Math.floor(b/12);return N<3?o.formatDistance("aboutXYears",R,l):N<9?o.formatDistance("overXYears",R,l):o.formatDistance("almostXYears",R+1,l)}}function ao(i,c){return pe(1,arguments),to(i,Date.now(),c)}(function(i){let c;if(typeof define=="function"&&define.amd)define(["leaflet"],i);else if(typeof module=="object"&&typeof module.exports=="object")c=require("leaflet"),module.exports=i(c);else{if(typeof window.L>"u")throw"Leaflet must be loaded first";i(window.L)}})(function(i){const c=i.Marker.prototype._initIcon,s=i.Marker.prototype._setPos,V=i.DomUtil.TRANSFORM==="msTransform";i.Marker.addInitHook(function(){let h=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;h&&(h=h[0]+"px "+h[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||h||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(o){o.target._applyRotation()})}),i.Marker.include({_initIcon:function(){c.call(this)},_setPos:function(n){s.call(this,n),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[i.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,V?this._icon.style[i.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[i.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(n){return this.options.rotationAngle=n,this.update(),this},setRotationOrigin:function(n){return this.options.rotationOrigin=n,this.update(),this}})});const no=""+new URL("blueboat-marker-DyHmCFOq.png",import.meta.url).href,io=""+new URL("brov2-marker-CBzp11FX.png",import.meta.url).href,so=""+new URL("generic-vehicle-marker-SovxT5Tc.png",import.meta.url).href,lo={class:"page-base"},ro=["id"],co=Se({__name:"Map",props:{widget:{}},setup(i){var ae;Ae(e=>({"6d2b0f58":Me.value}));const c=i,s=Ve(c).widget,V=Oe(),n=Ce(),h=De(),o=f(),I=f(15),l=f([-27.5935,-48.55854]),d=f(l.value),S=H(()=>`map-${s.value.hash}`);ie.registerUsage(se.latitude),ie.registerUsage(se.longitude),Ee(()=>{Object.keys(s.value.options).length===0&&(s.value.options={showVehiclePath:!0}),p.enableAutoUpdate()});const w=m.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),L=m.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri World Imagery"}),v={OpenStreetMap:w,"Esri World Imagery":L};_e(async()=>{o.value=m.map(S.value,{layers:[w,L]}).setView(l.value,I.value),o.value.zoomControl.setPosition("bottomright"),o.value.on("moveend",()=>{if(o.value===void 0)return;let{lat:t,lng:a}=o.value.getCenter();t&&a&&(l.value=[t,a])}),o.value.on("zoomend",()=>{var t;o.value!==void 0&&(I.value=((t=o.value)==null?void 0:t.getZoom())??l.value)}),o.value.on("click",()=>{o.value!==void 0&&o.value.on("click",ee)}),o.value.on("contextmenu",()=>{oe()});const e=m.control.layers(v);o.value.addControl(e),p.enableAutoUpdate(),window.addEventListener("keydown",te),p.goToTarget(y.HOME)}),Ne(()=>{p.disableAutoUpdate(),window.removeEventListener("keydown",te),o.value&&(o.value.off("click",ee),o.value.off("contextmenu"))}),M(l,(e,t)=>{var a,r,A;e.toString()!==t.toString()&&((a=o.value)==null||a.panTo(e),(A=(r=O.value)==null?void 0:r.getTooltip())==null||A.setContent(`Home: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`))}),M(o,(e,t)=>{o.value!==void 0&&(e==null?void 0:e.options)===void 0&&(o.value=t)}),M(I,(e,t)=>{var a;e!==t&&((a=o.value)==null||a.setZoom(I.value))}),M(c.widget,()=>{var e;(e=o.value)==null||e.invalidateSize()});const b=f(void 0),p=new Re(e=>b.value=e,e=>l.value=e);p.setTrackableTarget(y.VEHICLE,()=>g.value),p.setTrackableTarget(y.HOME,()=>d.value);const g=H(()=>n.coordinates.latitude?[n.coordinates.latitude,n.coordinates.longitude]:void 0),_=H(()=>{var e;return n.attitude.yaw?He((e=n.attitude)==null?void 0:e.yaw):0}),N=H(()=>{const e=n.lastHeartbeat;return e?`${ao(e??0,{includeSeconds:!0})} ago`:"never"}),{history:R}=Le(g);(ae=navigator==null?void 0:navigator.geolocation)==null||ae.watchPosition(e=>d.value=[e.coords.latitude,e.coords.longitude],e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let Q=!0;M([d,o],async()=>{d.value===l.value||!o.value||!Q||(p.goToTarget(y.HOME),Q=!1)});const T=f();M(n.coordinates,()=>{if(!(!o.value||!g.value)){if(T.value===void 0){T.value=m.marker(g.value);let e=so;n.vehicleType===le.MAV_TYPE_SURFACE_BOAT?e=no:n.vehicleType===le.MAV_TYPE_SUBMARINE&&(e=io);const t=new m.Icon({iconUrl:e,iconSize:[64,64],iconAnchor:[32,32]});T.value.setIcon(t);const a=m.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[64,-12]});T.value.bindTooltip(a),o.value.addLayer(T.value)}T.value.setLatLng(g.value)}}),M([g,_,N,()=>n.isArmed],()=>{var e,t,a,r;T.value!==void 0&&((r=T.value.getTooltip())==null||r.setContent(`
    <p>Coordinates: ${(e=g.value)==null?void 0:e[0].toFixed(6)}, ${(t=g.value)==null?void 0:t[1].toFixed(6)}</p>
    <p>Velocity: ${((a=n.velocity.ground)==null?void 0:a.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${_.value.toFixed(2)}°</p>
    <p>${n.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${N.value}</p>
  `),T.value.setRotationAngle(_.value))});const O=f();M(d,()=>{if(o.value===void 0)return;const e=d.value;if(e!==void 0){if(O.value===void 0){O.value=m.marker(e);const t=m.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:"H"});O.value.setIcon(t);const a=m.tooltip({content:"No data available",className:"waypoint-tooltip"});O.value.bindTooltip(a),o.value.addLayer(O.value)}O.value.setLatLng(d.value)}});const X=f();M(h.currentPlanningWaypoints,e=>{if(o.value!==void 0){if(X.value===void 0){const t=e.map(a=>a.coordinates);X.value=m.polyline(t,{color:"#358AC3"}).addTo(o.value)}X.value.setLatLngs(e.map(t=>t.coordinates)),e.forEach((t,a)=>{var x;const r=m.marker(t.coordinates),A=m.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:`${a}`});r.setIcon(A),(x=o.value)==null||x.addLayer(r)})}});const W=f();M(R,e=>{if(o.value===void 0||e===void 0)return;W.value===void 0&&(W.value=m.polyline([],{color:"#358AC3"}).addTo(o.value));const t=e.filter(a=>a.snapshot!==void 0).map(a=>a.snapshot);W.value.setLatLngs(t)});const z=f(!1),E=f(null),P=ze({top:"0px",left:"0px"}),C=f(),ee=e=>{var t,a,r,A;if(C.value!==void 0&&o.value!==void 0&&((t=C.value)==null||t.removeFrom(o.value)),((a=e==null?void 0:e.latlng)==null?void 0:a.lat)!=null&&((r=e==null?void 0:e.latlng)==null?void 0:r.lng)!=null){E.value=[e.latlng.lat,e.latlng.lng],z.value=!0;const x=(A=o.value)==null?void 0:A.getContainer();if(x){const{x:G,y:j}=x.getBoundingClientRect();P.left=`${e.originalEvent.clientX-G}px`,P.top=`${e.originalEvent.clientY-j}px`}}else console.error("Invalid event structure:",e);if(o.value!==void 0){C.value=m.marker(E.value);const x=m.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16]});C.value.setIcon(x),o.value.addLayer(C.value)}},he=e=>{switch(console.debug(`Map context menu option selected: ${e}.`),e){case"goto":if(E.value){const x=n.coordinates.altitude??0,G=E.value[0],j=E.value[1];je(()=>{n.goTo(0,0,0,0,G,j,x)},{command:"GoTo"},Ke(Je.GOTO))}break;default:console.warn("Unknown menu option selected:",e)}z.value=!1},oe=()=>{z.value=!1,E.value=null,o.value!==void 0&&C.value!==void 0&&o.value.removeLayer(C.value)},te=e=>{e.key==="Escape"&&oe()},Y=f(!1),q=f(0),be=async()=>{for(Y.value=!0,q.value=0;h.currentPlanningWaypoints.length>0;)h.currentPlanningWaypoints.pop();const e=async t=>{q.value=t};try{(await n.fetchMission(e)).forEach(a=>{h.currentPlanningWaypoints.push(a),me.fire({icon:"success",title:"Mission download succeed!",timer:2e3})})}catch(t){me.fire({icon:"error",title:"Mission download failed",text:t,timer:5e3})}finally{Y.value=!1}},ye=()=>{n.startMission()},Z=Pe(),Me=H(()=>`${Math.max(-Z.widgetClearanceForVisibleArea(s.value).bottom,0)}px`);return(e,t)=>{const a=Ue("tooltip");return K(),re(Ge,null,[$("div",lo,[$("div",{id:S.value,ref_key:"map",ref:o,class:"map"},[ue(k(F,{class:ce(["absolute left-0 m-3 bottom-button bg-slate-50",d.value?"":"active-events-on-disabled"]),color:b.value==u(y).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-map-marker",size:"x-small",disabled:!d.value,onClick:t[0]||(t[0]=D(r=>u(p).goToTarget(u(y).HOME,!0),["stop"])),onDblclick:t[1]||(t[1]=D(r=>u(p).follow(u(y).HOME),["stop"]))},null,8,["class","color","disabled"]),[[a,d.value?void 0:"Home position is currently undefined"]]),ue(k(F,{class:ce(["absolute m-3 bottom-button left-10 bg-slate-50",g.value?"":"active-events-on-disabled"]),color:b.value==u(y).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!g.value,onClick:t[2]||(t[2]=D(r=>u(p).goToTarget(u(y).VEHICLE,!0),["stop"])),onDblclick:t[3]||(t[3]=D(r=>u(p).follow(u(y).VEHICLE),["stop"]))},null,8,["class","color","disabled"]),[[a,g.value?void 0:"Vehicle position is currently undefined"]]),k(F,{class:"absolute m-3 bottom-button left-20 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:D(be,["stop"])}),k(F,{class:"absolute mb-3 ml-1 bottom-button left-32 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:D(ye,["stop"])})],8,ro)]),z.value?(K(),re("div",{key:0,class:"context-menu",style:de({top:P.top,left:P.left})},[$("ul",{onClick:t[5]||(t[5]=D(()=>{},["stop"]))},[$("li",{onClick:t[4]||(t[4]=r=>he("goto"))},"GoTo")])],4)):ve("",!0),k(Ye,{modelValue:u(Z).widgetManagerVars(u(s).hash).configMenuOpen,"onUpdate:modelValue":t[7]||(t[7]=r=>u(Z).widgetManagerVars(u(s).hash).configMenuOpen=r),width:"auto"},{default:B(()=>[k($e,{class:"pa-2",style:de(u(V).globalGlassMenuStyles)},{default:B(()=>[k(Fe,{class:"text-center"},{default:B(()=>[Be("Map widget settings")]),_:1}),k(Xe,null,{default:B(()=>[k(We,{modelValue:u(s).options.showVehiclePath,"onUpdate:modelValue":t[6]||(t[6]=r=>u(s).options.showVehiclePath=r),class:"my-1",label:"Show vehicle path",color:u(s).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Y.value?(K(),qe(Ze,{key:1,"model-value":q.value,height:"10",absolute:"",bottom:"",color:"white"},null,8,["model-value"])):ve("",!0)],64)}}});export{co as default};
