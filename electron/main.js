"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("electron"),s=require("path"),c=()=>typeof navigator=="object"&&typeof navigator.userAgent=="string"?navigator.userAgent.toLowerCase().includes("electron"):typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.electron=="string",r=()=>{if(!c()){console.warn("Filesystem storage is only available in Electron.");return}if(!window.electronAPI)throw console.error("electronAPI is not available on window object"),console.debug("Available window properties:",Object.keys(window)),new Error("Electron filesystem API is not properly initialized. This is likely a setup issue.")},i={setItem:async(o,e)=>{r();const l=await e.arrayBuffer();return await window.electronAPI.setItem(o,new Blob([l])),e},getItem:async o=>{r();const e=await window.electronAPI.getItem(o);return e?new Blob([e]):null},removeItem:async o=>{r(),await window.electronAPI.removeItem(o)},clear:async()=>{r(),await window.electronAPI.clear()},keys:async()=>(r(),await window.electronAPI.keys()),iterate:async o=>{r(),await window.electronAPI.iterate(o)}},a={dist:s.join(__dirname,"..")};let n;function p(){const{width:o,height:e}=t.screen.getPrimaryDisplay().workAreaSize;n=new t.BrowserWindow({icon:s.join(a.dist,"pwa-512x512.png"),webPreferences:{preload:s.join(a.dist,"electron/preload.js"),contextIsolation:!0,nodeIntegration:!1},width:o,height:e}),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),process.env.VITE_DEV_SERVER_URL?n.loadURL(process.env.VITE_DEV_SERVER_URL):n.loadFile(s.join(a.dist,"index.html"))}t.app.on("window-all-closed",()=>{console.log("Closing application."),n=null,t.app.quit()});t.app.on("ready",()=>{t.protocol.registerFileProtocol("file",(o,e)=>{e({path:o.url.substring(7)})})});t.protocol.registerSchemesAsPrivileged([{scheme:"file",privileges:{secure:!0,standard:!0,supportFetchAPI:!0,allowServiceWorkers:!0}}]);t.app.whenReady().then(async()=>{console.log("Electron app is ready."),console.log(`Cockpit version: ${t.app.getVersion()}`),console.log("Creating window..."),await p(),console.log("Setting up filesystem storage..."),w()});const w=()=>{t.ipcMain.on("setItem",(o,e)=>{i.setItem(e.key,e.value)}),t.ipcMain.on("getItem",(o,e)=>i.getItem(e)),t.ipcMain.on("removeItem",(o,e)=>{i.removeItem(e)}),t.ipcMain.on("clear",()=>{i.clear()}),t.ipcMain.on("keys",()=>i.keys()),t.ipcMain.on("iterate",(o,e)=>{i.iterate(e)})};t.app.on("before-quit",()=>{});exports.ROOT_PATH=a;
