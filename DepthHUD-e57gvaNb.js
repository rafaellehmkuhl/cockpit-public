import{d as G,I as q,p as K,q as X,D as J,u as Q,v as Z,y as b,l as h,am as ee,ay as te,x as ae,C as oe,K as se,z as E,ag as Y,ap as le,L as ne,o as ie,c as ue,a as x,i as n,A as c,W as de,N as re,b as l,aj as he,P as z,X as ce,ar as pe,B as ve,at as fe,a0 as ge,F as me,an as we,a3 as xe,a4 as Ve,a5 as Fe}from"./index-PX6SlQGo.js";import{w as Ce}from"./index-DxaGCbJO.js";import{g as P}from"./index-ZORhgBxb.js";import{V as De,a as Se,b as be,c as ye}from"./VExpansionPanel-Bo1rENfR.js";const _e=i=>(xe("data-v-d6aea3bc"),i=i(),Ve(),i),Te={class:"main"},Me=["width","height"],Ue={class:"flex items-center justify-between w-full my-1"},Ee=_e(()=>x("span",{class:"mr-1 text-slate-100"},"Display unit: ",-1)),Ye={class:"w-40"};var A=(i=>(i.METERS="Meters",i.Feet="Feet",i))(A||{});const Pe=G({__name:"DepthHUD",props:{widget:{}},setup(i){const B=q(),y=K();X.registerUsage(J.depth);const N=Q(),a=Z(i).widget,L=b([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),R=Object.values(A),O=h(()=>a.value.options.displayUnit==="Feet"?"ft":"m"),u=ee({depthLinesY:{},indicatorY:0}),V=b(Array(10).fill(0)),F=h(()=>V.value[V.value.length-1]),$=h(()=>V.value.slice(-10)),W=h(()=>Math.max(...$.value)),m=h(()=>1.3*W.value>10?1.3*W.value:10),C=h(()=>te(0,m.value+1)),j=h(()=>Math.max(...C.value));ae(()=>{const e={displayUnit:"Meters",showDepthValue:!0,hudColor:L.value[2][0]};a.value.options||(a.value.options={}),Object.entries(e).forEach(([t,o])=>{a.value.options[t]===void 0&&(a.value.options[t]=o)})}),oe(()=>{C.value.forEach(e=>u.depthLinesY[e]=_(e)),k()});const{height:H}=se(),r=h(()=>({width:128,height:a.value.size.height*H.value}));E(()=>N.altitude.msl,e=>{const t=-1*we(e,e,0);if(Math.abs(t-(F.value||0))>.1){const f=a.value.options.displayUnit==="Feet"?t*3.28084:t;V.value.push(f)}});const _=e=>{const t=e,o=r.value.height/j.value;return Y(o*t)},D=b(),T=b(),k=()=>{if(D.value===void 0||D.value===null)return;if(T.value===void 0){console.debug("Canvas context undefined!"),T.value=D.value.getContext("2d");return}const e=T.value,t=r.value.width,o=r.value.height;le(e);const f=12,p=16,v=10,s=1,I=5,d=10*s;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${f}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let g=[1,5];m.value>25&&(g=[2,10]),m.value>125&&(g=[5,25]),m.value>250&&(g=[10,50]),m.value>500&&(g=[20,100]);for(const[U,w]of Object.entries(u.depthLinesY))Number(U)%g[0]===0&&(e.beginPath(),e.moveTo(t-s-3.3*f-I,w+d),e.lineTo(s+3.9*p+v,w+d),e.lineWidth="1"),Number(U)%g[1]===0&&(e.lineWidth="2",e.moveTo(t-s-3.3*f,w+d),e.lineTo(s+3.9*p+v,w+d),e.fillText(`${U} ${O.value}`,t-s-3*f,w+d)),e.stroke();const S=Math.max(u.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${p}px Arial`,e.fillText(`${F.value.toFixed(1)} ${O.value}`,s+4.3*p-v-s,S+d)),e.beginPath(),e.moveTo(s+4.3*p+s,S+d),e.lineTo(s+4.3*p+s-v,S-v/2+d),e.lineTo(s+4.3*p+s-v,S+v/2+d),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const M=e.createLinearGradient(t/2,0,t/2,o);M.addColorStop(.95,a.value.options.hudColor),M.addColorStop(1,Ce(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=M,e.fillRect(0,0,t,o)};return E(F,()=>{C.value.forEach(t=>{var o;(o=u.depthLinesY)[t]??(o[t]=Y(r.value.height+100)),P.to(u.depthLinesY,.5,{[t]:_(t)})}),Object.keys(u.depthLinesY).filter(t=>!C.value.includes(Number(t))).forEach(t=>{P.to(u.depthLinesY,.5,{[t]:Y(r.value.height+100)})}),P.to(u,.5,{indicatorY:_(F.value)})}),E([u,r,a.value.options],()=>{y.isWidgetVisible(a.value)&&ne(()=>k())}),(e,t)=>(ie(),ue(me,null,[x("div",Te,[x("canvas",{ref_key:"canvasRef",ref:D,width:r.value.width,height:r.value.height},null,8,Me)]),n(ge,{modelValue:l(y).widgetManagerVars(l(a).hash).configMenuOpen,"onUpdate:modelValue":t[3]||(t[3]=o=>l(y).widgetManagerVars(l(a).hash).configMenuOpen=o),"min-width":"400","max-width":"35%"},{default:c(()=>[n(de,{class:"pa-2",style:re(l(B).globalGlassMenuStyles)},{default:c(()=>[n(he,null,{default:c(()=>[z("Depth HUD config")]),_:1}),n(ce,null,{default:c(()=>[n(pe,{class:"ma-1",label:"Show height value","model-value":l(a).options.showDepthValue,color:l(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=o=>l(a).options.showDepthValue=!l(a).options.showDepthValue)},null,8,["model-value","color"]),x("div",Ue,[Ee,x("div",Ye,[n(ve,{modelValue:l(a).options.displayUnit,"onUpdate:modelValue":t[1]||(t[1]=o=>l(a).options.displayUnit=o),options:l(R)},null,8,["modelValue","options"])])]),n(De,null,{default:c(()=>[n(Se,{class:"bg-[#FFFFFF22] text-white"},{default:c(()=>[n(be,null,{default:c(()=>[z("Color")]),_:1}),n(ye,null,{default:c(()=>[n(fe,{modelValue:l(a).options.hudColor,"onUpdate:modelValue":t[2]||(t[2]=o=>l(a).options.hudColor=o),class:"ma-2 text-white bg-[#FFFFFF22]",swatches:L.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ae=Fe(Pe,[["__scopeId","data-v-d6aea3bc"]]);export{Ae as default};
