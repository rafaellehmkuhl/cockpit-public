import{d as J,a3 as j,p as I,q,D as K,u as Z,a4 as Q,v as x,l as d,az as X,an as ee,aA as te,a8 as ae,z as oe,F as se,x as P,y as le,ah as Y,aq as ne,G as ie,o as ue,c as re,a as N,i as n,I as h,S as de,J as he,b as l,ak as ce,M as O,T as pe,as as ve,au as fe,Z as ge,K as me,a2 as xe}from"./index-DLSz87cR.js";import{w as we}from"./index-DxaGCbJO.js";import{g as k}from"./index-ZORhgBxb.js";import{V as Ve,a as Se,b as Ce,c as De}from"./VExpansionPanel-NNG_mWQ1.js";const Fe={class:"main"},be=["width","height"],Te=J({__name:"DepthHUD",props:{widget:{}},setup(W){const b=j(),w=I();q.registerUsage(K.depth);const U=Z(),a=Q(W).widget,E=x([["#FF2D2D"],["#0ADB0ACC"],["#FFFFFF"]]),z=d(()=>X[w.displayUnitPreferences.distance]),i=ee({depthLinesY:{},indicatorY:0}),V=x(Array(10).fill(0)),S=d(()=>V.value[V.value.length-1]),$=d(()=>V.value.slice(-10)),A=d(()=>Math.max(...$.value)),g=d(()=>1.3*A.value>10?1.3*A.value:10),C=d(()=>te(0,g.value+1)),B=d(()=>Math.max(...C.value));ae(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showDepthValue:!0,hudColor:E.value[2][0]})}),oe(()=>{C.value.forEach(e=>i.depthLinesY[e]=T(e)),L()});const{height:G}=se(),r=d(()=>({width:128,height:a.value.size.height*G.value})),H=x(w.displayUnitPreferences.distance);P(U.altitude,()=>{const e=U.altitude.msl,t=le(-e.value,e.toJSON().unit);if(Math.abs(t.value-(S.value||0))<.1)return;const c=t.to(w.displayUnitPreferences.distance);V.value.push(c.toJSON().value),H.value=c.toJSON().unit});const T=e=>{const t=e,s=r.value.height/B.value;return Y(s*t)},D=x(),y=x(),L=()=>{if(D.value===void 0||D.value===null)return;if(y.value===void 0){console.debug("Canvas context undefined!"),y.value=D.value.getContext("2d");return}const e=y.value,t=r.value.width,s=r.value.height;ne(e);const c=12,p=16,v=10,o=1,R=5,u=10*o;e.textAlign="left",e.textBaseline="middle",e.font=`bold ${c}px Arial`,e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor;let f=[1,5];g.value>25&&(f=[2,10]),g.value>125&&(f=[5,25]),g.value>250&&(f=[10,50]),g.value>500&&(f=[20,100]);for(const[M,m]of Object.entries(i.depthLinesY))Number(M)%f[0]===0&&(e.beginPath(),e.moveTo(t-o-3.3*c-R,m+u),e.lineTo(o+3.9*p+v,m+u),e.lineWidth="1"),Number(M)%f[1]===0&&(e.lineWidth="2",e.moveTo(t-o-3.3*c,m+u),e.lineTo(o+3.9*p+v,m+u),e.fillText(`${M} ${z.value}`,t-o-3*c,m+u)),e.stroke();const F=Math.max(i.indicatorY,0);e.strokeStyle=a.value.options.hudColor,e.fillStyle=a.value.options.hudColor,a.value.options.showDepthValue&&(e.textAlign="right",e.font=`bold ${p}px Arial`,e.fillText(`${S.value.toFixed(1)} ${z.value}`,o+4.3*p-v-o,F+u)),e.beginPath(),e.moveTo(o+4.3*p+o,F+u),e.lineTo(o+4.3*p+o-v,F-v/2+u),e.lineTo(o+4.3*p+o-v,F+v/2+u),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const _=e.createLinearGradient(t/2,0,t/2,s);_.addColorStop(.95,a.value.options.hudColor),_.addColorStop(1,we(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=_,e.fillRect(0,0,t,s)};return P(S,()=>{C.value.forEach(t=>{var s;(s=i.depthLinesY)[t]??(s[t]=Y(r.value.height+100)),k.to(i.depthLinesY,.5,{[t]:T(t)})}),Object.keys(i.depthLinesY).filter(t=>!C.value.includes(Number(t))).forEach(t=>{k.to(i.depthLinesY,.5,{[t]:Y(r.value.height+100)})}),k.to(i,.5,{indicatorY:T(S.value)})}),P([i,r,a.value.options],()=>{b.isWidgetVisible(a.value)&&ie(()=>L())}),(e,t)=>(ue(),re(me,null,[N("div",Fe,[N("canvas",{ref_key:"canvasRef",ref:D,width:r.value.width,height:r.value.height},null,8,be)]),n(ge,{modelValue:l(b).widgetManagerVars(l(a).hash).configMenuOpen,"onUpdate:modelValue":t[2]||(t[2]=s=>l(b).widgetManagerVars(l(a).hash).configMenuOpen=s),"min-width":"400","max-width":"35%"},{default:h(()=>[n(de,{class:"pa-2",style:he(l(w).globalGlassMenuStyles)},{default:h(()=>[n(ce,null,{default:h(()=>[O("Depth HUD config")]),_:1}),n(pe,null,{default:h(()=>[n(ve,{class:"ma-1",label:"Show height value","model-value":l(a).options.showDepthValue,color:l(a).options.showDepthValue?"white":void 0,"hide-details":"",onChange:t[0]||(t[0]=s=>l(a).options.showDepthValue=!l(a).options.showDepthValue)},null,8,["model-value","color"]),n(Ve,null,{default:h(()=>[n(Se,{class:"bg-[#FFFFFF22] text-white"},{default:h(()=>[n(Ce,null,{default:h(()=>[O("Color")]),_:1}),n(De,null,{default:h(()=>[n(fe,{modelValue:l(a).options.hudColor,"onUpdate:modelValue":t[1]||(t[1]=s=>l(a).options.hudColor=s),class:"ma-2 text-white bg-[#FFFFFF22]",swatches:E.value,width:"100%","show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),ke=xe(Te,[["__scopeId","data-v-b490dea8"]]);export{ke as default};
