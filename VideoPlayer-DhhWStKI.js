import{bw as E,c as T,ba as H,v as o,K as O,S as W,Q as L,af as q,ah as G,ag as Y,r as V,aj as K,k as y,w as x,al as Q,V as X,m as u,n as c,p as l,t as S,F as k,q as M,Z as g,H as i,W as f,a4 as Z,X as J,ar as ee,a5 as te,an as $,aG as C,a2 as F,aa as ae,ad as oe,ae as le,_ as se}from"./index-ChjXGYfo.js";const ne=E("v-banner-text"),d=h=>(oe("data-v-04c04648"),h=h(),le(),h),ie={ref:"videoWidget",class:"video-widget"},re={key:0,class:"no-video-alert"},de=d(()=>l("span",null,"No video stream selected.",-1)),ue=[de],ce={key:1,class:"no-video-alert"},pe=d(()=>l("br",null,null,-1)),me=d(()=>l("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),ve=d(()=>l("br",null,null,-1)),fe=d(()=>l("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),ye={key:2,class:"no-video-alert"},ge={class:"no-video-alert"},he=d(()=>l("span",{class:"text-xl font-bold"},"Server status: ",-1)),Se=d(()=>l("br",null,null,-1)),_e=d(()=>l("span",{class:"text-xl font-bold"},"Stream status: ",-1)),Ve=d(()=>l("br",null,null,-1)),we={key:3,class:"no-video-alert"},be=d(()=>l("p",null,"Loading stream...",-1)),xe=[be],ke={class:"flex-wrap justify-center d-flex ga-5"},Ie=T({__name:"VideoPlayer",props:{widget:{}},setup(h){H(s=>({"6a9233ee":o(e).options.videoFitStyle,"0769be12":D.value}));const U=O(),{showDialog:j}=W(),r=L(),I=q(),{namessAvailableAbstractedStreams:p}=G(r),e=Y(h).widget,n=V(),_=V(),m=V(),w=V(!1);K(()=>{const s={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},s,e.value.options),n.value=e.value.options.streamName});const v=y(()=>n.value?r.realStreamName(n.value):void 0);x(()=>r.streamsCorrespondency,()=>m.value=void 0,{deep:!0});const P=setInterval(()=>{var s;if(e.value.options.streamName===void 0&&!p.value.isEmpty()&&(e.value.options.streamName=p.value[0],n.value=e.value.options.streamName,p.value.length>1&&j({maxWidth:600,title:"Multiple streams detected",message:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,variant:"info"})),v.value!==void 0){const t=r.getMediaStream(v.value);Q(t,m.value)||(m.value=t);const a=((s=r.getStreamData(v.value))==null?void 0:s.connected)??!1;a!==w.value&&(w.value=a)}},1e3);X(()=>clearInterval(P)),x(n,()=>{e.value.options.streamName=n.value,m.value=void 0}),x(m,()=>{!_.value||!m.value||(_.value.srcObject=m.value,_.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(s=>{const t=`Failed to play stream. Reason: ${s}`;console.error(`[VideoPlayer] ${t}`)}))});const N=s=>{e.value.options.rotationAngle+=s},R=y(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),A=y(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),D=y(()=>`${R.value} ${A.value}`),z=y(()=>{var s;return v.value===void 0?"Unknown.":((s=r.getStreamData(v.value))==null?void 0:s.webRtcManager.signallerStatus)??"Unknown."}),B=y(()=>{var t;if(v.value===void 0)return"Unknown.";const s=r.availableIceIps;return!s.isEmpty()&&!s.find(a=>r.allowedIceIps.includes(a))?`Stream is coming from IPs [${s.join(", ")}], which are not in the list of allowed sources
      [${r.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((t=r.getStreamData(v.value))==null?void 0:t.webRtcManager.streamStatus)??"Unknown."});return(s,t)=>(u(),c(k,null,[l("div",ie,[n.value===void 0?(u(),c("div",re,ue)):!o(p).isEmpty()&&!o(p).includes(n.value)?(u(),c("div",ce,[l("p",null,'The selected stream "'+S(n.value)+'" is not available.',1),l("p",null,"Available ones are: "+S(o(p).map(a=>`"${a}"`).join(", "))+".",1),pe,me,ve,fe])):w.value?(u(),c("div",we,xe)):(u(),c("div",ye,[l("div",ge,[l("p",null,[he,(u(!0),c(k,null,M(z.value.toString().split("\\n"),(a,b)=>(u(),c("span",{key:b},[g(S(a)+" ",1),Se]))),128))]),l("p",null,[_e,(u(!0),c(k,null,M(B.value.toString().split("\\n"),(a,b)=>(u(),c("span",{key:b},[g(S(a)+" ",1),Ve]))),128))])])])),l("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:_,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(ae,{modelValue:o(I).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=a=>o(I).widgetManagerVars(o(e).hash).configMenuOpen=a),width:"auto"},{default:f(()=>[i(Z,{class:"pa-4 text-white",style:J([{"border-radius":"15px"},o(U).globalGlassMenuStyles])},{default:f(()=>[i(ee,{class:"text-center"},{default:f(()=>[g("Video widget config")]),_:1}),i(te,{class:"flex flex-col gap-y-4"},{default:f(()=>[i($,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),label:"Stream name",class:"my-3",items:o(p),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i($,{modelValue:o(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=a=>o(e).options.videoFitStyle=a),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(ne,null,{default:f(()=>[g('Saved stream name: "'+S(o(e).options.streamName)+'"',1)]),_:1}),i(C,{modelValue:o(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=a=>o(e).options.flipHorizontally=a),class:"my-1",label:"Flip horizontally",color:o(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(C,{modelValue:o(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=a=>o(e).options.flipVertically=a),class:"my-1",label:"Flip vertically",color:o(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),l("div",ke,[i(F,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=a=>N(-90))},{default:f(()=>[g(" Rotate Left")]),_:1}),i(F,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=a=>N(90))},{default:f(()=>[g(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),$e=se(Ie,[["__scopeId","data-v-04c04648"]]);export{$e as default};
