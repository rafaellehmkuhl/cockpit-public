import{bE as z,d as B,a_ as T,b as a,A as j,z as A,a2 as E,a4 as D,a3 as H,q as S,a7 as O,a9 as L,aa as Y,G as q,v as x,l as v,o as f,c as y,a as o,t as g,i,H as c,R as G,I as W,aj as J,L as V,S as K,ac as I,as as k,P as N,Y as Q,J as X,$ as Z,a0 as ee,a1 as te}from"./index-BuiXtLi8.js";const ae=z("v-banner-text"),d=m=>(Z("data-v-79191142"),m=m(),ee(),m),oe={ref:"videoWidget",class:"video-widget"},le={key:0,class:"no-video-alert"},se=d(()=>o("span",null,"No video stream selected.",-1)),ne=[se],ie={key:1,class:"no-video-alert"},re=d(()=>o("br",null,null,-1)),de=d(()=>o("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),ue=d(()=>o("br",null,null,-1)),ce=d(()=>o("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),pe={key:2,class:"no-video-alert"},me={class:"no-video-alert"},ve=d(()=>o("span",{class:"text-xl font-bold"},"Server status: ",-1)),fe=d(()=>o("span",{class:"text-xl font-bold"},"Stream status: ",-1)),ye={key:3,class:"no-video-alert"},ge=d(()=>o("p",null,"Loading stream...",-1)),he=[ge],Se={class:"flex-wrap justify-center d-flex ga-5"},Ve=B({__name:"VideoPlayer",props:{widget:{}},setup(m){T(l=>({"1dedc75f":a(e).options.videoFitStyle,"1576897a":P.value}));const $=j(),r=A(),w=E(),{namesAvailableStreams:u}=D(r),e=H(m).widget,n=S(),h=S(),p=S(),_=S(!1);O(()=>{const l={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},l,e.value.options),n.value=e.value.options.streamName});const M=setInterval(()=>{var s;e.value.options.streamName===void 0&&!u.value.isEmpty()&&(e.value.options.streamName=u.value[0],n.value=e.value.options.streamName,u.value.length>1&&L.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,icon:"info",confirmButtonText:"OK"}));const l=r.getMediaStream(e.value.options.streamName);Y(l,p.value)||(p.value=l);const t=((s=r.getStreamData(e.value.options.streamName))==null?void 0:s.connected)??!1;t!==_.value&&(_.value=t)},1e3);q(()=>clearInterval(M)),x(n,()=>{e.value.options.streamName=n.value,p.value=void 0}),x(p,()=>{!h.value||!p.value||(h.value.srcObject=p.value,h.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(l=>{const t=`Failed to play stream. Reason: ${l}`;console.error(`[VideoPlayer] ${t}`)}))});const b=l=>{e.value.options.rotationAngle+=l},C=v(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),F=v(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),P=v(()=>`${C.value} ${F.value}`),R=v(()=>{var l;return n.value===void 0?"Unknown.":((l=r.getStreamData(n.value))==null?void 0:l.webRtcManager.signallerStatus)??"Unknown."}),U=v(()=>{var l;return n.value===void 0?"Unknown.":r.availableIceIps.find(t=>r.allowedIceIps.includes(t))?((l=r.getStreamData(n.value))==null?void 0:l.webRtcManager.streamStatus)??"Unknown.":`Stream is coming from IPs (${r.availableIceIps}) that are not in the list of allowed sources
    (${r.allowedIceIps}). Please check your configuration.`});return(l,t)=>(f(),y(X,null,[o("div",oe,[n.value===void 0?(f(),y("div",le,ne)):!a(u).isEmpty()&&!a(u).includes(n.value)?(f(),y("div",ie,[o("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),o("p",null,"Available ones are: "+g(a(u).map(s=>`"${s}"`).join(", "))+".",1),re,de,ue,ce])):_.value?(f(),y("div",ye,he)):(f(),y("div",pe,[o("div",me,[o("p",null,[ve,o("span",null,g(R.value),1)]),o("p",null,[fe,o("span",null,g(U.value),1)])])])),o("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:h,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(Q,{modelValue:a(w).widgetManagerVars(a(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=s=>a(w).widgetManagerVars(a(e).hash).configMenuOpen=s),width:"auto"},{default:c(()=>[i(G,{class:"pa-4 text-white",style:W([{"border-radius":"15px"},a($).globalGlassMenuStyles])},{default:c(()=>[i(J,{class:"text-center"},{default:c(()=>[V("Video widget config")]),_:1}),i(K,{class:"flex flex-col gap-y-4"},{default:c(()=>[i(I,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),label:"Stream name",class:"my-3",items:a(u),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(I,{modelValue:a(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).options.videoFitStyle=s),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(ae,null,{default:c(()=>[V('Saved stream name: "'+g(a(e).options.streamName)+'"',1)]),_:1}),i(k,{modelValue:a(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=s=>a(e).options.flipHorizontally=s),class:"my-1",label:"Flip horizontally",color:a(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(k,{modelValue:a(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=s=>a(e).options.flipVertically=s),class:"my-1",label:"Flip vertically",color:a(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),o("div",Se,[i(N,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=s=>b(-90))},{default:c(()=>[V(" Rotate Left")]),_:1}),i(N,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=s=>b(90))},{default:c(()=>[V(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),xe=te(Ve,[["__scopeId","data-v-79191142"]]);export{xe as default};
