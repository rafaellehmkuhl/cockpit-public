import{d as I,a7 as P,y as g,C as U,z as w,o as z,j as H,a as f,Z as F,aI as J,ak as q,a6 as G,x as X,D as Y,u as Z,aa as K,I as Q,l as E,aD as ee,aE as c,aJ as te,aB as N,az as ae,J as se,c as oe,i as B,L as ne,am as le,b as u,N as ie,a3 as re,a4 as de,a5 as ce}from"./index-Csa3iGZA.js";import{g as h}from"./index-ZORhgBxb.js";const ue=I({__name:"Dialog",props:{show:Boolean},emits:["update:show"],setup(n,{emit:v}){const p=n,k=v,d=P(p).show,l=g(d.value),r=g(),m=g();return U(()=>{r.value.addEventListener("click",a=>{!a.target||a.target instanceof HTMLElement&&!a.target.closest(".action-button")&&a.target.nodeName!=="DIALOG"||(l.value=!1)}),document.addEventListener("keydown",a=>{l.value&&a.key==="Escape"&&(a.preventDefault(),a.stopImmediatePropagation(),l.value=!1)},{passive:!1})}),w(d,()=>l.value=d.value),w(l,()=>{l.value?r.value.showModal():(r.value.setAttribute("closing",""),r.value.addEventListener("animationend",()=>{r.value.removeAttribute("closing"),r.value.close()},{once:!0})),k("update:show",l.value)}),(a,s)=>(z(),H(q,{to:"body"},[f("dialog",{ref_key:"dialogRef",ref:r,class:"modal"},[f("div",F({ref_key:"dialogContentRef",ref:m},a.$attrs,{class:"flex flex-col items-center justify-center w-full h-full p-5 backdrop-blur-sm"}),[J(a.$slots,"default")],16)],512)]))}}),ge=n=>(re("data-v-758f6fd3"),n=n(),de(),n),fe=["height","width"],ve={class:"flex items-center"},pe=ge(()=>f("span",{class:"mr-3 text-slate-100"},"Heading style",-1)),he={class:"w-40"};var L=(n=>(n.NORTH_UP="North Up",n.HEAD_UP="Head Up",n))(L||{});const we=I({__name:"Compass",props:{widget:{}},setup(n){const v=G();X.registerUsage(Y.heading);const p=Z(),k=g(),d=g(),l=g(),r={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},m=Object.values(L),s=P(n).widget;K(()=>{Object.keys(s.value.options).length===0&&(s.value.options={headingStyle:m[0]})}),U(()=>{V(),M()});const{width:O,height:$}=Q(),T=E(()=>s.value.size.width*O.value),C=E(()=>s.value.size.height*$.value),y=E(()=>T.value<C.value?T.value:C.value),M=()=>{if(d.value===void 0||d.value===null)return;l.value===void 0&&(l.value=d.value.getContext("2d"));const e=l.value;ee(e);const t=.5*y.value,i=.13*y.value,A=.03*t;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${i}px Arial`,e.fillStyle="white",e.lineWidth=A,e.textBaseline="middle";const _=.7*t,R=.4*t,W=.55*t;e.translate(t,t),e.font=`bold ${i}px Arial`,e.fillText(`${o.yawAngleDegrees.toFixed(0)}Â°`,.15*i,0),e.rotate(c(-90)),s.value.options.headingStyle=="Head Up"&&e.rotate(-c(o.yawAngleDegrees));for(const[S,j]of Object.entries(r))e.save(),e.rotate(c(Number(S))),e.beginPath(),e.moveTo(W,0),e.lineTo(_,0),e.textBaseline="bottom",e.font=`bold ${.7*i}px Arial`,e.translate(_*1.025,0),e.rotate(c(90)),e.fillText(j,0,0),e.stroke(),e.restore();for(const S of te(360))S%9===0&&(e.save(),e.lineWidth=.25*A,e.rotate(c(Number(S))),e.beginPath(),e.moveTo(1.1*W,0),e.lineTo(_,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,_,0,c(360)),e.stroke(),s.value.options.headingStyle=="North Up"?e.rotate(c(o.yawAngleDegrees)):e.rotate(c(o.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const x=.05*t;e.moveTo(R,x),e.lineTo(W-.5*x,0),e.lineTo(R,-x),e.lineTo(R,x),e.closePath(),e.fill(),e.stroke()},b=g(.01);let D;w(p.attitude,e=>{if(D===void 0){b.value=N(p.attitude.yaw),D=e.yaw;return}Math.abs(N(e.yaw-D))>.1&&(D=e.yaw,b.value=N(p.attitude.yaw))});const o=ae({yawAngleDegrees:0}),V=()=>{const e=b.value,t=e<0?e+360:e,i=o.yawAngleDegrees>270&&t<90,A=o.yawAngleDegrees<90&&t>270;i?(h.to(o,.05,{yawAngleDegrees:0}),h.fromTo(o,.05,{yawAngleDegrees:0},{yawAngleDegrees:t})):A?(h.to(o,.05,{yawAngleDegrees:360}),h.fromTo(o,.05,{yawAngleDegrees:360},{yawAngleDegrees:t})):h.to(o,.1,{yawAngleDegrees:t})};return w(b,()=>V()),w([o,T,C],()=>{v.isWidgetVisible(s.value)&&se(()=>M())}),(e,t)=>(z(),oe(ie,null,[f("div",{ref_key:"compassRoot",ref:k,class:"compass"},[f("canvas",{ref_key:"canvasRef",ref:d,height:y.value,width:y.value,class:"rounded-[15%] bg-slate-950/70"},null,8,fe)],512),B(ue,{show:u(v).widgetManagerVars(u(s).hash).configMenuOpen,"onUpdate:show":t[1]||(t[1]=i=>u(v).widgetManagerVars(u(s).hash).configMenuOpen=i),class:"flex pa-4 bg-[#ffffff10] text-white backdrop-blur-2xl border-[1px] border-[#FAFAFA12]"},{default:ne(()=>[f("div",ve,[pe,f("div",he,[B(le,{modelValue:u(s).options.headingStyle,"onUpdate:modelValue":t[0]||(t[0]=i=>u(s).options.headingStyle=i),options:u(m)},null,8,["modelValue","options"])])])]),_:1},8,["show"])],64))}}),be=ce(we,[["__scopeId","data-v-758f6fd3"]]);export{be as default};
