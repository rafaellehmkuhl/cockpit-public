import{bs as T,c as D,b5 as h,s as l,J as H,R as O,Q as L,U as W,S as G,r as V,W as Y,k as c,w as x,Y as q,Z as J,l as d,m as u,n as o,t as S,F as k,p as $,a0 as y,G as i,$ as p,ab as Q,a4 as Z,ac as K,ad as X,a5 as C,av as F,a6 as M,a7 as _,_ as ee}from"./index-_zmxGxl2.js";const te=T("v-banner-text"),ae={ref:"videoWidget",class:"video-widget"},le={key:0,class:"no-video-alert"},oe={key:1,class:"no-video-alert"},ne={key:2,class:"no-video-alert"},se={class:"no-video-alert"},ie={key:3,class:"no-video-alert"},re={class:"flex-wrap justify-center d-flex ga-5"},de=D({__name:"VideoPlayer",props:{widget:{}},setup(U){h(n=>({"70fc1c24":l(t).options.videoFitStyle,a8c407dc:z.value}));const R=H(),r=O(),I=L(),{namessAvailableAbstractedStreams:f}=W(r),t=G(U).widget,s=V(),g=V(),v=V(),b=V(!1);Y(()=>{const n={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,internalStreamName:void 0};t.value.options=Object.assign({},n,t.value.options),s.value=t.value.options.internalStreamName});const m=c(()=>s.value?r.externalStreamId(s.value):void 0);x(()=>r.streamsCorrespondency,()=>v.value=void 0,{deep:!0});const P=setInterval(()=>{var n;if(t.value.options.internalStreamName===void 0&&!f.value.isEmpty()&&(t.value.options.internalStreamName=f.value[0],s.value=t.value.options.internalStreamName),m.value!==void 0){const e=r.getMediaStream(m.value);q(e,v.value)||(v.value=e);const a=((n=r.getStreamData(m.value))==null?void 0:n.connected)??!1;a!==b.value&&(b.value=a)}},1e3);J(()=>clearInterval(P)),x(s,()=>{t.value.options.internalStreamName=s.value,v.value=void 0}),x(v,()=>{!g.value||!v.value||(g.value.srcObject=v.value,g.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(n=>{const e=`Failed to play stream. Reason: ${n}`;console.error(`[VideoPlayer] ${e}`)}))});const N=n=>{t.value.options.rotationAngle+=n},j=c(()=>`scale(${t.value.options.flipHorizontally?-1:1}, ${t.value.options.flipVertically?-1:1})`),A=c(()=>`rotate(${t.value.options.rotationAngle??0}deg)`),z=c(()=>`${j.value} ${A.value}`),B=c(()=>{var n;return m.value===void 0?"Unknown.":((n=r.getStreamData(m.value))==null?void 0:n.webRtcManager.signallerStatus)??"Unknown."}),E=c(()=>{var e;if(m.value===void 0)return"Unknown.";const n=r.availableIceIps;return!n.isEmpty()&&!n.find(a=>r.allowedIceIps.includes(a))?`Stream is coming from IPs [${n.join(", ")}], which are not in the list of allowed sources
      [${r.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((e=r.getStreamData(m.value))==null?void 0:e.webRtcManager.streamStatus)??"Unknown."});return(n,e)=>(d(),u(k,null,[o("div",ae,[s.value===void 0?(d(),u("div",le,e[7]||(e[7]=[o("span",null,"No video stream selected.",-1)]))):!l(f).isEmpty()&&!l(f).includes(s.value)?(d(),u("div",oe,[o("p",null,'The selected stream "'+S(s.value)+'" is not available.',1),o("p",null,"Available ones are: "+S(l(f).map(a=>`"${a}"`).join(", "))+".",1),e[8]||(e[8]=o("br",null,null,-1)),e[9]||(e[9]=o("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),e[10]||(e[10]=o("br",null,null,-1)),e[11]||(e[11]=o("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1))])):b.value?(d(),u("div",ie,e[16]||(e[16]=[o("p",null,"Loading stream...",-1)]))):(d(),u("div",ne,[o("div",se,[o("p",null,[e[13]||(e[13]=o("span",{class:"text-xl font-bold"},"Server status: ",-1)),(d(!0),u(k,null,$(B.value.toString().split("\\n"),(a,w)=>(d(),u("span",{key:w},[y(S(a)+" ",1),e[12]||(e[12]=o("br",null,null,-1))]))),128))]),o("p",null,[e[15]||(e[15]=o("span",{class:"text-xl font-bold"},"Stream status: ",-1)),(d(!0),u(k,null,$(E.value.toString().split("\\n"),(a,w)=>(d(),u("span",{key:w},[y(S(a)+" ",1),e[14]||(e[14]=o("br",null,null,-1))]))),128))])])])),o("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:g,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(_,{modelValue:l(I).widgetManagerVars(l(t).hash).configMenuOpen,"onUpdate:modelValue":e[6]||(e[6]=a=>l(I).widgetManagerVars(l(t).hash).configMenuOpen=a),width:"auto"},{default:p(()=>[i(Q,{class:"pa-4 text-white",style:Z([{"border-radius":"15px"},l(R).globalGlassMenuStyles])},{default:p(()=>[i(K,{class:"text-center"},{default:p(()=>e[17]||(e[17]=[y("Video widget config")])),_:1}),i(X,{class:"flex flex-col gap-y-4"},{default:p(()=>[i(C,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),label:"Stream name",class:"my-3",items:l(f),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i(C,{modelValue:l(t).options.videoFitStyle,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).options.videoFitStyle=a),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(te,null,{default:p(()=>[y('Saved stream name: "'+S(l(t).options.internalStreamName)+'"',1)]),_:1}),i(F,{modelValue:l(t).options.flipHorizontally,"onUpdate:modelValue":e[2]||(e[2]=a=>l(t).options.flipHorizontally=a),class:"my-1",label:"Flip horizontally",color:l(t).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(F,{modelValue:l(t).options.flipVertically,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).options.flipVertically=a),class:"my-1",label:"Flip vertically",color:l(t).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),o("div",re,[i(M,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:e[4]||(e[4]=a=>N(-90))},{default:p(()=>e[18]||(e[18]=[y(" Rotate Left")])),_:1}),i(M,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:e[5]||(e[5]=a=>N(90))},{default:p(()=>e[19]||(e[19]=[y(" Rotate Right")])),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),me=ee(de,[["__scopeId","data-v-6d1459df"]]);export{me as default};
