import{bd as ke,be as Se,bf as Ve,bg as W,f as De,bh as de,bi as Le,bj as He,c as Ae,b7 as Oe,S as Ne,J as ze,P as $e,u as Pe,ab as Be,r as v,k as $,K as ve,L as me,W as Fe,bk as c,j as Ue,w as h,o as _e,bl as b,Z as Re,bm as Xe,as as We,bn as Ye,bo as fe,ap as Ge,Q as qe,l as V,m as pe,n as Y,q as ge,T as he,H as P,x as be,s as r,am as D,a6 as G,v as O,a4 as ye,G as B,$ as q,ad as Ze,ae as je,a0 as Ke,af as Je,ax as Qe,a7 as ea,bp as aa,F as oa,z as ta,B as la,E as na}from"./index-CDWwe4C0.js";function Te(f,y){if(f==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var l in y)Object.prototype.hasOwnProperty.call(y,l)&&(f[l]=y[l]);return f}function sa(f){return Te({},f)}var Me=1440,ia=2520,le=43200,ra=86400;function ua(f,y,l){var N,L;ke(2,arguments);var i=He(),n=(N=(L=l==null?void 0:l.locale)!==null&&L!==void 0?L:i.locale)!==null&&N!==void 0?N:Se;if(!n.formatDistance)throw new RangeError("locale must contain formatDistance property");var a=Ve(f,y);if(isNaN(a))throw new RangeError("Invalid time value");var s=Te(sa(l),{addSuffix:!!(l!=null&&l.addSuffix),comparison:a}),p,d;a>0?(p=W(y),d=W(f)):(p=W(f),d=W(y));var w=De(d,p),x=(de(d)-de(p))/1e3,u=Math.round((w-x)/60),I;if(u<2)return l!=null&&l.includeSeconds?w<5?n.formatDistance("lessThanXSeconds",5,s):w<10?n.formatDistance("lessThanXSeconds",10,s):w<20?n.formatDistance("lessThanXSeconds",20,s):w<40?n.formatDistance("halfAMinute",0,s):w<60?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",1,s):u===0?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",u,s);if(u<45)return n.formatDistance("xMinutes",u,s);if(u<90)return n.formatDistance("aboutXHours",1,s);if(u<Me){var Z=Math.round(u/60);return n.formatDistance("aboutXHours",Z,s)}else{if(u<ia)return n.formatDistance("xDays",1,s);if(u<le){var F=Math.round(u/Me);return n.formatDistance("xDays",F,s)}else if(u<ra)return I=Math.round(u/le),n.formatDistance("aboutXMonths",I,s)}if(I=Le(d,p),I<12){var U=Math.round(u/le);return n.formatDistance("xMonths",U,s)}else{var z=I%12,H=Math.floor(I/12);return z<3?n.formatDistance("aboutXYears",H,s):z<9?n.formatDistance("overXYears",H,s):n.formatDistance("almostXYears",H+1,s)}}function ca(f,y){return ke(1,arguments),ua(f,Date.now(),y)}const da=""+new URL("blueboat-marker-DyHmCFOq.png",import.meta.url).href,va=""+new URL("brov2-marker-CBzp11FX.png",import.meta.url).href,ma=""+new URL("generic-vehicle-marker-SovxT5Tc.png",import.meta.url).href,fa=["id"],ga=Ae({__name:"Map",props:{widget:{}},setup(f){var ce;Oe(e=>({55653467:Ee.value}));const y=f,l=Ne(y).widget,N=ze(),{showDialog:L}=$e(),i=Pe(),n=Be(),a=v(),s=v(15),p=v([-27.5935,-48.55854]),d=v(p.value),w=$(()=>`map-${l.value.hash}`),x=v(!1);ve.registerUsage(me.latitude),ve.registerUsage(me.longitude),Fe(()=>{Object.keys(l.value.options).length===0&&(l.value.options={showVehiclePath:!0}),g.enableAutoUpdate()});const u=c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap"}),I=c.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"© Esri World Imagery"}),Z={OpenStreetMap:u,"Esri World Imagery":I},F=v(),U=Ue(F),z=c.control.zoom({position:"bottomright"}),H=c.control.layers(Z);h(x,()=>{a.value!==void 0&&(x.value?(a.value.addControl(z),a.value.addControl(H)):(a.value.removeControl(z),a.value.removeControl(H)))}),h(U,()=>{x.value=U.value}),_e(async()=>{a.value=c.map(w.value,{layers:[u,I],attributionControl:!1}).setView(p.value,s.value),a.value.removeControl(a.value.zoomControl),a.value.on("moveend",()=>{if(a.value===void 0)return;let{lat:e,lng:o}=a.value.getCenter();e&&o&&(p.value=[e,o])}),a.value.on("zoomend",()=>{var e;a.value!==void 0&&(s.value=((e=a.value)==null?void 0:e.getZoom())??p.value)}),a.value.on("click",()=>{a.value!==void 0&&a.value.on("click",ie)}),a.value.on("contextmenu",()=>{re()}),g.enableAutoUpdate(),window.addEventListener("keydown",ue),m.value?g.goToTarget(b.VEHICLE):g.goToTarget(b.HOME)}),Re(()=>{g.disableAutoUpdate(),window.removeEventListener("keydown",ue),a.value&&(a.value.off("click",ie),a.value.off("contextmenu"))}),h(p,(e,o)=>{var t,M,T;e.toString()!==o.toString()&&((t=a.value)==null||t.panTo(e),(T=(M=E.value)==null?void 0:M.getTooltip())==null||T.setContent(`Home: ${e[0].toFixed(6)}, ${e[1].toFixed(6)}`))}),h(a,(e,o)=>{a.value!==void 0&&(e==null?void 0:e.options)===void 0&&(a.value=o)}),h(s,(e,o)=>{var t;e!==o&&((t=a.value)==null||t.setZoom(s.value))}),h(y.widget,()=>{var e;(e=a.value)==null||e.invalidateSize()});const _=v(void 0),g=new Xe(e=>_.value=e,e=>p.value=e);g.setTrackableTarget(b.VEHICLE,()=>m.value),g.setTrackableTarget(b.HOME,()=>d.value);const m=$(()=>i.coordinates.latitude?[i.coordinates.latitude,i.coordinates.longitude]:void 0),j=$(()=>{var e;return i.attitude.yaw?We((e=i.attitude)==null?void 0:e.yaw):0}),ne=$(()=>{const e=i.lastHeartbeat;return e?`${ca(e??0,{includeSeconds:!0})} ago`:"never"}),{history:we}=Ye(m);(ce=navigator==null?void 0:navigator.geolocation)==null||ce.watchPosition(e=>d.value=[e.coords.latitude,e.coords.longitude],e=>console.error(`Failed to get position: (${e.code}) ${e.message}`),{enableHighAccuracy:!1,timeout:5e3,maximumAge:0});let se=!0;h([d,a],async()=>{d.value===p.value||!a.value||!se||(g.goToTarget(b.HOME),se=!1)});const C=v();h(i.coordinates,()=>{if(!(!a.value||!m.value)){if(C.value===void 0){let e=ma;i.vehicleType===fe.MAV_TYPE_SURFACE_BOAT?e=da:i.vehicleType===fe.MAV_TYPE_SUBMARINE&&(e=va);const o=c.divIcon({className:"vehicle-marker",html:`<img src="${e}" style="width: 64px; height: 64px;">`,iconSize:[64,64],iconAnchor:[32,32]});C.value=c.marker(m.value,{icon:o});const t=c.tooltip({content:"No data available",className:"waypoint-tooltip",offset:[40,0]});C.value.bindTooltip(t),a.value.addLayer(C.value)}C.value.setLatLng(m.value)}}),h(m,()=>{_.value===b.VEHICLE||m.value===void 0||g.follow(b.VEHICLE)}),h([m,j,ne,()=>i.isArmed],()=>{var o,t,M,T,k;if(C.value===void 0)return;(T=C.value.getTooltip())==null||T.setContent(`
    <p>Coordinates: ${(o=m.value)==null?void 0:o[0].toFixed(6)}, ${(t=m.value)==null?void 0:t[1].toFixed(6)}</p>
    <p>Velocity: ${((M=i.velocity.ground)==null?void 0:M.toFixed(2))??"N/A"} m/s</p>
    <p>Heading: ${j.value.toFixed(2)}°</p>
    <p>${i.isArmed?"Armed":"Disarmed"}</p>
    <p>Last seen: ${ne.value}</p>
  `);const e=(k=C.value.getElement())==null?void 0:k.querySelector("img");e&&(e.style.transform=`rotate(${j.value}deg)`)});const E=v();h(d,()=>{if(a.value===void 0)return;const e=d.value;if(e!==void 0){if(E.value===void 0){E.value=c.marker(e);const o=c.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:"H"});E.value.setIcon(o);const t=c.tooltip({content:"No data available",className:"waypoint-tooltip"});E.value.bindTooltip(t),a.value.addLayer(E.value)}E.value.setLatLng(d.value)}});const K=v();h(n.currentPlanningWaypoints,e=>{if(a.value!==void 0){if(K.value===void 0){const o=e.map(t=>t.coordinates);K.value=c.polyline(o,{color:"#358AC3"}).addTo(a.value)}K.value.setLatLngs(e.map(o=>o.coordinates)),e.forEach((o,t)=>{var k;const M=c.marker(o.coordinates),T=c.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16],html:`${t}`});M.setIcon(T),(k=a.value)==null||k.addLayer(M)})}});const J=v();h(we,e=>{if(a.value===void 0||e===void 0)return;J.value===void 0&&(J.value=c.polyline([],{color:"#358AC3"}).addTo(a.value));const o=e.filter(t=>t.snapshot!==void 0).map(t=>t.snapshot);J.value.setLatLngs(o)});const R=v(!1),A=v(null),X=Ge({top:"0px",left:"0px"}),S=v(),ie=e=>{var o,t,M,T;if(S.value!==void 0&&a.value!==void 0&&((o=S.value)==null||o.removeFrom(a.value)),((t=e==null?void 0:e.latlng)==null?void 0:t.lat)!=null&&((M=e==null?void 0:e.latlng)==null?void 0:M.lng)!=null){A.value=[e.latlng.lat,e.latlng.lng],R.value=!0;const k=(T=a.value)==null?void 0:T.getContainer();if(k){const{x:oe,y:te}=k.getBoundingClientRect();X.left=`${e.originalEvent.clientX-oe}px`,X.top=`${e.originalEvent.clientY-te}px`}}else console.error("Invalid event structure:",e);if(a.value!==void 0){S.value=c.marker(A.value);const k=c.divIcon({className:"marker-icon",iconSize:[32,32],iconAnchor:[16,16]});S.value.setIcon(k),a.value.addLayer(S.value)}},xe=e=>{switch(e){case"goto":if(A.value){const k=i.coordinates.altitude??0,oe=A.value[0],te=A.value[1];ta(()=>{i.goTo(0,0,0,0,oe,te,k)},{command:"GoTo"},la(na.GOTO))}break;default:console.warn("Unknown menu option selected:",e)}R.value=!1},re=()=>{R.value=!1,A.value=null,a.value!==void 0&&S.value!==void 0&&a.value.removeLayer(S.value)},ue=e=>{e.key==="Escape"&&re()},Q=v(!1),ee=v(0),Ie=async()=>{for(Q.value=!0,ee.value=0;n.currentPlanningWaypoints.length>0;)n.currentPlanningWaypoints.pop();const e=async o=>{ee.value=o};try{(await i.fetchMission(e)).forEach(t=>{n.currentPlanningWaypoints.push(t),L({variant:"success",message:"Mission download succeed!",timer:2e3})})}catch(o){L({variant:"error",title:"Mission download failed",message:o,timer:5e3})}finally{Q.value=!1}},Ce=()=>{i.startMission()},ae=qe(),Ee=$(()=>`${Math.max(-ae.widgetClearanceForVisibleArea(l.value).bottom,0)}px`);return(e,o)=>(V(),pe(oa,null,[Y("div",{ref_key:"mapBase",ref:F,class:"page-base"},[Y("div",{id:w.value,ref_key:"map",ref:a,class:"map"},[x.value?ge((V(),P(G,{key:0,class:be(["absolute left-0 m-3 bottom-button bg-slate-50",d.value?"":"active-events-on-disabled"]),color:_.value==r(b).HOME?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-home-map-marker",size:"x-small",disabled:!d.value,onClick:o[0]||(o[0]=D(t=>r(g).goToTarget(r(b).HOME,!0),["stop"])),onDblclick:o[1]||(o[1]=D(t=>r(g).follow(r(b).HOME),["stop"]))},null,8,["class","color","disabled"])),[[he,d.value?void 0:"Home position is currently undefined"]]):O("",!0),x.value?ge((V(),P(G,{key:1,class:be(["absolute m-3 bottom-button left-10 bg-slate-50",m.value?"":"active-events-on-disabled"]),color:_.value==r(b).VEHICLE?"red":"",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-airplane-marker",size:"x-small",disabled:!m.value,onClick:o[2]||(o[2]=D(t=>r(g).goToTarget(r(b).VEHICLE,!0),["stop"])),onDblclick:o[3]||(o[3]=D(t=>r(g).follow(r(b).VEHICLE),["stop"]))},null,8,["class","color","disabled"])),[[he,m.value?void 0:"Vehicle position is currently undefined"]]):O("",!0),x.value?(V(),P(G,{key:2,class:"absolute m-3 bottom-button left-20 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-download",size:"x-small",onClick:D(Ie,["stop"])})):O("",!0),x.value?(V(),P(G,{key:3,class:"absolute mb-3 ml-1 bottom-button left-32 bg-slate-50",elevation:"2",style:{"z-index":"1002","border-radius":"0px"},icon:"mdi-play",size:"x-small",onClick:D(Ce,["stop"])})):O("",!0)],8,fa)],512),R.value?(V(),pe("div",{key:0,class:"context-menu",style:ye({top:X.top,left:X.left})},[Y("ul",{onClick:o[5]||(o[5]=D(()=>{},["stop"]))},[Y("li",{onClick:o[4]||(o[4]=t=>xe("goto"))},"GoTo")])],4)):O("",!0),B(ea,{modelValue:r(ae).widgetManagerVars(r(l).hash).configMenuOpen,"onUpdate:modelValue":o[7]||(o[7]=t=>r(ae).widgetManagerVars(r(l).hash).configMenuOpen=t),width:"auto"},{default:q(()=>[B(Ze,{class:"pa-2",style:ye(r(N).globalGlassMenuStyles)},{default:q(()=>[B(je,{class:"text-center"},{default:q(()=>[Ke("Map widget settings")]),_:1}),B(Je,null,{default:q(()=>[B(Qe,{modelValue:r(l).options.showVehiclePath,"onUpdate:modelValue":o[6]||(o[6]=t=>r(l).options.showVehiclePath=t),class:"my-1",label:"Show vehicle path",color:r(l).options.showVehiclePath?"white":void 0,"hide-details":""},null,8,["modelValue","color"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"]),Q.value?(V(),P(aa,{key:1,"model-value":ee.value,height:"10",absolute:"",bottom:"",color:"white"},null,8,["model-value"])):O("",!0)],64))}});export{ga as default};
