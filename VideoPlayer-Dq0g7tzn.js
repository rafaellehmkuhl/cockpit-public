import{bE as E,d as T,a_ as A,b as o,A as D,z as H,a2 as O,a4 as L,a3 as Y,q as V,a7 as q,a9 as G,aa as K,G as W,v as I,l as h,o as d,c as u,a as l,t as g,J as w,K as N,L as f,i,H as m,R as J,I as Q,aj as X,S as Z,ac as $,as as M,P as C,Y as ee,$ as te,a0 as ae,a1 as oe}from"./index-DPRnBnW8.js";const le=E("v-banner-text"),r=y=>(te("data-v-89a8b1f2"),y=y(),ae(),y),se={ref:"videoWidget",class:"video-widget"},ne={key:0,class:"no-video-alert"},ie=r(()=>l("span",null,"No video stream selected.",-1)),re=[ie],de={key:1,class:"no-video-alert"},ue=r(()=>l("br",null,null,-1)),ce=r(()=>l("p",null," This can happen if you changed vehicles and the stream name in the new one is different from the former, or if the source is not available at all. ",-1)),pe=r(()=>l("br",null,null,-1)),me=r(()=>l("p",null," Please open this video player configuration and select a new stream from the ones available, or check your source for issues. ",-1)),ve={key:2,class:"no-video-alert"},fe={class:"no-video-alert"},ye=r(()=>l("span",{class:"text-xl font-bold"},"Server status: ",-1)),he=r(()=>l("br",null,null,-1)),ge=r(()=>l("span",{class:"text-xl font-bold"},"Stream status: ",-1)),Se=r(()=>l("br",null,null,-1)),_e={key:3,class:"no-video-alert"},Ve=r(()=>l("p",null,"Loading stream...",-1)),be=[Ve],we={class:"flex-wrap justify-center d-flex ga-5"},xe=T({__name:"VideoPlayer",props:{widget:{}},setup(y){A(s=>({"85806f6c":o(e).options.videoFitStyle,"6a3c3924":j.value}));const F=D(),c=H(),x=O(),{namesAvailableStreams:p}=L(c),e=Y(y).widget,n=V(),S=V(),v=V(),b=V(!1);q(()=>{const s={videoFitStyle:"cover",flipHorizontally:!1,flipVertically:!1,rotationAngle:0,streamName:void 0};e.value.options=Object.assign({},s,e.value.options),n.value=e.value.options.streamName});const P=setInterval(()=>{var a;e.value.options.streamName===void 0&&!p.value.isEmpty()&&(e.value.options.streamName=p.value[0],n.value=e.value.options.streamName,p.value.length>1&&G.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
        If you want to change it, please open the widget configuration on the edit-menu.`,icon:"info",confirmButtonText:"OK"}));const s=c.getMediaStream(e.value.options.streamName);K(s,v.value)||(v.value=s);const t=((a=c.getStreamData(e.value.options.streamName))==null?void 0:a.connected)??!1;t!==b.value&&(b.value=t)},1e3);W(()=>clearInterval(P)),I(n,()=>{e.value.options.streamName=n.value,v.value=void 0}),I(v,()=>{!S.value||!v.value||(S.value.srcObject=v.value,S.value.play().then(()=>console.log("[VideoPlayer] Stream is playing")).catch(s=>{const t=`Failed to play stream. Reason: ${s}`;console.error(`[VideoPlayer] ${t}`)}))});const k=s=>{e.value.options.rotationAngle+=s},R=h(()=>`scale(${e.value.options.flipHorizontally?-1:1}, ${e.value.options.flipVertically?-1:1})`),U=h(()=>`rotate(${e.value.options.rotationAngle??0}deg)`),j=h(()=>`${R.value} ${U.value}`),z=h(()=>{var s;return n.value===void 0?"Unknown.":((s=c.getStreamData(n.value))==null?void 0:s.webRtcManager.signallerStatus)??"Unknown."}),B=h(()=>{var t;if(n.value===void 0)return"Unknown.";const s=c.availableIceIps;return!s.isEmpty()&&!s.find(a=>c.allowedIceIps.includes(a))?`Stream is coming from IPs [${s.join(", ")}], which are not in the list of allowed sources
      [${c.allowedIceIps.join(", ")}].\\n Please check your configuration.`:((t=c.getStreamData(n.value))==null?void 0:t.webRtcManager.streamStatus)??"Unknown."});return(s,t)=>(d(),u(w,null,[l("div",se,[n.value===void 0?(d(),u("div",ne,re)):!o(p).isEmpty()&&!o(p).includes(n.value)?(d(),u("div",de,[l("p",null,'The selected stream "'+g(n.value)+'" is not available.',1),l("p",null,"Available ones are: "+g(o(p).map(a=>`"${a}"`).join(", "))+".",1),ue,ce,pe,me])):b.value?(d(),u("div",_e,be)):(d(),u("div",ve,[l("div",fe,[l("p",null,[ye,(d(!0),u(w,null,N(z.value.toString().split("\\n"),(a,_)=>(d(),u("span",{key:_},[f(g(a)+" ",1),he]))),128))]),l("p",null,[ge,(d(!0),u(w,null,N(B.value.toString().split("\\n"),(a,_)=>(d(),u("span",{key:_},[f(g(a)+" ",1),Se]))),128))])])])),l("video",{id:"mainDisplayStream",ref_key:"videoElement",ref:S,muted:"",autoplay:"",playsinline:"",disablePictureInPicture:""}," Your browser does not support the video tag. ",512)],512),i(ee,{modelValue:o(x).widgetManagerVars(o(e).hash).configMenuOpen,"onUpdate:modelValue":t[6]||(t[6]=a=>o(x).widgetManagerVars(o(e).hash).configMenuOpen=a),width:"auto"},{default:m(()=>[i(J,{class:"pa-4 text-white",style:Q([{"border-radius":"15px"},o(F).globalGlassMenuStyles])},{default:m(()=>[i(X,{class:"text-center"},{default:m(()=>[f("Video widget config")]),_:1}),i(Z,{class:"flex flex-col gap-y-4"},{default:m(()=>[i($,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),label:"Stream name",class:"my-3",items:o(p),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue","items"]),i($,{modelValue:o(e).options.videoFitStyle,"onUpdate:modelValue":t[1]||(t[1]=a=>o(e).options.videoFitStyle=a),label:"Fit style",class:"my-3",items:["cover","fill","contain"],"item-title":"style",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":""},null,8,["modelValue"]),i(le,null,{default:m(()=>[f('Saved stream name: "'+g(o(e).options.streamName)+'"',1)]),_:1}),i(M,{modelValue:o(e).options.flipHorizontally,"onUpdate:modelValue":t[2]||(t[2]=a=>o(e).options.flipHorizontally=a),class:"my-1",label:"Flip horizontally",color:o(e).options.flipHorizontally?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),i(M,{modelValue:o(e).options.flipVertically,"onUpdate:modelValue":t[3]||(t[3]=a=>o(e).options.flipVertically=a),class:"my-1",label:"Flip vertically",color:o(e).options.flipVertically?"white":void 0,"hide-details":""},null,8,["modelValue","color"]),l("div",we,[i(C,{"prepend-icon":"mdi-file-rotate-left",variant:"outlined",onClick:t[4]||(t[4]=a=>k(-90))},{default:m(()=>[f(" Rotate Left")]),_:1}),i(C,{"prepend-icon":"mdi-file-rotate-right",variant:"outlined",onClick:t[5]||(t[5]=a=>k(90))},{default:m(()=>[f(" Rotate Right")]),_:1})])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ne=oe(xe,[["__scopeId","data-v-89a8b1f2"]]);export{Ne as default};
