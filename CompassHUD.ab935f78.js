import{d as Y,S as z,j as H,D as O,u as $,U as j,k as m,an as q,Z as G,q as I,ao as Z,i as J,m as y,aq as F,ar as K,at as Q,o as ee,c as ae,a as P,f as l,a2 as r,ah as te,aj as oe,a3 as E,au as se,av as M,b as s,a7 as ne,a4 as le,as as ie,ab as re}from"./index.d573d5d2.js";import{w as C}from"./index.72130098.js";import{g as ue}from"./index.26c17e5e.js";import{V as de,a as ce,b as fe,c as he,d as ge}from"./VExpansionPanel.b76bfea5.js";const pe={class:"main"},ve=["width","height"],we=Y({__name:"CompassHUD",props:{widget:{}},setup(k){const U=z();H.registerUsage(O.heading);const N=$(),a=j(k).widget,R=m([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]),X=e=>{switch(e){case-180:return"S";case-135:return"SW";case-90:return"W";case-45:return"NW";case 0:return"N";case 45:return"NE";case 90:return"E";case 135:return"SE";case 180:return"S";case 225:return"SW";case 270:return"W";case 315:return"NW";case 360:return"N";default:return`${e}\xB0`}},c=q({yawLinesX:{}}),V=[];let S=-180;for(;S<181;)V.push(S),S+=3;G(()=>{Object.keys(a.value.options).length===0&&(a.value.options={showYawValue:!0,hudColor:R.value[0][0],useNegativeRange:!1})}),I(()=>{V.forEach(e=>c.yawLinesX[e]=W(e)),D()});const{width:A}=Z(),u=J(()=>({width:a.value.size.width*A.value,height:64})),p=m(0);let T;y(N.attitude,e=>{Math.abs(F(e.yaw-(T||0)))>.1&&(T=e.yaw,p.value=F(N.attitude.yaw))});const W=e=>{let o=-(e-p.value||0);return o<-180?o+=360:o>180&&(o-=360),-o},v=m(),x=m(),D=()=>{if(v.value===void 0||v.value===null)return;if(x.value===void 0){console.debug("Canvas context undefined!"),x.value=v.value.getContext("2d");return}const e=x.value;K(e);const t=.5*u.value.width,o=.5*u.value.height,b=12,d=16,f=10,n=2,L=7;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${b}px Arial`,e.fillStyle="white";for(const[i,_]of Object.entries(c.yawLinesX)){if(_<-90||_>90)continue;const B=2*t/Math.PI*Math.sin(ie(_)),w=t+B;if(e.beginPath(),e.moveTo(w,d+n+f+n),e.lineTo(w,o*2-b-n-L),e.lineWidth="1",Number(i)%15===0){e.lineWidth="2",e.lineTo(w,o*2-b-n);let g=Number(i);a.value.options.useNegativeRange||(g=g<0?g+360:g),e.fillText(X(Number(g)),w,o*2-n)}e.stroke()}if(a.value.options.showYawValue){e.font=`bold ${d}px Arial`;let i=Number(p.value);a.value.options.useNegativeRange||(i=i<0?i+360:i),e.fillText(`${i.toFixed(1)}\xB0`,t,d)}e.beginPath(),e.moveTo(t,d+n+f),e.lineTo(t-.5*f,n+d+n),e.lineTo(t+.5*f,n+d+n),e.lineTo(t,d+n+f),e.closePath(),e.fill(),e.globalCompositeOperation="source-in";const h=e.createLinearGradient(0,o,u.value.width,o);h.addColorStop(.18,C(a.value.options.hudColor).alpha(0).toRgbString()),h.addColorStop(.3,C(a.value.options.hudColor).alpha(1).toRgbString()),h.addColorStop(.7,C(a.value.options.hudColor).alpha(1).toRgbString()),h.addColorStop(.82,C(a.value.options.hudColor).alpha(0).toRgbString()),e.fillStyle=h,e.fillRect(0,0,u.value.width,o*2)};return y(p,()=>{V.forEach(e=>{const t=W(e);Math.abs(c.yawLinesX[e]-t)>90?c.yawLinesX[e]=t:ue.to(c.yawLinesX,{duration:2.5,ease:"elastic.out(1.2, 0.5)",[e]:t})})}),y([c,u,a.value.options],()=>{!U.isWidgetVisible(a.value)||Q(()=>D())}),(e,t)=>(ee(),ae(le,null,[P("div",pe,[P("canvas",{ref_key:"canvasRef",ref:v,width:u.value.width,height:u.value.height},null,8,ve)]),l(ne,{modelValue:s(a).managerVars.configMenuOpen,"onUpdate:modelValue":t[3]||(t[3]=o=>s(a).managerVars.configMenuOpen=o),"min-width":"400","max-width":"35%"},{default:r(()=>[l(te,{class:"pa-2"},{default:r(()=>[l(oe,null,{default:r(()=>[E("HUD Compass widget config")]),_:1}),l(se,null,{default:r(()=>[l(M,{class:"ma-1",label:"Show yaw value",color:s(a).options.showYawValue?"rgb(0, 20, 80)":void 0,"model-value":s(a).options.showYawValue,"hide-details":"",onChange:t[0]||(t[0]=o=>s(a).options.showYawValue=!s(a).options.showYawValue)},null,8,["color","model-value"]),l(M,{class:"ma-1",label:"Use -180/+180 range",color:s(a).options.useNegativeRange?"rgb(0, 20, 80)":void 0,"model-value":s(a).options.useNegativeRange,"hide-details":"",onChange:t[1]||(t[1]=o=>s(a).options.useNegativeRange=!s(a).options.useNegativeRange)},null,8,["color","model-value"]),l(de,null,{default:r(()=>[l(ce,null,{default:r(()=>[l(fe,null,{default:r(()=>[E("Color")]),_:1}),l(he,null,{default:r(()=>[l(ge,{modelValue:s(a).options.hudColor,"onUpdate:modelValue":t[2]||(t[2]=o=>s(a).options.hudColor=o),class:"ma-2",swatches:R.value,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const be=re(we,[["__scopeId","data-v-f2175354"]]);export{be as default};
