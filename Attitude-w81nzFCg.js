import{d as X,a2 as Z,A as ee,p as N,D as W,u as te,a3 as oe,q as f,am as ae,a7 as se,x as le,C as ie,l as E,an as R,v as w,ao as b,ap as ne,aq as re,ar as d,ag as $,F as he,o as ue,c as de,a as C,i as l,H as c,R as ce,I as pe,b as a,aj as ve,L as z,S as ge,as as k,at as I,au as me,Y as fe,J as we,$ as be,a0 as Ve,a1 as xe}from"./index-DzaIPgBs.js";import{g as U}from"./index-ZORhgBxb.js";import{V as Ce,a as Fe,b as Se,c as Pe}from"./VExpansionPanel-NeEQ_0zK.js";const Te=g=>(be("data-v-3cafbe5c"),g=g(),Ve(),g),Ae={class:"main"},De=["width","height"],Re={class:"flex justify-center gap-x-8 mb-4"},ke=Te(()=>C("span",{class:"ml-2"},"Distance between pitch lines",-1)),Le=X({__name:"Attitude",props:{widget:{}},setup(g){const F=Z(),B=ee();N.registerUsage(W.roll),N.registerUsage(W.pitch);const V=te(),t=oe(g).widget,m=f(),S=f(),x=f(0),P=f(0),L=[-90,-70,-45,-30,-10,0,10,30,45,70,90],p=ae({rollDegrees:0,pitchLinesHeights:{}}),_=f([["#FFFFFF"],["#FF2D2D"],["#0ADB0ACC"]]);se(()=>{Object.keys(t.value.options).length===0&&(t.value.options={showCenterAim:!0,showPitchLines:!0,showRollPitchValues:!0,desiredAimRadius:150,pitchHeightFactor:300,hudColor:_.value[0][0]})}),le(()=>{L.forEach(e=>p.pitchLinesHeights[e]=5*e),T()});const{width:O,height:j}=ie(),r=E(()=>({width:t.value.size.width*O.value,height:t.value.size.height*j.value})),i=E(()=>R(t.value.options.desiredAimRadius,35,.2*r.value.width));let y,H;w(V.attitude,e=>{const o=Math.abs(b(e.roll-(y||0))),s=Math.abs(b(e.pitch-(H||0)));o>.1&&(y=e.roll,x.value=b(V.attitude.roll)),s>.1&&(H=e.pitch,P.value=b(V.attitude.pitch))});const q=e=>t.value.options.pitchHeightFactor*d(e)/Math.cos(d(e)),G=ne(m);w(G,(e,o)=>{e&&!o&&T()});const T=()=>{if(m.value===void 0||m.value===null)return;if(S.value===void 0){console.debug("Canvas context undefined!"),S.value=m.value.getContext("2d");return}const e=S.value;re(e);const o=.5*r.value.width,s=.5*r.value.height,Y=12,A=22,v=2;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${Y}px Arial`,e.fillStyle="white";const h=2*i.value;e.translate(o,s),e.rotate(-d(p.rollDegrees));for(const[u,n]of Object.entries(p.pitchLinesHeights)){e.beginPath();const J=Number(u)===0?1:.7,K=Number(u)===0?[]:[5,2],Q=Number(u)===0?3:2;if(e.lineWidth=Q,e.setLineDash(K),t.value.options.showPitchLines){const M=h+J*(o-h);e.moveTo(-M+v,n),e.lineTo(-h,n),e.lineTo(-h+5,n+15),e.fillText(Number(u),-h-4*v,n-3*v),e.moveTo(+M-v,n),e.lineTo(h,n),e.lineTo(h-5,n+15),e.fillText(Number(u),h+4*v,n-3*v),e.stroke()}}if(e.lineWidth=3,e.setLineDash([]),e.font=`bold ${A}px Arial`,t.value.options.showCenterAim&&(e.beginPath(),e.moveTo(-i.value,0),e.lineTo(-1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,d(135),d(225)),e.stroke(),e.beginPath(),e.moveTo(i.value,0),e.lineTo(1.5*i.value,0),e.stroke(),e.beginPath(),e.arc(0,0,i.value,d(-45),d(45)),e.stroke()),t.value.options.showRollPitchValues){const u=`r: ${Number(x.value).toFixed(2)}`,n=`p: ${Number(P.value).toFixed(2)}`;e.rotate(d(-p.rollDegrees)),i.value<200?(e.fillText(u,0,R(-1.5*i.value,-.8*s,0)),e.fillText(n,0,R(1.5*i.value,0,.8*s))):(e.textAlign="start",e.fillText(u,-i.value+A,-30),e.fillText(n,-i.value+A,30)),e.stroke()}e.translate(-o,-s),e.globalCompositeOperation="source-in";const D=e.createLinearGradient(0,0,r.value.width,r.value.height);D.addColorStop(0,t.value.options.hudColor),D.addColorStop(1,t.value.options.hudColor),e.fillStyle=D,e.fillRect(0,0,r.value.width,r.value.height)};return w(P,()=>{L.forEach(e=>{const o=-$(q(e-b(V.attitude.pitch)),2);U.to(p.pitchLinesHeights,.1,{[e]:o})})}),w(x,()=>{U.to(p,.1,{rollDegrees:-$(x.value,2)})}),w([p,r,t.value.options],()=>{F.isWidgetVisible(t.value)&&he(()=>T())}),(e,o)=>(ue(),de(we,null,[C("div",Ae,[C("canvas",{ref_key:"canvasRef",ref:m,width:r.value.width,height:r.value.height},null,8,De)]),l(fe,{modelValue:a(F).widgetManagerVars(a(t).hash).configMenuOpen,"onUpdate:modelValue":o[6]||(o[6]=s=>a(F).widgetManagerVars(a(t).hash).configMenuOpen=s),"min-width":"400","max-width":"45%"},{default:c(()=>[l(ce,{class:"pa-4",style:pe([a(B).globalGlassMenuStyles,{"border-radius":"15px"}])},{default:c(()=>[l(ve,{class:"text-center"},{default:c(()=>[z("Attitude widget config")]),_:1}),l(ge,null,{default:c(()=>[C("div",Re,[l(k,{class:"ma-1",label:"Show roll/pitch values","model-value":a(t).options.showRollPitchValues,color:a(t).options.showRollPitchValues?"white":void 0,"hide-details":"",onChange:o[0]||(o[0]=s=>a(t).options.showRollPitchValues=!a(t).options.showRollPitchValues)},null,8,["model-value","color"]),l(k,{class:"ma-1",label:"Show center aim","model-value":a(t).options.showCenterAim,color:a(t).options.showCenterAim?"white":void 0,"hide-details":"",onChange:o[1]||(o[1]=s=>a(t).options.showCenterAim=!a(t).options.showCenterAim)},null,8,["model-value","color"]),l(k,{class:"ma-1",label:"Show pitch lines","model-value":a(t).options.showPitchLines,color:a(t).options.showPitchLines?"white":void 0,"hide-details":"",onChange:o[2]||(o[2]=s=>a(t).options.showPitchLines=!a(t).options.showPitchLines)},null,8,["model-value","color"])]),ke,l(I,{modelValue:a(t).options.pitchHeightFactor,"onUpdate:modelValue":o[3]||(o[3]=s=>a(t).options.pitchHeightFactor=s),label:"Pitch lines gain factor",color:"white",min:1,max:2500,"thumb-label":"",class:"mt-3"},null,8,["modelValue"]),l(I,{modelValue:a(t).options.desiredAimRadius,"onUpdate:modelValue":o[4]||(o[4]=s=>a(t).options.desiredAimRadius=s),label:"Center circle radius",color:"white",min:10,max:300,"thumb-label":""},null,8,["modelValue"]),l(Ce,{theme:"dark"},{default:c(()=>[l(Fe,{class:"bg-[#FFFFFF22]"},{default:c(()=>[l(Se,null,{default:c(()=>[z("Color")]),_:1}),l(Pe,{class:"pa-2"},{default:c(()=>[l(me,{modelValue:a(t).options.hudColor,"onUpdate:modelValue":o[5]||(o[5]=s=>a(t).options.hudColor=s),class:"ma-1 bg-[#FFFFFF11] text-white",swatches:_.value,"show-swatches":"",width:"100%"},null,8,["modelValue","swatches"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue"])],64))}}),Ne=xe(Le,[["__scopeId","data-v-3cafbe5c"]]);export{Ne as default};
