import{d as E,p as O,q as P,D as F,u as I,y as m,v as z,x as $,C as j,au as H,l as q,ap as L,aq as l,av as X,z as T,ao as k,am as Y,L as G,o as J,c as K,a as d,i as R,A as Q,B as Z,b as i,F as ee,a3 as ae,a4 as te,a5 as se}from"./index-PX6SlQGo.js";import{g as r}from"./index-ZORhgBxb.js";import{_ as oe}from"./Dialog.vue_vue_type_style_index_0_lang-DFzAQRm2.js";const ne=o=>(ae("data-v-b5f35b8a"),o=o(),te(),o),le=["height","width"],ie={class:"flex items-center"},re=ne(()=>d("span",{class:"mr-3 text-slate-100"},"Heading style",-1)),de={class:"w-40"};var M=(o=>(o.NORTH_UP="North Up",o.HEAD_UP="Head Up",o))(M||{});const ge=E({__name:"Compass",props:{widget:{}},setup(o){const y=O();P.registerUsage(F.heading);const b=I(),C=m(),g=m(),A=m(),U={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},W=Object.values(M),n=z(o).widget;$(()=>{Object.keys(n.value.options).length===0&&(n.value.options={headingStyle:W[0]})}),j(()=>{V(),N()});const{width:D,height:x}=H(C),c=q(()=>D.value<x.value?D.value:x.value),N=()=>{if(g.value===void 0||g.value===null)return;A.value===void 0&&(A.value=g.value.getContext("2d"));const e=A.value;L(e);const a=.5*c.value,s=.13*c.value,p=.03*a;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${s}px Arial`,e.fillStyle="white",e.lineWidth=p,e.textBaseline="middle";const v=.7*a,S=.4*a,_=.55*a;e.translate(a,a),e.font=`bold ${s}px Arial`,e.fillText(`${t.yawAngleDegrees.toFixed(0)}Â°`,.15*s,0),e.rotate(l(-90)),n.value.options.headingStyle=="Head Up"&&e.rotate(-l(t.yawAngleDegrees));for(const[w,B]of Object.entries(U))e.save(),e.rotate(l(Number(w))),e.beginPath(),e.moveTo(_,0),e.lineTo(v,0),e.textBaseline="bottom",e.font=`bold ${.7*s}px Arial`,e.translate(v*1.025,0),e.rotate(l(90)),e.fillText(B,0,0),e.stroke(),e.restore();for(const w of X(360))w%9===0&&(e.save(),e.lineWidth=.25*p,e.rotate(l(Number(w))),e.beginPath(),e.moveTo(1.1*_,0),e.lineTo(v,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,v,0,l(360)),e.stroke(),n.value.options.headingStyle=="North Up"?e.rotate(l(t.yawAngleDegrees)):e.rotate(l(t.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const h=.05*a;e.moveTo(S,h),e.lineTo(_-.5*h,0),e.lineTo(S,-h),e.lineTo(S,h),e.closePath(),e.fill(),e.stroke()},f=m(.01);let u;T(b.attitude,e=>{if(u===void 0){f.value=k(b.attitude.yaw),u=e.yaw;return}Math.abs(k(e.yaw-u))>.1&&(u=e.yaw,f.value=k(b.attitude.yaw))});const t=Y({yawAngleDegrees:0}),V=()=>{const e=f.value,a=e<0?e+360:e,s=t.yawAngleDegrees>270&&a<90,p=t.yawAngleDegrees<90&&a>270;s?(r.to(t,.05,{yawAngleDegrees:0}),r.fromTo(t,.05,{yawAngleDegrees:0},{yawAngleDegrees:a})):p?(r.to(t,.05,{yawAngleDegrees:360}),r.fromTo(t,.05,{yawAngleDegrees:360},{yawAngleDegrees:a})):r.to(t,.1,{yawAngleDegrees:a})};return T(f,()=>V()),T([t,D,x],()=>{y.isWidgetVisible(n.value)&&G(()=>N())}),(e,a)=>(J(),K(ee,null,[d("div",{ref_key:"compassRoot",ref:C,class:"compass"},[d("canvas",{ref_key:"canvasRef",ref:g,height:c.value,width:c.value,class:"rounded-[15%] bg-slate-950/70"},null,8,le)],512),R(oe,{show:i(y).widgetManagerVars(i(n).hash).configMenuOpen,"onUpdate:show":a[1]||(a[1]=s=>i(y).widgetManagerVars(i(n).hash).configMenuOpen=s),class:"flex pa-4 bg-[#ffffff10] text-white backdrop-blur-2xl border-[1px] border-[#FAFAFA12]"},{default:Q(()=>[d("div",ie,[re,d("div",de,[R(Z,{modelValue:i(n).options.headingStyle,"onUpdate:modelValue":a[0]||(a[0]=s=>i(n).options.headingStyle=s),options:i(W)},null,8,["modelValue","options"])])])]),_:1},8,["show"])],64))}}),ve=se(ge,[["__scopeId","data-v-b5f35b8a"]]);export{ve as default};
