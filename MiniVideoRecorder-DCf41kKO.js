import{x as ee,I as te,y as ae,z as oe,A as se,B as ne,C as le,E as ie,F as re,G as de,H as Y,J as ue,K as ce,L as ve,M as me,N as fe,O as ge,P as be,f as n,Q as he,w as xe,R as we,S as X,V as B,d as pe,T as ye,U as Se,W as _e,m as x,X as ke,Y as Ve,Z as Ce,s as Ne,_ as Re,p as V,j as q,$ as Be,a0 as C,a1 as Te,a2 as Me,r as Pe,o as d,c as v,a as u,n as I,b as $,a3 as _,a4 as D,a5 as z,t as H,h as K,i as O,a6 as Ie,a7 as $e,a8 as G,a9 as De,aa as Oe,ab as Ae,ac as Fe}from"./index-CmdarkP7.js";const We=ee({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:te,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...ae(),...oe({location:"top end"}),...se(),...ne(),...le(),...ie({transition:"scale-rotate-transition"})},"VBadge"),je=re()({name:"VBadge",inheritAttrs:!1,props:We(),setup(e,S){const{backgroundColorClasses:l,backgroundColorStyles:A}=de(Y(e,"color")),{roundedClasses:i}=ue(e),{t:a}=ce(),{textColorClasses:w,textColorStyles:N}=ve(Y(e,"textColor")),{themeClasses:R}=me(),{locationStyles:m}=fe(e,!0,s=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(s)?+(e.offsetY??0):["left","right"].includes(s)?+(e.offsetX??0):0));return ge(()=>{const s=Number(e.content),c=!e.max||isNaN(s)?e.content:s<=+e.max?s:`${e.max}+`,[M,f]=be(S.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return n(e.tag,X({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline},e.class]},f,{style:e.style}),{default:()=>{var g,b;return[n("div",{class:"v-badge__wrapper"},[(b=(g=S.slots).default)==null?void 0:b.call(g),n(he,{transition:e.transition},{default:()=>{var p,k;return[xe(n("span",X({class:["v-badge__badge",R.value,l.value,i.value,w.value],style:[A.value,N.value,e.inline?{}:m.value],"aria-atomic":"true","aria-label":a(e.label,s),"aria-live":"polite",role:"status"},M),[e.dot?void 0:S.slots.badge?(k=(p=S.slots).badge)==null?void 0:k.call(p):e.icon?n(B,{icon:e.icon},null):c]),[[we,e.modelValue]])]}})])]}})}),{}}}),T=e=>(Oe("data-v-26ecb075"),e=e(),Ae(),e),Ue={key:1},Ee={class:"text-xs text-white select-none scroll-text"},Le={key:3,class:"w-16 text-justify text-slate-100"},Ye={key:4,class:"w-16 text-justify text-slate-100"},Xe=T(()=>u("div",{class:"text-center text-xs text-white select-none flex-nowrap"},"Processing video...",-1)),qe=[Xe],ze={key:5,class:"flex justify-center w-8"},He={class:"p-6 m-5 bg-white rounded-md"},Ke=T(()=>u("p",{class:"text-xl font-semibold"},"Choose a stream to record",-1)),Ge=T(()=>u("div",{class:"w-auto h-px my-2 bg-grey-lighten-3"},null,-1)),Je={class:"flex items-center"},Qe=T(()=>u("span",null,"Record",-1)),Ze={key:1,class:"w-5 h-5 ml-2 rounded-full bg-red"},et=pe({__name:"MiniVideoRecorder",props:{miniWidget:{}},setup(e){const S=ye(),l=Se(),i=_e(e).miniWidget,a=x(),{namesAvailableStreams:w}=ke(l),N=x(),{isOutside:R}=Ve(N),m=x(!1),s=x(!1),c=x(!1),M=Ce({interval:100}),f=x(),g=x(!1),b=x(0);Ne(async()=>{await p()}),Re(async()=>{Object.keys(i.value.options).length===0&&(i.value.options={streamName:void 0}),a.value=i.value.options.streamName}),V(a,()=>{i.value.options.streamName=a.value,f.value=void 0});const p=async()=>{const o=await l.videoStoringDB.length(),t=Object.values(l.unprocessedVideos).filter(h=>h.dateFinish);b.value=o+t.length};function k(o){if(a.value=o,a.value===void 0){C.fire({text:"No stream selected.",icon:"error"});return}if(w.value.includes(a.value))return;const t="The selected stream is not available. Please check its source or select another stream.";throw C.fire({text:t,icon:"error"}),new Error(t)}const J=async()=>{if(y.value){a.value!==void 0&&l.stopRecording(a.value);return}if(a.value===void 0){m.value=!0;return}F()},F=()=>{k(a.value),l.startRecording(a.value),m.value=!1},y=q(()=>a.value===void 0?!1:l.isRecording(a.value)),Q=q(()=>{var j,U,E,L;if(a.value===void 0)return"00:00:00";const o=(j=l.getStreamData(a.value))==null?void 0:j.timeRecordingStart;if(o===void 0)return"00:00:00";const t=Be({start:o,end:M.value}),h=((U=t.hours)==null?void 0:U.toFixed(0).length)===1?`0${t.hours}`:t.hours,r=((E=t.minutes)==null?void 0:E.toFixed(0).length)===1?`0${t.minutes}`:t.minutes,P=((L=t.seconds)==null?void 0:L.toFixed(0).length)===1?`0${t.seconds}`:t.seconds;return`${h}:${r}:${P}`}),Z=async o=>{k(o),f.value=void 0,c.value=!0;let t=0;const h=100,r=3e3;for(;c.value&&t<r;)c.value=f.value===void 0||!f.value.active,await new Promise(P=>setTimeout(P,h)),t+=h;if(c.value){C.fire({text:"Could not load media stream.",icon:"error"});return}i.value.options.streamName=o};let W;return S.isRealMiniWidget(i.value)&&(W=setInterval(()=>{i.value.options.streamName===void 0&&!w.value.isEmpty()&&(i.value.options.streamName=w.value[0],a.value=i.value.options.streamName,w.value.length>1&&C.fire({title:"Multiple streams detected",text:`You have multiple streams available, so we chose one randomly to start with.
          If you want to change it, please open the widget configuration.`,icon:"info",confirmButtonText:"OK"}));const o=l.getMediaStream(i.value.options.streamName);Te(o,f.value)||(f.value=o)},1e3)),Me(()=>clearInterval(W)),V(()=>l.areThereVideosProcessing,o=>{g.value=o,p()}),V(()=>l.keysAllUnprocessedVideos,()=>p()),V(()=>s.value,async o=>{o===!1&&await p()}),V(y,()=>{if(!y.value){window.onbeforeunload=null;return}window.onbeforeunload=()=>(C.fire({text:`
      You have a video recording ongoing.
      Remember to stop it before closing Cockpit, or the record will be lost.
    `,icon:"warning"}),"I hope the user does not click on the leave button.")}),(o,t)=>{const h=Pe("FontAwesomeIcon");return d(),v(z,null,[u("div",{ref_key:"recorderWidget",ref:N,class:I(["flex justify-around px-2 py-1 text-center rounded-lg h-9 align-center bg-slate-800/60",{"w-48":b.value>0,"w-32":b.value<=0}])},[g.value?(d(),v("div",Ue,[n(B,{class:"w-6 h-6 animate-spin",color:"white"},{default:_(()=>[D("mdi-loading")]),_:1})])):(d(),v("div",{key:0,class:I([{"blob red w-5 opacity-100 rounded-sm":y.value,"opacity-30 bg-red-400":$(R)&&!y.value},"w-6 transition-all duration-500 rounded-full aspect-square bg-red-lighten-1 hover:cursor-pointer opacity-70 hover:opacity-90"]),onClick:t[0]||(t[0]=r=>J())},null,2)),!y.value&&!g.value?(d(),v(z,{key:2},[a.value?(d(),v("div",{key:0,class:"flex flex-col max-w-[50%] scroll-container transition-all border-blur cursor-pointer",onClick:t[1]||(t[1]=r=>m.value=!0)},[u("div",Ee,H(a.value),1)])):(d(),K(h,{key:1,icon:"fa-solid fa-video",class:"h-6 text-slate-100"}))],64)):O("",!0),y.value&&!g.value?(d(),v("div",Le,H(Q.value),1)):g.value?(d(),v("div",Ye,qe)):O("",!0),b.value>0?(d(),v("div",ze,[n(Ie,{vertical:"",class:"h-6"}),n(je,{color:"info",content:b.value,dot:$(R)||s.value,class:"cursor-pointer",onClick:t[3]||(t[3]=r=>s.value=!0)},{default:_(()=>[n(B,{class:"w-6 h-6 text-slate-100 ml-3",onClick:t[2]||(t[2]=r=>s.value=!0)},{default:_(()=>[D(" mdi-video-box ")]),_:1})]),_:1},8,["content","dot"])])):O("",!0)],2),n(G,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=r=>m.value=r),width:"auto"},{default:_(()=>[u("div",He,[Ke,Ge,n($e,{"model-value":a.value,label:"Stream name",items:$(w),"item-title":"name",density:"compact",variant:"outlined","no-data-text":"No streams available.","hide-details":"","return-object":"","onUpdate:modelValue":Z},null,8,["model-value","items"]),u("div",Je,[u("button",{class:"w-auto p-3 m-2 font-medium transition-all rounded-md shadow-md text-uppercase hover:bg-slate-100",onClick:t[4]||(t[4]=r=>m.value=!1)}," Cancel "),u("button",{class:I(["flex items-center p-3 mx-2 font-medium transition-all rounded-md shadow-md w-fit text-uppercase hover:bg-slate-100",{"bg-slate-200 opacity-30 pointer-events-none":c.value}]),onClick:F},[Qe,c.value?(d(),K(B,{key:0,class:"m-2 animate-spin"},{default:_(()=>[D("mdi-loading")]),_:1})):(d(),v("div",Ze))],2)])])]),_:1},8,["modelValue"]),n(G,{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=r=>s.value=r),width:"900px"},{default:_(()=>[n(De,{"as-video-library":""})]),_:1},8,["modelValue"])],64)}}}),at=Fe(et,[["__scopeId","data-v-26ecb075"]]);export{at as default};
