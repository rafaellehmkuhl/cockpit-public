import{d as M,aG as O,p as P,D as j,u as I,q as m,aH as $,aL as H,y as z,b2 as L,k as q,a_ as F,a$ as l,b3 as G,v as S,aZ as A,aW as K,af as X,o as Y,c as Z,a as i,h as R,B as J,aR as Q,b as r,b4 as ee,K as ae,as as te,at as se,_ as oe}from"./index-BXHW_BfD.js";import{g as c}from"./index-ZORhgBxb.js";const ne=o=>(te("data-v-04ae29b1"),o=o(),se(),o),le=["height","width"],ie={class:"w-full h-full"},re={class:"flex flex-col items-center justify-around"},ce={class:"flex items-center justify-between w-full my-1"},de=ne(()=>i("span",{class:"mr-1 text-slate-100"},"Heading style",-1)),ge={class:"w-40"};var V=(o=>(o.NORTH_UP="North Up",o.HEAD_UP="Head Up",o))(V||{});const ue=M({__name:"Compass",props:{widget:{}},setup(o){const U=O();P.registerUsage(j.heading);const y=I(),x=m(),d=m(),_=m(),B={0:"N",45:"NE",90:"E",135:"SE",180:"S",225:"SW",270:"W",315:"NW"},T=Object.values(V),n=$(o).widget;H(()=>{Object.keys(n.value.options).length===0&&(n.value.options={headingStyle:T[0]})}),z(()=>{N(),C()});const{width:k,height:W}=L(x),g=q(()=>k.value<W.value?k.value:W.value),C=()=>{if(d.value===void 0||d.value===null)return;_.value===void 0&&(_.value=d.value.getContext("2d"));const e=_.value;F(e);const a=.5*g.value,s=.13*g.value,p=.03*a;e.textAlign="center",e.strokeStyle="white",e.font=`bold ${s}px Arial`,e.fillStyle="white",e.lineWidth=p,e.textBaseline="middle";const v=.7*a,b=.4*a,D=.55*a;e.translate(a,a),e.font=`bold ${s}px Arial`,e.fillText(`${t.yawAngleDegrees.toFixed(0)}Â°`,.15*s,0),e.rotate(l(-90)),n.value.options.headingStyle=="Head Up"&&e.rotate(l(t.yawAngleDegrees));for(const[w,E]of Object.entries(B))e.save(),e.rotate(l(Number(w))),e.beginPath(),e.moveTo(D,0),e.lineTo(v,0),e.textBaseline="bottom",e.font=`bold ${.7*s}px Arial`,e.translate(v*1.025,0),e.rotate(l(90)),e.fillText(E,0,0),e.stroke(),e.restore();for(const w of G(360))w%9===0&&(e.save(),e.lineWidth=.25*p,e.rotate(l(Number(w))),e.beginPath(),e.moveTo(1.1*D,0),e.lineTo(v,0),e.stroke(),e.restore());e.beginPath(),e.arc(0,0,v,0,l(360)),e.stroke(),n.value.options.headingStyle=="North Up"?e.rotate(l(t.yawAngleDegrees)):e.rotate(-l(t.yawAngleDegrees)),e.beginPath(),e.lineWidth=1,e.strokeStyle="red",e.fillStyle="red";const h=.05*a;e.moveTo(b,h),e.lineTo(D-.5*h,0),e.lineTo(b,-h),e.lineTo(b,h),e.closePath(),e.fill(),e.stroke()},u=m(.01);let f;S(y.attitude,e=>{if(f===void 0){u.value=A(y.attitude.yaw),f=e.yaw;return}Math.abs(A(e.yaw-f))>.1&&(f=e.yaw,u.value=A(y.attitude.yaw))});const t=K({yawAngleDegrees:0}),N=()=>{const e=u.value,a=e<0?e+360:e,s=t.yawAngleDegrees>270&&a<90,p=t.yawAngleDegrees<90&&a>270;s?(c.to(t,.05,{yawAngleDegrees:0}),c.fromTo(t,.05,{yawAngleDegrees:0},{yawAngleDegrees:a})):p?(c.to(t,.05,{yawAngleDegrees:360}),c.fromTo(t,.05,{yawAngleDegrees:360},{yawAngleDegrees:a})):c.to(t,.1,{yawAngleDegrees:a})};return S(u,()=>N()),S(t,()=>{U.isWidgetVisible(n.value)&&X(()=>C())}),(e,a)=>(Y(),Z(ae,null,[i("div",{ref_key:"compassRoot",ref:x,class:"compass"},[i("canvas",{ref_key:"canvasRef",ref:d,height:g.value,width:g.value,class:"rounded-[15%] bg-red-600"},null,8,le)],512),R(ee,{show:r(n).managerVars.configMenuOpen,"onUpdate:show":a[1]||(a[1]=s=>r(n).managerVars.configMenuOpen=s),class:"w-72"},{default:J(()=>[i("div",ie,[i("div",re,[i("div",ce,[de,i("div",ge,[R(Q,{modelValue:r(n).options.headingStyle,"onUpdate:modelValue":a[0]||(a[0]=s=>r(n).options.headingStyle=s),options:r(T)},null,8,["modelValue","options"])])])])])]),_:1},8,["show"])],64))}}),he=oe(ue,[["__scopeId","data-v-04ae29b1"]]);export{he as default};
